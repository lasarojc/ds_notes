


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Coordena√ß√£o - Notas em Sistemas Distribu√≠dos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coordenacao" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribu√≠dos" class="md-header-nav__button md-logo" aria-label="Notas em Sistemas Distribu√≠dos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Notas em Sistemas Distribu√≠dos
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Coordena√ß√£o
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribu√≠dos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribu√≠dos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Notas em Sistemas Distribu√≠dos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Pr√≥logo" class="md-nav__link">
      Pr√≥logo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intro/" title="Introdu√ß√£o" class="md-nav__link">
      Introdu√ß√£o
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../basics/" title="Fundamentos" class="md-nav__link">
      Fundamentos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../comm/" title="Comunica√ß√£o" class="md-nav__link">
      Comunica√ß√£o
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../arch/" title="Arquiteturas" class="md-nav__link">
      Arquiteturas
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Coordena√ß√£o
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Coordena√ß√£o" class="md-nav__link md-nav__link--active">
      Coordena√ß√£o
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exclusao-mutua" class="md-nav__link">
    Exclus√£o M√∫tua
  </a>
  
    <nav class="md-nav" aria-label="Exclus√£o M√∫tua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coordenador" class="md-nav__link">
    Coordenador
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anel" class="md-nav__link">
    Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lidando-com-falhas" class="md-nav__link">
    Lidando com Falhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quorum" class="md-nav__link">
    Qu√≥rum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eleicao-de-lideres" class="md-nav__link">
    Elei√ß√£o de L√≠deres
  </a>
  
    <nav class="md-nav" aria-label="Elei√ß√£o de L√≠deres">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-brigao-bully" class="md-nav__link">
    Algoritmo do Brig√£o (Bully)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-anel" class="md-nav__link">
    Algoritmo do Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-chang-robert" class="md-nav__link">
    Algoritmo de Chang &amp; Robert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-yoyo" class="md-nav__link">
    Algoritmo do YoYo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questoes-importantes" class="md-nav__link">
    Quest√µes importantes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../time/" title="Tempo" class="md-nav__link">
      Tempo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../fault/" title="Toler√¢ncia a Falhas" class="md-nav__link">
      Toler√¢ncia a Falhas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disdb/" title="Bancos de Dados" class="md-nav__link">
      Bancos de Dados
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disfs/index.md" title="Sistemas de Arquivos" class="md-nav__link">
      Sistemas de Arquivos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tech/" title="Tecnologias" class="md-nav__link">
      Tecnologias
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../projeto/" title="Projeto" class="md-nav__link">
      Projeto
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exclusao-mutua" class="md-nav__link">
    Exclus√£o M√∫tua
  </a>
  
    <nav class="md-nav" aria-label="Exclus√£o M√∫tua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coordenador" class="md-nav__link">
    Coordenador
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anel" class="md-nav__link">
    Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lidando-com-falhas" class="md-nav__link">
    Lidando com Falhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quorum" class="md-nav__link">
    Qu√≥rum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eleicao-de-lideres" class="md-nav__link">
    Elei√ß√£o de L√≠deres
  </a>
  
    <nav class="md-nav" aria-label="Elei√ß√£o de L√≠deres">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-brigao-bully" class="md-nav__link">
    Algoritmo do Brig√£o (Bully)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-anel" class="md-nav__link">
    Algoritmo do Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-chang-robert" class="md-nav__link">
    Algoritmo de Chang &amp; Robert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-yoyo" class="md-nav__link">
    Algoritmo do YoYo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questoes-importantes" class="md-nav__link">
    Quest√µes importantes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="coordenacao">Coordena√ß√£o</h1>
<p>Como visto na se√ß√£o sobre <a href="../basics/#multiprogramacao-e-multithreading-em-sistemas-distribuidos
../Multiprograma√ß√£o concorrencia/concorrencia.md">Multiprograma√ß√£o</a>, diversas tarefas exigem coordena√ß√£o entre threads em uma aplica√ß√£o monol√≠tica em que se faz uso de concorr√™ncia para melhor uso de recursos computacionais, obten√ß√£o de melhor desempenho, e modulariza√ß√£o do c√≥digo. </p>
<p>Sistemas distribu√≠dos levam concorr√™ncia a um novo patamar de complexidade, fazendo uso de m√∫ltiplos processos, cada um com possivelmente m√∫ltiplos <em>threads</em>, ainda por cima, espalhados geograficamente. 
Outras solu√ß√µes e abstra√ß√µes s√£o portanto necess√°rias.</p>
<h2 id="exclusao-mutua">Exclus√£o M√∫tua</h2>
<p>Um dos problemas enfrentados em sistemas que fazem uso de concorr√™ncia, distribu√≠dos ou n√£o, √© a exclus√£o m√∫tua.
Em um sistema monol√≠tico, uma vari√°vel global, um lock, ou outra primitiva de sincroniza√ß√£o podem ser usadas na sincroniza√ß√£o, mas em um sistema distribu√≠do, primitivas simples como estas provavelmente n√£o estar√£o dispon√≠veis ou o sistema ser√° muito restrito.
Como, ent√£o, controlar o acesso de m√∫ltiplos processos a um recurso compartilhado, garantindo que cada processo controla <strong>exclusivamente</strong> aquele recurso durante seu acesso?
Qualquer solu√ß√£o que se proponha a este problema de exclus√£o m√∫tua, precisa ter as propriedades 1, 2, 3, e, idealmente, a 4, a seguir:</p>
<div class="admonition info">
<p class="admonition-title">Exclus√£o M√∫tua</p>
<ol>
<li><strong>exclus√£o m√∫tua</strong> - somente um processo pode estar na <strong>regi√£o cr√≠tica</strong> em qualquer instante de tempo;</li>
<li><strong>aus√™ncia de deadlocks</strong> - se processos est√£o tentando acessar o recurso, ent√£o <strong>algum processo deve conseguir acesso</strong> em algum instante, dado que nenhum processo fique na regi√£o cr√≠tica indefinidamente;</li>
<li><strong>n√£o-inani√ß√£o</strong> - todos os processos interessados conseguem, em algum momento, acessar o recurso;</li>
<li><strong>espera limitada</strong> - idealmente, o tempo de espera pelo recurso √© limitado.</li>
</ol>
</div>
<p>H√° diversas solu√ß√µes para exclus√£o m√∫tua em sistemas distribu√≠dos, em diversos cen√°rios, com seus pr√≥s e contras.
Tr√™s das mais simples, e que ilustram o universo de solu√ß√µes s√£o via um processo centralizador, em um anel em que a vez √© circulada, e baseada em quoruns.</p>
<h3 id="coordenador">Coordenador</h3>
<p>Enquanto em um sistema monol√≠tico h√° um sistema operacional que  prov√™ abstra√ß√µes simples para os processos a serem coordenados, em um sistema distribu√≠do, n√£o h√° naturalmente tal entidade.
Uma poss√≠vel solu√ß√£o para o problema de exclus√£o m√∫tua em um ambiente distribu√≠do √© justamente dar um passo para tr√°s e introduzir um coordenador.</p>
<p>Nesta abordagem, os processos que precisam acessar a regi√£o cr√≠tica s√£o denominados <strong>participantes</strong> e um dos processos assume o papel de <strong>coordenador</strong>. √â poss√≠vel que um mesmo processo atue nos dois pap√©is sem nenhum preju√≠zo. Os processos executam o seguinte protocolo:</p>
<ul>
<li>Participante<ol>
<li>Envia requisi√ß√£o de acesso ao coordenador</li>
<li>Espera por resposta do coordenador</li>
<li>Acessa o recurso</li>
<li>Envia libera√ß√£o do recurso para o coordenador</li>
</ol>
</li>
<li>Coordenador<ol>
<li>Inicializa recurso como livre</li>
<li>Ao receber uma requisi√ß√£o, a enfileira</li>
<li>Ao receber uma libera√ß√£o, marca o recurso como livre</li>
<li>Sempre que recurso estiver marcado como livre <strong>E</strong> a fila n√£o estiver vazia<ol>
<li>remove primeiro processo da fila</li>
<li>envia libera√ß√£o para processo removido</li>
<li>marca o recurso como ocupado</li>
</ol>
</li>
</ol>
</li>
</ul>
<p>O diagrama a seguir apresenta uma execu√ß√£o deste protocolo em um cen√°rio com tr√™s participantes.
O estado do coordenador mostra se o recurso est√° livre ou ocupado e quais processos esperam por permiss√£o de acesso.</p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;+Part2: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = [Part3]
        Part2-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part3]
        Coordenador-&gt;&gt;Part2: ResponseFree
    note over Coordenador: Recurso=ocupado/Fila = []
        Coordenador-&gt;&gt;+Part3: ResponseOK
        Part3-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>Este algoritmo satisfaz as caracter√≠sticas elencadas acima.   </p>
<ul>
<li>Exclus√£o m√∫tua - se o coordenador autoriza um participante X, somente ap√≥s o participante X liberar o recurso √© que outro participante poder√° obter nova autoriza√ß√£o.</li>
<li>Aus√™ncia de deadlocks - Todo processo que requisitar o recurso, entrar√° em uma fila, em apenas uma posi√ß√£o; assim, a fila prover√° uma ordem total para os acessos, sem a possibilidade de circularidade nesta ordem.</li>
<li>N√£o-inani√ß√£o - Dado que ningu√©m fura a fila e que a cada vez que o recurso √© liberado a fila anda, em algum momento a vez do processo chegar√°.</li>
<li>Espera limitada - Dado que a posi√ß√£o na fila pode apenas decrementar, seria poss√≠vel estimar quanto tempo o participante precisa esperar para acessar o recurso.</li>
</ul>
<p>Outra vantagem deste algoritmo √© sua simplicidade e, consequentemente, facilidade de implementa√ß√£o.
Contudo, este algoritmo tem tamb√©m desvantagens, por exemplo, se muitas requisi√ß√µes de acesso forem feitas, o coordenador pode ser sobrecarregado e se tornar um <strong>gargalo</strong> no acesso √† regi√£o cr√≠tica.</p>
<p>Mais s√©rio ainda √© a quest√£o de como lidar com falhas, por exemplo, se ou o coordenador ou o participante que detem o direito de acesso ao recurso para de funcionar,  ent√£o nenhum outro processo conseguir√° acesso.
Estes aspectos nos permitem mergulhar na √°rea de toler√¢ncia a falhas, e o faremos, mas mais tarde. 
Por enquanto, consideraremos toler√¢ncia a falhas de forma superficial, ap√≥s discutirmos outra abordagem.</p>
<h3 id="anel">Anel</h3>
<p>Nesta abordagem, os processos se organizam em um anel l√≥gico, com um processo antes e outro depois. 
Um dos processos √© iniciado com um <em>token</em> que d√° acesso ao recurso e o <em>token</em> √© passado adiante no anel; sempre que estiver de posse do token, o processo pode acessar o recurso. Ou seja, todos os participantes executam o seguinte protocolo:</p>
<ul>
<li>Participante<ol>
<li>Ao receber o <em>token</em> de acesso, se quiser acessar o recurso, acessa.</li>
<li>Envia o <em>token</em> para o pr√≥ximo n√≥ do anel.</li>
</ol>
</li>
</ul>
<p>O diagrama adiante mostra uma execu√ß√£o do algoritmo em que apenas os participantes 1 e 3 acessam o recurso.</p>
<div class="mermaid">sequenceDiagram
    Part1-&gt;&gt;Part2: Permiss√£o de Acesso
    Part2-&gt;&gt;Part3: Permiss√£o de Acesso
        note over Part3: Acessa o recurso
    Part3-&gt;&gt;Part4: Permiss√£o de Acesso
    Part4-&gt;&gt;Part1: Permiss√£o de Acesso
        note over Part1: Acessa o recurso
        Part1-&gt;&gt;Part2: Permiss√£o de Acesso
    Part2-&gt;&gt;Part3: Permiss√£o de Acesso
        note over Part3: Acessa o recurso
    Part3-&gt;&gt;Part4: Permiss√£o de Acesso
    Part4-&gt;&gt;Part1: Permiss√£o de Acesso</div>

<p>Como o algoritmo centralizado, o algoritmo do anel tamb√©m garante as propriedades 1, 2, 3 e 4, al√©m de ser f√°cil de implementar, testar e entender.
Diferente do algoritmo centralizado, o algoritmo do anel n√£o sofre com problemas de gargalo, pois nenhum processo precisa participar em todos os acessos, como o coordenador.
Contudo, o algoritmo do anel desperdi√ßa tempo passando o <em>token</em> para quem n√£o necessariamente quer acessar a regi√£o cr√≠tica.
Tamb√©m importante √© que este algoritmo tamb√©m sofre com falhas: se um participante falha enquanto com o <em>token</em>, levando-o para al√©m.</p>
<h3 id="lidando-com-falhas">Lidando com Falhas</h3>
<p>Em ambos os algoritmos, centralizado e do anel, se um processo falhar, o algoritmo pode ficar "travado". 
Vejamos alguns casos espec√≠ficos:</p>
<ul>
<li>No algoritmo centralizado, se o coordenador falha antes de liberar o acesso para algum processo, ele leva consigo a permiss√£o.</li>
<li>Em ambos os algoritmos, se o processo acessando o recurso falha, a permiss√£o √© perdida e os demais processos sofrer√£o inani√ß√£o.</li>
<li>No algoritmo do anel, se qualquer outro processo falha, o anel √© interrompido o anel n√£o conseguir√° circular.</li>
</ul>
<p>Observe que nem falamos de falhas dos canais e j√° temos diversos cen√°rios a serem resolvidos, para os quais se lhes pedir uma solu√ß√£o, tenho certeza absoluta de que me oferecer√£o alguma baseada em <em>timeouts</em>.
Por exemplo, se o processo n√£o devolver a permiss√£o de acesso antes de que uma certa quantidade de tempo tenha passado, um <em>timeout</em>, ent√£o assuma que o mesmo parou de funcionar e n√£o voltar√° mais, e gere uma nova permiss√£o a ser passada a outros requisitantes.  Aplicada esta ideia do <em>timeout</em>  no algoritmo com coordenador, teremos o efeito ilustrado a seguir.</p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;Part2: ResponseOK
    activate Part2
    note over Coordenador: Recurso=ocupado/Fila = [Part3]

    note over Part2: üíÄ‚ò†Ô∏èüíÄ‚ò†Ô∏èüíÄ‚ò†Ô∏èüíÄ
    deactivate Part2
        Coordenador-&gt;&gt;Coordenador: Timeout

    note over Coordenador: Recurso=livre/Fila = [Part3]
    note over Coordenador: Recurso=ocupado/Fila = []
        Coordenador-&gt;&gt;+Part3: ResponseOK
        Part3-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>O problema desta e outras "solu√ß√µes" baseadas em <em>timeouts</em> est√° no <strong>assumir que o processo parou de funcionar</strong>, pois caso isso n√£o seja verdade, teremos agora duas autoriza√ß√µes ao mesmo tempo no sistema, podendo levar √† viola√ß√£o da propriedade de exclus√£o m√∫tua. </p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;+Part2: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = [Part3]

        Coordenador-&gt;&gt;Coordenador: Timeout

    note over Coordenador: Recurso=livre/Fila = [Part3]
    note over Coordenador: Recurso=ocupado/Fila = []
    rect rgb(200, 0, 0)
        Coordenador-&gt;&gt;+Part3: ResponseOK

        Part2-&gt;&gt;-Coordenador: RequestFree
        Part3-&gt;&gt;-Coordenador: RequestFree
    end
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>Por mais que se ajuste o valor do temporizador, em um sistema distribu√≠do ass√≠ncrono, mesmo que aumentado com um rel√≥gio para medir a passagem do tempo local, o mesmo pode <strong>sempre</strong> estar errado. </p>
<div class="admonition warning">
<p class="admonition-title">Impossibilidade de detec√ß√£o de falhas</p>
<p>Em um sistema distribu√≠do ass√≠ncrono, √© imposs√≠vel distinguir um processo falho de um processo lento.</p>
</div>
<p>Mais tarde discutiremos as implica√ß√µes desta impossibilidade. Por agora, tentemos responder √† seguinte quest√£o.</p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Qual deve ser um <em>timeout</em>  <strong>razo√°vel</strong> para o meu sistema?</p>
</div>
<p>A resposta depende de mais perguntas, como:</p>
<ul>
<li>Qual o custo <span><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span> de esperar por mais tempo?</li>
<li>Qual o custo <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span> de cometer um engano?</li>
<li>Qual a probabilidade <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> de cometer um engano?</li>
</ul>
<p>O custo esperado por causa dos erros, isto √©, a esperan√ßa matem√°tica da vari√°vel aleat√≥ria custo, √© menor que o custo de se esperar por mais tempo, isto √©, <span><span class="MathJax_Preview">C * p &lt; E</span><script type="math/tex">C * p < E</script></span>?</p>
<p>Embora esta an√°lise possa ser feita para estes algoritmos, a verdade √© que s√£o realmente limitados e outras abordagens seriam melhor destino dos seus esfor√ßos.
Por exemplo, podemos partir para a an√°lise de algoritmos probabil√≠sticos, pois afinal, como disse certa vez Werner Vogels, CTO da Amazon</p>
<blockquote>
<p>Se o mundo √© probabil√≠stico, porqu√™ meus algoritmos devem ser determin√≠sticos?"</p>
</blockquote>
<p>Uma abordagem probabil√≠stica interessante √© baseada em qu√≥runs.</p>
<h3 id="quorum">Qu√≥rum</h3>
<p>De acordo com o <a href="https://dicionario.priberam.org/quorum">Dicion√°rio Priberam da L√≠ngua Portuguesa, consultado em 17-04-2019</a>, "qu√≥rum" √© o  </p>
<blockquote>
<p>N√∫mero de pessoas imprescind√≠vel para a realiza√ß√£o de algo.</p>
</blockquote>
<p>Aqui, este este <em>algo</em> ser√° a libera√ß√£o de acesso ao recurso almejado pelos processos no sistema distribu√≠do.</p>
<p>Esta abordagem √© semelhante em v√°rios aspectos √† coordenada.
De fato, um dos pap√©is na abordagem √© o de coordenador, que executa o mesmo protocolo que antes.
Entretanto, em vez de apenas um coordenador no sistema, temos <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, dos quais o participante precisa obter <span><span class="MathJax_Preview">m &gt; n/2</span><script type="math/tex">m > n/2</script></span> autoriza√ß√µes antes de acessar o recurso; <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> √© o qu√≥rum do sistema.</p>
<div class="admonition note">
<p class="admonition-title">Qu√≥rum</p>
<ul>
<li><span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> coordenadores.</li>
<li><span><span class="MathJax_Preview">m &gt; n/2</span><script type="math/tex">m > n/2</script></span> coordenadores</li>
</ul>
</div>
<p>J√° os demais participantes devem agora considerar todo o conjunto de coordenadores antes de assumir que tem acesso a um recurso. O algoritmo completo √© o seguinte:   </p>
<ul>
<li>Coordenador   <ol>
<li>Inicializa recurso como livre</li>
<li>Ao receber uma requisi√ß√£o, a enfileira</li>
<li>Ao receber uma libera√ß√£o, marca o recurso como livre</li>
<li>Sempre que recurso estiver marcado como livre <strong>E</strong> a fila n√£o estiver vazia<ol>
<li>remove primeiro processo da fila</li>
<li>envia libera√ß√£o para processo removido</li>
<li>marca o recurso como ocupado</li>
</ol>
</li>
</ol>
</li>
<li>Participante<ol>
<li>Envia requisi√ß√£o de acesso aos <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> coordenadores</li>
<li>Espera por resposta de <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores</li>
<li>Acessa o recurso</li>
<li>Envia libera√ß√£o do recurso para o coordenador</li>
</ol>
</li>
</ul>
<p>Al√©m disso, para tornamos o problema mais interessante e demonstrar o potencial deste algoritmo, consideremos que as autoriza√ß√µes s√£o armazenadas somente em mem√≥ria, e que coordenadores, ao falhar e ent√£o resumir suas atividades, esqueceme das autoriza√ß√µes j√° atribu√≠das.</p>
<div class="admonition warning">
<p class="admonition-title">Perda de mem√≥ria</p>
<p>Quando um coordenador falha, esquece que deu ok e reinicia seu estado.</p>
</div>
<p>Vejamos uma execu√ß√£o bem sucedida destes algoritmo:</p>
<details class="bug"><summary>TODO</summary><p>Construir execu√ß√£o bem sucedida.</p>
</details>
<p>Este algoritmo √© bom? Suponhamos o seguinte cen√°rio:</p>
<ul>
<li>Coordenadores = {<span><span class="MathJax_Preview">c_1,c_2,c_3,c_4,c_5,c_6,c_7</span><script type="math/tex">c_1,c_2,c_3,c_4,c_5,c_6,c_7</script></span>}</li>
<li><span><span class="MathJax_Preview">n = 7</span><script type="math/tex">n = 7</script></span></li>
<li><span><span class="MathJax_Preview">m = 4</span><script type="math/tex">m = 4</script></span></li>
<li>Participante <span><span class="MathJax_Preview">p_1</span><script type="math/tex">p_1</script></span> consegue autoriza√ß√£o de {<span><span class="MathJax_Preview">c_1,c_2,c_3,c_4</span><script type="math/tex">c_1,c_2,c_3,c_4</script></span>} e entra na regi√£o cr√≠tica.</li>
<li>Coordenador <span><span class="MathJax_Preview">c_4</span><script type="math/tex">c_4</script></span> falha e se recupera</li>
<li>Participante <span><span class="MathJax_Preview">p_2</span><script type="math/tex">p_2</script></span> consegue autoriza√ß√£o de {<span><span class="MathJax_Preview">c_4,c_5,c_6,c_7</span><script type="math/tex">c_4,c_5,c_6,c_7</script></span>} e entra na regi√£o cr√≠tica.</li>
</ul>
<p>Neste cen√°rio, a propriedade de <strong>Exclus√£o M√∫tua</strong> √© violada. 
Isto porqu√™, dados os dois qu√≥runs, todos os processos na interse√ß√£o foram reinicidaos.
Mas de forma geral, qual a probabilidade de isso acontecer? 
Ou seja, dados dois quoruns, de tamanho <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span>, que se sobrepoem em <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> processos, qual a probabilidade <span><span class="MathJax_Preview">P_v</span><script type="math/tex">P_v</script></span> de que os <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> processos na interse√ß√£o sejam reiniciados e levem √† viola√ß√£o?</p>
<p><img alt="Quoruns" src="drawings/quorum_k.drawio-0.svg" /></p>
<p>Seja a <span><span class="MathJax_Preview">P</span><script type="math/tex">P</script></span> a probabilidade de <strong>um coordenador em espec√≠fico falhar</strong> e se recuperar dentro de uma janela de tempo <span><span class="MathJax_Preview">\delta t</span><script type="math/tex">\delta t</script></span>. Temos</p>
<ul>
<li>Probabilidade de falha de <strong>exatamente 1</strong> coordenador: <span><span class="MathJax_Preview">P^1(1-P)^{n-1}</span><script type="math/tex">P^1(1-P)^{n-1}</script></span></li>
<li>Probabilidade de <strong><span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> coordenadores</strong> falharem: <span><span class="MathJax_Preview">P^k(1-P)^{n-k}</span><script type="math/tex">P^k(1-P)^{n-k}</script></span></li>
<li>Probabilidade de quaisquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> em <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores falharem: <span><span class="MathJax_Preview">\binom{m}{k} P^k(1-P)^{m-k}</span><script type="math/tex">\binom{m}{k} P^k(1-P)^{m-k}</script></span>       </li>
</ul>
<p>Mas qual √© o tamanho <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> da interse√ß√£o?</p>
<ul>
<li><span><span class="MathJax_Preview">\left| A \cup B\right| = \left| A \right| + \left|B\right| - \left| A \cap B \right| \Rightarrow n = m + m - k</span><script type="math/tex">\left| A \cup B\right| = \left| A \right| + \left|B\right| - \left| A \cap B \right| \Rightarrow n = m + m - k</script></span></li>
<li><span><span class="MathJax_Preview">\left| A \cap B \right| = \left| A \right| + \left|B\right| - \left| A \cup B\right| \Rightarrow k = m + m - n = 2m - n</span><script type="math/tex">\left| A \cap B \right| = \left| A \right| + \left|B\right| - \left| A \cup B\right| \Rightarrow k = m + m - n = 2m - n</script></span></li>
</ul>
<p>At√© agora consideramos que a <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> corresponde √† cardinalidade da interse√ß√£o dos dois quoruns, mas se mais do que a interse√ß√£o forem reiniciados, tamb√©m teremos problemas. Assim, se <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> assume qualquer valor entre o tamanho da interse√ß√£o e o n√∫mero total de coordenadores, teremos problemas. </p>
<ul>
<li>Probabilidade de quaisquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> em <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores falharem, para qualquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> variando de <span><span class="MathJax_Preview">2m-n</span><script type="math/tex">2m-n</script></span> a <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>: <span><span class="MathJax_Preview">P_v = \sum_{k=2m-n}^n \binom{m}{k} P^k(1-P)^{m-k}</span><script type="math/tex">P_v = \sum_{k=2m-n}^n \binom{m}{k} P^k(1-P)^{m-k}</script></span></li>
</ul>
<p>Para facilitar o entendimento desta grandeza, considere o exemplo:</p>
<ul>
<li><span><span class="MathJax_Preview">P=0.0001</span><script type="math/tex">P=0.0001</script></span> (1 minuto a cada 10 dias)</li>
<li><span><span class="MathJax_Preview">n = 32</span><script type="math/tex">n = 32</script></span></li>
<li><span><span class="MathJax_Preview">m = 0.75n</span><script type="math/tex">m = 0.75n</script></span></li>
<li><span><span class="MathJax_Preview">P_v &lt; 10^{-40}</span><script type="math/tex">P_v < 10^{-40}</script></span> (<a href="https://cosmosmagazine.com/mathematics/the-big-baffling-number-at-the-heart-of-a-cosmic-coincidence">Curiosidade sobre <span><span class="MathJax_Preview">10^{40}</span><script type="math/tex">10^{40}</script></span></a>)</li>
</ul>
<p>A probabilidade de viola√ß√£o da exclus√£o m√∫tua, neste caso, √© muito pequena, a despeito de suportar falhas dos coordenadores. </p>
<div class="admonition note">
<p class="admonition-title">Pr√≥</p>
<ul>
<li>Tolera falhas de coordenadores, com probabilidade controlada de viola√ß√£o de exclus√£o m√∫tua.</li>
</ul>
</div>
<p>Mas e as outras propriedades desej√°veis do algoritmo de exclus√£o m√∫tua, s√£o alcan√ßadas? Relembrando:</p>
<div class="admonition note">
<p class="admonition-title">Contras</p>
<ul>
<li>Exclus√£o M√∫tua probabil√≠stica: <span><span class="MathJax_Preview">1 - P_v</span><script type="math/tex">1 - P_v</script></span></li>
<li>N√£o-inani√ß√£o<ul>
<li>E se cada participante obtiver o ok de um coordenador?</li>
<li>Temporizador para quebrar o <em>deadlock</em>?</li>
</ul>
</li>
<li>Espera limitada<ul>
<li>Aborts podem levar a espera infinita.</li>
</ul>
</li>
</ul>
</div>
<p>Assim, este agoritmo tamb√©m pode n√£o ser adequado para certas situa√ß√µes. Vamos tentar reacessar os problemas da primeira abordagem.
Por um lado, o uso de um l√≠der para coordenar a√ß√µes em um SD simplifica o projeto, mas, por outro, o coordenador pode se tornar um ponto √∫nico de falha, como no algoritmo de exclus√£o m√∫tua centralizado.
Mas e se substitu√≠ssemos o coordenador no caso de falhas? Este √© o problema conhecido como elei√ß√£o de l√≠deres.</p>
<details class="bug"><summary>TODO</summary><ul>
<li>Maekawa - Diminui n√∫mero de votos necess√°rios (<a href="https://www.geeksforgeeks.org/maekawas-algorithm-for-mutual-exclusion-in-distributed-system/?ref=rp">descri√ß√£o</a>)</li>
<li>Lamport - Usa rel√≥gios l√≥gicos, mas √© poss√≠vel entender sem este background (<a href="https://www.geeksforgeeks.org/lamports-algorithm-for-mutual-exclusion-in-distributed-system/">descri√ßao</a>)</li>
<li>Ricart-Agrawala - Melhora algoritmo de Lamport (<a href="https://www.geeksforgeeks.org/ricart-agrawala-algorithm-in-mutual-exclusion-in-distributed-system/?ref=rp">descri√ß√£o</a>)</li>
<li><a href="https://www.cs.cmu.edu/~dga/15-440/F09/lectures/Distributed-Mutual-Exclusion-slides.pdf">Distributed-Mutual-Exclusion-slides</a></li>
</ul>
</details>
<h2 id="eleicao-de-lideres">Elei√ß√£o de L√≠deres</h2>
<p>O problema da escolha de um processo centralizador, ou l√≠der, pode ser posto informalmente como o procedimento pelo qual <strong>um processo √© escolhido</strong> dentre os demais processos, sendo que o <strong>processo escolhido √© ciente da escolha</strong> e <strong>todos os demais processos o identificam como eleito</strong>. Uma <strong>nova elei√ß√£o</strong> deve acontecer sempre que o l√≠der se tornar <strong>indispon√≠vel</strong>.
Para entendermos melhor o problema, tentemos desenvolver um protocolo simples para escolhermos um l√≠der, por exemplo, em sua turma da disciplina de Sistemas Distribu√≠dos. </p>
<p>Em primeiro lugar, precisamos definir um conjunto de candidatos: s√£o todos eleg√≠veis ou apenas um subconjunto se candidata? 
Todos se conhecem ou h√° grupos incomunic√°veis diretamente dentro da turma?
Mesmo que um colega seja bem conectado na turma, de que adianta ele ser l√≠der se frequentemente n√£o est√° presente quando necess√°rio?
Em termos computacionais, estas quest√µes s√£o relevantes pois todos os processoes n√£o nascem iguais; alguns residem em m√°quinas com mais mem√≥ria, mais poder de processamento, melhor conex√£o com o resto do mundo ou maior grau de conectividade. Talvez este processo seja um l√≠der mais √∫til que os demais.
Al√©m disso, se o processo est√° frequentemente desconectado, mesmo que bem servido de recursos, n√£o ser√° um bom l√≠der.</p>
<p>Em segundo lugar, ainda que assumamos um conjunto de processos indiferenci√°veis entre si, com acesso equivalente a recursos e que estejam sempre dispon√≠ves, ou exatamente por isso, temos  um problem mais fundamental para resolver: para eleger um l√≠der, precisamos identificar processos, de forma inequ√≠voca. 
Dentro de uma √∫nica m√°quina, identificamos processos facilmente usando seu <strong>pid</strong>, ou <em>process id</em>, um inteiro associado a cada processoinstanciado pelo sistema operacional; o pid √© v√°lido enquanto o processo estiver executando e pode ser reciclado uma vez que o processo para de executar, o que pode ser um problema. Al√©m disso, o <em>host</em> √© reiniciado, os pid tamb√©m s√£o, e portanto esta identifica√ß√£o n√£o √© duradoura. Mais importante, o pid s√≥ faz sentido dentro de uma √∫nica m√°quina e n√£o em um sistema distribu√≠do.</p>
<p>Se apenas uma inst√¢ncia do processo executa em um mesmo <em>host</em>, ent√£o o identificador do <em>host</em> em si √© suficiente e, de fato, comumente utilizado. Se mais de um processo executa no mesmo <em>host</em>, ent√£o cabe ao desenvolvedor criar um esquema que permita diferenciar os processos, e n√£o precisa ser nada complicado; pode ser apenas um <strong>par√¢metro</strong> passado na inicializa√ß√£o do processo ou a combina√ß√£o <strong>IP/porta</strong>.</p>
<p>Assumindo um esquema de nomea√ß√£o est√° dispon√≠vel e que todos os processos se conhecem, voltemos ao problema de eleger um l√≠der para sua turma.
Uma abordagem que pode funcionar √© colocar todos os candidatos para brigar e quem sobrar em p√© no final, √© o novo l√≠der.
A despeito desta op√ß√£o gerar um l√≠der n√£o muito popular, o algoritmo do brig√£o √© um cl√°ssico.</p>
<p><img alt="Why you bully?" src="images/why-you-bully-meme.jpg" />  </p>
<h3 id="algoritmo-do-brigao-bully">Algoritmo do Brig√£o (<em>Bully</em>)</h3>
<p>No algoritmo do brig√£o, alguma caracter√≠sticas compar√°vel dos processos √© escolhida e aquele processo funcional com o valor de tal caracter√≠stica mais vantajoso para um l√≠der √© escolhido como tal.
Por exemplo, pode ser vantajoso ter um l√≠der com maior quantidade de mem√≥ria, frequ√™ncia da CPU ou largura de banda da conex√£o com a Internet; no caso de empate, o identificador do processo pode ser usado para gerar uma ordem total entre os processos.</p>
<p>Para simplificar, vamos assumir que o identificador do processo reflete as qualidades do mesmo para a lideran√ßa, tal que o maior identificador seja o melhor candidato. Os maiores processos, os "brig√µes", elimina os processos menores da competi√ß√£o, sempre que uma elei√ß√£o acontecer. 
O algoritmo, √© o seguinte, onde <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> e <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> s√£o usados para representar tanto identificadores de processos quando os processos em si.</p>
<div class="admonition note">
<p class="admonition-title">Algoritmo do Brig√£o<ul>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> suspeita que o l√≠der n√£o est√° presente<ul>
<li><span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> envia mensagem (ELEICAO,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) para todos os processos com identificador maior que <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span></li>
<li>Se <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> n√£o recebe (OK,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) de outros processos, envia (COORD,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) para todos os processos</li>
<li>Se algum responde, aguarda notifica√ß√£o do novo l√≠der</li>
</ul>
</li>
</ul>
</p>
<ul>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe (ELEICAO,<span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>), <span><span class="MathJax_Preview">q &lt; p</span><script type="math/tex">q < p</script></span>
        * Envia (OK,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>)</li>
<li>Se um processo falho se recupera, inicia uma elei√ß√£o</li>
</ul>
</div>
<p><img alt="Bully algorithm" src="images/bully.png" /></p>
<details class="todo"><summary>TODO</summary><p>Explicar passos.
  Expandir pr√≥ximos</p>
</details>
<h3 id="algoritmo-do-anel">Algoritmo do Anel</h3>
<div class="admonition note">
<p class="admonition-title">Algoritmo do Anel</p>
<ul>
<li>Organize os n√≥s em um anel l√≥gico</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> acha que o l√≠der est√° morto:<ul>
<li>Envia mensagem {<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>} para "a direita" no anel.<ul>
<li>Se processo √† direita est√° falho, salte-o, e assim por diante.</li>
</ul>
</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe {<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>}<ul>
<li>Envia  {<span><span class="MathJax_Preview">p,q</span><script type="math/tex">p,q</script></span>} para a direita.</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> tal que <span><span class="MathJax_Preview">q \in S</span><script type="math/tex">q \in S</script></span><ul>
<li>Escolhe menor id em <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>, por exemplo, e anuncia como l√≠der.</li>
</ul>
</li>
</ul>
</div>
<h3 id="algoritmo-de-chang-robert">Algoritmo de Chang &amp; Robert</h3>
<div class="admonition note">
<p class="admonition-title">Algoritmo de Chang e Robert</p>
<ul>
<li>Organize os n√≥s em um anel l√≥gico</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> acha que o l√≠der est√° morto:<ul>
<li>Envia mensagem <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> para "a direita" no anel, saltando falhos.</li>
<li>Liga flag "participante"</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span><ul>
<li>Se <span><span class="MathJax_Preview">p &gt; q</span><script type="math/tex">p > q</script></span>, repassa <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> para a direita.</li>
<li>Sen√£o, envia  <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> para a direita.</li>
<li>Liga flag "participante"</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> da esquerda <ul>
<li>Se "participante" est√° ligado, identifica <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> como l√≠der.</li>
<li>Desliga "participante"</li>
<li>Se <span><span class="MathJax_Preview">p \neq q</span><script type="math/tex">p \neq q</script></span>, repassa <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> √† direita</li>
</ul>
</li>
</ul>
</div>
<h3 id="algoritmo-do-yoyo">Algoritmo do YoYo</h3>
<p><a href="https://en.wikipedia.org/wiki/Leader_election">Fonte</a></p>
<div class="admonition note">
<p class="admonition-title">Algoritmo do YoYo</p>
<ul>
<li>Grafos incompletos</li>
<li>
<p>Duas fases</p>
</li>
<li>
<p>Fase 1</p>
<ul>
<li><span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> envia seu identificador para seus vizinhos.</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span><ul>
<li>Se <span><span class="MathJax_Preview">p&gt;q</span><script type="math/tex">p>q</script></span>, adiciona aresta <span><span class="MathJax_Preview">q\rightarrow p</span><script type="math/tex">q\rightarrow p</script></span></li>
<li>Sen√£o, adiciona aresta <span><span class="MathJax_Preview">q\leftarrow p</span><script type="math/tex">q\leftarrow p</script></span></li>
<li>Fonte (source)</li>
<li>Vertedouro (sink)</li>
<li>Interno</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Fase 2</p>
<ul>
<li>Fontes enviam seus identificadores para seus vizinhos.</li>
<li>Interno espera msg de todas as arestas de entrada, escolhe o menor id, e repassa para arestas de sa√≠da.</li>
<li>
<p>Vertedouro espera msg de todas as arestas de entrada e escolhe o menor id.</p>
</li>
<li>
<p>Vertedouro envia S para vizinhos de onde viu menor valor e N para os demais.</p>
</li>
<li>Interno repassa S para o vizinho correspondente ao menor id e N para os demais.</li>
<li>Fonte espera por todos os votos. Se todos s√£o S, continua; caso contr√°rio, desiste.</li>
<li>N inverte a dire√ß√£o das arestas em que trafega.</li>
<li>Poss√≠vel otimizar para eliminar n√≥s e arestas irrelevantes.</li>
</ul>
</li>
</ul>
</div>
<p>Exemplo: 
<img alt="Fonte: Hemis62 - Own work, CC BY-SA 4.0" src="images/yoyo.png" /></p>
<ul>
<li>a) The network, </li>
<li>b) Oriented network after setup phase, </li>
<li>c) YO- phase in which source values are passed, </li>
<li>d) YO phase sending responses from sinks, </li>
<li>e) updated structure after -YO phase.</li>
</ul>
<h3 id="questoes-importantes">Quest√µes importantes</h3>
<p>Problemas?</p>
<ul>
<li>Estabilidade?</li>
<li>
<p>O que acontece se a rede √© particionada?</p>
<ul>
<li>Split Brain   <ul>
<li>Network Partitioning: rede dividida em duas partes incomunic√°veis.</li>
<li>M√∫ltiplas elei√ß√µes podem acontecer em paralelo.</li>
<li>M√∫ltiplos l√≠deres em paralelo.</li>
<li>Como lidar com este problema? <ul>
<li>Use primeiro algoritmo e s√≥ eleja l√≠der ap√≥s maioria de votos.</li>
<li>Rede redundante, disco compartilhado, centraliza√ß√£o, volta ao primeiro caso.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Detec√ß√£o de Falhas</p>
<ul>
<li>Elei√ß√£o de l√≠deres perfeita √© imposs√≠vel em cen√°rios real√≠sticos.<ul>
<li>Detec√ß√£o de falhas perfeita √© imposs√≠vel...</li>
<li>em sistemas distribu√≠dos ass√≠ncronos (Internet)</li>
<li>sujeitos √† parti√ß√µes (Internet)</li>
<li>com requisitos de disponibilidade total.</li>
<li>Falemos mais sobre este problema depois.</li>
</ul>
</li>
</ul>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../arch/" title="Arquiteturas" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Arquiteturas
              </div>
            </div>
          </a>
        
        
          <a href="../time/" title="Tempo" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tempo
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>