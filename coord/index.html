


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Coordenação - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#coordenacao" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-header-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Coordenação
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Prólogo" class="md-nav__link">
      Prólogo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intro/" title="Introdução" class="md-nav__link">
      Introdução
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../basics/" title="Fundamentos" class="md-nav__link">
      Fundamentos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../comm/" title="Comunicação" class="md-nav__link">
      Comunicação
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../arch/" title="Arquiteturas" class="md-nav__link">
      Arquiteturas
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Coordenação
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Coordenação" class="md-nav__link md-nav__link--active">
      Coordenação
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exclusao-mutua" class="md-nav__link">
    Exclusão Mútua
  </a>
  
    <nav class="md-nav" aria-label="Exclusão Mútua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coordenador" class="md-nav__link">
    Coordenador
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anel" class="md-nav__link">
    Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lidando-com-falhas" class="md-nav__link">
    Lidando com Falhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quorum" class="md-nav__link">
    Quórum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eleicao-de-lideres" class="md-nav__link">
    Eleição de Líderes
  </a>
  
    <nav class="md-nav" aria-label="Eleição de Líderes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-brigao-bully" class="md-nav__link">
    Algoritmo do Brigão (Bully)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-anel" class="md-nav__link">
    Algoritmo do Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-chang-robert" class="md-nav__link">
    Algoritmo de Chang &amp; Robert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-yoyo" class="md-nav__link">
    Algoritmo do YoYo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questoes-importantes" class="md-nav__link">
    Questões importantes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../time/" title="Tempo" class="md-nav__link">
      Tempo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../fault/" title="Tolerância a Falhas" class="md-nav__link">
      Tolerância a Falhas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disdb/" title="Bancos de Dados" class="md-nav__link">
      Bancos de Dados
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disfs/index.md" title="Sistemas de Arquivos" class="md-nav__link">
      Sistemas de Arquivos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tech/" title="Tecnologias" class="md-nav__link">
      Tecnologias
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../projeto/" title="Projeto" class="md-nav__link">
      Projeto
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exclusao-mutua" class="md-nav__link">
    Exclusão Mútua
  </a>
  
    <nav class="md-nav" aria-label="Exclusão Mútua">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coordenador" class="md-nav__link">
    Coordenador
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anel" class="md-nav__link">
    Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lidando-com-falhas" class="md-nav__link">
    Lidando com Falhas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quorum" class="md-nav__link">
    Quórum
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eleicao-de-lideres" class="md-nav__link">
    Eleição de Líderes
  </a>
  
    <nav class="md-nav" aria-label="Eleição de Líderes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-brigao-bully" class="md-nav__link">
    Algoritmo do Brigão (Bully)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-anel" class="md-nav__link">
    Algoritmo do Anel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-chang-robert" class="md-nav__link">
    Algoritmo de Chang &amp; Robert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-do-yoyo" class="md-nav__link">
    Algoritmo do YoYo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#questoes-importantes" class="md-nav__link">
    Questões importantes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="coordenacao">Coordenação</h1>
<p>Como visto na seção sobre <a href="../basics/#multiprogramacao-e-multithreading-em-sistemas-distribuidos
../Multiprogramação concorrencia/concorrencia.md">Multiprogramação</a>, diversas tarefas exigem coordenação entre threads em uma aplicação monolítica em que se faz uso de concorrência para melhor uso de recursos computacionais, obtenção de melhor desempenho, e modularização do código. </p>
<p>Sistemas distribuídos levam concorrência a um novo patamar de complexidade, fazendo uso de múltiplos processos, cada um com possivelmente múltiplos <em>threads</em>, ainda por cima, espalhados geograficamente. 
Outras soluções e abstrações são portanto necessárias.</p>
<h2 id="exclusao-mutua">Exclusão Mútua</h2>
<p>Um dos problemas enfrentados em sistemas que fazem uso de concorrência, distribuídos ou não, é a exclusão mútua.
Em um sistema monolítico, uma variável global, um lock, ou outra primitiva de sincronização podem ser usadas na sincronização, mas em um sistema distribuído, primitivas simples como estas provavelmente não estarão disponíveis ou o sistema será muito restrito.
Como, então, controlar o acesso de múltiplos processos a um recurso compartilhado, garantindo que cada processo controla <strong>exclusivamente</strong> aquele recurso durante seu acesso?
Qualquer solução que se proponha a este problema de exclusão mútua, precisa ter as propriedades 1, 2, 3, e, idealmente, a 4, a seguir:</p>
<div class="admonition info">
<p class="admonition-title">Exclusão Mútua</p>
<ol>
<li><strong>exclusão mútua</strong> - somente um processo pode estar na <strong>região crítica</strong> em qualquer instante de tempo;</li>
<li><strong>ausência de deadlocks</strong> - se processos estão tentando acessar o recurso, então <strong>algum processo deve conseguir acesso</strong> em algum instante, dado que nenhum processo fique na região crítica indefinidamente;</li>
<li><strong>não-inanição</strong> - todos os processos interessados conseguem, em algum momento, acessar o recurso;</li>
<li><strong>espera limitada</strong> - idealmente, o tempo de espera pelo recurso é limitado.</li>
</ol>
</div>
<p>Há diversas soluções para exclusão mútua em sistemas distribuídos, em diversos cenários, com seus prós e contras.
Três das mais simples, e que ilustram o universo de soluções são via um processo centralizador, em um anel em que a vez é circulada, e baseada em quoruns.</p>
<h3 id="coordenador">Coordenador</h3>
<p>Enquanto em um sistema monolítico há um sistema operacional que  provê abstrações simples para os processos a serem coordenados, em um sistema distribuído, não há naturalmente tal entidade.
Uma possível solução para o problema de exclusão mútua em um ambiente distribuído é justamente dar um passo para trás e introduzir um coordenador.</p>
<p>Nesta abordagem, os processos que precisam acessar a região crítica são denominados <strong>participantes</strong> e um dos processos assume o papel de <strong>coordenador</strong>. É possível que um mesmo processo atue nos dois papéis sem nenhum prejuízo. Os processos executam o seguinte protocolo:</p>
<ul>
<li>Participante<ol>
<li>Envia requisição de acesso ao coordenador</li>
<li>Espera por resposta do coordenador</li>
<li>Acessa o recurso</li>
<li>Envia liberação do recurso para o coordenador</li>
</ol>
</li>
<li>Coordenador<ol>
<li>Inicializa recurso como livre</li>
<li>Ao receber uma requisição, a enfileira</li>
<li>Ao receber uma liberação, marca o recurso como livre</li>
<li>Sempre que recurso estiver marcado como livre <strong>E</strong> a fila não estiver vazia<ol>
<li>remove primeiro processo da fila</li>
<li>envia liberação para processo removido</li>
<li>marca o recurso como ocupado</li>
</ol>
</li>
</ol>
</li>
</ul>
<p>O diagrama a seguir apresenta uma execução deste protocolo em um cenário com três participantes.
O estado do coordenador mostra se o recurso está livre ou ocupado e quais processos esperam por permissão de acesso.</p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;+Part2: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = [Part3]
        Part2-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part3]
        Coordenador-&gt;&gt;Part2: ResponseFree
    note over Coordenador: Recurso=ocupado/Fila = []
        Coordenador-&gt;&gt;+Part3: ResponseOK
        Part3-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>Este algoritmo satisfaz as características elencadas acima.   </p>
<ul>
<li>Exclusão mútua - se o coordenador autoriza um participante X, somente após o participante X liberar o recurso é que outro participante poderá obter nova autorização.</li>
<li>Ausência de deadlocks - Todo processo que requisitar o recurso, entrará em uma fila, em apenas uma posição; assim, a fila proverá uma ordem total para os acessos, sem a possibilidade de circularidade nesta ordem.</li>
<li>Não-inanição - Dado que ninguém fura a fila e que a cada vez que o recurso é liberado a fila anda, em algum momento a vez do processo chegará.</li>
<li>Espera limitada - Dado que a posição na fila pode apenas decrementar, seria possível estimar quanto tempo o participante precisa esperar para acessar o recurso.</li>
</ul>
<p>Outra vantagem deste algoritmo é sua simplicidade e, consequentemente, facilidade de implementação.
Contudo, este algoritmo tem também desvantagens, por exemplo, se muitas requisições de acesso forem feitas, o coordenador pode ser sobrecarregado e se tornar um <strong>gargalo</strong> no acesso à região crítica.</p>
<p>Mais sério ainda é a questão de como lidar com falhas, por exemplo, se ou o coordenador ou o participante que detem o direito de acesso ao recurso para de funcionar,  então nenhum outro processo conseguirá acesso.
Estes aspectos nos permitem mergulhar na área de tolerância a falhas, e o faremos, mas mais tarde. 
Por enquanto, consideraremos tolerância a falhas de forma superficial, após discutirmos outra abordagem.</p>
<h3 id="anel">Anel</h3>
<p>Nesta abordagem, os processos se organizam em um anel lógico, com um processo antes e outro depois. 
Um dos processos é iniciado com um <em>token</em> que dá acesso ao recurso e o <em>token</em> é passado adiante no anel; sempre que estiver de posse do token, o processo pode acessar o recurso. Ou seja, todos os participantes executam o seguinte protocolo:</p>
<ul>
<li>Participante<ol>
<li>Ao receber o <em>token</em> de acesso, se quiser acessar o recurso, acessa.</li>
<li>Envia o <em>token</em> para o próximo nó do anel.</li>
</ol>
</li>
</ul>
<p>O diagrama adiante mostra uma execução do algoritmo em que apenas os participantes 1 e 3 acessam o recurso.</p>
<div class="mermaid">sequenceDiagram
    Part1-&gt;&gt;Part2: Permissão de Acesso
    Part2-&gt;&gt;Part3: Permissão de Acesso
        note over Part3: Acessa o recurso
    Part3-&gt;&gt;Part4: Permissão de Acesso
    Part4-&gt;&gt;Part1: Permissão de Acesso
        note over Part1: Acessa o recurso
        Part1-&gt;&gt;Part2: Permissão de Acesso
    Part2-&gt;&gt;Part3: Permissão de Acesso
        note over Part3: Acessa o recurso
    Part3-&gt;&gt;Part4: Permissão de Acesso
    Part4-&gt;&gt;Part1: Permissão de Acesso</div>

<p>Como o algoritmo centralizado, o algoritmo do anel também garante as propriedades 1, 2, 3 e 4, além de ser fácil de implementar, testar e entender.
Diferente do algoritmo centralizado, o algoritmo do anel não sofre com problemas de gargalo, pois nenhum processo precisa participar em todos os acessos, como o coordenador.
Contudo, o algoritmo do anel desperdiça tempo passando o <em>token</em> para quem não necessariamente quer acessar a região crítica.
Também importante é que este algoritmo também sofre com falhas: se um participante falha enquanto com o <em>token</em>, levando-o para além.</p>
<h3 id="lidando-com-falhas">Lidando com Falhas</h3>
<p>Em ambos os algoritmos, centralizado e do anel, se um processo falhar, o algoritmo pode ficar "travado". 
Vejamos alguns casos específicos:</p>
<ul>
<li>No algoritmo centralizado, se o coordenador falha antes de liberar o acesso para algum processo, ele leva consigo a permissão.</li>
<li>Em ambos os algoritmos, se o processo acessando o recurso falha, a permissão é perdida e os demais processos sofrerão inanição.</li>
<li>No algoritmo do anel, se qualquer outro processo falha, o anel é interrompido o anel não conseguirá circular.</li>
</ul>
<p>Observe que nem falamos de falhas dos canais e já temos diversos cenários a serem resolvidos, para os quais se lhes pedir uma solução, tenho certeza absoluta de que me oferecerão alguma baseada em <em>timeouts</em>.
Por exemplo, se o processo não devolver a permissão de acesso antes de que uma certa quantidade de tempo tenha passado, um <em>timeout</em>, então assuma que o mesmo parou de funcionar e não voltará mais, e gere uma nova permissão a ser passada a outros requisitantes.  Aplicada esta ideia do <em>timeout</em>  no algoritmo com coordenador, teremos o efeito ilustrado a seguir.</p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;Part2: ResponseOK
    activate Part2
    note over Coordenador: Recurso=ocupado/Fila = [Part3]

    note over Part2: 💀☠️💀☠️💀☠️💀
    deactivate Part2
        Coordenador-&gt;&gt;Coordenador: Timeout

    note over Coordenador: Recurso=livre/Fila = [Part3]
    note over Coordenador: Recurso=ocupado/Fila = []
        Coordenador-&gt;&gt;+Part3: ResponseOK
        Part3-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>O problema desta e outras "soluções" baseadas em <em>timeouts</em> está no <strong>assumir que o processo parou de funcionar</strong>, pois caso isso não seja verdade, teremos agora duas autorizações ao mesmo tempo no sistema, podendo levar à violação da propriedade de exclusão mútua. </p>
<div class="mermaid">sequenceDiagram
    participant Coordenador
    note over Coordenador: Recurso=livre/Fila = []
        Part1-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part1]
        Coordenador-&gt;&gt;+Part1: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = []
        Part2-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=ocupado/Fila = [Part2]
        Part1-&gt;&gt;-Coordenador: RequestFree
    note over Coordenador: Recurso=livre/Fila = [Part2]
        Coordenador-&gt;&gt;Part1: ResponseFree
        Part3-&gt;&gt;Coordenador: RequestAccess
    note over Coordenador: Recurso=livre/Fila = [Part2,Part3]
        Coordenador-&gt;&gt;+Part2: ResponseOK
    note over Coordenador: Recurso=ocupado/Fila = [Part3]

        Coordenador-&gt;&gt;Coordenador: Timeout

    note over Coordenador: Recurso=livre/Fila = [Part3]
    note over Coordenador: Recurso=ocupado/Fila = []
    rect rgb(200, 0, 0)
        Coordenador-&gt;&gt;+Part3: ResponseOK

        Part2-&gt;&gt;-Coordenador: RequestFree
        Part3-&gt;&gt;-Coordenador: RequestFree
    end
    note over Coordenador: Recurso=livre/Fila = []
        Coordenador-&gt;&gt;Part3: ResponseFree</div>

<p>Por mais que se ajuste o valor do temporizador, em um sistema distribuído assíncrono, mesmo que aumentado com um relógio para medir a passagem do tempo local, o mesmo pode <strong>sempre</strong> estar errado. </p>
<div class="admonition warning">
<p class="admonition-title">Impossibilidade de detecção de falhas</p>
<p>Em um sistema distribuído assíncrono, é impossível distinguir um processo falho de um processo lento.</p>
</div>
<p>Mais tarde discutiremos as implicações desta impossibilidade. Por agora, tentemos responder à seguinte questão.</p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>Qual deve ser um <em>timeout</em>  <strong>razoável</strong> para o meu sistema?</p>
</div>
<p>A resposta depende de mais perguntas, como:</p>
<ul>
<li>Qual o custo <span><span class="MathJax_Preview">E</span><script type="math/tex">E</script></span> de esperar por mais tempo?</li>
<li>Qual o custo <span><span class="MathJax_Preview">C</span><script type="math/tex">C</script></span> de cometer um engano?</li>
<li>Qual a probabilidade <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> de cometer um engano?</li>
</ul>
<p>O custo esperado por causa dos erros, isto é, a esperança matemática da variável aleatória custo, é menor que o custo de se esperar por mais tempo, isto é, <span><span class="MathJax_Preview">C * p &lt; E</span><script type="math/tex">C * p < E</script></span>?</p>
<p>Embora esta análise possa ser feita para estes algoritmos, a verdade é que são realmente limitados e outras abordagens seriam melhor destino dos seus esforços.
Por exemplo, podemos partir para a análise de algoritmos probabilísticos, pois afinal, como disse certa vez Werner Vogels, CTO da Amazon</p>
<blockquote>
<p>Se o mundo é probabilístico, porquê meus algoritmos devem ser determinísticos?"</p>
</blockquote>
<p>Uma abordagem probabilística interessante é baseada em quóruns.</p>
<h3 id="quorum">Quórum</h3>
<p>De acordo com o <a href="https://dicionario.priberam.org/quorum">Dicionário Priberam da Língua Portuguesa, consultado em 17-04-2019</a>, "quórum" é o  </p>
<blockquote>
<p>Número de pessoas imprescindível para a realização de algo.</p>
</blockquote>
<p>Aqui, este este <em>algo</em> será a liberação de acesso ao recurso almejado pelos processos no sistema distribuído.</p>
<p>Esta abordagem é semelhante em vários aspectos à coordenada.
De fato, um dos papéis na abordagem é o de coordenador, que executa o mesmo protocolo que antes.
Entretanto, em vez de apenas um coordenador no sistema, temos <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>, dos quais o participante precisa obter <span><span class="MathJax_Preview">m &gt; n/2</span><script type="math/tex">m > n/2</script></span> autorizações antes de acessar o recurso; <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> é o quórum do sistema.</p>
<div class="admonition note">
<p class="admonition-title">Quórum</p>
<ul>
<li><span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> coordenadores.</li>
<li><span><span class="MathJax_Preview">m &gt; n/2</span><script type="math/tex">m > n/2</script></span> coordenadores</li>
</ul>
</div>
<p>Já os demais participantes devem agora considerar todo o conjunto de coordenadores antes de assumir que tem acesso a um recurso. O algoritmo completo é o seguinte:   </p>
<ul>
<li>Coordenador   <ol>
<li>Inicializa recurso como livre</li>
<li>Ao receber uma requisição, a enfileira</li>
<li>Ao receber uma liberação, marca o recurso como livre</li>
<li>Sempre que recurso estiver marcado como livre <strong>E</strong> a fila não estiver vazia<ol>
<li>remove primeiro processo da fila</li>
<li>envia liberação para processo removido</li>
<li>marca o recurso como ocupado</li>
</ol>
</li>
</ol>
</li>
<li>Participante<ol>
<li>Envia requisição de acesso aos <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> coordenadores</li>
<li>Espera por resposta de <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores</li>
<li>Acessa o recurso</li>
<li>Envia liberação do recurso para o coordenador</li>
</ol>
</li>
</ul>
<p>Além disso, para tornamos o problema mais interessante e demonstrar o potencial deste algoritmo, consideremos que as autorizações são armazenadas somente em memória, e que coordenadores, ao falhar e então resumir suas atividades, esqueceme das autorizações já atribuídas.</p>
<div class="admonition warning">
<p class="admonition-title">Perda de memória</p>
<p>Quando um coordenador falha, esquece que deu ok e reinicia seu estado.</p>
</div>
<p>Vejamos uma execução bem sucedida destes algoritmo:</p>
<details class="bug"><summary>TODO</summary><p>Construir execução bem sucedida.</p>
</details>
<p>Este algoritmo é bom? Suponhamos o seguinte cenário:</p>
<ul>
<li>Coordenadores = {<span><span class="MathJax_Preview">c_1,c_2,c_3,c_4,c_5,c_6,c_7</span><script type="math/tex">c_1,c_2,c_3,c_4,c_5,c_6,c_7</script></span>}</li>
<li><span><span class="MathJax_Preview">n = 7</span><script type="math/tex">n = 7</script></span></li>
<li><span><span class="MathJax_Preview">m = 4</span><script type="math/tex">m = 4</script></span></li>
<li>Participante <span><span class="MathJax_Preview">p_1</span><script type="math/tex">p_1</script></span> consegue autorização de {<span><span class="MathJax_Preview">c_1,c_2,c_3,c_4</span><script type="math/tex">c_1,c_2,c_3,c_4</script></span>} e entra na região crítica.</li>
<li>Coordenador <span><span class="MathJax_Preview">c_4</span><script type="math/tex">c_4</script></span> falha e se recupera</li>
<li>Participante <span><span class="MathJax_Preview">p_2</span><script type="math/tex">p_2</script></span> consegue autorização de {<span><span class="MathJax_Preview">c_4,c_5,c_6,c_7</span><script type="math/tex">c_4,c_5,c_6,c_7</script></span>} e entra na região crítica.</li>
</ul>
<p>Neste cenário, a propriedade de <strong>Exclusão Mútua</strong> é violada. 
Isto porquê, dados os dois quóruns, todos os processos na interseção foram reinicidaos.
Mas de forma geral, qual a probabilidade de isso acontecer? 
Ou seja, dados dois quoruns, de tamanho <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span>, que se sobrepoem em <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> processos, qual a probabilidade <span><span class="MathJax_Preview">P_v</span><script type="math/tex">P_v</script></span> de que os <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> processos na interseção sejam reiniciados e levem à violação?</p>
<p><img alt="Quoruns" src="drawings/quorum_k.drawio-0.svg" /></p>
<p>Seja a <span><span class="MathJax_Preview">P</span><script type="math/tex">P</script></span> a probabilidade de <strong>um coordenador em específico falhar</strong> e se recuperar dentro de uma janela de tempo <span><span class="MathJax_Preview">\delta t</span><script type="math/tex">\delta t</script></span>. Temos</p>
<ul>
<li>Probabilidade de falha de <strong>exatamente 1</strong> coordenador: <span><span class="MathJax_Preview">P^1(1-P)^{n-1}</span><script type="math/tex">P^1(1-P)^{n-1}</script></span></li>
<li>Probabilidade de <strong><span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> coordenadores</strong> falharem: <span><span class="MathJax_Preview">P^k(1-P)^{n-k}</span><script type="math/tex">P^k(1-P)^{n-k}</script></span></li>
<li>Probabilidade de quaisquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> em <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores falharem: <span><span class="MathJax_Preview">\binom{m}{k} P^k(1-P)^{m-k}</span><script type="math/tex">\binom{m}{k} P^k(1-P)^{m-k}</script></span>       </li>
</ul>
<p>Mas qual é o tamanho <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> da interseção?</p>
<ul>
<li><span><span class="MathJax_Preview">\left| A \cup B\right| = \left| A \right| + \left|B\right| - \left| A \cap B \right| \Rightarrow n = m + m - k</span><script type="math/tex">\left| A \cup B\right| = \left| A \right| + \left|B\right| - \left| A \cap B \right| \Rightarrow n = m + m - k</script></span></li>
<li><span><span class="MathJax_Preview">\left| A \cap B \right| = \left| A \right| + \left|B\right| - \left| A \cup B\right| \Rightarrow k = m + m - n = 2m - n</span><script type="math/tex">\left| A \cap B \right| = \left| A \right| + \left|B\right| - \left| A \cup B\right| \Rightarrow k = m + m - n = 2m - n</script></span></li>
</ul>
<p>Até agora consideramos que a <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> corresponde à cardinalidade da interseção dos dois quoruns, mas se mais do que a interseção forem reiniciados, também teremos problemas. Assim, se <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> assume qualquer valor entre o tamanho da interseção e o número total de coordenadores, teremos problemas. </p>
<ul>
<li>Probabilidade de quaisquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> em <span><span class="MathJax_Preview">m</span><script type="math/tex">m</script></span> coordenadores falharem, para qualquer <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> variando de <span><span class="MathJax_Preview">2m-n</span><script type="math/tex">2m-n</script></span> a <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span>: <span><span class="MathJax_Preview">P_v = \sum_{k=2m-n}^n \binom{m}{k} P^k(1-P)^{m-k}</span><script type="math/tex">P_v = \sum_{k=2m-n}^n \binom{m}{k} P^k(1-P)^{m-k}</script></span></li>
</ul>
<p>Para facilitar o entendimento desta grandeza, considere o exemplo:</p>
<ul>
<li><span><span class="MathJax_Preview">P=0.0001</span><script type="math/tex">P=0.0001</script></span> (1 minuto a cada 10 dias)</li>
<li><span><span class="MathJax_Preview">n = 32</span><script type="math/tex">n = 32</script></span></li>
<li><span><span class="MathJax_Preview">m = 0.75n</span><script type="math/tex">m = 0.75n</script></span></li>
<li><span><span class="MathJax_Preview">P_v &lt; 10^{-40}</span><script type="math/tex">P_v < 10^{-40}</script></span> (<a href="https://cosmosmagazine.com/mathematics/the-big-baffling-number-at-the-heart-of-a-cosmic-coincidence">Curiosidade sobre <span><span class="MathJax_Preview">10^{40}</span><script type="math/tex">10^{40}</script></span></a>)</li>
</ul>
<p>A probabilidade de violação da exclusão mútua, neste caso, é muito pequena, a despeito de suportar falhas dos coordenadores. </p>
<div class="admonition note">
<p class="admonition-title">Pró</p>
<ul>
<li>Tolera falhas de coordenadores, com probabilidade controlada de violação de exclusão mútua.</li>
</ul>
</div>
<p>Mas e as outras propriedades desejáveis do algoritmo de exclusão mútua, são alcançadas? Relembrando:</p>
<div class="admonition note">
<p class="admonition-title">Contras</p>
<ul>
<li>Exclusão Mútua probabilística: <span><span class="MathJax_Preview">1 - P_v</span><script type="math/tex">1 - P_v</script></span></li>
<li>Não-inanição<ul>
<li>E se cada participante obtiver o ok de um coordenador?</li>
<li>Temporizador para quebrar o <em>deadlock</em>?</li>
</ul>
</li>
<li>Espera limitada<ul>
<li>Aborts podem levar a espera infinita.</li>
</ul>
</li>
</ul>
</div>
<p>Assim, este agoritmo também pode não ser adequado para certas situações. Vamos tentar reacessar os problemas da primeira abordagem.
Por um lado, o uso de um líder para coordenar ações em um SD simplifica o projeto, mas, por outro, o coordenador pode se tornar um ponto único de falha, como no algoritmo de exclusão mútua centralizado.
Mas e se substituíssemos o coordenador no caso de falhas? Este é o problema conhecido como eleição de líderes.</p>
<details class="bug"><summary>TODO</summary><ul>
<li>Maekawa - Diminui número de votos necessários (<a href="https://www.geeksforgeeks.org/maekawas-algorithm-for-mutual-exclusion-in-distributed-system/?ref=rp">descrição</a>)</li>
<li>Lamport - Usa relógios lógicos, mas é possível entender sem este background (<a href="https://www.geeksforgeeks.org/lamports-algorithm-for-mutual-exclusion-in-distributed-system/">descriçao</a>)</li>
<li>Ricart-Agrawala - Melhora algoritmo de Lamport (<a href="https://www.geeksforgeeks.org/ricart-agrawala-algorithm-in-mutual-exclusion-in-distributed-system/?ref=rp">descrição</a>)</li>
<li><a href="https://www.cs.cmu.edu/~dga/15-440/F09/lectures/Distributed-Mutual-Exclusion-slides.pdf">Distributed-Mutual-Exclusion-slides</a></li>
</ul>
</details>
<h2 id="eleicao-de-lideres">Eleição de Líderes</h2>
<p>O problema da escolha de um processo centralizador, ou líder, pode ser posto informalmente como o procedimento pelo qual <strong>um processo é escolhido</strong> dentre os demais processos, sendo que o <strong>processo escolhido é ciente da escolha</strong> e <strong>todos os demais processos o identificam como eleito</strong>. Uma <strong>nova eleição</strong> deve acontecer sempre que o líder se tornar <strong>indisponível</strong>.
Para entendermos melhor o problema, tentemos desenvolver um protocolo simples para escolhermos um líder, por exemplo, em sua turma da disciplina de Sistemas Distribuídos. </p>
<p>Em primeiro lugar, precisamos definir um conjunto de candidatos: são todos elegíveis ou apenas um subconjunto se candidata? 
Todos se conhecem ou há grupos incomunicáveis diretamente dentro da turma?
Mesmo que um colega seja bem conectado na turma, de que adianta ele ser líder se frequentemente não está presente quando necessário?
Em termos computacionais, estas questões são relevantes pois todos os processoes não nascem iguais; alguns residem em máquinas com mais memória, mais poder de processamento, melhor conexão com o resto do mundo ou maior grau de conectividade. Talvez este processo seja um líder mais útil que os demais.
Além disso, se o processo está frequentemente desconectado, mesmo que bem servido de recursos, não será um bom líder.</p>
<p>Em segundo lugar, ainda que assumamos um conjunto de processos indiferenciáveis entre si, com acesso equivalente a recursos e que estejam sempre disponíves, ou exatamente por isso, temos  um problem mais fundamental para resolver: para eleger um líder, precisamos identificar processos, de forma inequívoca. 
Dentro de uma única máquina, identificamos processos facilmente usando seu <strong>pid</strong>, ou <em>process id</em>, um inteiro associado a cada processoinstanciado pelo sistema operacional; o pid é válido enquanto o processo estiver executando e pode ser reciclado uma vez que o processo para de executar, o que pode ser um problema. Além disso, o <em>host</em> é reiniciado, os pid também são, e portanto esta identificação não é duradoura. Mais importante, o pid só faz sentido dentro de uma única máquina e não em um sistema distribuído.</p>
<p>Se apenas uma instância do processo executa em um mesmo <em>host</em>, então o identificador do <em>host</em> em si é suficiente e, de fato, comumente utilizado. Se mais de um processo executa no mesmo <em>host</em>, então cabe ao desenvolvedor criar um esquema que permita diferenciar os processos, e não precisa ser nada complicado; pode ser apenas um <strong>parâmetro</strong> passado na inicialização do processo ou a combinação <strong>IP/porta</strong>.</p>
<p>Assumindo um esquema de nomeação está disponível e que todos os processos se conhecem, voltemos ao problema de eleger um líder para sua turma.
Uma abordagem que pode funcionar é colocar todos os candidatos para brigar e quem sobrar em pé no final, é o novo líder.
A despeito desta opção gerar um líder não muito popular, o algoritmo do brigão é um clássico.</p>
<p><img alt="Why you bully?" src="images/why-you-bully-meme.jpg" />  </p>
<h3 id="algoritmo-do-brigao-bully">Algoritmo do Brigão (<em>Bully</em>)</h3>
<p>No algoritmo do brigão, alguma características comparável dos processos é escolhida e aquele processo funcional com o valor de tal característica mais vantajoso para um líder é escolhido como tal.
Por exemplo, pode ser vantajoso ter um líder com maior quantidade de memória, frequência da CPU ou largura de banda da conexão com a Internet; no caso de empate, o identificador do processo pode ser usado para gerar uma ordem total entre os processos.</p>
<p>Para simplificar, vamos assumir que o identificador do processo reflete as qualidades do mesmo para a liderança, tal que o maior identificador seja o melhor candidato. Os maiores processos, os "brigões", elimina os processos menores da competição, sempre que uma eleição acontecer. 
O algoritmo, é o seguinte, onde <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> e <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> são usados para representar tanto identificadores de processos quando os processos em si.</p>
<div class="admonition note">
<p class="admonition-title">Algoritmo do Brigão<ul>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> suspeita que o líder não está presente<ul>
<li><span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> envia mensagem (ELEICAO,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) para todos os processos com identificador maior que <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span></li>
<li>Se <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> não recebe (OK,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) de outros processos, envia (COORD,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>) para todos os processos</li>
<li>Se algum responde, aguarda notificação do novo líder</li>
</ul>
</li>
</ul>
</p>
<ul>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe (ELEICAO,<span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>), <span><span class="MathJax_Preview">q &lt; p</span><script type="math/tex">q < p</script></span>
        * Envia (OK,<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>)</li>
<li>Se um processo falho se recupera, inicia uma eleição</li>
</ul>
</div>
<p><img alt="Bully algorithm" src="images/bully.png" /></p>
<details class="todo"><summary>TODO</summary><p>Explicar passos.
  Expandir próximos</p>
</details>
<h3 id="algoritmo-do-anel">Algoritmo do Anel</h3>
<div class="admonition note">
<p class="admonition-title">Algoritmo do Anel</p>
<ul>
<li>Organize os nós em um anel lógico</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> acha que o líder está morto:<ul>
<li>Envia mensagem {<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>} para "a direita" no anel.<ul>
<li>Se processo à direita está falho, salte-o, e assim por diante.</li>
</ul>
</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe {<span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>}<ul>
<li>Envia  {<span><span class="MathJax_Preview">p,q</span><script type="math/tex">p,q</script></span>} para a direita.</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span> tal que <span><span class="MathJax_Preview">q \in S</span><script type="math/tex">q \in S</script></span><ul>
<li>Escolhe menor id em <span><span class="MathJax_Preview">S</span><script type="math/tex">S</script></span>, por exemplo, e anuncia como líder.</li>
</ul>
</li>
</ul>
</div>
<h3 id="algoritmo-de-chang-robert">Algoritmo de Chang &amp; Robert</h3>
<div class="admonition note">
<p class="admonition-title">Algoritmo de Chang e Robert</p>
<ul>
<li>Organize os nós em um anel lógico</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> acha que o líder está morto:<ul>
<li>Envia mensagem <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> para "a direita" no anel, saltando falhos.</li>
<li>Liga flag "participante"</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span><ul>
<li>Se <span><span class="MathJax_Preview">p &gt; q</span><script type="math/tex">p > q</script></span>, repassa <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> para a direita.</li>
<li>Senão, envia  <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> para a direita.</li>
<li>Liga flag "participante"</li>
</ul>
</li>
<li>Quando <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> recebe <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> da esquerda <ul>
<li>Se "participante" está ligado, identifica <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> como líder.</li>
<li>Desliga "participante"</li>
<li>Se <span><span class="MathJax_Preview">p \neq q</span><script type="math/tex">p \neq q</script></span>, repassa <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> à direita</li>
</ul>
</li>
</ul>
</div>
<h3 id="algoritmo-do-yoyo">Algoritmo do YoYo</h3>
<p><a href="https://en.wikipedia.org/wiki/Leader_election">Fonte</a></p>
<div class="admonition note">
<p class="admonition-title">Algoritmo do YoYo</p>
<ul>
<li>Grafos incompletos</li>
<li>
<p>Duas fases</p>
</li>
<li>
<p>Fase 1</p>
<ul>
<li><span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> envia seu identificador para seus vizinhos.</li>
<li>Quando <span><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span> recebe <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span><ul>
<li>Se <span><span class="MathJax_Preview">p&gt;q</span><script type="math/tex">p>q</script></span>, adiciona aresta <span><span class="MathJax_Preview">q\rightarrow p</span><script type="math/tex">q\rightarrow p</script></span></li>
<li>Senão, adiciona aresta <span><span class="MathJax_Preview">q\leftarrow p</span><script type="math/tex">q\leftarrow p</script></span></li>
<li>Fonte (source)</li>
<li>Vertedouro (sink)</li>
<li>Interno</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Fase 2</p>
<ul>
<li>Fontes enviam seus identificadores para seus vizinhos.</li>
<li>Interno espera msg de todas as arestas de entrada, escolhe o menor id, e repassa para arestas de saída.</li>
<li>
<p>Vertedouro espera msg de todas as arestas de entrada e escolhe o menor id.</p>
</li>
<li>
<p>Vertedouro envia S para vizinhos de onde viu menor valor e N para os demais.</p>
</li>
<li>Interno repassa S para o vizinho correspondente ao menor id e N para os demais.</li>
<li>Fonte espera por todos os votos. Se todos são S, continua; caso contrário, desiste.</li>
<li>N inverte a direção das arestas em que trafega.</li>
<li>Possível otimizar para eliminar nós e arestas irrelevantes.</li>
</ul>
</li>
</ul>
</div>
<p>Exemplo: 
<img alt="Fonte: Hemis62 - Own work, CC BY-SA 4.0" src="images/yoyo.png" /></p>
<ul>
<li>a) The network, </li>
<li>b) Oriented network after setup phase, </li>
<li>c) YO- phase in which source values are passed, </li>
<li>d) YO phase sending responses from sinks, </li>
<li>e) updated structure after -YO phase.</li>
</ul>
<h3 id="questoes-importantes">Questões importantes</h3>
<p>Problemas?</p>
<ul>
<li>Estabilidade?</li>
<li>
<p>O que acontece se a rede é particionada?</p>
<ul>
<li>Split Brain   <ul>
<li>Network Partitioning: rede dividida em duas partes incomunicáveis.</li>
<li>Múltiplas eleições podem acontecer em paralelo.</li>
<li>Múltiplos líderes em paralelo.</li>
<li>Como lidar com este problema? <ul>
<li>Use primeiro algoritmo e só eleja líder após maioria de votos.</li>
<li>Rede redundante, disco compartilhado, centralização, volta ao primeiro caso.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Detecção de Falhas</p>
<ul>
<li>Eleição de líderes perfeita é impossível em cenários realísticos.<ul>
<li>Detecção de falhas perfeita é impossível...</li>
<li>em sistemas distribuídos assíncronos (Internet)</li>
<li>sujeitos à partições (Internet)</li>
<li>com requisitos de disponibilidade total.</li>
<li>Falemos mais sobre este problema depois.</li>
</ul>
</li>
</ul>
</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../arch/" title="Arquiteturas" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Arquiteturas
              </div>
            </div>
          </a>
        
        
          <a href="../time/" title="Tempo" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tempo
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>