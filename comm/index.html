
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>Comunicação - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#canais-e-protocolos" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-header__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Comunicação
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        Prefácio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../arch/" class="md-nav__link">
        Arquiteturas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        Modelos
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Comunicação
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Comunicação
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#canais-e-protocolos" class="md-nav__link">
    Canais e Protocolos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-internet" class="md-nav__link">
    A Internet
  </a>
  
    <nav class="md-nav" aria-label="A Internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sockets" class="md-nav__link">
    Sockets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    TCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    UDP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip-multicast" class="md-nav__link">
    IP-Multicast
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alem-dos-sockets" class="md-nav__link">
    Além dos Sockets
  </a>
  
    <nav class="md-nav" aria-label="Além dos Sockets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representacao-de-dados" class="md-nav__link">
    Representação de dados
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#middleware-e-transparencia" class="md-nav__link">
    Middleware e Transparência
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-mensagens" class="md-nav__link">
    Comunicação orientada a Mensagens
  </a>
  
    <nav class="md-nav" aria-label="Comunicação orientada a Mensagens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-passing-interface" class="md-nav__link">
    Message Passing Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filas-de-mensagem" class="md-nav__link">
    Filas de mensagem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishsubscribe" class="md-nav__link">
    Publish/Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Publish/Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arquiteturas-baseadas-em-pubsub" class="md-nav__link">
    Arquiteturas baseadas em Pub/Sub
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protocolos-epidemicos" class="md-nav__link">
    Protocolos Epidêmicos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-fluxos" class="md-nav__link">
    Comunicação Orientada a Fluxos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invocacao-remota-de-procedimentos-rpc" class="md-nav__link">
    Invocação Remota de Procedimentos - RPC
  </a>
  
    <nav class="md-nav" aria-label="Invocação Remota de Procedimentos - RPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transparencia" class="md-nav__link">
    Transparência
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interface-definition-language" class="md-nav__link">
    Interface Definition Language
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../p2p/" class="md-nav__link">
        P2P
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../microservices/" class="md-nav__link">
        Microsserviços
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../coord/" class="md-nav__link">
        Coordenação
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        Tempo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fault/" class="md-nav__link">
        Tolerância a Falhas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../consistency/" class="md-nav__link">
        Consistência
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disdb/" class="md-nav__link">
        Bancos de Dados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disfs/" class="md-nav__link">
        Sistemas de Arquivos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cases/" class="md-nav__link">
        Estudos de Caso
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tech/" class="md-nav__link">
        Tecnologias
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#canais-e-protocolos" class="md-nav__link">
    Canais e Protocolos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-internet" class="md-nav__link">
    A Internet
  </a>
  
    <nav class="md-nav" aria-label="A Internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sockets" class="md-nav__link">
    Sockets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    TCP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#udp" class="md-nav__link">
    UDP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ip-multicast" class="md-nav__link">
    IP-Multicast
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alem-dos-sockets" class="md-nav__link">
    Além dos Sockets
  </a>
  
    <nav class="md-nav" aria-label="Além dos Sockets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representacao-de-dados" class="md-nav__link">
    Representação de dados
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#middleware-e-transparencia" class="md-nav__link">
    Middleware e Transparência
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-mensagens" class="md-nav__link">
    Comunicação orientada a Mensagens
  </a>
  
    <nav class="md-nav" aria-label="Comunicação orientada a Mensagens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#message-passing-interface" class="md-nav__link">
    Message Passing Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filas-de-mensagem" class="md-nav__link">
    Filas de mensagem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publishsubscribe" class="md-nav__link">
    Publish/Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Publish/Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#arquiteturas-baseadas-em-pubsub" class="md-nav__link">
    Arquiteturas baseadas em Pub/Sub
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protocolos-epidemicos" class="md-nav__link">
    Protocolos Epidêmicos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-fluxos" class="md-nav__link">
    Comunicação Orientada a Fluxos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invocacao-remota-de-procedimentos-rpc" class="md-nav__link">
    Invocação Remota de Procedimentos - RPC
  </a>
  
    <nav class="md-nav" aria-label="Invocação Remota de Procedimentos - RPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transparencia" class="md-nav__link">
    Transparência
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interface-definition-language" class="md-nav__link">
    Interface Definition Language
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

<!-- Edit button -->


  <!--
       Hack: check whether the content contains a h1 headline. If it
       doesn't, the page title (or respectively site name) is used
       as the main headline.
    -->

  <h1>Comunicação</h1>


  <!-- Content -->
  <p>As camadas de abstração mais básicas do desenvolvimento de SD estão <strong>na rede de computadores</strong>, que servem de substrato a todo e qualquer sistema distribuído, afinal, a pedra fundamental da construção de sistemas distribuídos é a capacidade de comunicação entre seus componentes.</p>
<h2 id="canais-e-protocolos">Canais e Protocolos</h2>
<p>Para que os componentes de um sistema distribuído se comuniquem, é necessário que seus <em>hosts</em> possuam <strong>interfaces de rede</strong> e que estas interfaces estejam ligadas a uma rede com capacidade de roteamento de dados, estabelecendo um <strong>canal de comunicação</strong> entre os componentes.
Além do canal, é também necessário que se estabeleça um <strong>protocolo de comunicação</strong>, que define as regras para que a comunicação aconteça, por exemplo, a gramática para formação de mensagens.
Por exemplo, quando você fala com uma pessoa, cara-a-cara, o meio de comunicação é o ar e o protocolo utilizado é a linguagem conhecida pelas duas partes, o Português por exemplo.
Na prática, canais de comunicação podem ter diversas topologias e características, por exemplo:</p>
<table>
<thead>
<tr>
<th>Ponto-a-ponto</th>
<th>Barramento Compartilhado</th>
<th>Token Ring</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sem colisões</td>
<td>Com colisões</td>
<td>Sem colisões</td>
</tr>
<tr>
<td>Roteamento trivial</td>
<td>Roteamento complexo</td>
<td>Roteamento simples</td>
</tr>
<tr>
<td>Caro (exponencial)</td>
<td>Barato (linear)</td>
<td>Barato (linear)</td>
</tr>
</tbody>
</table>
<p>Nas redes atuais, pode se dizer que o meio mais utilizado é provido pela arquitetura <strong>Ethernet</strong>, que trata da comunicação entre nós usando um <strong>barramento compartilhado</strong>, mesmo que este esteja por vezes escondido.
Sobre este meio, são usados protocolos para, por exemplo,</p>
<ul>
<li>Controle de acesso ao meio </li>
<li>Transmissão de mensagens</li>
<li>Evitar e tratar colisões</li>
</ul>
<p>As redes Ethernet, contudo, cobrem pequenas áreas e para se ter conversas mais "abrangentes", é necessário que se conecte diversas destas redes.
A conversa então é feita por meio de intermediários, <strong><em>gateways</em></strong> que conectam duas ou mais redes, permitindo que mensagens de um interlocutor sejam <strong>roteadas</strong> para o outro, via tais intermediários.</p>
<p>Um exemplo interessante das questões ligadas à manutenção da conversa entre dois pontos é a decisão sobre o uso de <strong>comutação de pacotes</strong> (<em>packet switching</em>) ou de <strong>circuitos</strong> (<em>circuit switching</em>).</p>
<table>
<thead>
<tr>
<th>Comutação de pacotes</th>
<th>Comutação de circuito</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cada pacote viaja independentemente</td>
<td>Todo pacote viaja por caminho predefinido</td>
</tr>
<tr>
<td>Latência variável</td>
<td>Latência mais constante</td>
</tr>
<tr>
<td>Banda não reservada</td>
<td>Banda reservada</td>
</tr>
<tr>
<td>Banda não desperdiçada</td>
<td>Banda desperdiçada</td>
</tr>
</tbody>
</table>
<p>Outro fator importante é a <strong>unidade máxima de transmissão</strong> (<em>maximum transmission unit</em>, MTU), o tamanho máximo de um pacote em determinada rede. É necessário entender que qualquer quantidade de dados maior que o MTU precisará ser dividida em múltiplos pacotes. Também é importante perceber que redes são heterogêneas, e que o vários segmentos no caminho entre origem e destino podem ter MTU diferentes, levando à fragmentação de pacotes em trânsito e, possivelmente, entrega desordenada dos mesmos.</p>
<p>Finalmente, há uma questão importante relativa à confiabilidade na transmissão dos elementos da conversa, isto é, se a rede deve garantir ou não que algo "dito" por um interlocutor deve garantidamente ser "ouvido" pelo outro, ou se a <strong>mensagem pode ser perdida</strong> no meio.</p>
<p>Felizmente boa parte da <strong>complexidade da resolução destas questões é abstraída do desenvolvedor dos sistemas distribuídos</strong>, isto é, você, lhe cabendo apenas a decisão de qual protocolo utilizar.
Nas redes atuais, a conversa em componentes será feita, em algum nível, por meio dos protocolos da arquitetura <strong>Internet</strong>.</p>
<h2 id="a-internet">A Internet</h2>
<p>A Internet tem este nome por usar o protocolo de interconexão de redes independentes, o <em>internetworking protocol</em>, ou IP.
Para a aplicação usando o IP, todas as redes se comportam como uma única e coerente rede, exceto por alguns detalhes.
Os elementos que conectam as diversas redes são denominados <strong>roteadores</strong> e fazem um <strong>melhor esforço</strong> para encaminhar os pacotes de dados do remetente ao destinatário.</p>
<p><img alt="A Internet" src="../images/internet.png" /><sup id="fnref:internet"><a class="footnote-ref" href="#fn:internet">1</a></sup></p>
<p>Se você se lembrar da pilha de protocolos de comunicação de referência OSI, lembrará que há uma organização em camadas em que cada camada é responsável pela comunicação em um nível e serve de fundação para a funcionalidade da camada de cima, isto é, cada camada é responsável pela comunicação em um nível de abstração que serve de base para o nível imediatamente superior:
O protocolo de cada camada inclui <strong>cabeçalhos</strong> (<em>header</em>) e <strong>carga</strong> (<em>payload</em>) e o conjunto de cabeçalho + carga de uma camada é considerado carga da camada inferior.
Assim, embora tenha-se a impressão de que cada camada conversa com a equivalente do outro lado da comunicação, na prática, a comunicação desce e sobe a pilha. </p>
<p><img alt="Pilhas de Comunicação" src="../drawings/pilha.drawio-0.svg" /></p>
<p>São sete as camadas:</p>
<ol>
<li>Física: Bits</li>
<li>Enlace: Frames/quadros; controle de fluxo; acesso ao meio.</li>
<li>Rede: Datagramas/pacotes; roteamento</li>
<li>Transporte: Controle de fluxo; fim a fim; confiabilidade; tcp e udp</li>
<li>Sessão: Streams/fluxos; conexões lógicas; restart; checkpoint; http, ssl</li>
<li>Apresentação: Objetos; json, xml; criptografia</li>
<li>Aplicação: Aplicações; http, pop, ftp</li>
</ol>
<p><img alt="Pilhas de Comunicação" src="../drawings/pilha.drawio-1.svg" /></p>
<p>Embora o IP se refira estritamente ao protocolo da camada 3 da pilha, nos referimos à pilha que usa este protocolo como a pilha IP.
Comparada à pilha OSI, a IP é mais simples, como se vê na figura, 
pois as camadas 5 e 6 não estão presentes na pilha IP e as funcionalidades correspondentes são implementadas na camada 7, de aplicaçao.</p>
<p><a href="http://computing.dcu.ie/~humphrys/Notes/Networks/intro.2.html"><img alt="OSI x IP" src="../drawings/pilha.drawio-2.svg" /></a></p>
<p>Contudo, não tema! Estas funcionalidades podem se normalmente implementadas por meio de <em>frameworks</em> ou do <em>middleware</em> em uso.
Alguns exemplos de tais funcionalidades são</p>
<ul>
<li>(De)Serialização - conversão de estruturas complexas, e.g., objetos e estruturas, em sequência de bytes.</li>
<li>Nomeamento - identificação de <em>hosts</em></li>
<li>Criptografia - ocultação dos dados trafegados</li>
<li>Replicação - comunicação com múltiplos interlocutores</li>
<li>Invocação remota de procedimentos - abstração de protocolos de comunicação</li>
</ul>
<p>A grande vantagem desta abordagem é que se pode implementar exatamente e somente as funcionalidades desejadas.
Este característica é conhecida como o <a href="http://web.mit.edu/Saltzer/www/publications/endtoend/endtoend.pdf">argumento fim-a-fim no projeto de sistemas</a>; uma análise recente deste argumento foi feita <a href="https://blog.acolyer.org/2014/11/14/end-to-end-arguments-in-system-design/">aqui</a>.</p>
<p>Como usuários da pilha IP, temos que entender como a camada 3 funciona, mas dificilmente interagiremos com algo além da camada 4, a camada de <strong>transporte</strong>.</p>
<h3 id="sockets">Sockets</h3>
<p>Na prática, para implementarmos a comunicação entre processos, usamos <strong>sockets</strong>.
Para se definir um socket a partir de um <strong><em>host</em></strong> é necessário identificar o outro fim da comunicação, isto é, o outro <em>host</em>, ou melhor, uma de suas interfaces de rede.
Os sockets são então a abstração dos canais de comunicação, mas como dito antes, é necessário definir também os protocolos usados por estes sockets.
O primeiro protocolo é o de endereçamento, que define qual pilha de protocolos usar, na camada 3.
No caso da pilha IP, usa-se o protocolo AF_INET ou PF_INET.
Escolhido o protocolo, </p>
<ul>
<li>cada interface tem um endereço MAC, na camada 2, que a identifica entre as interfaces na mesma rede local, e </li>
<li>cada interface tem um endereço IPv4/IPv6 de 32/128 bits, que o indentifica entre todos os hosts na Internet.<sup id="fnref:ippub"><a class="footnote-ref" href="#fn:ippub">2</a></sup></li>
</ul>
<p>Mas dentro de um <em>host</em>, podem haver diversas aplicações sendo executadas. Como identificar exatamente com qual se quer conversar?
Isto é feito pela definição uma porta:</p>
<ul>
<li>Porta: inteiro de 16 bits</li>
<li>Associadas a serviços pela <a href="http://www.iana.org">Internet Assigned Numbers Authority</a>, IANA.<ul>
<li>Portas "Bem conhecidas": 0-1023</li>
<li>Portas Proprietárias: 49151</li>
<li>Portas Dinâmicas: 65535</li>
</ul>
</li>
</ul>
<p>Também é necessário definir o protocolo de transporte dos dados, na camada 4.
Novamente, no caso da pilha IP, pode-se usar TCP (<strong>SOCK_STREAM</strong>) ou UDP (<strong>SOCK_DGRAM</strong>).</p>
<p>A API usada para estabelecer a conversa via socket tem várias chamadas, que devem ser executadas na ordem certa no processo iniciando a conversa e naquele que aceita participar da mesma. Comecemos estudando o TCP.</p>
<h3 id="tcp">TCP</h3>
<p>O fluxograma da criação de um socket TCP é apresentado na seguinte figura:
<div class="mermaid">stateDiagram-v2
   Servidor --&gt; Entrada/Saída
   Cliente --&gt; Entrada/Saída
   Entrada/Saída --&gt; Encerramento

   state Servidor {
     ss: Cria socket
     sb: Associa porta
     sl: Escuta conexões
     sa: Aceita conexões
     ss --&gt; sb 
     sb --&gt; sl
     sl --&gt; sa
   }

   state Entrada/Saída {
     leitura --&gt; escrita
     escrita --&gt; leitura
   }

   state Cliente {   
     cs: Cria socket
     cc: Inicia conexão
     cs --&gt; cc
   }

   state Encerramento {
       sc: Fecha conexão
   }</div></p>
<!--![image](images/04-15.png)-->

<p>Estabelecido o socket, o mesmo pode ser usado como um <strong>arquivo</strong>, isto é, lendo-se e escrevendo-se bytes.
O que exatamente deve ser escrito e como o que é lido deve ser interpretado é o protocolo da camada 7, <strong>sua responsabilidade</strong>.</p>
<p>Vejamos um exemplo do uso de sockets, em Python, descrito no arquivo <code>server.py</code>.<sup id="fnref:pyname"><a class="footnote-ref" href="#fn:pyname">3</a></sup></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">#server.py</span>
<span class="c1">#!/usr/bin/python                           # This is server.py file</span>

<span class="kn">import</span> <span class="nn">socket</span>                               <span class="c1"># Import socket module</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>                         <span class="c1"># Create a socket object</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>                 <span class="c1"># Get local machine name</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span>                                <span class="c1"># Reserve a port for your service.</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>                        <span class="c1"># Bind to the port</span>

<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                                 <span class="c1"># Now wait for client connections.</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
   <span class="n">c</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>                     <span class="c1"># Establish connection with client.</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Got connection from&#39;</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
   <span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;Thank you for connecting&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
   <span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                                <span class="c1"># Close the connection</span>
</code></pre></div>
</td></tr></table>
<p>Para executá-lo, execute o seguinte comando em um terminal. </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>python server.py
</code></pre></div>
</td></tr></table>
<p>Em outro terminal, execute <strong>um dos</strong> dois comandos a seguir. <sup id="fnref:telnet"><a class="footnote-ref" href="#fn:telnet">4</a></sup></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>telnet localhost <span class="m">12345</span>
</code></pre></div>
</td></tr></table>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>netcat localhost <span class="m">12345</span>
</code></pre></div>
</td></tr></table>
<p>No segundo terminal a mensagem 
<code>Thank you for connecting</code>
será impressa, enquanto no primeiro veremos algo como 
 <code>('Got connection from', ('127.0.0.1', 57801))</code> </p>
<p>O que está acontecendo aqui é um processo criou um socket e ficou aguardando uma conexão, usando o código em Python.
Tanto o telnet quando o netcat são programas genéricos para se conversar com outro processo usando TCP/IP.
Aqui, estes programas simplesmente se conectaram e imprimiram o que quer que o primeiro processo lhes tenha enviado, assumindo que correspondia a uma string, o que neste caso é correto.
Simples, não é mesmo?</p>
<p>Duas observações importantes a serem feitas aqui. 
A primeira é que, em geral, denominamos o processo que fica aguardando a conexão de <strong>servidor</strong> e o processo que se conecta de <strong>cliente</strong>. Isto por quê, em geral, o servidor executa alguma tarefa, serve, o cliente, embora isto não seja necessariamente verdade.</p>
<p>Por completude, vamos também escrever o código do cliente, agora que você já sabe que o servidor funciona.
Do lado cliente, estabelece-se uma conexão apontando-se para onde está o servidor.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">#client.py</span>

<span class="c1">#!/usr/bin/python                      # This is client.py file</span>

<span class="kn">import</span> <span class="nn">socket</span>                          <span class="c1"># Import socket module</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>                    <span class="c1"># Create a socket object</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>            <span class="c1"># Get local machine name</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">12345</span>                           <span class="c1"># Reserve a port for your service.</span>

<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>                              <span class="c1"># Close the socket when done</span>
</code></pre></div>
</td></tr></table></p>
<p>E para se executar o cliente, faça:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>python client.py
</code></pre></div>
</td></tr></table></p>
<p>Observe que o <code>socket.close()</code> encerra a conexão do lado de quem invoca. Na contraparte, invocações a <code>socket.recv()</code> retornam com 0 bytes lidos.</p>
<p>A título de comparação, em Java, a criação do socket do lado do servidor seria muito mais simples, consistindo apenas em: 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Socket</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerSocket</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></p>
<p>O cliente em Java também é simplificado.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Socket</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Socket</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span><span class="n">port</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></p>
<div class="admonition question">
<p class="admonition-title">Exercício: Múltiplos Pacotes</p>
<p>Façamos agora uma modificação no código do servidor para que envie não uma, mas duas mensagens para o cliente. Isto é, modifique seu servidor assim</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;Thank you for connecting&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">c</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;Come back often&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="o">...</span>
</code></pre></div>
</td></tr></table>
<p>Agora execute novamente o cliente e veja o que acontece.  Consegue explicar o fenômeno?</p>
<p>Modifiquemos o cliente agora, para que tenha dois <code>recv</code>, assim.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">...</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
<span class="o">...</span>
</code></pre></div>
</td></tr></table></p>
<p>E agora, o que acontece? A saída é como esperava? Como explica este fenômeno e como poderia corrigí-lo?</p>
</div>
<div class="admonition question">
<p class="admonition-title">Exercício: Ping-Pong</p>
<p>Modifique cliente e servidor tal que o cliente envie uma mensagem passada na linha de comando ao servidor e fique esperando uma resposta, e tal que o servidor fique esperando uma mensagem e então solicite ao operador que digite uma resposta e a envie para o cliente. O loop continua até que o usuário digite SAIR, e a conexão seja encerrada.</p>
<table>
<thead>
<tr>
<th>Terminal 1</th>
<th>Terminal 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>python server.py</td>
<td>python client.py</td>
</tr>
<tr>
<td>Esperando conexão.</td>
<td>conectando-se ao servidor</td>
</tr>
<tr>
<td>Conectado</td>
<td>Conectado</td>
</tr>
<tr>
<td>Esperando mensagem</td>
<td>Digite mensagem: lalala</td>
</tr>
<tr>
<td></td>
<td>Mensagem enviada</td>
</tr>
<tr>
<td>Mensagem recebida: lalala</td>
<td>Esperando resposta</td>
</tr>
<tr>
<td>Digite resposta: lelele</td>
<td></td>
</tr>
<tr>
<td>Resposta enviada.</td>
<td>Resposta recebida: lelele</td>
</tr>
<tr>
<td></td>
<td>Digite mensagem: SAIR</td>
</tr>
<tr>
<td></td>
<td>Desconectando.</td>
</tr>
<tr>
<td>Conexão encerrada.</td>
<td></td>
</tr>
<tr>
<td>Esperando conexão.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Observe que para ler do teclado em Python 2 você deve usar <code class="highlight"><span class="n">x</span> <span class="o">=</span> <span class="n">raw_input</span><span class="p">()</span></code>, enquanto que em Python 3 seria <code class="highlight"><span class="n">x</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span></code>. Além disso, em Python 2, você deve remover as invocações para <code>encode</code> e <code>decode</code>.</p>
</div>
<h3 id="udp">UDP</h3>
<p>No exemplo anterior, usamos o protocolo TCP (o padrão da API). Caso quiséssemos usar UDP, precisaríamos nos atentar a alguns detalhes.</p>
<p>A criação do socket é feita explicitando-se o uso de <strong>datagramas</strong>: <code class="highlight"><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span></code></p>
<p>Um servidor UDP não executa <code>listen</code> ou <code>accept</code> e, em Python, simplesmente executa <code class="highlight"><span class="n">data</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recvfrom</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span></code> para receber o datagrama, onde <code>data</code> é o conteúdo recebido e  <code>addr</code> o endereço de quem enviou o datagrama.</p>
<p>Neste caso, um mesmo socket é usado para manter comunicação com múltiplos interlocutores. Para enviar uma resposta a um interlocutor em específico, <code>addr</code> é usado: <code class="highlight"><span class="n">sent</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span></code>, onde <code>sent</code> é a quantidade de bytes enviados.</p>
<p>Além deste detalhe, é importante manter em mente outras características do UDP:</p>
<ul>
<li>falta de ordem</li>
<li>falta de confiabilidade</li>
<li>menos dados lidos que enviados.</li>
<li>mais dados lidos que enviados (pode acontecer também no TCP)</li>
</ul>
<p>Com tantas dificuldades para se usar o UDP, fica a questão: <strong>para que serve UDP?</strong></p>
<div class="admonition question">
<p class="admonition-title">Exercício: Ping-Pong UDP</p>
<p>Modifique o código do exercício Ping-Pong para usar UDP em vez de TCP na comunicação entre nós.
Execute múltiplos clientes ao mesmo tempo. Como o seu servidor lida com isso? Modifique-o para mandar um "eco" da mensagem recebida de volta ao remetente. </p>
</div>
<h3 id="ip-multicast">IP-Multicast</h3>
<p>Imagine que você tenha que enviar um <em>stream</em> de vídeo para um amigo mostrando como você está jogando o mais novo jogo da velha no mercado.
Qual protocolo de transporte você usaria? TCP, provavelmente, já que garante a entrega ordenada dos pacotes do vídeo.
Como você já sabe, o TCP envia confirmações de pacotes recebidos e usa uma janela deslizante para determinar quais pacotes reenviar, o que pode causar interrupções na execução do vídeo.
Além do mais, as pessoas provavelmente preferirão perder alguns quadros que perder a sincronia com sua excitante partida.
Parece que uma opção melhor seria então usar UDP, correto?</p>
<p>Imagine agora que os mesmos dados devam ser enviados para múltiplos destinatários (você está ficando famoso!)
Com múltiplos destinatários, múltiplos controles precisariam ser mantidos no TCP, o que pode se tornar custoso; mais uma razão para usar UDP!</p>
<p><img alt="Multicast" src="../drawings/group_com.drawio-0.svg" /></p>
<p>Para terminar, lhe darei uma razão final: IP-Multicast!
Multicast, em oposição ao Unicast, é a capacidade de enviar mensagens para um grupo de destinatários, em vez de apenas um. </p>
<p><img alt="Multicast" src="../drawings/group_com.drawio-1.svg" /></p>
<p>IP-Multicast é uma implementação desta ideia, usando umaa configuração específica do UDP, associada a recursos dos comutadores de rede, para otimizar o envio dos mesmos dados a múltiplos destinatários.
Grupos são identificados por endereços IP especiais, conhecidos como Classe D (224.0.0.0-239.255.255.255), e propagados pela rede.
A seguinte tabela descreve os usos das sub-faixas de endereços.<sup id="fnref:multicast_use"><a class="footnote-ref" href="#fn:multicast_use">5</a></sup></p>
<table>
<thead>
<tr>
<th>Endereço</th>
<th>Uso</th>
</tr>
</thead>
<tbody>
<tr>
<td>224.0.0.0-224.0.0.255</td>
<td>Multicast local - Usado por protocolos L2, como EIGRP e OSPF</td>
</tr>
<tr>
<td>224.0.1.0-224.0.1.255</td>
<td>Multicast roteaddo - Usado por protocolos L3</td>
</tr>
<tr>
<td>232.0.0.0-232.255.255.255</td>
<td><em>Source Specific Multicast</em> - Receptores definem fontes confiáveis</td>
</tr>
<tr>
<td>233.0.0.0-233.255.255.255</td>
<td>Reservado para detentores <em>Autonomous Systems</em></td>
</tr>
<tr>
<td>239.0.0.0-239.255.255.255</td>
<td>Reservado para IANA</td>
</tr>
<tr>
<td>Resto</td>
<td>Uso geral</td>
</tr>
</tbody>
</table>
<p>Quando um pacote é enviado para o endereço do grupo, <strong>todos</strong> os membros do grupo recebem tal mensagem.
Melhor dizendo, todos os membros podem receber a mensagem, mas como estamos falando de UDP, <strong>é possível que alguns não recebam</strong>.
Além disso, <strong>não há garantia qualquer sobre a ordem de recepção das mensagens</strong>.</p>
<p>Apenas reforçando, IP-Multicast só funciona com UDP, pois lidar com retransmissões em um grupo grande levaria a um estado imenso sendo mantido na origem dos dados.
Outro ponto importante é que pelo podencial desestabilizador do IP-Multicast, ele é normalemente limitado à pequenas seções das redes.</p>
<p>Mas experimentemos com esta tecnologia na prática.
Criemos um programa que <strong>criar Socket UDP</strong>, <strong>associa-o a um grupo</strong>, e <strong>recebe pacotes</strong> destinados ao grupo.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// MReceiver.java</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MReceiver</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">inBuf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">256</span><span class="o">]</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">MulticastSocket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MulticastSocket</span><span class="p">(</span><span class="mi">8888</span><span class="p">);</span>
      <span class="n">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="s">&quot;224.2.2.3&quot;</span><span class="p">);</span>
      <span class="n">socket</span><span class="p">.</span><span class="na">joinGroup</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DatagramPacket</span> <span class="n">inPacket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="p">(</span><span class="n">inBuf</span><span class="p">,</span> <span class="n">inBuf</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
        <span class="n">socket</span><span class="p">.</span><span class="na">receive</span><span class="p">(</span><span class="n">inPacket</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="p">(</span><span class="n">inBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inPacket</span><span class="p">.</span><span class="na">getLength</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;From &quot;</span> <span class="o">+</span> <span class="n">inPacket</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; Msg : &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ioe</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Instancie múltiplos processos deste, na mesma máquina e em máquinas distintas.
Agora criemos um programa que envia pacotes para o dito grupo.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">// MSender.java</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.*</span><span class="p">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MSender</span> <span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">byte</span><span class="o">[]</span> <span class="n">outBuf</span><span class="p">;</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">PORT</span> <span class="o">=</span> <span class="mi">8888</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
   <span class="n">DatagramSocket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramSocket</span><span class="p">();</span>
   <span class="kt">long</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="n">InetAddress</span> <span class="n">address</span> <span class="o">=</span> <span class="n">InetAddress</span><span class="p">.</span><span class="na">getByName</span><span class="p">(</span><span class="s">&quot;224.2.2.3&quot;</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
    <span class="n">outBuf</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;Multicast numero &quot;</span> <span class="o">+</span> <span class="n">counter</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">address</span><span class="p">).</span><span class="na">getBytes</span><span class="p">();</span>
    <span class="n">DatagramPacket</span> <span class="n">outPacket</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DatagramPacket</span><span class="p">(</span><span class="n">outBuf</span><span class="p">,</span> <span class="n">outBuf</span><span class="p">.</span><span class="na">length</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">PORT</span><span class="p">);</span>
    <span class="n">socket</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="n">outPacket</span><span class="p">);</span>
    <span class="k">try</span> <span class="p">{</span> <span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span> <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">ie</span><span class="p">)</span> <span class="p">{}</span>
   <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="p">)</span> <span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">ioe</span><span class="p">);</span> <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Observe como a mesma mensagem é recebida pelos vários membros e que como diferentes fontes tem seus pacotes recebidos.</p>
<p>A título de curiosidade, IP-Multicast também está presente em IPv6, mas com algumas pequenas diferenças </p>
<div class="admonition tip">
<p class="admonition-title">IP-Multicast em IPv6<sup id="fnref:ipv6multi"><a class="footnote-ref" href="#fn:ipv6multi">6</a></sup></p>
<p>In IPv6, the left-most bits of an address are used to determine its type. For a multicast address, the first 8 bits are all ones, i.e. FF00::/8. Further, bit 113-116 represent the scope of the address, which can be either one of the following 4: Global, Site-local, Link-local, Node-local.</p>
<p>In addition to unicast and multicast, IPv6 also supports anycast, in which a packet can be sent to any member of the group, but need not be sent to all members.''</p>
</div>
<div class="admonition question">
<p class="admonition-title">Exercício: IP-Multicast</p>
<p>Implemente e teste o seguinte <strong>receiver</strong>, colocando várias instâncias para executar em múltiplos terminais, ao mesmo tempo.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="n">MCAST_GRP</span> <span class="o">=</span> <span class="s1">&#39;224.1.1.1&#39;</span>
<span class="n">MCAST_PORT</span> <span class="o">=</span> <span class="mi">5007</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_UDP</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">MCAST_PORT</span><span class="p">))</span>
<span class="n">mreq</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;=4sl&quot;</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">MCAST_GRP</span><span class="p">),</span> <span class="n">socket</span><span class="o">.</span><span class="n">INADDR_ANY</span><span class="p">)</span>
<span class="c1">#4 bytes (4s) seguidos de um long (l), usando ordem nativa (=)</span>

<span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_IP</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">IP_ADD_MEMBERSHIP</span><span class="p">,</span> <span class="n">mreq</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">10240</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</code></pre></div>
</td></tr></table>
<p>Implemente e teste o seguinte <strong>sender</strong>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">MCAST_GRP</span> <span class="o">=</span> <span class="s1">&#39;224.1.1.1&#39;</span>
<span class="n">MCAST_PORT</span> <span class="o">=</span> <span class="mi">5007</span>

<span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_UDP</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">IPPROTO_IP</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">IP_MULTICAST_TTL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">sock</span><span class="o">.</span><span class="n">sendto</span><span class="p">(</span><span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="p">(</span><span class="n">MCAST_GRP</span><span class="p">,</span> <span class="n">MCAST_PORT</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
</div>
<h2 id="alem-dos-sockets">Além dos Sockets</h2>
<p>O desenvolvimento de sistemas distribuídos usando diretamente Sockets como forma de comunicação entre componentes não é para os fracos de coração.
Sua grande vantagem está no <strong>acesso baixo nível à rede</strong>, e todo o ganho de desempenho que isso pode trazer.
Suas desvantagens, entretanto, são várias:</p>
<ul>
<li>interface de "arquivo" para se ler e escrever bytes;</li>
<li>controle de fluxo de "objetos" é por conta da aplicação, isto é, a aplicação precisa sinalizar quantos bytes serão escritos de um lado, para que o outro saiba quanto ler para obter um "objeto" correto;</li>
<li>logo, a serialização e desserialização de objetos é também por conta da aplicação;</li>
<li>tratamento de desconexões e eventuais reconexões também é gerenciado pela aplicação e nem a tão famosa confiabilidade do TCP ajuda.</li>
</ul>
<p>Enquanto se poderia argumentar que algumas destas desvantagens podem ser descartadas em função da discussão de incluir ou não API na comunicação <a href="http://web.mit.edu/Saltzer/www/publications/endtoend/endtoend.pdf">fim-a-fim</a>, é certo que algumas funcionalidades são ubíquas em aplicações distribuídas.
Foquemo-nos agora na necessidade de representar dados complexos em formato inteligível pelos vários componentes da aplicação distribuída.</p>
<h3 id="representacao-de-dados">Representação de dados</h3>
<p>Exceto por aplicações muito simples, processos em um sistema distribuído trocam dados complexos, por exemplo estruturas ou classes com diversos campos, incluindo valores numéricos de diversos tipos, strings e vetores de bytes, com diversos níveis de aninhamento e somando vários KB.
Neste cenário, vários fatores precisam ser levados em consideração na hora de colocar esta estrutura <em>no fio</em>, como:</p>
<ul>
<li>variações de definições de tipos, por exemplo, <code>inteiro</code>: 8: 16, 32, ou 64 bits?</li>
<li>variações na representação de dados complexos: classe x estrutura   </li>
<li>conjunto de caracteres diferentes: ASCII x UTF</li>
<li>little endian, como x64 e IA-32, ou  big endian como SPARC (&lt; V9), Motorola e PowerPC? ou ainda, flexível como  ARM,  MIPS ou  IA-64?</li>
<li>fim de linha com crlf (DOS) x lf (Unix)?</li>
<li>fragmentação de dados na rede <br />
<a href="http://www.acsa.net/IP/"><img alt="Fragmentação" src="../images/ipfrag.png" /></a></li>
</ul>
<h6>Representação Textual</h6>
<p>Uma abordagem comumente usada é a representação em formato textual "amigável a humanos".
Veja o exemplo de como o protocolo HTTP requisita e recebe uma página HTML.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>telnet www.google.com 80
Trying 187.72.192.217...
Connected to www.google.com.
Escape character is &#39;^]&#39;.
GET / HTTP/1.1
host: www.google.com
                        <span class="err">&lt;</span>=== Linha vazia!
</code></pre></div>
</td></tr></table>
As linhas 5 e 6 são entradas pelo cliente para requisitar a página raiz do sítio <a href="https://www.google.com">www.google.com</a>.
A linha 7, vazia, indica ao servidor que a requisição está terminada.</p>
<p>Em resposta a esta requisição, o servidor envia o seguinte, em que as primeiras linhas trazem metadados da página requisitada e, após a linha em branco, vem a resposta em HTML à requisição.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>HTTP/1.1 302 Found
Location: http://www.google.com.br/?gws_rd=cr<span class="err">&amp;</span>ei=HTDqWJ3BDYe-wATs_a3ACA
Cache-Control: private
Content-Type: text/html; charset=UTF-8
P3P: CP=&quot;This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.&quot;
Date: Sun, 09 Apr 2017 12:59:09 GMT
Server: gws
Content-Length: 262
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
Set-Cookie: NID=100=NB_AruuFWL0hXk2-h7VDduHO_UkjAr6RaqgG7VbccTsfLzFfhxEKx21Xpa2EH7IgshgczE9vU4W1TyKsa07wQeuZosl5DbyZluR1ViDRf0C-5lRpd9cCpCD5JXXjy-UE; expires=Mon, 09-Oct-2017 12:59:09 GMT; path=/; domain=.google.com; HttpOnly

<span class="p">&lt;</span><span class="nt">HTML</span><span class="p">&gt;&lt;</span><span class="nt">HEAD</span><span class="p">&gt;&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">TITLE</span><span class="p">&gt;</span>302 Moved<span class="p">&lt;/</span><span class="nt">TITLE</span><span class="p">&gt;&lt;/</span><span class="nt">HEAD</span><span class="p">&gt;&lt;</span><span class="nt">BODY</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">H1</span><span class="p">&gt;</span>302 Moved<span class="p">&lt;/</span><span class="nt">H1</span><span class="p">&gt;</span>
The document has moved
<span class="p">&lt;</span><span class="nt">A</span> <span class="na">HREF</span><span class="o">=</span><span class="s">&quot;http://www.google.com.br/?gws_rd=cr&amp;amp;ei=HTDqWJ3BDYe-wATs_a3ACA&quot;</span><span class="p">&gt;</span>here<span class="p">&lt;/</span><span class="nt">A</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">BODY</span><span class="p">&gt;&lt;/</span><span class="nt">HTML</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Representações textuais são usadas em diversos protocolos como SMTP, POP, e telnet.
Algumas destas representações seguem padrões formalizados, o que facilita a geração e interpretação dos dados. 
Dois padrões bem conhecidas são XML e JSON.</p>
<p><a href="https://xml.org">XML</a> é o acrônimo para <em>Extensible Markup Language</em>, ou seja, uma linguagem marcação que pode ser estendida para representar diferentes tipos de informação.
A HTML, por exemplo, é uma instância de XML destinada à representação de hipertexto (A bem da verdade, XML foi uma generalização de HTML).</p>
<p>Por exemplo, para representarmos os dados relativos à uma pessoa, podemos ter uma instância XML assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;person&gt;</span>
    <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;id&gt;</span>112234556<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;email&gt;</span>jdoe@example.com<span class="nt">&lt;/email&gt;</span>
    <span class="nt">&lt;telephones&gt;</span>
       <span class="nt">&lt;telephone</span> <span class="na">type=</span><span class="s">&quot;mobile&quot;</span><span class="nt">&gt;</span>123 321 123<span class="nt">&lt;/telephone&gt;</span>
       <span class="nt">&lt;telephone</span> <span class="na">type=</span><span class="s">&quot;home&quot;</span><span class="nt">&gt;</span>321 123 321<span class="nt">&lt;/telephone&gt;</span>
    <span class="nt">&lt;/telephones&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Uma das grandes vantagens do uso de XML é a possibilidade de se formalizar o que pode ou não estar em um arquivo para um certo domínio utilizando um <a href="https://docs.microsoft.com/pt-br/dotnet/standard/data/xml/xml-document-object-model-dom">XML <em>Domain Object Model</em></a>. Há, por exemplo, modelos para representação de documentos de texto, governos eletrônicos, representação de conhecimento, <a href="http://www.xml.org/">etc</a>.
Sua maior desvantagem é que é muito verborrágico e por vezes complicado de se usar, abrindo alas para o seu mais famoso concorrente, JSON.</p>
<p><a href="http://json.org/">JSON</a> é o acrônimo de <em>Javascript Object Notation</em>, isto é, o formato para representação de objetos da linguagem Javascript.
Devido à sua simplicidade e versatilidade, entretanto, foi adotado como forma de representação de dados em sistemas desenvolvidos nas mais diferentes linguagens.
O mesmo exemplo visto anteriormente, em XML, é representado em JSON assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">112234556</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;jdoe@example.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;telephones&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mobile&quot;</span><span class="p">,</span> <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;123 321 123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;home&quot;</span><span class="p">,</span> <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;321 123 321&quot;</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Em Python, por exemplo, JSON são gerados e interpretados nativamente, sem a necessidade de <em>frameworks</em> externos, facilitando seu uso.
Mas de fato, a opção final por XML ou JSON é questão de preferência, uma vez que os dois formatos são, de fato, equivalentes na questão da representação de informação.</p>
<p>Outros formatos, binários, oferecem vantagens no uso de espaço para armazenar e transmitir dados, e por isso são frequentemente usados como forma de <em>serialização</em> de dados em sistemas distribuídos, isto é, na transformação de TAD para sequências de bytes que seguirão "no fio".</p>
<ul>
<li>ASN.1 (Abstract Syntax Notation), pela ISO</li>
<li>XDR (eXternal Data Representation)</li>
<li>Java serialization</li>
<li>Google Protocol Buffers</li>
<li>Thrift</li>
</ul>
<p>ASN.1 e XDR são de interesse histórico, mas não os discutiremos aqui.
Quanto à serialização feita nativamente pelo Java, por meio de <code>ObjectOutputStreams</code>, como neste <a href="https://www.tutorialspoint.com/java/java_serialization.htm">exemplo</a>, embora seja tentadora para quem usa Java, é necessário saber que ela é restrita à JVM e que usa muito espaço, embora minimize riscos de uma desserialização para uma classe diferente.</p>
<p>Nos foquemos nas outras alternativas listadas, protobuf e Thrift, que podem levar a representações binárias e textuais.</p>
<h6>Protocol Buffers</h6>
<p>Nas palavras dos <a href="https://developers.google.com/protocol-buffers/">criadores</a>,</p>
<blockquote>
<p>Protocol buffers are a language-neutral, platform-neutral extensible mechanism for serializing structured data.</p>
</blockquote>
<p>Por meio de protobuf, é possível estruturar dados e gerar o código correspondente em diversas linguagens, for forma compartilhável entre as mesmas. Veja o exemplo a seguir, que especifica os dados referentes a uma pessoa. 
Observe a presença de campos de preenchimento opcional (<strong>optional</strong>), de enumerações (<strong>enum</strong>), e de coleções (<strong>repeated</strong>).</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">message</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">required</span> <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">required</span> <span class="kt">int32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">optional</span> <span class="kt">string</span> <span class="na">email</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="n">PhoneType</span> <span class="p">{</span>
        <span class="na">MOBILE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="na">HOME</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="na">WORK</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">message</span> <span class="nc">PhoneNumber</span> <span class="p">{</span>
        <span class="k">required</span> <span class="kt">string</span> <span class="na">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">optional</span> <span class="n">PhoneType</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="k">default</span> <span class="o">=</span> <span class="n">HOME</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">repeated</span> <span class="n">PhoneNumber</span> <span class="na">phone</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Além dos tipos usados no exemplo, diversos outros tipos primitivos estão disponíveis:</p>
<ul>
<li><code>bool</code>: boolean (true/false)</li>
<li><code>double</code>: 64-bit; ponto-flutuante </li>
<li><code>float</code>: 32-bit; ponto-flutuante </li>
<li><code>i32</code>: 32-bit; inteiro sinalizado </li>
<li><code>i64</code>: 64-bit; inteiro sinalizado</li>
<li><code>siXX</code>: signed</li>
<li><code>uiXX</code>: unsigned</li>
<li><code>sfixedXX</code>: codificação de tamanho fixo</li>
<li><code>bytes</code>: 8-bit; inteiro sinalizado</li>
<li><code>string</code>: string UTF-8 ou ASCII 7-bit</li>
</ul>
<p>Além destes, também pode ser usado um tipo indefinido e adaptável, <a href="https://developers.google.com/protocol-buffers/docs/proto3#any"><code>Any</code></a>, bem como coleções.</p>
<p>A especificação protobuf pode ser traduzida para <a href="https://developers.google.com/protocol-buffers/docs/proto3">múltiplas linguagens</a>
Por exemplo, se a tradução for feita para C++, o tipo <code>message</code> resulta em uma classe de mesmo nome, com funcionalidades para serialização e desserialização do objeto, como no exemplo a seguir.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">//Instancia person e salva conteúdo em arquivo</span>
<span class="n">Person</span> <span class="n">person</span><span class="p">;</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&quot;John Doe&quot;</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_id</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_email</span><span class="p">(</span><span class="s">&quot;jdoe@example.com&quot;</span><span class="p">);</span>
<span class="n">fstream</span> <span class="nf">output</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">SerializeToOstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">);</span>

<span class="c1">//Instancia Person e o inicializa com dados do arquivo</span>
<span class="n">fstream</span> <span class="nf">input</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="n">Person</span> <span class="n">person</span><span class="p">;</span>
<span class="n">person</span><span class="p">.</span><span class="n">ParseFromIstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Name: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;E-mail: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">email</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
<p>De acordo com <em>benchmarks</em> do próprio <a href="https://developers.google.com/protocol-buffers/docs/overview">projeto</a>, a operação em XML seria mais ordens de grandeza mais lenta e ocuparia mais espaço.</p>
<blockquote>
<p>When this message is encoded to the protocol buffer binary format, it would probably be 28 bytes long and take around 100-200 nanoseconds to parse. The XML version is at least 69 bytes if you remove whitespace, and would take around 5,000-10,000 nanoseconds to parse.</p>
</blockquote>
<h6>Thrift</h6>
<p>Originalmente desenvolvido pela Facebook, <a href="https://thrift.apache.org/">Apache Thrift</a> é um arcabouço desenvolvimento de serviços multi-linguagens. Isto, mesmo que por enquanto nos foquemos no aspecto da representação de dados desta tecnologia, veremos depois que pode ser usado para executar a troca de dados entre processos.<sup id="fnref:fbthrift"><a class="footnote-ref" href="#fn:fbthrift">7</a></sup>
Comparado ao protobuf, ele possui praticamente as mesmas funcionalidades, i.e., a definição de estruturas de dados complexos e geração de código para serialização e desserialização de instâncias destas estruturas.
O mesmo exemplo acima, que define uma estrutura para representar pessoas e seus contatos, ficaria assim em thrift.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="nc">PhoneType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">MOBILE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">HOME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">WORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">struct</span><span class="w"> </span><span class="nc">PhoneNumber</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="k">required</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">number</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="n">PhoneType</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">PhoneType.HOME</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kd">struct</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="k">required</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="k">required</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="n">id</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">email</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="kt">list</span><span class="p">&lt;</span><span class="n">PhoneNumber</span><span class="p">&gt;</span><span class="w"> </span><span class="n">phone</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span>

<span class="kd">exception</span><span class="w"> </span><span class="nc">PessoaNaoEncontrada</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="kt">i64</span><span class="w"> </span><span class="n">hora</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">chaveProcurada</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table>
<p>Usar a classe correspondente em Java, depois da geração de código pelo compilador <code>thriftc</code>, é bem simples.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Person</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="p">(</span><span class="s">&quot;John Doe&quot;</span><span class="p">,</span><span class="mi">112234556</span><span class="p">,</span><span class="s">&quot;jdoe@example.com&quot;</span><span class="p">,</span> <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">())</span>
</code></pre></div>
</td></tr></table>
<p>Observe que além do uso de coleções e enumerações, demonstradas no exemplo, os mesmos tipos básicos também estão disponíveis.</p>
<ul>
<li>bool: boolean (true/false)</li>
<li>byte: 8-bit; inteiro sinalizado</li>
<li>i16: 16-bit; inteiro sinalizado</li>
<li>i32: 32-bit; inteiro sinalizado</li>
<li>i64: 64-bit; inteiro sinalizado</li>
<li>double: 64-bit; ponto-flutuante </li>
<li>string: string UTF-8</li>
<li>binary: sequência de bytes</li>
<li>coleções: List, Map, Set</li>
</ul>
<p>Uma vez que tenhamos facilidades para representar dados complexos e transformá-los em sequências de bytes, e de volta, pensemos em como podemos definir, de forma simplificada, serviços que manipulam estes dados.
Estas funcionalidades são normalmente implementadas por <em>frameworks</em> de comunicação de mais alto nível que, jargão da área de sistemas distribuídos, são denominados <strong><em>middleware</em></strong>.</p>
<h2 id="middleware-e-transparencia">Middleware e Transparência</h2>
<details class="info inline end"><summary>Middleware</summary><ul>
<li>software</li>
<li>hardware/OS</li>
<li>aplicação</li>
<li>diversas funcionalidades</li>
</ul>
</details>
<p>De acordo com <a href="https://www.amazon.com/Distributed-Systems-Principles-Paradigms-Tanenbaum-dp-B00DEKA7T2/dp/B00DEKA7T2/ref=mt_hardcover?_encoding=UTF8&amp;me=&amp;qid=">Tanenbaum &amp; Van Steen</a>, <em>middleware</em> é </p>
<blockquote>
<p>... the software layer that lies between the operating system and applications on each side of a distributed computing system in a network.</p>
</blockquote>
<p>Isto é, o <em>middleware</em> é a camada <em>ware</em> que fica no <em>middle</em>, entre, o <em>software</em> e o <em>hardware</em>. 
Software, no caso, é a aplicação distribuída sendo desenvolvida e hardware é a <strong>abstração</strong> do <em>host</em> em que se executam os componentes, provida pelo sistema operacional.
Uso aqui o termo <strong>abstração</strong> porquê o sistema operacional pode encapsular <em>hardware</em> real, mas também pode encapsular outra abstração de <em>hardware</em>, por exemplo, uma máquina virtual ou contêiner.</p>
<p>A figura seguinte   mostra um exemplo com três aplicações executando sobre um <em>middleware</em>, que por sua vez é executado sobre diferentes sistemas operacionais, em <em>hosts</em>  conectados por uma rede de comunicação. </p>
<p><img alt="Middleware" src="../images/01-01.png" style="width:500px" /><sup id="fnref:0101"><a class="footnote-ref" href="#fn:0101">8</a></sup></p>
<p>Com este cenário em mente, é importante entender o que diz <a href="https://web.archive.org/web/20050507151935/http://middleware.objectweb.org/">Sacha Krakowiak</a> quando afirma que as principais funções do <em>middleware</em> são:</p>
<ul>
<li>esconder a distribuição e o fato de que um aplicação é geralmente composta por múltiplas partes, executando em localizações geograficamente distintas,</li>
<li>esconder a heterogeneidade dos vários componentes de hardware, sistemas operacionais e protocolos de comunicação</li>
<li>prover interfaces uniformes, de alto nível e padronizadas para os desenvolvedores de aplicação e integradores, de forma que aplicações possam ser facilmente compostas, reusadas, portadas e feitas interoperáveis.</li>
</ul>
<p>Assim, os <em>middleware</em> facilitam a conexão entre componentes e permitem o uso de protocolos mais abstratos que as operações de  <code>write(byte[])</code> e <code>read(): byte[]</code> dos protocolos de baixo nível, escondendo a complexidade da coordenação de sistemas independentes.
Desenvolver sistemas distribuídos sem usar um <em>middleware</em> é como desenvolver um aplicativo sem usar quaisquer bibliotecas: possível, mas complicado, e estará certamente reinventando a roda. Isto é, você praticamente tem que refazer o <em>middleware</em> antes de desenvolver o sistema em si.</p>
<p>Idealmente, com o <em>middleware</em>, o desenvolvedor conseguiria facilmente implementar uma aplicação em que a distribuição fosse totalmente transparente, levando o sistema, uma coleção de sistemas computacionais (software ou hardware) independentes, a se apresentar para o usuário como <strong>um sistema único</strong>, monolítico.
Pense no browser e na WWW, por exemplo: o quanto você sabe sobre as páginas estarem particionadas em milhões de servidores? Isso é o que chamamos de <strong>transparência</strong>.</p>
<details class="info inline end"><summary>Transparência Total</summary><p>Acesso + Localização + Relocação + Migração + Replicação + Falha</p>
</details>
<p>Se não há qualquer indício de que a aplicação é distribuída, então temos <strong>transparência total</strong>.<br />
Podemos quebrar esta transparência total em várias transparências mais simples: <strong>Acesso</strong>, <strong>Localização</strong>, <strong>Relocação</strong>,
<strong>Migração</strong>, <strong>Replicação</strong>, e <strong>Falha</strong>.
Vejamos cada uma destas separadamente.</p>
<h6>Transparência de Acesso</h6>
<details class="info inline end"><summary>Transparência de Acesso</summary><ul>
<li>como se apresenta</li>
<li>representação de dados<ul>
<li>arquitetura</li>
<li>OS</li>
<li>linguagem</li>
</ul>
</li>
<li>padrões abertos e bem conhecidos.</li>
</ul>
</details>
<p>A transparência de acesso diz respeito à representação de dados e mecanismos de invocação (arquitetura, formatos, linguagens...).
Cada computador tem uma arquitetura e uma forma de representar seus dados. Por exemplo, considere os padrões para representação de números em ponto flutuante IEEE e IBM. Ambos dividem os bits em sinal, expoente e mantissa, mas com tamanhos diferentes.</p>
<div class="admonition note">
<p class="admonition-title">IEEE<sup id="fnref:IEEEFP"><a class="footnote-ref" href="#fn:IEEEFP">9</a></sup></p>
<table>
<thead>
<tr>
<th align="center">Precisão</th>
<th align="center">Tamanho total (bits)</th>
<th align="center">Sinal (bits)</th>
<th align="center">Expoente (bits)</th>
<th align="center">Mantissa (bits)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Half</td>
<td align="center">16</td>
<td align="center">1</td>
<td align="center">5</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">Single</td>
<td align="center">32</td>
<td align="center">1</td>
<td align="center">8</td>
<td align="center">23</td>
</tr>
<tr>
<td align="center">Double</td>
<td align="center">64</td>
<td align="center">1</td>
<td align="center">11</td>
<td align="center">52</td>
</tr>
<tr>
<td align="center">Quadruple</td>
<td align="center">128</td>
<td align="center">1</td>
<td align="center">15</td>
<td align="center">112</td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">IBM<sup id="fnref:IBMFP"><a class="footnote-ref" href="#fn:IBMFP">10</a></sup></p>
<table>
<thead>
<tr>
<th align="center">Precisão</th>
<th align="center">Tamanho total (bits)</th>
<th align="center">Sinal (bits)</th>
<th align="center">Expoente (bits)</th>
<th align="center">Mantissa (bits)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Single</td>
<td align="center">32</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">24</td>
</tr>
<tr>
<td align="center">Double</td>
<td align="center">64</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">56</td>
</tr>
<tr>
<td align="center">Quadruple</td>
<td align="center">128</td>
<td align="center">1</td>
<td align="center">7</td>
<td align="center">112 (8b ignorados)</td>
</tr>
</tbody>
</table>
</div>
<p>E se dois componentes de um SD executam em máquinas com arquiteturas diferentes, como trocam números em ponto flutuante?
É preciso que usem um padrão conhecido por ambos os <em>hosts</em>, seja o padrão a arquitetura "nativa" do host ou um padrão intermediário, definido pelo <em>middleware</em>.</p>
<p>A mesma questão é válida para representações de strings e classes, e diferenças de sistemas operacionais e linguagens.
No caso específico das strings, pense em um programa escrito em linguagem C e que este programa deva comunicar-se com um outro, escrito em Java, e trocar strings com o mesmo.
Enquanto em C uma string é uma sequência de bytes imprimíveis terminadas por um <code>\0</code>, em Java uma string é uma classe que encapsula uma sequência de chars, sendo que cada <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/intl/overview.html">char é um código 16 bits</a> representativo de um código Unicode<sup id="fnref:stringjava"><a class="footnote-ref" href="#fn:stringjava">11</a></sup>.
Como transferir strings entre duas plataformas?  Não fazê-lo? Simplificar a string Java?  Estender a string C?<br />
Para se tentar obter transparência de acesso, é importante que se use <strong>padrões</strong> implementados em múltiplas arquiteturas, <strong>abertos</strong>  e bem conhecidos, com <strong>interfaces bem definidas</strong>.</p>
<h6>Transparência de Localização</h6>
<details class="info inline end"><summary>Transparência de localização</summary><ul>
<li>onde está o objeto</li>
<li>latência<ul>
<li>cache</li>
<li>paralelismo</li>
<li>programação assíncrona</li>
<li>arquiteturas reativas</li>
</ul>
</li>
</ul>
</details>
<p>A transparência de localização diz respeito a onde está o objeto acessado pela aplicação, seja um BD, página Web ou serviço de echo: pouco importa ao usuário, se está dentro da mesma máquina de onde executa o acesso, se na sala ao lado ou em um servidor do outro lado do globo, desde que o serviço seja provido de forma rápida e confiável.
A esta transparência é essencial uma boa distribuição do serviço, sobre uma rede com baixa latência, ou o uso de técnicas que permitam esconder a latência.</p>
<h6># Escondendo a Latência</h6>
<p>Para se esconder a latência, várias táticas são utilizáveis:</p>
<ul>
<li><em>Caching</em> de dados<ul>
<li>Em vez de sempre buscar os dados no servidor, mantenha cópias locais dos dados que mudam menos (e.g., o CSS do <em>stack overflow</em>).</li>
</ul>
</li>
<li>Use paralelismo<ul>
<li>Em vez de validar formulário após preenchimento de cada campo, valide em paralelo enquanto usuário preenche o campo seguinte.</li>
<li>Use <em>callbacks</em> para indicar campos com problemas a serem corrigidos.</li>
<li>Saiba que nem todo problema é paralelizável, por exemplo, autenticação</li>
</ul>
</li>
<li>Use programação assíncrona<ul>
<li>AsyncIO</li>
<li>C# <a href="https://docs.microsoft.com/en-us/dotnet/csharp/async">await/async</a></li>
<li><a href="https://en.wikipedia.org/wiki/Futures_and_promises">Futures e Promises</a></li>
</ul>
</li>
</ul>
<p>Outra forma de diminuir latência é trazer para próximo do usuário parte da computação.
Isto é comumente feito com a interface com usuário,  mas pode ser usado também para outras partes do sistema. 
Como exemplo do primeiro, pense em consoles de video-game que fazem o processamento gráfico pesado de jogos online na casa do usuário<sup id="fnref:stadia"><a class="footnote-ref" href="#fn:stadia">12</a></sup>.
Como exemplo do segundo, pense em aplicativos que mantém os dados em celulares até que uma boa conexão, por exemplo WiFi, esteja disponível para sincronizar com o servidor.</p>
<p>De forma geral, pense em esconder latência pelos seguintes passos:</p>
<ul>
<li>Distribua tarefas</li>
<li>Delegue computação aos clientes (e.g., JavaScript e Applets Java)</li>
<li>Particione dados entre servidores (e.g., Domain Name Service e World Wide Web) para dividir a carga e aumentar a vazão</li>
<li>Aproxime dados dos clientes</li>
<li>Mantenha cópias de dados em múltiplos lugares.</li>
<li>Atualize dados de acordo com necessidade (e.g., cache do navegador, com código do google.com sendo atualizado a cada 4 dias)</li>
</ul>
<h6>Transparência de Relocação</h6>
<details class="info inline end"><summary>Transparência de relocação</summary><ul>
<li>como se movimenta</li>
<li>visto por clientes</li>
</ul>
</details>
<p>As vezes componentes do sistema distribuído precisam ser movimentados de uma localização à outra, por exemplo porquê um novo <em>host</em> foi contratado.
Se implementadas corretamente, as técnicas que entregam transparência de localização não deixam que o cliente perceba a movimentação, no que chamamos transparência de Relocação.</p>
<ul>
<li>Rede de baixa latência</li>
<li>Distribuição inteligente<ul>
<li>E.g: Serviços de nome</li>
</ul>
</li>
<li>Múltiplas cópias<ul>
<li>Cópias temporárias</li>
</ul>
</li>
</ul>
<h6>Transparência de Migração</h6>
<details class="info inline end"><summary>Transparência de migração</summary><ul>
<li>como se movimenta</li>
<li>visto por si mesmo</li>
</ul>
</details>
<p>Do ponto de vista do próprio serviço, não perceber que se está sendo movimentado é chamado transparência de Migração.
Um serviço com esta propriedade, não precisa ser parado e reconfigurado quando a mudança acontece.
Uma das formas de se implementar esta propriedade é através da migração provida por máquinas virtuais, usado, por exemplo, para consolidar o uso de servidores em nuvens computacionais.
Veja o exemplo do VMotion da VMware.</p>
<p><img alt="http://hyaking.com/wp-content/uploads/2017/01/Hyaking_Image_vmware-vmotion.jpg" src="../images/vmotion.jpg" /></p>
<p>Na verdade, a movimentação neste cenário, é uma cópia da máquina virtual. Uma vez que a cópia esteja próxima do fim, a imagem original é congelada, a cópia concluída, e há um chaveamento na rede para se direcionar toda comunicação para nova cópia. O máquina original é então descartada.</p>
<h6>Transparência de Replicação</h6>
<details class="info inline end"><summary>Transparência de replicação</summary><ul>
<li>redundância</li>
<li>visto por clientes</li>
</ul>
</details>
<p>A capacidade de ter cópias de um serviço e de direcionar trabalho de uma para outra é também útil para se obter transparência no caso de falhas.
Isto porquê para se manter um serviço funcional a despeito de falhas, é preciso ter múltiplas cópias, prontas para funcionar a qualquer momento.</p>
<p>Dependendo das garantias desejadas na manutenção da <strong>consistência</strong> entre as cópias, o custo pode variar muito, de forma que para se ter um custo menor, tem-se garantias mais fracas, por exemplo, que as réplicas tem um <strong>atraso</strong> entre elas de no máximo <span class="arithmatex">\(X\)</span> minutos. Este é um dilema parecido com o TCP x UDP, em que mais garantias implicam em maior custo de comunicação.</p>
<p>Algumas aplicações toleram inconsistências e podem viver com menores custos. Um exemplo famoso é o dos "carrinhos de compra" da <a href="https://www.allthingsdistributed.com/2008/12/eventually_consistent.html">Amazon.com</a>, que podem fechar pedidos com conteúdo diferente do desejado pelo cliente.</p>
<p>Outras aplicações são normalmente construídas com requisitos de consistência forte entre as réplicas, como sistemas financeiros.
Para estas aplicações, uma técnica importante para se conseguir replicação é o uso de <em>frameworks</em> de <strong>comunicação em grupo</strong>, que entregam para múltiplas instâncias de um mesmo serviço, as mesmas mensagens, permitindo que elas se mantenham como cópias.
Esta técnica funciona se os serviços forem máquinas de estado determinísticas, que consideram como eventos as mensagens entregues pelo protocolo de comunicação em grupo e é denominada <a href="https://en.wikipedia.org/wiki/State_machine_replication"><strong>replicação de máquinas de estado</strong></a>.</p>
<details class="info inline end"><summary>Replicação de Máquina de Estados</summary><ul>
<li>determinística</li>
<li>mesmo estado inicial</li>
<li>mesmos eventos</li>
<li>mesmo estado final</li>
<li>atraso entre réplicas</li>
</ul>
</details>
<div class="mermaid">stateDiagram
    ei: Estado Inicial
    e1: Estado 1
    e2: Estado 2
    e3: Estado 3
    en: Estado N

    ei --&gt; e1
    e1 --&gt; e2
    e2 --&gt; e1
    e2 --&gt; e3
    e3 --&gt; e2
    e1 --&gt; en
    e3 --&gt; en</div>
<details class="todo"><summary>Todo</summary><p>Figura com state machine replication</p>
</details>
<p>Novamente é preciso chamar à atenção a questão dos custos desta técnica.
Replicação de Máquinas de Estados é muito custosa e por isso faz-se um esforço para não utilizá-la ou para utilizá-la em "cantinhos" do sistema onde inconsistências são absolutamente caras demais para sere permitidas.
Isto porquê manter múltiplas cópias <span class="arithmatex">\(\Rightarrow\)</span> sincronização <span class="arithmatex">\(\Rightarrow\)</span> custos. 
Se houver mudanças frequentes nos dados, tal custo precisa ser pago também frequentemente.
Mitigações incluem uso de réplicas temporárias, protocolos de invalidação de cache, contratação de redes com mais largura de banda  e menor latência, sendo que estes últimos esbarram em limitações financeiras e físicas.</p>
<h6>Transparência de Concorrência</h6>
<details class="info inline end"><summary>Transparência de concorrência</summary><ul>
<li>obliviedade a outros serviços</li>
<li>visto por clientes</li>
</ul>
</details>
<p>Outra transparência almejável é de concorrência, isto é, imperceptibilidade quanto ao fato de que o serviço está executando concorrentemente a outros serviços e sendo acessado por outros clientes.
Isto é importante tanto em termos de segurança, no sentido de que um cliente não deveria acessar os dados do outro, caso isso seja um requisito do sistema, quanto tem termos de desempenho.
Nuvens computacionais são um exemplo de onde este tipo de transparência é essencial.</p>
<p>Considere um serviço de banco de dados em uma nuvem qualquer. Para prover a mesma interface com a qual usuários estão acostumados a anos, é possível que este serviço seja simplesmente um <em>wrapper</em> ao redor do SGBD que se comprava e instalava <em>in-house</em> anteriormente.
Para se tornar viável, contudo, uma mesma instância deve servir múltiplos clientes, os <em>tenants</em>, sem que a carga de trabalho introduzida por um, interfira no desempenho do outro. No meio, chamamos esta propriedade de <em>multi-tenancy</em>, mas é apenas um exemplo de transparência de concorrência.</p>
<ul>
<li><img alt="https://cdn.jjude.com/mt-models.png" src="../images/multitenancy_models.png" /></li>
</ul>
<p>Esta transparência está fundamentalmente ligada à escalabilidade, isto é, à adequação dos <em>pool</em> de recursos às demandas dos clientes: se mais clientes estão presentes, então aumente a quantidade de servidores (<em>scale up</em>) e separe as cargas (<em>sharding</em>); se menos clientes estão presentes, então desligue algumas máquinas (<em>scale down</em>) e consolide recursos.</p>
<h6>Desafios para se obter transparência</h6>
<p>Apesar de desejáveis, as transparência discutidas são difíceis de se conseguir, principalmente se em conjunto.
Isto porquê, do <strong>ponto de vista de usuários</strong> espalhados pelo globo, atrás de redes heterogêneas e com possibilidade de erros, acontecerão atrasos e perdas na comunicação, denunciando a distribuição.</p>
<p>Do <strong>ponto de vista do desenvolvedor</strong>, é preciso tomar decisões baseado em premissas ligadas à realidade da rede. Por exemplo, se uma requisição não foi respondida, quanto tempo um cliente deve esperar antes de reenviá-la, possivelmente para outro servidor, sem incorrer em risco significativo da requisição ser processada duas vezes? A resposta para esta pergunta é muito mais complicada do que pode parecer.</p>
<p><strong>De forma geral</strong>, qualquer aumento de transparência tem um custo, seja em termos monetários (e.g., contratação de enlace dedicado ou de <em>host</em> em outra posição geográfica), ou em termos de desempenho (e.g., coordenar a entrega de mensagens em sistemas de comunicação em grupo).</p>
<p>Provavelmente os maiores obstáculos para se alcançar os diversos tipos de  transparência são impostos pela parte da infraestrutura que torna o sistema distribuído possível, a rede.
Para entender o porquê, vejamos algumas premissas normalmente assumidas sobre a rede que não são, definitivamente, verdade:</p>
<ul>
<li>A latência é zero.</li>
<li>A largura de banda é infinita.</li>
<li>A rede é confiável.</li>
<li>A rede é segura.</li>
<li>A rede é homogênea.</li>
<li>A rede é estática.</li>
<li>A rede tem acesso grátis.</li>
<li>A rede é administrada por você ou alguém acessível.</li>
</ul>
<h2 id="comunicacao-orientada-a-mensagens">Comunicação orientada a Mensagens</h2>
<p>Nesta seção, discutiremos <em>middleware</em> focados nas mensagens trocadas entre processos e não em como estas mensagens são tratadas, assim como fizemos no segundo capítulo destas notas, em que revisamos o uso de <em>sockets</em> na comunicação entre processos, afinal, <em>sockets</em> são uma tecnologia para a troca de mensagens entre processos. 
Contudo, <em>sockets</em> são uma abstração de baixo nível, difíceis de se usar corretamente, então aqui nós nos focaremos em abstrações de mais alto nível.</p>
<h3 id="message-passing-interface">Message Passing Interface</h3>
<p>Subindo as camadas de abstração uma tecnologia interessante é a <strong><em>Message Passing Interface</em></strong>, muito usada para coordenar a distribuição e agregação de dados em aplicações em HPC (<em>high performance computing</em>). 
Quatro das operações providas pelas implementações de MPI são mostradas na figura a seguir, responsáveis por espalhar dados (<strong><em>broadcast</em></strong>), fragmentos dos dados (<strong><em>scatter</em></strong>), coletar e compor fragmentos (<strong><em>gather</em></strong>), ou reduzir resultados parciais (<strong><em>reduce</em></strong>).</p>
<p><img alt="CFD" src="../images/mpi.jpeg" /></p>
<p>Por exemplo, suponha que você esteja desenvolvendo uma aplicação que fará buscas de caminhos em grafos, com várias propriedades distintas.
Digamos que precise calcular uma rota entre vários vértices do grafo usando caminhadas aleatórias. Usando a função <em>broadcast</em>, você pode enviar uma cópia do grafo para cada processo disponível para que independentemente calcule alguma rota. </p>
<p><img alt="MPI" src="../drawings/mpi.drawio-0.svg" /></p>
<p>Ao final do cálculo, um processo pode coletar os resultados de cada processo e escolher a melhor entre as rotas encontradas usando a função <em>reduction</em>.</p>
<p><img alt="MPI" src="../drawings/mpi.drawio-3.svg" /></p>
<p>Se preferir que cada busca se restrinja a um subgrafo, onde os vários subgrafos são complementares, então a função <em>scatter</em> seria usada.<sup id="fnref:scatter"><a class="footnote-ref" href="#fn:scatter">13</a></sup></p>
<p><img alt="MPI" src="../drawings/mpi.drawio-1.svg" /></p>
<p>Finalmente, a função <em>gather</em> poderia ser usada para coletar subgrafos com rotas encontradas e montar um grafo com todas as alternativas.</p>
<p><img alt="MPI" src="../drawings/mpi.drawio-2.svg" /></p>
<h3 id="filas-de-mensagem">Filas de mensagem</h3>
<details class="todo"><summary>TODO</summary><ul>
<li>Conteúdo. </li>
<li>Gancho para pub/sub.</li>
</ul>
</details>
<h3 id="publishsubscribe">Publish/Subscribe</h3>
<p>Em capítulos anteriores, estudamos a arquitetura cliente/servidor, em que o cliente envia mensagens diretamente ao um servidor para que este, em reação à mensagem, realize alguma operação.
Na arquitetura <em>publish/subscribe</em> (ou <em>pub/sub</em>), há também a figura de um processo envia mensagens, o <strong><em>publisher</em></strong>, e a figura do que recebe mensagens, o <strong><em>subscriber</em></strong>, mas com pelo menos duas diferenças fundamentais que fazem com pub/sub se apresente como uma alternativa à cliente/servidor.
Em primeiro lugar, os dois processos nunca comunicam diretamente e não precisam nem saber da existência do outro ou sequer executarem ao mesmo tempo, estando <strong>desacoplados</strong>.
Em segundo lugar, mensagens são associadas a <strong>tópicos</strong>, aos quais os <strong><em>subscribers</em></strong> se subscrevem; somente tópicos de interesse são entregues aos <em>subscribers</em>, em um tipo de <strong>filtragem</strong>.</p>
<p><img alt="https://aws.amazon.com/pub-sub-messaging/" src="../images/aws_pubsub.png" /></p>
<h6>Desacoplamento</h6>
<p>Um dos aspectos mais importantes proporcionados pelo padrão <em>pub/sub</em> é o desacoplamento entre as partes envolvidas, o qual ocorre em várias dimensões:</p>
<ul>
<li>Espaço: <em>publishers</em> e <em>subscribers</em> não precisam se conhecer (por exemplo, não há necessidade de informar endereço IP e porta de cada um).</li>
<li>Tempo: <em>publishers</em> e <em>subscribers</em> não precisam nem estar em execução ao mesmo tempo.</li>
<li>Sincronização: operações em cada componente não precisa ser interrompida durante a publicação ou recebimento.</li>
</ul>
<p>Este desacoplamento é implementado por meio de <strong><em>brokers</em></strong>, processos especiais que servem de ponto de conexão entre <em>publishers</em>  e <em>subscribers</em>, que dão persistência às mensagens (caso necessário), e distribuem as mensagens a quem devido.</p>
<h6>Filtragem</h6>
<p>O <em>broker</em> tem um papel fundamental pois permite a especificação de diversos níveis de filtragem:</p>
<ul>
<li>Baseada em assunto: <em>subscribers</em> se registram para receber mensagens de um ou mais tópicos de interesse. Em geral esses tópicos são strings com um formato hierárquico, por exemplo <code>/devices/sensor/+/temperature</code>.</li>
<li>Baseada em conteúdo: baseada em linguagem de filtragem de conteúdo específica. <em>Downside:</em> mensagem não pode ser criptografada.</li>
<li>Baseada em tipo: leva em consideração o tipo ou classe de uma mensagem ou evento, como o tipo <em>Exception</em> e subtipos, por exemplo.</li>
</ul>
<p>Observe que uma mesma mensagem pode ser entregue a múltiplos <em>subscribers</em> se pertencer a um tópico de interesse em comum e que um mesmo <em>subscriber</em> pode se interessar por diversos tópicos.</p>
<p><img alt="https://cloud.google.com/pubsub/docs/overview" src="../images/google_pubsub.svg" /></p>
<h4 id="arquiteturas-baseadas-em-pubsub">Arquiteturas baseadas em Pub/Sub</h4>
<p>Embora simples, frameworks pub/sub permitem a implementação de arquiteturas complexas, como o exemplo da figura a seguir.</p>
<p><img alt="https://cloud.google.com/pubsub/docs/overview" src="../images/google_pubsub2.svg" /></p>
<h3 id="protocolos-epidemicos">Protocolos Epidêmicos</h3>
<details class="todo"><summary>TODO</summary><p><a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.148.101">http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.148.101</a></p>
</details>
<h2 id="comunicacao-orientada-a-fluxos">Comunicação Orientada a Fluxos</h2>
<details class="todo"><summary>TODO</summary><p>Material</p>
</details>
<h2 id="invocacao-remota-de-procedimentos-rpc">Invocação Remota de Procedimentos - RPC</h2>
<!-- Nas seções anteriores nós estudamos arcabouços de RPC que, em geral, provêem funcionalidade para a invocação síncrona de procedimentos e métodos, espelhando a semântica da invocação sequencial em monolitos. [^asynch]
Apesar destas melhorias, **sistemas de RPC assumem que as duas partes da comunicação estão online ao mesmo tempo**. 
Arcabouços de **comunicação orientada a mensagens** implementada pelos ***middleware*** **orientados a mensagem**, oferecem um alternativa.

[^asynch]: Embora com o uso cada vez mais frequente de métodos de programação assíncrona nos monolitos, por exemplo usando-se e *Futures/Promisses*, e a introdução de outras abstrações, como funções geradoras, é natural que alguns arcabouços de RPC mais modernos reflitam estas evoluções. gRPC, por exemplo, permite a implementação de um modelo de comunicação em que procedimentos remotos são invocados de forma assíncrona ou até mesmo que um fluxo de dados entre chamador e chamado seja estabelecido. -->

<p>Em 1984, Birrel e Nelson<sup id="fnref:birrel"><a class="footnote-ref" href="#fn:birrel">14</a></sup> introduziram o mecanismo de Invocação Remota de Procedimentos (<em>Remote Procedure Calls</em>), que permite que processos façam, pasmem, invocações de procedimentos remotos!
Óbvio, a inovação não está na capacidade de uma máquina conversar com outra, mas em como esta conversa acontece, do ponto de vista do programador.
Por exemplo, RPC permite que se procure a <em>substring</em> apontada por <code>c</code> dentro da string apontada por <code>a</code>, a partir da posição 3, usando <code>x = substring(a,3,c);</code> mas com o invocador da função em um processo e a implementação da função propriamente dita, em outro, possivelmente em outra máquina.</p>
<h3 id="stubs">Stubs</h3>
<p>Se o que queremos é colocar o código da função <code>substring</code> em um outro processo e executá-lo como se estivéssemos no mesmo processo que faz a invocação, precisamos pensar em várias questões, sendo a principal o fato de que, embora seja simulada a invocação local, "por debaixo do capô" há o uso sockets para a comunicação com o processo remoto.
Esta simulação usará código extra, que finge implementar <code>substring</code> para o invocador mas delega ao código remoto o trabalho real da busca.
Este código extra é conhecido como <strong>stub</strong>, ou para ser mais preciso, <strong><em>stub</em></strong> <strong>cliente</strong>, que faz parte do processo invocando a operação, e <strong><em>stub</em></strong> <strong>servidor</strong>, que faz parte do processo executando a operação invocada<sup id="fnref:skeleton"><a class="footnote-ref" href="#fn:skeleton">15</a></sup>.</p>
<p>Assim, o cliente invoca a função no <em>stub</em> cliente, achando que é a função que quer executar.
O <em>stub</em> cliente faz o <strong><em>marshaling</em></strong> <sup id="fnref:marshal"><a class="footnote-ref" href="#fn:marshal">16</a></sup>  dos parâmetros e usa o SO para transferir os dados via rede para o stub servidor.
Quando recebe a resposta do servidor, o <em>stub</em> cliente retorna a mesma resposta, como se tivesse sido calculada localmente.
Já o stub servidor fica esperando o contato do cliente.
Quando acontece, faz o <strong><em>unmarshalling</em></strong> dos dados, invoca a função localmente na aplicação servidor e pega o resultado, que retorna ao cliente.</p>
<p><img alt="RPC" src="../drawings/rpc.drawio-0.svg" /></p>
<table>
<thead>
<tr>
<th>Stub cliente</th>
<th>Stub servidor</th>
</tr>
</thead>
<tbody>
<tr>
<td>1. invoca <code>substring</code> no <em>stub</em></td>
<td>1. retorna o resultado para o <em>stub</em></td>
</tr>
<tr>
<td>2. conecta-se ao servidor, envia parâmetros e especifica a função</td>
<td>2. envia resulta serializado para cliente</td>
</tr>
<tr>
<td>3. transmite os dados serializados</td>
<td>transmite resposta serializada</td>
</tr>
<tr>
<td>4. desserializa parâmetros</td>
<td>4. desserializa os parâmetro</td>
</tr>
<tr>
<td>5. invoca a função <code>substring</code> localmente</td>
<td>5. retorna o resultado para o invocador</td>
</tr>
</tbody>
</table>
<h3 id="transparencia">Transparência</h3>
<p>É para o programador a grande vantagem do uso de RPC, pois se pode escrever código distribuído "igual" ao não-distribuído, certo? 
Isto é, <strong>interface baseada em procedimentos</strong> e sem a necessidade de detalhar <strong>portas, sockets, e representação de dados</strong>.  Ou seja, tudo é transparente!
Como já discutimos, vários fatores trabalham contra a <a href="../intro/#transparencia">transparência em sistemas distribuídos</a>.
Em específico quanto à transparência dada pelo RPC, também temos limitações.
Antes de nos aprofundarmos, lembremos como uma invocação de funções acontece normalmente dentro de um único processo.<sup id="fnref:omissao"><a class="footnote-ref" href="#fn:omissao">17</a></sup>
O código <code>x = substring(a,3,c);</code>, que procura <code>*c</code> em <code>*a</code>, é traduzido nos seguintes passos em linguagem de máquina:</p>
<ul>
<li>coloque o valor de <code>c</code> na pilha</li>
<li>coloque <code>3</code> na pilha</li>
<li>coloque o valor de <code>a</code> na pilha</li>
<li>coloque o endereço de retorno na pilha (junto com outros dados de controle)</li>
<li>salte para <code>substring</code> ajustando o <em>instruction pointer</em></li>
<li>... procure substring ...</li>
<li>coloque o resultado no acumulador</li>
<li>limpe a pilha</li>
<li>salte de volta recuperando o endereço de retorno da pilha e ajustando o IP</li>
<li>coloque resultado em <code>x</code></li>
</ul>
<p><img alt="RPC" src="../drawings/rpc.drawio-4.svg" /></p>
<p>O problema é que há uma distinção clara em pelo menos dois processos e se pensarmos no código descrito acima, temos que entender que </p>
<ul>
<li>processos independentes não compartilham um espaço de endereçamento, e</li>
<li>processos independentes não compartilham uma pilha.</li>
</ul>
<p><img alt="RPC" src="../drawings/rpc.drawio-1.svg" /></p>
<p>Assim, como fica a <strong>passagem de parâmetro por referência</strong>, uma vez que o stub servidor não pode usar endereços do espaço de endereçamento do cliente?
Algumas abordagens para simular a passagem por referência são possíveis. Por exemplo, <strong>o valor apontado pelo ponteiro é passado para o servidor</strong>, que armazena o valor e alguma posição de memória e passa o endereço de tal posição para a função invocada.</p>
<p><img alt="RPC" src="../drawings/rpc.drawio-2.svg" /></p>
<p>Contudo, a modificação do valor pela função não reflete imediatamente no invocador; tais valores tem que ser copiados novamente e usados para sobrescrever o valor original no cliente.
Além disso, esta abordagem só é possível se o valor apontado for delimitado, o que nem sempre é fácil de determinar. 
Por exemplo, se o ponteiro for para o primeiro elemento de uma lista, o que deve ser copiado para o servidor? Só o primeiro elemento? Toda a lista? Como ensinar para o <em>framework</em> RPC o que é "toda" a lista?</p>
<p>Java "resolve" o problema da passagem de parâmetro por referência passando todo o grafo do objeto passado como parâmetro para o servidor. Isto é, além de serializar o objeto apontado no parâmetro, se o mesmo aponta para outros objetos, estes também serão serializados e transferidos; o servidor irá então reconstruir todo o grafo e passar para o método sendo invocado.
É muito fácil ver que esta abordagem pode se tornar inviável rapidamente. Quando for o caso, Java permite marcar objetos como <strong>remotos</strong> e, em vez de serializar este objeto e enviar para o servidor, envia informação suficiente para que o servidor possa invocar métodos em tal objeto no cliente, tornando nebulosa a definição de quem é quem.</p>
<p>Outros fatores também trabalham contra a transparência para o desenvolvedor.</p>
<h6>Descoberta de Serviços</h6>
<p>Por exemplo, mesmo que o socket seja ocultado, ele ainda existe e precisa de informações sobre <strong>onde se conectar</strong> (endereço e porta), que de alguma forma deve ser passada para o framework de RPC.
Esta informação pode ser configurada <em>a priori</em> por um administrador de sistemas, mas requer atualizações sempre que a localização do serviço for alterada ou novos servidores adicionados.
Mais interessante seria um mecanismo que permitisse uma indireção para o serviço; o próprio DNS pode ser uma opção inicial, mas um serviço dedicado pode ser mais apropriado, pois permite descobrir serviços e não apenas servidores.</p>
<p>Birrel e Nelson propuseram um serviço de <strong>Páginas Amarelas</strong>, no qual clientes podem questionar quem oferece um certo serviço e serem redirecionados automaticamente.
Esta abordagem tem seus próprios problemas, como por exemplo determinar <strong>quem administra</strong> o serviço para incluir novos servidores.
E como determinar qual serviço acessar, caso hajam <strong>múltiplas opções de servidores</strong>.</p>
<p><img alt="RPC" src="../drawings/rpc.drawio-3.svg" /></p>
<p>Apesar dos problemas, <strong>páginas amarelas</strong> foram usadas em abordagens muito mais recentes para descobertas de serviços, por exemplo <a href="https://en.wikipedia.org/wiki/Web_Services_Discovery">Web Services Discovery</a>, que permite a descoberta de Web Services em escala global, e <a href="https://docs.oracle.com/javase/7/docs/technotes/tools/solaris/rmiregistry.html">Java Remote Object Registry</a> que permite a descoberta de objetos remotos Java.</p>
<h6>Tratamento de Exceções</h6>
<p>Uma vez que a invocação é remota, há sempre o risco de problemas de comunicação entre cliente e servidor.
Logo, é necessária a introdução de código para tratamento de erros deste tipo, o que absolutamente não era necessário no caso do código centralizado.
Assim, o que era um simples <code>x = substring(a,3,c);</code> passa para algo assim (em uma linguagem fictícia):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">-2</span><span class="p">;</span>
<span class="n">try</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">substring</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">c</span><span class="p">);</span><span class="err">`</span>
<span class="p">}</span> <span class="n">catch</span><span class="p">(</span><span class="n">CommunicationFailureException</span> <span class="n">cfe</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log_error</span><span class="p">(</span><span class="s">&quot;Como pode substring falhar? Desespero!!!&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">-2</span><span class="p">)</span>
    <span class="n">system_exit</span><span class="p">(</span><span class="mi">-2</span><span class="p">)</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">-1</span><span class="p">)</span>
    <span class="c1">//não achou</span>
<span class="k">else</span>
    <span class="c1">//achou na posição x</span>
</code></pre></div>
</td></tr></table>
<p>O que nos leva novamente ao ponto sobre não haver transparência total em sistemas distribuídos... e esta falta de transparência pode ser muito mais complicada do que simplesmente adicionar try e catch ao seu código.</p>
<p>Mais que isso, imagine que a operação sendo executada altere algum estado no servidor.
Se esta fosse uma operacão local, cada invocação da operação corresponderia a exatamente uma execução da operação, na ausência de falhas.
No caso de falhas, se o processo quebra como um todo, no seu reinício, pode-se identificar se a operação foi ou não executada e aplicar ações corretivas.
Mas e no caso remoto?</p>
<h6>Reexecuções</h6>
<p>No caso da operação distribuída, se o servidor quebra, isso levará a um erro ser percebido do lado do cliente como uma <strong>falha na conexão</strong>.
Se o cliente havia invocado uma operação mas percebeu o erro antes de receber uma confirmação de sua execução, isto pode indicar que:</p>
<ul>
<li>(i) ou a requisição nunca foi recebida pelo servidor e, portanto, não foi executada,</li>
<li>(ii) ou a execução foi recebida e executada, mas a resposta não foi enviada.</li>
</ul>
<p><img alt="RPC" src="../drawings/rpc.drawio-5.svg" /></p>
<p>O cliente tem que tratar o erro, mas como?
Se a operação <strong>precisa</strong> ser executada <strong>a qualquer custo</strong>, o cliente pode retentá-la quando conseguir novo contato com o servidor (ou mesmo com outro).
Neste caso, se o que de fato aconteceu foi a situação (i), então retentar garantirá que a operação seja executada pelo servidor, mesmo que várias tentativas sejam necessárias.
Contudo, se o que o ocorreu foi a situação (ii), então reenviar a operação levará a mesma a ser executada múltiplas vezes, o que pode ou não ser ok.
Esta abordagem é o que garantirá que a execução acontece <strong>pelo menos 1 vez</strong>.</p>
<p><img alt="RPC" src="../drawings/rpc.drawio-6.svg" /></p>
<p>Imagine que a operação se tratasse de uma transferência de saldo, ou a encomenda de de um caminhão carregado de algum produto caro. Neste caso, reexecutar não parece ser uma opção.
Neste caso, talvez a melhor opção seja não retentar a operação, o que levará a zero execuções na situação (ii) e uma execução na situação, ou seja, a <strong>no máximo uma</strong> execução.
Uma situação em que esta abordagem é claramente preferível é a entrega de quadros em um <em>stream</em> de vídeo ou áudio, devido à importância da operação ser atrelada ao momento de sua execução.</p>
<p><img alt="RPC" src="../drawings/rpc.drawio-6.svg" /></p>
<div class="admonition info inline end">
<p class="admonition-title">Quantidade de execuções</p>
<ul>
<li>No máximo uma - não retentar</li>
<li>Exatamente uma - impedir que falhas aconteçam <img alt="☹" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/2639.svg" title=":white_frowning_face:" /></li>
<li>Pelo menos uma - retentar até ter confirmação</li>
</ul>
</div>
<p>Nenhuma destas abordagens é igual ao que é garantido na versão centralizada e que é provavelmente o que todo desenvolvedor desejaria para suas invocações de métodos, que fossem executados <strong>exatamente uma</strong> vez.
Garantir esta semântica na comunicação é muito difícil, pois é impossível ter certeza de que uma mensagem não foi processada pelo servidor ainda.
De fato, é impossível ter certeza se o servidor falhou; pode ter sido apenas uma falha na comunicação.</p>
<p>Como é impossível evitar falhas, se uma operação deve executada, ela deve ser retentada. 
Mas ela não pode ser repetida, então a alternativa é tornar as operações <a href="https://en.wikipedia.org/wiki/Idempotence"><strong>idempotentes</strong></a>, o que quer dizer que o efeito desejado é alcançado pela primeira execução e que execuções seguintes não alteram o estado.</p>
<div class="admonition note">
<p class="admonition-title">Operações idempotentes</p>
<p>Múltiplas execuções tem o mesmo efeito uma execução.</p>
<ul>
<li>Exemplo: <code>x = 10</code></li>
<li>Anti-exemplo:  <code>x = x+1</code>.</li>
</ul>
</div>
<p>Infelizmente não é trivial programar para idempotência, principalmente se o servidor for acessado concorrentemente por múltiplos clientes, tornando seu estado uam região crítica.</p>
<h6>Concorrência no servidor</h6>
<p>É importante notar que um servidor não está obrigado a atender requisições de somente um cliente.
Logo, se múltiplos clientes acessam o mesmo servidor, o estado do servidor será "compartilhado" pelos vários clientes e passos são necessários para que o comportamento no acesso deste estado seja coerente com a especificação.</p>
<p>Pense por exemplo em um servidor que conta o número de acessos feitos por clientes.
O incremento do contador deve ser considerado uma região crítica, caso múltiplos threads tratem as requisições dos clientes, o que já vimos ser uma boa idia.
Claro que dificilmente seu servidor seria algo tão simples assim.
Em vez disso, ele provavelmente executará lógicas complicadas, como por exemplo, armazenar o estado de contas bancárias e, neste caso, as funções expostas por RPC incluiríam a operação <strong>transferir saldo de A para B</strong>, o que nos leva a mais um problema interessante, o do risco de reexecuções.</p>
<p>Além disso, o servidor provavelmente suportará diversas operações e por isso deverá identificar qual a operação sendo requisitada.
Isto é feito por um <em>dispatcher</em>, que demultiplexa as operações requisitadas; o dispatcher pode, em algumas arquiteturas, ser independente do skeleton em si.</p>
<h3 id="interface-definition-language">Interface Definition Language</h3>
<p>Há diversas opções de <em>frameworks</em> para RPC, com diferentes características, focos, e garantias.
Alguns são parte da linguagem e outros são implementados como bibliotecas.
Alguns suportam múltiplas linguagens e alguns apenas uma.</p>
<div class="admonition note">
<p class="admonition-title">Suporte a RPC na linguagem</p>
<ul>
<li>Sem RPC: C, C++, Java &lt; 5.0 (1.5), Python</li>
<li>Com RPC: Java, Go, Erlang, Scala, Haskell</li>
<li>Ambientes heterogêneos: Thrift, gRPC, Akka, SOAP</li>
</ul>
</div>
<p>Frameworks mais modernos permitem escolher a forma de serialização dos dados, se legível para humanos ou binário, se o transporte é via HTTP ou protocolo mais baixo nível, se os dados trafegam abertamente ou se faz uso de comunicação criptografada (SSL).
Outros permitem escolher semântica de execução entre <strong>no máximo uma</strong> e <strong>pelo menos uma</strong>, e há até quem prometa <strong>exatamente uma</strong>.
Mas todos os <strong>frameworks</strong> tem algumas características em comum e uma delas é o uso de uma <strong>Linguagem de Definição de Interface</strong> (IDL).</p>
<p>Uma <a href="https://en.wikipedia.org/wiki/Interface_description_language">IDL</a> é a linguagem pela qual desenvolvedor define quais as operações (funções, procedimentos, métodos) serão acessíveis via RPC e quais os seus operandos.
Há várias IDL definidas, para os diversos <em>frameworks</em> disponíveis.</p>
<p>A imagem a seguir mostra um exemplo genérico da criação cliente e servidor usando um framework RPC genérico, inclusive o processamento da definição feita em IDL do serviço e a junção deste código gerado ao código escrito pelo desenvolvedor.</p>
<p><img alt="IDL" src="../images/idl.png" /></p>
<p>O fluxo de processamento é o seguinte:</p>
<ul>
<li>Arquivo em IDL é compilado por um compilador IDL e gera diversos arquivos:<ul>
<li><em>stub</em> cliente - código que implementa a interface, com código para repassar invocações para o servidor.</li>
<li><em>stub</em> servidor (<em>skeleton</em>) - código que atende a conexões do <em>stub</em> cliente e repassa para a implementação própria da função.</li>
<li>conversão de dados - código que serializa e deserializa dados para serem trafegados de e para o servidor</li>
<li>cabeçalhos - definições da interface na linguagem de desenvolvimento da aplicação; se linguagem C, por exemplo, estes serão arquivos <code>.h</code>, se em Java, então estes serão arquivos<code>.java</code>, com definição de <code>interface</code>.</li>
</ul>
</li>
<li>O código cliente é compilado e gera o cliente, que deve <ul>
<li>inicializar a infraestrutura RPC<ul>
<li>Tipo de transporte</li>
<li>SSL?</li>
<li>Localizar servidor</li>
</ul>
</li>
<li>Lidar com falhas</li>
</ul>
</li>
<li>O código servidor é compilado e gera o servidor, que deve<ul>
<li>exportar e localizar serviços (serviço de nomeação)</li>
<li>Gerenciamento de portas</li>
<li>Conexões</li>
</ul>
</li>
</ul>
<h2 id="referencias">Referências</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=Q2sFmqvpBe0">The call Stack</a></li>
<li><a href="https://en.wikipedia.org/wiki/Message-oriented_middleware">Message Oriented Middleware</a></li>
<li><a href="https://en.wikipedia.org/wiki/Enterprise_service_bus">Enterprise Message Bus</a></li>
<li><a href="https://www.netlify.com/blog/2017/03/02/to-message-bus-or-not-distributed-systems-design/">To Message Bus or Not: distributed system design</a></li>
</ul>
<!--Além das funcionalidades equivalentes a protobuf, thrift também provê funcionalidades similares a gRPC, para definir serviços que manipulam estes dados, mas voltaremos a este ponto mais adiante. 

Como discutiremos mais adiante, Protobuf é normalmente utilizado como uma peça na construção de serviços utilizando [gRPC](https://grpc.io/). -->

<div class="footnote">
<hr />
<ol>
<li id="fn:internet">
<p>By User:Ludovic.ferre - Internet Connectivity Distribution&amp;Core.svg, CC BY-SA 3.0, (<a href="https://commons.wikimedia.org/w/index.php?curid=10030716">https://commons.wikimedia.org/w/index.php?curid=10030716</a>)&#160;<a class="footnote-backref" href="#fnref:internet" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:ippub">
<p>Endereços IP não públicos não servem como identificadores únicos na Internet.&#160;<a class="footnote-backref" href="#fnref:ippub" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:pyname">
<p>Você pode usar outro nome, desde que não seja <code>socket.py</code>, e que adapte o comando para sua execução.&#160;<a class="footnote-backref" href="#fnref:pyname" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:telnet">
<p>O programa <code>telnet</code> é normalmente instalado por padrão tanto no Windows, OSX quanto no Linux. Já o <code>netcat</code> normalmente precisa ser instalado por você. Em alguns sistemas, em vez de <code>netcat</code> o comando é o <code>nc</code>.&#160;<a class="footnote-backref" href="#fnref:telnet" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:multicast_use">
<p><a href="http://www.dasblinkenlichten.com/understanding-ip-multicast/">Understanding IP Multicast</a>&#160;<a class="footnote-backref" href="#fnref:multicast_use" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:ipv6multi">
<p><a href="http://www.baeldung.com/java-broadcast-multicast">IP-Multicast em IPv6</a>&#160;<a class="footnote-backref" href="#fnref:ipv6multi" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:fbthrift">
<p>O Facebook, insatisfeito com os progressos da versão Apache, acabou fazendo um novo <em>fork</em>  do projeto, <a href="https://github.com/facebook/fbthrift">fbthrift</a>, também de código livre, mas que tem evoluído de forma desconexa do projeto Apache. Contudo, no escopo do nosso estudo, as duas versões são essencialmente iguais.&#160;<a class="footnote-backref" href="#fnref:fbthrift" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:0101">
<p>Distributed Systems: Principles and Paradigms. Capítulo 1, Figura 1.&#160;<a class="footnote-backref" href="#fnref:0101" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:IEEEFP">
<p><a href="https://www.tutorialspoint.com/fixed-point-and-floating-point-number-representations">IEEE Floating Point</a>&#160;<a class="footnote-backref" href="#fnref:IEEEFP" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:IBMFP">
<p><a href="https://en.wikipedia.org/wiki/IBM_hexadecimal_floating_point#Single-precision_32-bit">IBM Floating Point</a>&#160;<a class="footnote-backref" href="#fnref:IBMFP" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn:stringjava">
<p>Simplificações são possíveis, mas introduzem outras complexidades.&#160;<a class="footnote-backref" href="#fnref:stringjava" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
<li id="fn:stadia">
<p>O <a href="https://stadia.google.com/">Google stadia</a> é uma plataforma de jogos que vai na contramão desta ideia, levando todo o processamento pesado para a nuvem.&#160;<a class="footnote-backref" href="#fnref:stadia" title="Jump back to footnote 12 in the text">&#8617;</a></p>
</li>
<li id="fn:scatter">
<p>O particionamento básico provido pela MPI é simplesmente uma divisão do buffer com os dados entre os vários processos, então para fragmentar um grafo, você teria um pouco de trabalho.&#160;<a class="footnote-backref" href="#fnref:scatter" title="Jump back to footnote 13 in the text">&#8617;</a></p>
</li>
<li id="fn:birrel">
<p><a href="http://www.birrell.org/andrew/papers/ImplementingRPC.pdf">Implementing RPC</a>&#160;<a class="footnote-backref" href="#fnref:birrel" title="Jump back to footnote 14 in the text">&#8617;</a></p>
</li>
<li id="fn:skeleton">
<p>O <em>stub</em> do servidor também é conhecido como <em>skeleton</em>.&#160;<a class="footnote-backref" href="#fnref:skeleton" title="Jump back to footnote 15 in the text">&#8617;</a></p>
</li>
<li id="fn:marshal">
<p>Marshalling: representar parâmetros de forma própria para transmissão "no fio".&#160;<a class="footnote-backref" href="#fnref:marshal" title="Jump back to footnote 16 in the text">&#8617;</a></p>
</li>
<li id="fn:omissao">
<p>Omitirei alguns detalhes aqui, em nome da generalidade, mas vocês podem recuperá-los em seus livros de Arquitetura de Computadores.&#160;<a class="footnote-backref" href="#fnref:omissao" title="Jump back to footnote 17 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <!-- Last update of source file -->


              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../fundamentals/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Modelos
            </div>
          </div>
        </a>
      
      
        <a href="../p2p/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Próximo
              </span>
              P2P
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/mathjaxhelper.js"></script>
      
    
  </body>
</html>