


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.1">
    
    
      
        <title>Comunicação - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a676eddb.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#comunicacao" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-header-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Comunicação
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Prólogo" class="md-nav__link">
      Prólogo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intro/" title="Introdução" class="md-nav__link">
      Introdução
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../basics/" title="Fundamentos" class="md-nav__link">
      Fundamentos
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Comunicação
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Comunicação" class="md-nav__link md-nav__link--active">
      Comunicação
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#representacao-de-dados" class="md-nav__link">
    Representação de dados
  </a>
  
    <nav class="md-nav" aria-label="Representação de dados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representacao-textual" class="md-nav__link">
    Representação Textual
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protobuffers" class="md-nav__link">
    ProtoBuffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thrift" class="md-nav__link">
    Thrift
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invocacao-remota-de-procedimentos-rpc" class="md-nav__link">
    Invocação Remota de Procedimentos - RPC
  </a>
  
    <nav class="md-nav" aria-label="Invocação Remota de Procedimentos - RPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transparencia" class="md-nav__link">
    Transparência
  </a>
  
    <nav class="md-nav" aria-label="Transparência">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descoberta-de-servicos" class="md-nav__link">
    Descoberta de Serviços
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tratamento-de-excecoes" class="md-nav__link">
    Tratamento de Exceções
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reexecucoes" class="md-nav__link">
    Reexecuções
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concorrencia-no-servidor" class="md-nav__link">
    Concorrência no servidor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frameworks" class="md-nav__link">
    Frameworks
  </a>
  
    <nav class="md-nav" aria-label="Frameworks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interface-definition-language-idl" class="md-nav__link">
    Interface Definition Language - IDL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-grpc" class="md-nav__link">
    Estudo de Caso RPC: gRPC
  </a>
  
    <nav class="md-nav" aria-label="Estudo de Caso RPC: gRPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-java" class="md-nav__link">
    Exemplo Java
  </a>
  
    <nav class="md-nav" aria-label="Exemplo Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pegando-o-codigo" class="md-nav__link">
    Pegando o código
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilando-e-executando" class="md-nav__link">
    Compilando e executando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#o-servico" class="md-nav__link">
    O serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementando-um-servico" class="md-nav__link">
    Implementando um serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stub-do-servidor" class="md-nav__link">
    Stub do servidor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stub-do-cliente" class="md-nav__link">
    Stub do cliente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idl-grpc" class="md-nav__link">
    IDL gRPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-python" class="md-nav__link">
    Exemplo Python
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-thrift" class="md-nav__link">
    Estudo de Caso RPC: Thrift
  </a>
  
    <nav class="md-nav" aria-label="Estudo de Caso RPC: Thrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao_1" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idl-thrift" class="md-nav__link">
    IDL Thrift
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquitetura" class="md-nav__link">
    Arquitetura
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classpath" class="md-nav__link">
    Classpath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-rmi" class="md-nav__link">
    Estudo de Caso RPC: RMI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-mensagens" class="md-nav__link">
    Comunicação orientada a Mensagens
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishsubscribe" class="md-nav__link">
    Publish/Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Publish/Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplamento" class="md-nav__link">
    Desacoplamento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtragem" class="md-nav__link">
    Filtragem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt" class="md-nav__link">
    MQTT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencia" class="md-nav__link">
    Referência
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-mosquitto" class="md-nav__link">
    Estudo de caso: MosQuiTTo
  </a>
  
    <nav class="md-nav" aria-label="Estudo de caso: MosQuiTTo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao_2" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inicializando-o-servico" class="md-nav__link">
    Inicializando o serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicando" class="md-nav__link">
    Publicando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumindo" class="md-nav__link">
    Consumindo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programando" class="md-nav__link">
    Programando
  </a>
  
    <nav class="md-nav" aria-label="Programando">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemplo-de-publisher" class="md-nav__link">
    Exemplo de Publisher
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../arch/" title="Arquiteturas" class="md-nav__link">
      Arquiteturas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../coord/" title="Coordenação" class="md-nav__link">
      Coordenação
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../time/" title="Tempo" class="md-nav__link">
      Tempo
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../fault/" title="Tolerância a Falhas" class="md-nav__link">
      Tolerância a Falhas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disdb/" title="Bancos de Dados" class="md-nav__link">
      Bancos de Dados
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../disfs/index.md" title="Sistemas de Arquivos" class="md-nav__link">
      Sistemas de Arquivos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tech/" title="Tecnologias" class="md-nav__link">
      Tecnologias
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#representacao-de-dados" class="md-nav__link">
    Representação de dados
  </a>
  
    <nav class="md-nav" aria-label="Representação de dados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representacao-textual" class="md-nav__link">
    Representação Textual
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protobuffers" class="md-nav__link">
    ProtoBuffers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thrift" class="md-nav__link">
    Thrift
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#invocacao-remota-de-procedimentos-rpc" class="md-nav__link">
    Invocação Remota de Procedimentos - RPC
  </a>
  
    <nav class="md-nav" aria-label="Invocação Remota de Procedimentos - RPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stubs" class="md-nav__link">
    Stubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transparencia" class="md-nav__link">
    Transparência
  </a>
  
    <nav class="md-nav" aria-label="Transparência">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descoberta-de-servicos" class="md-nav__link">
    Descoberta de Serviços
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tratamento-de-excecoes" class="md-nav__link">
    Tratamento de Exceções
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reexecucoes" class="md-nav__link">
    Reexecuções
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concorrencia-no-servidor" class="md-nav__link">
    Concorrência no servidor
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frameworks" class="md-nav__link">
    Frameworks
  </a>
  
    <nav class="md-nav" aria-label="Frameworks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interface-definition-language-idl" class="md-nav__link">
    Interface Definition Language - IDL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-grpc" class="md-nav__link">
    Estudo de Caso RPC: gRPC
  </a>
  
    <nav class="md-nav" aria-label="Estudo de Caso RPC: gRPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-java" class="md-nav__link">
    Exemplo Java
  </a>
  
    <nav class="md-nav" aria-label="Exemplo Java">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pegando-o-codigo" class="md-nav__link">
    Pegando o código
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilando-e-executando" class="md-nav__link">
    Compilando e executando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#o-servico" class="md-nav__link">
    O serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementando-um-servico" class="md-nav__link">
    Implementando um serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stub-do-servidor" class="md-nav__link">
    Stub do servidor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stub-do-cliente" class="md-nav__link">
    Stub do cliente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idl-grpc" class="md-nav__link">
    IDL gRPC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exemplo-python" class="md-nav__link">
    Exemplo Python
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-thrift" class="md-nav__link">
    Estudo de Caso RPC: Thrift
  </a>
  
    <nav class="md-nav" aria-label="Estudo de Caso RPC: Thrift">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao_1" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#idl-thrift" class="md-nav__link">
    IDL Thrift
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arquitetura" class="md-nav__link">
    Arquitetura
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#classpath" class="md-nav__link">
    Classpath
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-rpc-rmi" class="md-nav__link">
    Estudo de Caso RPC: RMI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comunicacao-orientada-a-mensagens" class="md-nav__link">
    Comunicação orientada a Mensagens
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishsubscribe" class="md-nav__link">
    Publish/Subscribe
  </a>
  
    <nav class="md-nav" aria-label="Publish/Subscribe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desacoplamento" class="md-nav__link">
    Desacoplamento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtragem" class="md-nav__link">
    Filtragem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt" class="md-nav__link">
    MQTT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencia" class="md-nav__link">
    Referência
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estudo-de-caso-mosquitto" class="md-nav__link">
    Estudo de caso: MosQuiTTo
  </a>
  
    <nav class="md-nav" aria-label="Estudo de caso: MosQuiTTo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacao_2" class="md-nav__link">
    Instalação
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inicializando-o-servico" class="md-nav__link">
    Inicializando o serviço
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publicando" class="md-nav__link">
    Publicando
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consumindo" class="md-nav__link">
    Consumindo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#programando" class="md-nav__link">
    Programando
  </a>
  
    <nav class="md-nav" aria-label="Programando">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exemplo-de-publisher" class="md-nav__link">
    Exemplo de Publisher
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="comunicacao">Comunicação</h1>
<p>O desenvolvimento de sistemas distribuídos usando diretamente Sockets como forma de comunicação entre componentes não é para os fracos de coração.
Sua grande vantagem está no <strong>acesso baixo nível à rede</strong>, e todo o ganho de desempenho que isso pode trazer.
Suas desvantagens, entretanto, são várias:</p>
<ul>
<li>interface de "arquivo" para se ler e escrever bytes;</li>
<li>controle de fluxo de "objetos" é por conta da aplicação, isto é, a aplicação precisa sinalizar quantos bytes serão escritos de um lado, para que o outro saiba quanto ler para obter um "objeto" correto;</li>
<li>logo, a serialização e desserialização de objetos é também por conta da aplicação;</li>
<li>tratamento de desconexões e eventuais reconexões também é gerenciado pela aplicação e nem a tão famosa confiabilidade do TCP ajuda.</li>
</ul>
<p>Enquanto se poderia argumentar que algumas destas desvantagens podem ser descartadas em função da discussão de incluir ou não API na comunicação <a href="http://web.mit.edu/Saltzer/www/publications/endtoend/endtoend.pdf">fim-a-fim</a>, é certo que algumas funcionalidades são ubíquas em aplicações distribuídas.
Aqui discutiremos algumas destas funcionalidades e como podem e são implementadas por <em>frameworks</em> de comunicação de mais alto nível.</p>
<h2 id="representacao-de-dados">Representação de dados</h2>
<p>Exceto por aplicações muito simples, processos em um sistema distribuído trocam dados complexos, por exemplo estruturas ou classes com diversos campos, incluindo valores numéricos de diversos tipos, strings e vetores de bytes, com diversos níveis de aninhamento e somando vários KB.
Neste cenário, vários fatores precisam ser levados em consideração na hora de colocar esta estrutura <em>no fio</em>, como:</p>
<ul>
<li>variações de definições de tipos, por exemplo, <code>inteiro</code>: 8: 16, 32, ou 64 bits?</li>
<li>variações na representação de dados complexos: classe x estrutura   </li>
<li>conjunto de caracteres diferentes: ASCII x UTF</li>
<li>little endian, como x64 e IA-32, ou  big endian como SPARC (&lt; V9), Motorola e PowerPC? ou aidna, flexível como  ARM,  MIPS ou  IA-64?</li>
<li>fim de linha com crlf (DOS) x lf (Unix)?</li>
<li>fragmentação de dados na rede <br />
<a href="http://www.acsa.net/IP/"><img alt="Fragmentação" src="images/ipfrag.png" /></a></li>
</ul>
<h3 id="representacao-textual">Representação Textual</h3>
<p>Uma abordagem comumente usada é a representação em formato textual "amigável a humanos".
Veja o exemplo de como o protocolo HTTP requisita e recebe uma página HTML.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>telnet www.google.com 80
Trying 187.72.192.217...
Connected to www.google.com.
Escape character is &#39;^]&#39;.
GET / HTTP/1.1
host: www.google.com
</code></pre></div>
</td></tr></table>
As linhas 5 e 6 são entradas pelo cliente para requisitar a página raiz do sítio <a href="https://www.google.com">www.google.com</a>.
A linha 7, vazia, indica ao servidor que a requisição está terminada.</p>
<p>Em resposta a esta requisição, o servidor envia o seguinte, em que as primeiras linhas trazem metadados da página requisitada e, após a linha em branco, vem a resposta em HTML à requisição.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>HTTP/1.1 302 Found
Location: http://www.google.com.br/?gws_rd=cr<span class="err">&amp;</span>ei=HTDqWJ3BDYe-wATs_a3ACA
Cache-Control: private
Content-Type: text/html; charset=UTF-8
P3P: CP=&quot;This is not a P3P policy! See https://www.google.com/support/accounts/answer/151657?hl=en for more info.&quot;
Date: Sun, 09 Apr 2017 12:59:09 GMT
Server: gws
Content-Length: 262
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
Set-Cookie: NID=100=NB_AruuFWL0hXk2-h7VDduHO_UkjAr6RaqgG7VbccTsfLzFfhxEKx21Xpa2EH7IgshgczE9vU4W1TyKsa07wQeuZosl5DbyZluR1ViDRf0C-5lRpd9cCpCD5JXXjy-UE; expires=Mon, 09-Oct-2017 12:59:09 GMT; path=/; domain=.google.com; HttpOnly

<span class="p">&lt;</span><span class="nt">HTML</span><span class="p">&gt;&lt;</span><span class="nt">HEAD</span><span class="p">&gt;&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;content-type&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;text/html;charset=utf-8&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">TITLE</span><span class="p">&gt;</span>302 Moved<span class="p">&lt;/</span><span class="nt">TITLE</span><span class="p">&gt;&lt;/</span><span class="nt">HEAD</span><span class="p">&gt;&lt;</span><span class="nt">BODY</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">H1</span><span class="p">&gt;</span>302 Moved<span class="p">&lt;/</span><span class="nt">H1</span><span class="p">&gt;</span>
The document has moved
<span class="p">&lt;</span><span class="nt">A</span> <span class="na">HREF</span><span class="o">=</span><span class="s">&quot;http://www.google.com.br/?gws_rd=cr&amp;amp;ei=HTDqWJ3BDYe-wATs_a3ACA&quot;</span><span class="p">&gt;</span>here<span class="p">&lt;/</span><span class="nt">A</span><span class="p">&gt;</span>.
<span class="p">&lt;/</span><span class="nt">BODY</span><span class="p">&gt;&lt;/</span><span class="nt">HTML</span><span class="p">&gt;</span>
</code></pre></div>
</td></tr></table>

<p>Representações textuais são usadas em diversos protocolos como SMTP, POP, e telnet.
Algumas destas representações seguem padrões formalizados, o que facilita a geração e interpretação dos dados. 
Dois padrões bem conhecidas são XML e JSON.</p>
<p><a href="https://xml.org">XML</a> é o acrônimo para <em>Extensible Markup Language</em>, ou seja, uma linguagem marcação que pode ser estendida para representar diferentes tipos de informação.
A HTML, por exemplo, é uma instância de XML destinada à representação de hipertexto (A bem da verdade, XML foi uma generalização de HTML).</p>
<p>Por exemplo, para representarmos os dados relativos à uma pessoa, podemos ter uma instância XML assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nt">&lt;person&gt;</span>
    <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;id&gt;</span>112234556<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;email&gt;</span>jdoe@example.com<span class="nt">&lt;/email&gt;</span>
    <span class="nt">&lt;telephones&gt;</span>
       <span class="nt">&lt;telephone</span> <span class="na">type=</span><span class="s">&quot;mobile&quot;</span><span class="nt">&gt;</span>123 321 123<span class="nt">&lt;/telephone&gt;</span>
       <span class="nt">&lt;telephone</span> <span class="na">type=</span><span class="s">&quot;home&quot;</span><span class="nt">&gt;</span>321 123 321<span class="nt">&lt;/telephone&gt;</span>
    <span class="nt">&lt;/telephones&gt;</span>
<span class="nt">&lt;/person&gt;</span>
</code></pre></div>
</td></tr></table>

<p>Uma das grandes vantagens do uso de XML é a possibilidade de se formalizar o que pode ou não estar em um arquivo para um certo domínio utilizando um <a href="https://docs.microsoft.com/pt-br/dotnet/standard/data/xml/xml-document-object-model-dom">XML <em>Domain Object Model</em></a>. Há, por exemplo, modelos para representação de documentos de texto, governos eletrônicos, representação de conhecimento, <a href="http://www.xml.org/">etc</a>.
Sua maior desvantagem é que é muito verborrágico e por vezes complicado de se usar, abrindo alas para o seu mais famoso concorrente, JSON.</p>
<p><a href="http://json.org/">JSON</a> é o acrônimo de <em>Javascript Object Notation</em>, isto é, o formato para representação de objetos da linguagem Javascript.
Devido à sua simplicidade e versatilidade, entretanto, foi adotado como forma de representação de dados em sistemas desenvolvidos nas mais diferentes linguagens.
O mesmo exemplo visto anteriormente, em XML, é representado em JSON assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">112234556</span><span class="p">,</span>
    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;jdoe@example.com&quot;</span><span class="p">,</span>
    <span class="nt">&quot;telephones&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;mobile&quot;</span><span class="p">,</span> <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;123 321 123&quot;</span><span class="p">},</span>
        <span class="p">{</span> <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;home&quot;</span><span class="p">,</span> <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;321 123 321&quot;</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Em Python, por exemplo, JSON são gerados e interpretados nativamente, sem a necessidade de <em>frameworks</em> externos, facilitando seu uso.
Mas de fato, a opção final por XML ou JSON é questão de preferência, uma vez que os dois formatos são, de fato, equivalentes na questão da representação de informação.</p>
<p>Outros formatos, binários, oferecem vantagens no uso de espaço para armazenar e transmitir dados, e por isso são frequentemente usados como forma de <em>serialização</em> de dados em sistemas distribuídos, isto é, na transformação de TAD para sequências de bytes que seguirão "no fio".</p>
<ul>
<li>ASN.1 (Abstract Syntax Notation), pela ISO</li>
<li>XDR (eXternal Data Representation)</li>
<li>Java serialization</li>
<li>Google Protocol Buffers</li>
<li>Thrift</li>
</ul>
<p>ASN.1 e XDR são de interesse histórico, mas não os discutiremos aqui.
Quanto à serialização feita nativamente pelo Java, por meio de <code>ObjectOutputStreams</code>, como neste <a href="https://www.tutorialspoint.com/java/java_serialization.htm">exemplo</a>, embora seja tentadora para quem usa Java, é necessário saber que ela é restrita à JVM e que usa muito espaço, embora minimize riscos de uma desserialização para uma classe diferente.</p>
<p>Nos foquemos nas autras alternativas listadas, ProtoBuffers e Thrift, que podem levar a representações binárias e textuais.</p>
<h3 id="protobuffers">ProtoBuffers</h3>
<p>Nas palavras dos <a href="https://developers.google.com/protocol-buffers/">criadores</a>,</p>
<blockquote>
<p>Protocol buffers are a language-neutral, platform-neutral extensible mechanism for serializing structured data.</p>
</blockquote>
<p>Por meio de protobuffers, é possível estruturar dados e gerar o código correspondente em diversas linguagens, for forma compartilhável entre as mesmas. Veja o exemplo a seguir, que especifica os dados referentes a uma pessoa. 
Observe a presença de campos de preenchimento opcional (<strong>optional</strong>), de enumerações (<strong>enum</strong>), e de coleções (<strong>repeated</strong>).</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">message</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">required</span> <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">required</span> <span class="kt">int32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">optional</span> <span class="kt">string</span> <span class="na">email</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="n">PhoneType</span> <span class="p">{</span>
        <span class="na">MOBILE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="na">HOME</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="na">WORK</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">message</span> <span class="nc">PhoneNumber</span> <span class="p">{</span>
        <span class="k">required</span> <span class="kt">string</span> <span class="na">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">optional</span> <span class="n">PhoneType</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="k">default</span> <span class="o">=</span> <span class="n">HOME</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">repeated</span> <span class="n">PhoneNumber</span> <span class="na">phone</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Com tal definição é possível gerar código como o seguinte, em C++, que serializa os dados para escrita em um arquivo...</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Person</span> <span class="n">person</span><span class="p">;</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_name</span><span class="p">(</span><span class="s">&quot;John Doe&quot;</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_id</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">set_email</span><span class="p">(</span><span class="s">&quot;jdoe@example.com&quot;</span><span class="p">);</span>
<span class="n">fstream</span> <span class="nf">output</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="n">person</span><span class="p">.</span><span class="n">SerializeToOstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">output</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

<p>e lê do arquivo e desserializa para hidratar um novo objeto.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">fstream</span> <span class="nf">input</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">,</span> <span class="n">ios</span><span class="o">::</span><span class="n">in</span> <span class="o">|</span> <span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<span class="n">Person</span> <span class="n">person</span><span class="p">;</span>
<span class="n">person</span><span class="p">.</span><span class="n">ParseFromIstream</span><span class="p">(</span><span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Name: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;E-mail: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">person</span><span class="p">.</span><span class="n">email</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

<p>De acordo com <em>benchmarks</em> do próprio <a href="https://developers.google.com/protocol-buffers/docs/overview">projeto</a>, a operação em XML seria mais ordens de grandeza mais lenta e ocuparia mais espaço.</p>
<blockquote>
<p>When this message is encoded to the protocol buffer binary format, it would probably be 28 bytes long and take around 100-200 nanoseconds to parse. The XML version is at least 69 bytes if you remove whitespace, and would take around 5,000-10,000 nanoseconds to parse.</p>
</blockquote>
<h3 id="thrift">Thrift</h3>
<details class="bug"><summary>TODO</summary><p>Thrift como forma de representação de dados: <a href="https://thrift-tutorial.readthedocs.io/en/latest/thrift-types.html">Thrift type system</a></p>
</details>
<h2 id="invocacao-remota-de-procedimentos-rpc">Invocação Remota de Procedimentos - RPC</h2>
<p>Em 1984, Birrel e Nelson<sup id="fnref:birrel"><a class="footnote-ref" href="#fn:birrel">1</a></sup>
introduziram o mecanismo de <strong>Invocação Remota de Procedimentos</strong> (<em>Remote Procedure Calls</em>), que permite que processos façam, pasmem, invocações de procedimentos remotos!
Óbvio, a inovação não está na capacidade de uma máquina conversar com outra, mas em como esta conversa acontece, do ponto de vista do programador.
Por exemplo, RPC permita que se procure a <em>substring</em> <code>"teste"</code> dentro da string apontada por <code>a</code>, a partir da posição 3, usando <code>x = substring(a,3,"teste");</code>, mas com o invocador da função em um processo e a implementação da função propriamente dita, em outro, possivelmente em outra máquina.</p>
<h3 id="stubs">Stubs</h3>
<p>Antes de nos aprofundarmos, vejamos como uma invocação de funções acontece normalmente dentro de um único processo<sup id="fnref:omissao"><a class="footnote-ref" href="#fn:omissao">2</a></sup>.
O código <code>x = substring(a,3,"teste");</code>, que procura <code>"teste"</code> em <code>*a</code>, é traduzido nos seguintes passos em linguagem de máquina:</p>
<ul>
<li>coloque o endereço de <code>"teste"</code> na pilha</li>
<li>coloque <code>3</code> na pilha</li>
<li>coloque o valor de <code>a</code> na pilha</li>
<li>coloque o endereço de retorno na pilha (junto com outros dados de controle)</li>
<li>salte para <code>substring</code> ajustando o <em>instruction pointer</em></li>
<li>... procure substring ...</li>
<li>coloque o resultado no acumulador</li>
<li>limpe a pilha</li>
<li>salte de volta recuperando o endereço de retorno da pilha e ajustando o IP</li>
<li>coloque resultado em <code>x</code></li>
</ul>
<p>Se o que queremos é colocar o código da função <code>substring</code> em um outro processo e executá-lo como se estivéssemos no mesmo processo que faz a invocação, precisamos pensar em várias questões relativas ao fluxo mostrado acima.
Claramente não podemos usar o mesmo fluxo para invocar uma função, mas precisamos de código de simule a invocação local mas que, por baixo do capô, use sockets para se comunicar com o processo remoto.<br />
Estq simulação usará código extra, que finge implementar <code>substring</code> para o invocador mas delega ao código remoto o trabalho real da busca.
Este código extra é conhecido como <strong>stub</strong>, ou para ser mais preciso, <em>stub cliente</em>, que faz parte do processo invocando a operação, e <em>stub</em> servidor, que faz parte do processo executando a operação invocada<sup id="fnref:skeleton"><a class="footnote-ref" href="#fn:skeleton">3</a></sup>.</p>
<p>Assim, o cliente invoca função no stub cliente, achando que é a função que quer executar.
Stub cliente faz o <strong>marshaling</strong> <sup id="fnref:marshal"><a class="footnote-ref" href="#fn:marshal">4</a></sup>  dos parâmetros e usa o SO para transferir os dados via rede para o stub servidor.
Quando recebe a resposta do servidor, o stub cliente retorna a mesma resposta, como se tivesse calculado localmente.</p>
<div class="admonition note">
<p class="admonition-title">Stub cliente</p>
<p>Implementa uma função <code>substring(char*, int, char*)</code> que</p>
<ul>
<li>abre socket para servidor</li>
<li>envia parâmetros</li>
<li>especifica função</li>
<li>espera resposta</li>
<li>retorna resultado</li>
</ul>
</div>
<p>Já o stub servidor fica esperando o contato do cliente.
Quando acontece, faz o "unmarshalling" dos dados, invoca a função localmente na aplicação servidor e pega o resultado, que retona ao cliente.</p>
<div class="admonition note">
<p class="admonition-title">Stub servidor</p>
<ul>
<li>espera conexão</li>
<li>recebe parâmetros</li>
<li>recebe especificação da função</li>
<li>invoca função localmente</li>
<li>envia resultado para cliente</li>
</ul>
</div>
<p><img alt="Skeleton" src="images/stubskeleton.png" /></p>
<h3 id="transparencia">Transparência</h3>
<p>É para o programador a grande vantagem do uso de RPC, pois se pode escrever código distribuído "igual" ao centralizado, certo? Isto é, <strong>interface baseada em procedimentos</strong> e sem a necessidade de detalhar <strong>portas, sockets, e representação de dados</strong>.  Ou seja, tudo é transparente!
Como já discutimos, vários fatores trabalham contra a <a href="../intro/#transparencia">transparência em sistemas distribuídos</a>.
Em específico quanto à transparência dada pelo RPC, também temos limitações.
O problema é que há uma distinção clara em pelo menos dois processos e se pensarmos no código descrito acima, temos que entender que </p>
<ul>
<li>processos independentes não compartilham um espaço de endereçamento, e</li>
<li>processos independentes não compartilham uma pilha.</li>
</ul>
<p>Assim, como fica a <strong>passagem de parâmetro por referência</strong>, uma vez que o stub servidor não pode usar endereços do espaço de endereçamento do cliente?
Algumas abordagens para simular a passagem por referência são possíveis. Por exemplo, <strong>o valor apontado pelo ponteiro é passado para o servidor</strong>, que armazena o valor e alguma posição de memória e passa o endereço de tal posição para a função invocada.
Contudo, a modificação do valor pela função não reflete imediatamente no invocador; tais valores tem que ser copiados novamente e usados para sobrescrever o valor original no cliente.
Além disso, esta abordagem só é possível se o valor apontado for delimitado, o que nem sempre é fácil de determinar. 
Por exemplo, se o ponteiro for para o primeiro elemento de uma lista, o que deve ser copiado para o servidor? Só o primeiro elemento? Toda a lista? Como ensinar para o <em>framework</em> RPC o que é "toda" a lista?</p>
<p>Java "resolve" o problema da passagem de parâmetro por referência passando todo o grafo do objeto passado como parâmetro para o servidor. Isto é, além de serializar o objeto apontado no parâmetro, se o mesmo aponta para outros objetos, estes também serão serializados e transferidos; o servidor irá então reconstruir todo o grafo e passar para o método sendo invocado.
É muito fácil ver que esta abordagem pode se tornar inviável rapidamente. Quando for o caso, Java permite marcar objetos como <strong>remotos</strong> e, em vez de serializar este objeto e enviar para o servidor, envia informação suficiente para que o servidor possa invocar métodos em tal objeto no cliente, tornando nebulosa a definição de quem é quem.</p>
<p>Outros fatores também trabalham contra a transparência para o desenvolvedor. Vejamos alguns</p>
<h4 id="descoberta-de-servicos">Descoberta de Serviços</h4>
<p>Por exemplo, mesmo que o socket seja ocultado, ele ainda existe e precisa de informações sobre <strong>onde se conectar</strong> (endereço e porta), que de alguma forma deve ser passada para o framework de RPC.
Esta informação pode ser configurada <em>a priori</em> por um administrador de sistemas, mas requer atualizações sempre que a localização do serviço for alterada ou novos servidores adicionados.
Mais interessante seria um mecanismo que permitisse uma indireção para o serviço; o próprio DNS pode ser uma opção inicial, mas um serviço dedicado pode ser mais apropriado, pois permite descobrir serviços e não apenas servidores.</p>
<p>Birrel e Nelson propuseram um serviço de <strong>Páginas Amarelas</strong>, no qual clientes podem questionar quem oferece um certo serviço e serem redirecionados automaticamente.
Esta abordagem tem seus próprios problemas, como por exemplo determinar <strong>quem administra</strong> o serviço para incluir novos servidores.
E como determinar qual serviço acessar, caso hajam <strong>múltiplas opções de servidores</strong>.</p>
<p>Apesar dos problemas, <strong>páginas amarelas</strong> foram usadas em abordagens muito mais recentes para descobertas de serviços, por exemplo <a href="https://en.wikipedia.org/wiki/Web_Services_Discovery">Web Services Discovery</a>, que permite a descoberta de Web Services em escala global, e <a href="https://docs.oracle.com/javase/7/docs/technotes/tools/solaris/rmiregistry.html">Java Remote Object Registry</a> que permite a descoberta de objetos remotos Java.</p>
<h4 id="tratamento-de-excecoes">Tratamento de Exceções</h4>
<p>Uma vez que a invocação é remota, há sempre o risco de problemas de comunicação entre cliente e servidor.
Logo, é necessária a introdução de código para tratamento de erros deste tipo, o que absolutamente não era necessário no caso do código centralizado.
Assim, o que era um simples <code>x = substring(a,3,"teste");</code> passa para algo assim (em uma linguagem fictícia):</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
<span class="n">try</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">substring</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="s">&quot;teste&quot;</span><span class="p">);</span><span class="err">`</span>
<span class="p">}</span> <span class="n">catch</span><span class="p">(</span><span class="n">CommunicationFailureException</span> <span class="n">cfe</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log_error</span><span class="p">(</span><span class="s">&quot;Como pode substring falhar? Desespero!!!&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">system_exit</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">//não achou</span>
<span class="k">else</span>
    <span class="c1">//achou &quot;teste&quot; na posição x</span>
</code></pre></div>
</td></tr></table>

<p>O que nos leva novamente ao ponto sobre não haver transparência total em sistemas distribuídos... e esta falta de transparência pode ser muito mais complicada do que simplesmente adicionar try e catch ao seu código.</p>
<p>Mais que isso, imagine que a operação sendo executada altere algum estado no servidor.
Se esta fosse uma operacão local, cada invocação da operação corresponderia a exatamente uma execução da operação, na ausência de falhas.
No caso de falhas, se o processo quebra como um todo, no seu reinício, pode-se identificar se a operação foi ou não executada e aplicar ações corretivas.
Mas e no caso remoto?</p>
<h4 id="reexecucoes">Reexecuções</h4>
<p>No caso da operação distribuída, se o servidor quebra, isso levará a um erro ser percebido do lado do cliente como uma <strong>falha na conexão</strong>.
Se o cliente havia invocado uma operação mas percebeu o erro antes de receber uma confirmação de sua execução, isto pode indicar que:</p>
<ul>
<li>(i) ou a requisição nunca foi recebida pelo servidor e, portanto, não foi executada,</li>
<li>(ii) ou a execução foi recebida e executada, mas a resposta não foi enviada.</li>
</ul>
<p>O cliente tem que tratar o erro, mas como?
Se a operação <strong>precisa</strong> ser executada <strong>a qualquer custo</strong>, o cliente pode retentá-la quando conseguir novo contato com o servidor (ou mesmo com outro).
Neste caso, se o que de fato aconteceu foi a situação (i), então retentar garantirá que a operação seja executada pelo servidor, mesmo que várias tentativas sejam necessárias.
Contudo, se o que o ocorreu foi a situação (ii), então reenviar a operação levará a mesma a ser executada múltiplas vezes, o que pode ou não ser ok.
Esta abordagem é garantirá que a execução acontece <strong>pelo menos 1 vez</strong>.</p>
<p>Imagine que a operação se tratasse de uma transferência de saldo, ou a encomenda de de um caminhão carregado de algum produto caro. Neste caso, reexecutar não parece ser uma opção.
Neste caso, talvez a melhor opção seja não retentar a operação, o que levará a zero execuções na situação (ii) e uma execução na situação, ou seja, a <strong>no máximo uma</strong> execução.
Uma situação em que esta abordagem é claramente preferível é a entrega de quadros em um <em>stream</em> de vídeo ou áudio, devido à importância da operação ser atrelada ao momento de sua execução.</p>
<p>Nenhuma destas abordagens é igual ao que é garantido na versão centralizada e que é provelmente o que todo desenvolvedor desejaria para suas invocações de métodos, que fossem executados <strong>exatamente uma</strong> vez.
Garantir esta semântica na comunicação é muito difícil, pois é impossível ter certeza de que uma mensagem não foi processada pelo servidor ainda.
De fato, é impossível ter certeza se o servidor falhou; pode ter sido apenas uma falha na comunicação.</p>
<div class="admonition note">
<p class="admonition-title">Quantidade de execuções</p>
<ul>
<li>No máximo uma - não retentar</li>
<li>Exatamente uma - impedir que falhas aconteçam :/</li>
<li>Pelo menos uma - retentar até ter confirmação</li>
</ul>
</div>
<p>Como é impossível evitar falhas, se uma operação deve executada, ela deve ser retentada. 
Mas ela não pode ser repetida, então a alternativa é tornar as operações <a href="https://en.wikipedia.org/wiki/Idempotence"><strong>idempotentes</strong></a>, o que quer dizer que o efeito desejado é alcançado pela primeira execução e que execuções seguintes não alteram o estado.</p>
<div class="admonition note">
<p class="admonition-title">Operações idempotentes</p>
<p>Múltiplas execuções tem o mesmo efeito uma execução.</p>
<ul>
<li>Exemplo: <code>x = 10</code></li>
<li>Anti-exemplo:  <code>x = x+1</code>.</li>
</ul>
</div>
<p>Infelizmente não é trivial programar para idempotência, principalmente se o servidor for acessado concorrentemente por múltiplos clientes, tornando seu estado uam região crítica.</p>
<h4 id="concorrencia-no-servidor">Concorrência no servidor</h4>
<p>É importante notar que um servidor não está obrigado a atender requisições de somente um cliente.
Logo, se múltiplos clientes acessam o mesmo servidor, o estado do servidor será "compartilhado" pelos vários clientes e passos são necessários para que o comportamento no acesso deste estado seja coerente com a especificação.</p>
<p>Pense por exemplo em um servidor que conta o número de acessos feitos por clientes.
O incremento do contador deve ser considerado uma região crítica, caso múltiplos threads tratem as requisições dos clientes, o que já vimos ser uma boa idia.
Claro que dificilmente seu servidor seria algo tão simples assim.
Em vez disso, ele provavelmente executará lógicas complicadas, como por exemplo, armazenar o estado de contas bancárias e, neste caso, as funções expostas por RPC incluiríam a operação <strong>transferir saldo de A para B</strong>, o que nos leva a mais um problema interessante, o do risco de reexecuções.</p>
<p>Além disso, o servidor provavelmente suportará diversas operações e por isso deverá identificar qual a operação sendo requisitada.
Isto é feito por um <em>dispatcher</em>, que demultiplexa as operações requisitadas; o dispatcher pode, em algumas arquiteturas, ser independente do skeleton em si.</p>
<h3 id="frameworks">Frameworks</h3>
<p>Há diversas opçõe de <em>frameworks</em> para RPC, com diferentes características, focos, e garantias.
Alguns são parte da linguagem e outros são implementados como bibliotecas.
Alguns suportam múltiplas linguagens e alguns apenas uma.</p>
<div class="admonition note">
<p class="admonition-title">Suporte a RPC na linguagem</p>
<ul>
<li>Sem RPC: C, C++, Java &lt; 5.0 (1.5), Python</li>
<li>Com RPC: Java, Go, Erlang, Scala, Haskell</li>
<li>Ambientes heterogêneos: Thrift, gRPC, Akka, SOAP</li>
</ul>
</div>
<p>Frameworks mais modernos permitem escolher a forma de serialização dos dados, se legível para humanos ou binário, se o transporte é via HTTP ou protocolo mais baixo nível, se os dados trafegam abertamente ou se faz uso de comunicação criptografada (SSL).
Outros permitem escolher semântica de execução entre <strong>no máximo uma</strong> e <strong>pelo menos uma</strong>, e há até quem prometa <strong>exatamente uma</strong>.
Mas todos os <strong>frameworks</strong> tem algumas características em comum e uma delas é o uso de uma <strong>Linguagem de Definição de Interface</strong> (IDL).</p>
<h4 id="interface-definition-language-idl">Interface Definition Language - IDL</h4>
<p>Uma <a href="https://en.wikipedia.org/wiki/Interface_description_language">IDL</a> é a linguagem pela qual desenvolvedor define quais as operações (funções, procedimentos, métodos) serão acessíveis via RPC e quais os seus operandos.
Há várias IDL definidas, para os diversos <em>frameworks</em> disponíveis.</p>
<p>A imagem a seguir mostra um exemplo genérico da criação cliente e servidor usando um framework RPC genérico, inclusive o processamento da definição feita em IDL do serviço e a junção deste código gerado ao código escrito pelo desenvolvedor.</p>
<p><img alt="IDL" src="images/idl.png" /></p>
<p>O fluxo de processamento é o seguinte:</p>
<ul>
<li>Arquivo em IDL é compilado por um compilador IDL e gera diversos arquivos:<ul>
<li><em>stub</em> cliente - código que implementa a interface, com código para repassar invocações para o servidor.</li>
<li><em>stub</em> servidor (<em>skeleton</em>) - código que atende a conexões do <em>stub</em> cliente e repassa para a implementação própria da função.</li>
<li>conversão de dados - código que serializa e deserializa dados para serem trafegados de e para o servidor</li>
<li>cabeçalhos - definições da interface na linguagem de desenvolvimento da aplicação; se linguagem C, por exemplo, estes serão arquivos <code>.h</code>, se em Java, então estes serão arquivos<code>.java</code>, com definição de <code>interface</code>.</li>
</ul>
</li>
<li>O código cliente é compilado e gera o cliente, que deve <ul>
<li>inicializar a infraestrutura RPC<ul>
<li>Tipo de transporte</li>
<li>SSL?</li>
<li>Localizar servidor</li>
</ul>
</li>
<li>Lidar com falhas</li>
</ul>
</li>
<li>O código servidor é compilado e gera o servidor, que deve<ul>
<li>exportar e localizar serviços (serviço de nomeação)</li>
<li>Gerenciamento de portas</li>
<li>Conexões</li>
</ul>
</li>
</ul>
<p>Mas para entendermos melhor o fluxo, vejamos algumas ferramentas reais.</p>
<h3 id="estudo-de-caso-rpc-grpc">Estudo de Caso RPC: gRPC</h3>
<p>gRPC é um framework para invocação remota de procedimentos multi-linguagem e sistema operacional, usando internamente pelo Google há vários anos para implementar sua arquitetura de micro-serviços.
Inicialmente desenvolvido pelo Google, o gRPC é hoje de código livre encubado pela Cloud Native Computing Foundation.</p>
<p>O sítio <a href="https://grpc.io">gRPC.io</a> documenta muito bem o gRPC, inclusive os <a href="https://grpc.io/blog/principles/">princípios</a> que nortearam seu projeto.</p>
<p>O seu uso segue, em linhas gerais, o modelo discutido nas seções anteriores, isto é, inicia-se pela definição de estruturas de dados e serviços, "compila-se" a definição para gerar stubs na linguagem desejada, e compila-se os stubs juntamente com os códigos cliente e servidor para gerar os binários correspondentes.
Vejamos a seguir um tutorial passo a passo, em Java, baseado no <a href="https://grpc.io/docs/quickstart/java.html">quickstart guide</a>.</p>
<h4 id="instalacao">Instalação</h4>
<p>Os procedimentos de instalação dependem da linguagem em que pretende usar o gRPC, tanto para cliente quanto para servidor.
No caso do <strong>Java</strong>, <strong>não há instalação propriamente dita</strong>.</p>
<h4 id="exemplo-java">Exemplo Java</h4>
<p>Observe que o repositório base apontado no tutorial serve de exemplo para diversas linguagens e diversos serviços, então sua estrutura é meio complicada. Nós nos focaremos aqui no exemplo mais simples, uma espécie de "hello word" do RPC.</p>
<h5 id="pegando-o-codigo">Pegando o código</h5>
<p>Para usar os exemplos, você precisa clonar o repositório com o tutorial, usando o comando a seguir.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>git clone -b v1.33.0 https://github.com/grpc/grpc-java
</code></pre></div>
</td></tr></table>

<p>Uma vez clonado, entre na pasta de exemplo do Java e certifique-se que está na versão 1.33, usada neste tutorial.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nb">cd</span> grpc-java<span class="se">\e</span>xamples
git checkout v1.33.0
</code></pre></div>
</td></tr></table>

<h5 id="compilando-e-executando">Compilando e executando</h5>
<p>O projeto usa <a href="https://gradle.org/">gradle</a> para gerenciar as dependências. Para, use o <em>wrapper</em> do gradle como se segue.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./gradlew installDist
</code></pre></div>
</td></tr></table>

<p>Caso esteja na UFU, coloque também informação sobre o proxy no comando.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./gradlew -Dhttp.proxyHost<span class="o">=</span>proxy.ufu.br -Dhttp.proxyPort<span class="o">=</span><span class="m">3128</span> -Dhttps.proxyHost<span class="o">=</span>proxy.ufu.br -Dhttps.proxyPort<span class="o">=</span><span class="m">3128</span> installDist
</code></pre></div>
</td></tr></table>

<p>Como quando usamos sockets diretamente, para usar o serviço definido neste exemplo, primeiros temos que executar o servidor.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./build/install/examples/bin/hello-world-server
</code></pre></div>
</td></tr></table>

<p>Agora, em <strong>um terminal distinto</strong> e a partir da mesma localização, execute o cliente, quantas vezes quiser.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./build/install/examples/bin/hello-world-client
</code></pre></div>
</td></tr></table>

<h5 id="o-servico">O serviço</h5>
<p>O exemplo não é muito excitante, pois tudo o que o serviço faz é enviar uma saudação aos clientes.
O serviço é definido no seguinte arquivo <code>.proto</code>, localizado em <code>./src/main/proto/helloworld.proto</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>message HelloRequest {
  string name = 1;
}

message HelloReply {
  string message = 1;
}


// The greeting service definition.
service Greeter {
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}
</code></pre></div>
</td></tr></table>

<p>No arquivo, inicialmente são definidas duas mensagens, usadas como requisição (cliente para servidor) e outra como resposta (servidor para cliente) do serviço definido em seguida.</p>
<p>A mensagem <code>HelloRequest</code> tem apenas um campo denominado <code>name</code>, do tipo <code>string</code>. Esta mensagem conterá o nome do cliente, usado na resposta gerada pelo servidor.</p>
<p>A mensagem <code>HelloReply</code> também tem um campo do tipo <code>string</code>, denominado <code>message</code>, que conterá a resposta do servidor.</p>
<p>O serviço disponível é definido pela palavra chave <code>service</code>e de nome <code>Greeter</code>; é importante entender que este nome será usado em todo o código gerado pelo compilador gRPC e que se for mudado, todas as referências ao código gerado devem ser atualizadas.</p>
<p>O serviço possui apenas uma operação, <code>SayHello</code>, que recebe como entrada uma mensagem <code>HelloRequest</code> e gera como resposta uma mensagem <code>HelloReply</code>.
Caso a operação precisasse de mais do que o conteúdo de <code>name</code> para executar, a mensagem <code>HelloRequest</code> deveria ser estendida, pois não há passar mais de uma mensagem para a operação.
Por outro lado, embora seja possível passar zero mensagens, esta não é uma prática recomendada.
Isto porquê caso o serviço precisasse ser modificado no futuro, embora seja possível estender uma mensagem, não é possível modificar a assinatura do serviço. 
Assim, caso não haja a necessidade de se passar qualquer informação para a operação, recomenda-se que seja usada uma mensagem de entrada vazia, que poderia ser estendida no futuro.
O mesmo se aplica ao resultado da operação.</p>
<p>Observe também que embora o serviço de exemplo tenha apenas uma operação, poderia ter múltiplas.
Por exemplo, para definir uma versão em português da operação <code>SayHello</code>, podemos fazer da seguinte forma.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">message</span> <span class="nc">HelloRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">HelloReply</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="kd">message</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">OlaRequest</span> <span class="p">{</span>     <span class="c1">// &lt;&lt;&lt;&lt;&lt;====</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">OlaReply</span> <span class="p">{</span>       <span class="c1">// &lt;&lt;&lt;&lt;&lt;====</span>
  <span class="kt">string</span> <span class="kd">message</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">service</span> <span class="n">Greeter</span> <span class="p">{</span>
  <span class="k">rpc</span> <span class="n">SayHello</span> <span class="p">(</span><span class="n">HelloRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">HelloReply</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">rpc</span> <span class="n">DigaOla</span> <span class="p">(</span><span class="n">OlaRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">OlaReply</span><span class="p">)</span> <span class="p">{}</span><span class="c1">// &lt;&lt;&lt;&lt;&lt;====</span>
<span class="p">}</span>
<span class="o">...</span>
</code></pre></div>
</td></tr></table>

<p>Observe que a nova operação recebe como entrada  mensagens <code>OlaRequest</code> e <code>OlaReply</code>, que tem definições exatamente iguais a <code>HellorRequest</code> e <code>HelloReply</code>.
Logo, em vez de definir novas mensagens, poderíamos ter usado as já definidas. Novamente, esta não é uma boa prática, pois caso fosse necessário evoluir uma das operações para atender a novos requisitos e estender suas mensagens, não será necessário tocar o restante do serviço.
Apenas reforçando, é boa prática definir <em>requests</em> e <em>responses</em> para cada método, a não ser que não haja dúvida de que serão para sempre iguais.</p>
<h5 id="implementando-um-servico">Implementando um serviço</h5>
<p>Agora modifique o arquivo <code>.proto</code> como acima, para incluir a operação <code>DigaOla</code>, recompile e reexecute o serviço.
Não dá certo, não é mesmo? Isto porquê você adicionou a definição de uma nova operação, mas não incluiu o código para implementá-la.
Façamos então a modificação do código, começando por <code>./src/main/java/io/grpc/examples/helloworld/HelloWorldServer.java</code>.
Este arquivo define a classe que <strong>implementa</strong> o serviço <code>Greeter</code>, <code>GreeterImpl</code>, com um método para cada uma das operações definidas. 
Para confirmar, procure por <code>sayHello</code>para encontrar a implementação de <code>SayHello</code>; observe que a diferença do <code>casing</code> vem das boas práticas de Java, de definir métodos e variáveis em <em>Camel casing</em>.</p>
<p>Para que sua versão estendida do serviço <code>Greeter</code> funcione, defina um método correspondendo à <code>DigaOla</code>, sem consultar o código exemplo abaixo, mas usando o código de <code>sayHello</code> como base; não se importe por enquanto com os métodos sendo invocados.
Note que os <code>...</code> indicam que parte do código, que não sofreu modificações, foi omitido.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="kd">private</span> <span class="kd">class</span> <span class="nc">GreeterImpl</span> <span class="kd">extends</span> <span class="n">GreeterGrpc</span><span class="p">.</span><span class="na">GreeterImplBase</span> <span class="p">{</span>
<span class="p">...</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sayHello</span><span class="p">(</span><span class="n">HelloRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">HelloReply</span><span class="o">&gt;</span> <span class="n">responseObserver</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">...</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">digaOla</span><span class="p">(</span><span class="n">OlaRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">OlaReply</span><span class="o">&gt;</span> <span class="n">responseObserver</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">OlaReply</span> <span class="n">reply</span> <span class="o">=</span> 
      <span class="n">OlaReply</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setMessage</span><span class="p">(</span><span class="s">&quot;Ola &quot;</span> <span class="o">+</span> <span class="n">req</span><span class="p">.</span><span class="na">getName</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>
    <span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">reply</span><span class="p">);</span>
    <span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Se você recompilar e reexecutar o código, não perceberá qualquer mudança na saída do programa. Isto porquê embora tenha definido um novo serviço, você não o utilizou. Para tanto, agora modifique o cliente, em <code>src/main/java/io/grpc/examples/helloworld/HelloWorldClient.java</code>, novamente se baseando no código existente e não se preocupando com "detalhes".</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">greet</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Will try to greet &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot; ...&quot;</span><span class="p">);</span>
<span class="p">...</span>
  <span class="n">OlaRequest</span> <span class="n">request2</span> <span class="o">=</span> <span class="n">OlaRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setName</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
  <span class="n">OlaReply</span> <span class="n">response2</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="n">response2</span> <span class="o">=</span> <span class="n">blockingStub</span><span class="p">.</span><span class="na">digaOla</span><span class="p">(</span><span class="n">request2</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">StatusRuntimeException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">WARNING</span><span class="p">,</span> <span class="s">&quot;RPC failed: {0}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span>
   <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Greeting: &quot;</span> <span class="o">+</span> <span class="n">response2</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Agora sim, você pode reexecutar cliente e servidor.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>./gradlew installDist
./build/install/examples/bin/hello-world-server <span class="p">&amp;</span>
./build/install/examples/bin/hello-world-client
</code></pre></div>
</td></tr></table>

<p>Percebeu como foi fácil adicionar uma operação ao serviço? Agora nos foquemos nos detalhes.</p>
<h5 id="stub-do-servidor">Stub do servidor</h5>
<ul>
<li>Como criar o servidor</li>
<li>Como definir o serviço</li>
<li>Como "startar" o servidor.</li>
</ul>
<h5 id="stub-do-cliente">Stub do cliente</h5>
<ul>
<li>Stub bloqueante</li>
<li>Stub não bloqueante</li>
</ul>
<h5 id="idl-grpc">IDL gRPC</h5>
<p>Outras características da IDL do gRPC</p>
<ul>
<li>Tipos básicos<ul>
<li>bool: boolean (true/false)</li>
<li>double: 64-bit; ponto-flutuante </li>
<li>float: 32-bit; ponto-flutuante </li>
<li>i32: 32-bit; inteiro sinalizado </li>
<li>i64: 64-bit; inteiro sinalizado</li>
<li>siXX: signed</li>
<li>uiXX: unsigned</li>
<li>sfixedXX: codificação de tamanho fixo</li>
<li>bytes: 8-bit; inteiro sinalizado</li>
<li>string: string UTF-8 ou ASCII 7-bit</li>
<li>Any: tipo indefinido</li>
</ul>
</li>
<li><a href="https://developers.google.com/protocol-buffers/docs/proto3">Diferentes traduções</a></li>
<li>
<p>Coleções
Defina e implemente uma operação <code>DigaOlas</code> em que uma lista de nomes é enviada ao servidor e tal que o servidor responda com uma longa string cumprimentando todos os nomes, um ap;os o outro.</p>
</li>
<li>
<p><em>Streams</em></p>
<ul>
<li>Do lado do servidor <br />
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">listOfHi</span> <span class="o">=</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="s">&quot;e aih&quot;</span><span class="p">,</span> <span class="s">&quot;ola&quot;</span><span class="p">,</span> <span class="s">&quot;ciao&quot;</span><span class="p">,</span> <span class="s">&quot;bao&quot;</span><span class="p">,</span> <span class="s">&quot;howdy&quot;</span><span class="p">,</span> <span class="s">&quot;s&#39;up&quot;</span><span class="p">);</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">digaOlas</span><span class="p">(</span><span class="n">OlaRequest</span> <span class="n">req</span><span class="p">,</span> <span class="n">StreamObserver</span><span class="o">&lt;</span><span class="n">OlaReply</span><span class="o">&gt;</span> <span class="n">responseObserver</span><span class="p">)</span> <span class="p">{</span>
<span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">hi</span><span class="p">:</span> <span class="n">listOfHi</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">OlaReply</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">OlaReply</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setMessage</span><span class="p">(</span><span class="n">hi</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="n">req</span><span class="p">.</span><span class="na">getName</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>
  <span class="n">responseObserver</span><span class="p">.</span><span class="na">onNext</span><span class="p">(</span><span class="n">reply</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">responseObserver</span><span class="p">.</span><span class="na">onCompleted</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></li>
<li>Do lado do cliente <br />
 <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">OlaRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">OlaRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setName</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="k">try</span> <span class="p">{</span>
   <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">OlaReply</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">blockingStub</span><span class="p">.</span><span class="na">digaOlas</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="na">hasNext</span><span class="p">()){</span>
     <span class="n">OlaReply</span> <span class="n">response</span> <span class="o">=</span> <span class="n">it</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
     <span class="n">logger</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Greeting: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
   <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">StatusRuntimeException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">logger</span><span class="p">.</span><span class="na">log</span><span class="p">(</span><span class="n">Level</span><span class="p">.</span><span class="na">WARNING</span><span class="p">,</span> <span class="s">&quot;RPC failed: {0}&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="na">getStatus</span><span class="p">());</span>
   <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table></li>
</ul>
</li>
</ul>
<h5 id="exemplo-python">Exemplo Python</h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>apt-get install python3
apt-get install python3-pip
python3 -m pip install --upgrade pip
python3 -m pip install grpcio
python3 -m pip install grpcio-tools

git clone -b v1.10.x https://github.com/grpc/grpc
<span class="nb">cd</span> grpc/examples/python/helloworld
python3 greeter<span class="se">\_</span>server.py
python3 greeter<span class="se">\_</span>client.py
</code></pre></div>
</td></tr></table>

<p>Para recompilar os stubs, faça</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>python3 -m grpc_tools.protoc -I../../protos --python_out<span class="o">=</span>. --grpc_python_out<span class="o">=</span>. ../../protos/helloworld.proto
</code></pre></div>
</td></tr></table>

<p>Modifique o servidor</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">DigaOla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">helloworld_pb2</span><span class="o">.</span><span class="n">OlaReply</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;Ola, </span><span class="si">%s</span><span class="s1">!&#39;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>Modifique o cliente</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">response</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">DigaOla</span><span class="p">(</span><span class="n">helloworld_pb2</span><span class="o">.</span><span class="n">OlaRequest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;zelelele&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Greeter client received: &quot;</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

<h3 id="estudo-de-caso-rpc-thrift">Estudo de Caso RPC: Thrift</h3>
<p><a href="https://thrift.apache.org/">Thrift</a></p>
<h4 id="instalacao_1">Instalação</h4>
<ul>
<li><a href="http://www.apache.org/dyn/closer.cgi?path=/thrift/0.13.0/thrift-0.13.0.tar.gz">Baixe</a> e compile o thrift</li>
<li>ou instale-o usando apt-get, por exemplo. <code>apt-get install thrift-compiler</code></li>
<li>execute "thrift" na linha de comando.</li>
<li>Para thrift com Java, também precisarão dos seguintes arquivos</li>
<li><a href="http://mvnrepository.com/artifact/org.slf4j/slf4j-api/1.7.21">slf4j</a></li>
<li><a href="https://mvnrepository.com/artifact/org.apache.thrift/libthrift/0.13.0">libthrift0.13.0.jar</a></li>
<li>coloque-os na pasta <code>jars</code></li>
</ul>
<h4 id="idl-thrift">IDL Thrift</h4>
<ul>
<li>Tipos básicos<ul>
<li>bool: boolean (true/false)</li>
<li>byte: 8-bit; inteiro sinalizado</li>
<li>i16: 16-bit; inteiro sinalizado</li>
<li>i32: 32-bit; inteiro sinalizado</li>
<li>i64: 64-bit; inteiro sinalizado</li>
<li>double: 64-bit; ponto-flutuante </li>
<li>string: string UTF-8</li>
<li>binary: sequência de bytes</li>
</ul>
</li>
<li>Estruturas
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">struct</span><span class="w"> </span><span class="nc">Example</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">number</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="mi">2</span><span class="p">:</span><span class="kt">i64</span><span class="w"> </span><span class="n">bigNumber</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="mi">3</span><span class="p">:</span><span class="kt">double</span><span class="w"> </span><span class="n">decimals</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="mi">4</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;thrifty&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table></li>
<li>Serviços
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">service</span><span class="w"> </span><span class="nc">ChaveValor</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">set</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">value</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nf">get</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="k">throws</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">KeyNotFound</span><span class="w"> </span><span class="n">knf</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table></li>
<li><strong>Não se pode retornar NULL!!!</strong></li>
<li>Exceções
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kd">exception</span><span class="w"> </span><span class="nc">KeyNotFound</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="mi">1</span><span class="p">:</span><span class="kt">i64</span><span class="w"> </span><span class="n">hora</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"></span>
<span class="w">   </span><span class="mi">2</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">chaveProcurada</span><span class="o">=</span><span class="s2">&quot;thrifty&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</td></tr></table></li>
<li>Containers<ul>
<li>List</li>
<li>Map</li>
<li>Set</li>
</ul>
</li>
</ul>
<p>Exemplo: chavevalor.thrift</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">namespace</span><span class="w"> </span><span class="nn">java</span><span class="w"> </span><span class="n">chavevalor</span><span class="w"></span>
<span class="kn">namespace</span><span class="w"> </span><span class="nn">py</span><span class="w"> </span><span class="n">chavevalor</span><span class="w"></span>


<span class="kd">exception</span><span class="w"> </span><span class="nc">KeyNotFound</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>


<span class="kd">service</span><span class="w"> </span><span class="nc">ChaveValor</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nf">getKV</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="k">throws</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">KeyNotFound</span><span class="w"> </span><span class="n">knf</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">setKV</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="kt">string</span><span class="w"> </span><span class="n">value</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delKV</span><span class="o">(</span><span class="mi">1</span><span class="p">:</span><span class="kt">i32</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w">  </span>
</code></pre></div>
</td></tr></table>

<p>Compilação</p>
<p><code>thrift --gen java chavevalor.thrift</code></p>
<p><code>thrift --gen py chavevalor.thrift</code></p>
<p>ChaveValorHandler.java
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">namespace</span> <span class="n">java</span> <span class="n">chavevalor</span>
<span class="n">namespace</span> <span class="n">py</span> <span class="n">chavevalor</span>


<span class="n">exception</span> <span class="n">KeyNotFound</span>
<span class="p">{</span>
<span class="p">}</span>


<span class="n">service</span> <span class="n">ChaveValor</span>
<span class="p">{</span>
    <span class="n">string</span> <span class="nf">getKV</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i32</span> <span class="n">key</span><span class="p">)</span> <span class="kd">throws</span> <span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">KeyNotFound</span> <span class="n">knf</span><span class="p">),</span>
    <span class="n">bool</span> <span class="nf">setKV</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i32</span> <span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="n">string</span> <span class="n">value</span><span class="p">),</span>
    <span class="kt">void</span> <span class="nf">delKV</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i32</span> <span class="n">key</span><span class="p">)</span>
<span class="p">}</span>  

<span class="kn">package</span> <span class="nn">chavevalor</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.apache.thrift.TException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">chavevalor.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChaveValorHandler</span> <span class="kd">implements</span> <span class="n">ChaveValor</span><span class="p">.</span><span class="na">Iface</span> <span class="p">{</span>
   <span class="kd">private</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="p">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">kv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">getKV</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">TException</span> <span class="p">{</span>
       <span class="k">if</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
          <span class="k">return</span> <span class="n">kv</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
       <span class="k">else</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="n">KeyNotFound</span><span class="p">();</span>
   <span class="p">}</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">setKV</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">valor</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">TException</span> <span class="p">{</span>
       <span class="n">kv</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">valor</span><span class="p">);</span>
       <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delKV</span><span class="p">(</span><span class="kt">int</span> <span class="n">key</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">TException</span> <span class="p">{</span>
       <span class="n">kv</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
   <span class="p">}</span>    
<span class="p">}</span>
</code></pre></div>
</td></tr></table></p>
<h4 id="arquitetura">Arquitetura</h4>
<ul>
<li>Runtime library -- componentes podem ser selecionados em tempo de execução e implementações podem ser trocadas</li>
<li>Protocol -- responsável pela serializaçãoo dos dados<ul>
<li>TBinaryProtocol</li>
<li>TJSONProtocol</li>
<li>TDebugProtocol</li>
<li>...</li>
</ul>
</li>
<li>Transport -- I/O no ``fio''<ul>
<li>TSocket</li>
<li>TFramedTransport (non-blocking server)</li>
<li>TFileTransport</li>
<li>TMemoryTransport</li>
</ul>
</li>
<li>
<p>Processor -- Conecta protocolos de entrada e saída com o \emph{handler}</p>
</li>
<li>
<p>Handler -- Implementação das operações oferecidas</p>
</li>
<li>Server -- Escuta portas e repassa dados (protocolo) para o processors<ul>
<li>TSimpleServer</li>
<li>TThreadPool</li>
<li>TNonBlockingChannel</li>
</ul>
</li>
</ul>
<h4 id="classpath">Classpath</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>javac  -cp jars/libthrift0.9.3.jar:jars/slf4japi1.7.21.jar:gen-java  -d . *.java 
java -cp jars/libthrift0.9.3.jar:jars/slf4japi1.7.21.jar:gen-java:. chavevalor.ChaveValorServer
java -cp jars/libthrift0.9.3.jar:jars/slf4japi1.7.21.jar:gen-java:. chavevalor.ChaveValorClient 
</code></pre></div>
</td></tr></table>

<h4 id="referencias">Referências</h4>
<p><a href="http://thrift-tutorial.readthedocs.org/en/latest/index.html">Tutorial</a></p>
<h3 id="estudo-de-caso-rpc-rmi">Estudo de Caso RPC: RMI</h3>
<details class="bug"><summary>TODO</summary><p>Como usar RMI.</p>
</details>
<h2 id="comunicacao-orientada-a-mensagens">Comunicação orientada a Mensagens</h2>
<details class="bug"><summary>TODO</summary><ul>
<li><a href="https://en.wikipedia.org/wiki/Message-oriented_middleware">MOM</a></li>
<li><a href="https://en.wikipedia.org/wiki/Enterprise_service_bus">Enterprise Message Bus</a></li>
<li><a href="https://www.netlify.com/blog/2017/03/02/to-message-bus-or-not-distributed-systems-design/">To Message Bus or Not: distributed system design</a></li>
</ul>
</details>
<p>O foco aqui é na descrição da tecnologia, mas não das arquiteturas resultantes, que serão vistas no capítulo seguinte.</p>
<h2 id="publishsubscribe">Publish/Subscribe</h2>
<p>O padrão <em>publish/subscribe</em> (ou <em>pub/sub</em>) se apresenta como uma alternativa à arquitetura cliente-servidor.
Enquanto no modelo client-servidor, o cliente se comunica diretamente com um <em>endpoint</em> representado pelo servidor, no padrão <em>pub/sub</em> temos clientes que enviam mensagens, ou <em>publishers</em>, e clientes que recebem as mensagens, ou <em>subscribers</em>. Esses dois tipos de clientes nunca se comunicam diretamente e não precisam nem saber da existência do outro.
Um agente especial, denominado <em>broker</em>, gerencia a conexão, armazena e filtrando as mensagens, além de distribuí-las corretamente aos <em>subscribers</em>.</p>
<h3 id="desacoplamento">Desacoplamento</h3>
<p>Um dos aspectos mais importantes proporciados pelo padrão <em>pub/sub</em> é o desacoplamento entre as partes envolvidas, o qual ocorre em várias dimensões:</p>
<ul>
<li>Espaço: <em>publishers</em> e <em>subscribers</em> não precisam se conhecer (por exemplo, não há necessidade de informar endereço IP e porta de cada um).</li>
<li>Tempo: <em>publishers</em> e <em>subscribers</em> não precisam nem estar em execução ao mesmo tempo.</li>
<li>Sincronização: operações em cada componente não precisa ser interrompida durante a publicação ou recebimento.</li>
</ul>
<h3 id="filtragem">Filtragem</h3>
<p>O <em>broker</em> tem um papel fundamental pois permite a especificação de diversos níveis de filtragem:</p>
<ul>
<li>Baseada em assunto: <em>subscribers</em> se registram para receber mensagens de um ou mais tópicos de interesse. Em geral esses tópicos são strings com um formato hierárquico, por exemplo <code>/devices/sensor/+/temperature</code>.</li>
<li>Baseada em conteúdo: baseada em linguagem de filtragem de conteúdo específica. <em>Downside:</em> mensagem não pode ser criptografada.</li>
<li>Baseada em tipo: leva em consideração o tipo ou classe de uma mensagem ou evento, como o tipo <em>Exception</em> e subtipos, por exemplo.</li>
</ul>
<h3 id="mqtt">MQTT</h3>
<p>MQTT é um protocolo de transporte para publish/subscribe do tipo cliente-servidor.
É leve, aberto e fácil de implementar, ideal para comunicação <em>Machine to Machine</em> (M2M) e uso no contexto de Internet das Coisas (<em>Internet of Things - I0T</em>).</p>
<blockquote>
<p>MQTT is a very light weight and binary protocol, and due to its minimal packet overhead, MQTT excels when transferring data over the wire in comparison to protocols like HTTP. Another important aspect of the protocol is that MQTT is extremely easy to implement on the client side. Ease of use was a key concern in the development of MQTT and makes it a perfect fit for constrained devices with limited resources today.</p>
</blockquote>
<p>O padrão é definido pela OASIS, uma organização aberta responsável por padrões como SAML e DocBook. A especificação atual é a de número 5, lançada em março de 2019.</p>
<h3 id="referencia">Referência</h3>
<p><a href="https://www.hivemq.com/mqtt-essentials/">MQTT Essentials</a></p>
<h3 id="estudo-de-caso-mosquitto">Estudo de caso: MosQuiTTo</h3>
<blockquote>
<p><a href="https://mosquitto.org">Eclipse Mosquitto</a> is an open source (EPL/EDL licensed) message broker that implements the MQTT protocol versions 5.0, 3.1.1 and 3.1. Mosquitto is lightweight and is suitable for use on all devices from low power single board computers to full servers.</p>
</blockquote>
<h4 id="instalacao_2">Instalação</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>apt-get install mosquitto <span class="c1"># Ubuntu</span>
brew install mosquitto <span class="c1"># MacOS</span>
</code></pre></div>
</td></tr></table>

<h4 id="inicializando-o-servico">Inicializando o serviço</h4>
<p>O arquivo <code>mosquito.conf</code> contém as configurações para o <em>broker</em>. 
As configurações funcionam bem para o nosso caso. O <em>broker</em> aceita requisições na porta 1883 e <em>publishers</em> e <em>subscribers</em> também utilizam essa porta por padrão.
Basta iniciar o <em>broker</em> com a opção <code>-v</code> para ter mais detalhes sobre o que ocorre internamente.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>mosquitto -v
</code></pre></div>
</td></tr></table>

<h4 id="publicando">Publicando</h4>
<p>Para publicar uma mensagem, o <em>publisher</em> deve indicar um host, porta, tópico e mensagem. Caso o host e porta sejam omitidos, assume-se <code>localhost:1883</code>.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># publicando valor de 40 para tópicos &#39;sensor/temperature/1&#39; e &#39;sensor/temperature/2&#39;</span>
mosquitto_pub -t sensor/temperature/1 -m <span class="m">40</span>
mosquitto_pub -t sensor/temperature/2 -m <span class="m">32</span>
</code></pre></div>
</td></tr></table>

<p>Caso o <em>subscriber</em> não esteja em execução, adicione a opção <code>-r</code> para que o broker retenha a mensagem.</p>
<h4 id="consumindo">Consumindo</h4>
<p>O consumidor funciona de maneira semelhante, informando o tópico de interesse:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># consumindo mensagens de tópico /sensor/temperature/*</span>
mosquito_pub -t sensor/temperature/+
</code></pre></div>
</td></tr></table>

<h4 id="programando">Programando</h4>
<p>Existem também APIs em diversas linguagem para desenvolvimento de aplicações que utilizem o Mosquitto.
A biblioteca pode ser baixada <a href="https://repo.eclipse.org/content/repositories/paho-snapshots/org/eclipse/paho/org.eclipse.paho.client.mqttv3/1.2.6-SNAPSHOT/org.eclipse.paho.client.mqttv3-1.2.6-20200715.040602-1.jar">aqui</a>.</p>
<h5 id="exemplo-de-publisher">Exemplo de <em>Publisher</em></h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttClient</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttConnectOptions</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.MqttMessage</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.eclipse.paho.client.mqttv3.persist.MemoryPersistence</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MqttPublishSample</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">topic</span>        <span class="o">=</span> <span class="s">&quot;MQTT Examples&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">content</span>      <span class="o">=</span> <span class="s">&quot;Message from MqttPublishSample&quot;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">qos</span>             <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">broker</span>       <span class="o">=</span> <span class="s">&quot;tcp://mqtt.eclipse.org:1883&quot;</span><span class="p">;</span>
    <span class="n">String</span> <span class="n">clientId</span>     <span class="o">=</span> <span class="s">&quot;JavaSample&quot;</span><span class="p">;</span>
    <span class="n">MemoryPersistence</span> <span class="n">persistence</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryPersistence</span><span class="p">();</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="n">MqttClient</span> <span class="n">sampleClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="n">broker</span><span class="p">,</span> <span class="n">clientId</span><span class="p">,</span> <span class="n">persistence</span><span class="p">);</span>
      <span class="n">MqttConnectOptions</span> <span class="n">connOpts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MqttConnectOptions</span><span class="p">();</span>
      <span class="n">connOpts</span><span class="p">.</span><span class="na">setCleanSession</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connecting to broker: &quot;</span><span class="o">+</span><span class="n">broker</span><span class="p">);</span>
      <span class="n">sampleClient</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="n">connOpts</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Connected&quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Publishing message: &quot;</span><span class="o">+</span><span class="n">content</span><span class="p">);</span>
      <span class="n">MqttMessage</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MqttMessage</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
      <span class="n">message</span><span class="p">.</span><span class="na">setQos</span><span class="p">(</span><span class="n">qos</span><span class="p">);</span>
      <span class="n">sampleClient</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Message published&quot;</span><span class="p">);</span>
      <span class="n">sampleClient</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Disconnected&quot;</span><span class="p">);</span>
      <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">MqttException</span> <span class="n">me</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;reason &quot;</span><span class="o">+</span><span class="n">me</span><span class="p">.</span><span class="na">getReasonCode</span><span class="p">());</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;msg &quot;</span><span class="o">+</span><span class="n">me</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;loc &quot;</span><span class="o">+</span><span class="n">me</span><span class="p">.</span><span class="na">getLocalizedMessage</span><span class="p">());</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;cause &quot;</span><span class="o">+</span><span class="n">me</span><span class="p">.</span><span class="na">getCause</span><span class="p">());</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;excep &quot;</span><span class="o">+</span><span class="n">me</span><span class="p">);</span>
      <span class="n">me</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<!-- Distinction from message queues
There is a lot of confusion about the name MQTT and whether the protocol is implemented as a message queue or not. We will try to shed some light on the topic and explain the differences. In our last post, we mentioned that MQTT refers to the MQseries product from IBM and has nothing to do with “message queue“. Regardless of where the name comes from, it’s useful to understand the differences between MQTT and a traditional message queue:

A message queue stores message until they are consumed When you use a message queue, each incoming message is stored in the queue until it is picked up by a client (often called a consumer). If no client picks up the message, the message remains stuck in the queue and waits to be consumed. In a message queue, it is not possible for a message not to be processed by any client, as it is in MQTT if nobody subscribes to a topic.

A message is only consumed by one client Another big difference is that in a traditional message queue a message can be processed by one consumer only. The load is distributed between all consumers for a queue. In MQTT the behavior is quite the opposite: every subscriber that subscribes to the topic gets the message.

Queues are named and must be created explicitly A queue is far more rigid than a topic. Before a queue can be used, the queue must be created explicitly with a separate command. Only after the queue is named and created is it possible to publish or consume messages. In contrast, MQTT topics are extremely flexible and can be created on the fly.

If you can think of any other differences that we overlooked, we would love to hear from you in the comments. -->

<details class="bug"><summary>TODO</summary><p>Diferenciar de MOM</p>
</details>
<!-- O foco aqui é na descrição da tecnologia, mas não das arquiteturas resultantes, que serão vistas no capítulo seguinte. -->

<div class="admonition question">
<p class="admonition-title">Exercícios - RPC e Publish/Subscribe</p>
<ul>
<li>Usando <em>thrift</em> e a linguagem Java, extenda o serviço ChaveValor para retornar o valor antigo de uma determinada chave na operação <code>setKV()</code>  caso a chave já exista.</li>
<li>Usando o <em>broker</em> mosquitto instalado localmente, faça em Java um <em>publisher</em> que simula um sensor de temperatura e publica valores aleatórios entre 15 e 45 a cada segundo.</li>
<li>Faça o <em>subscriber</em> que irá consumir esses dados de temperatura.</li>
</ul>
</div>
<div class="footnote">
<hr />
<ol>
<li id="fn:birrel">
<p><a href="http://www.birrell.org/andrew/papers/ImplementingRPC.pdf">Implementing RPC</a>&#160;<a class="footnote-backref" href="#fnref:birrel" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:omissao">
<p>Omitirei alguns detalhes aqui, em nome da generalidade, mas vocês podem recuperá-los em seus livros de Arquitetura de Computadores.&#160;<a class="footnote-backref" href="#fnref:omissao" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:skeleton">
<p>O <em>stub</em> do servidor também é conhecido como <em>skeleton</em>.&#160;<a class="footnote-backref" href="#fnref:skeleton" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:marshal">
<p>Marshalling: representar parâmetros de forma própria para transmissão "no fio".&#160;<a class="footnote-backref" href="#fnref:marshal" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../basics/" title="Fundamentos" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Fundamentos
              </div>
            </div>
          </a>
        
        
          <a href="../arch/" title="Arquiteturas" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Arquiteturas
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.c51dfa35.min.js"></script>
      <script src="../assets/javascripts/bundle.eaaa3931.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  </body>
</html>