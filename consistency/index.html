
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Consistência - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
  



  
  



  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PJX835H7DP"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-PJX835H7DP",{page_path:t.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PJX835H7DP"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modelos-de-consistencia" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-header__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Consistência
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando a pesquisa
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        Prefácio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Comunicação
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Comunicação" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Comunicação
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/redes/" class="md-nav__link">
        Redes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/internet/" class="md-nav__link">
        Internet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/sockets/" class="md-nav__link">
        Sockets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/datarep/" class="md-nav__link">
        Representação
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/middleware/" class="md-nav__link">
        Middlewares
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/rpc/" class="md-nav__link">
        RPC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/mom/" class="md-nav__link">
        MOM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/epidemics/" class="md-nav__link">
        Epidêmicos
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../comm/refs/" class="md-nav__link">
        Referências
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Arquiteturas
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Arquiteturas" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Arquiteturas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../arch/arch/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../arch/p2p/" class="md-nav__link">
        P2P
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../arch/microservices/" class="md-nav__link">
        Microsserviços
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        Modelos
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Coordenação
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Coordenação" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Coordenação
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../coord/concurrency/" class="md-nav__link">
        Concorrência
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../coord/coord/" class="md-nav__link">
        Coordenação
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Tempo
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tempo" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Tempo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../time/physical/" class="md-nav__link">
        Tempo Físico
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../time/logical/" class="md-nav__link">
        Tempo Lógico
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fault/" class="md-nav__link">
        Tolerância a Falhas
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Consistência
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Consistência
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelos-de-consistencia" class="md-nav__link">
    Modelos de Consistência
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Consistência">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelos-centrados-nos-dados" class="md-nav__link">
    Modelos Centrados nos Dados
  </a>
  
    <nav class="md-nav" aria-label="Modelos Centrados nos Dados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linearabilidade" class="md-nav__link">
    Linearabilidade
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-sequencial" class="md-nav__link">
    Consistência Sequencial
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-causal" class="md-nav__link">
    Consistência Causal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-fifo" class="md-nav__link">
    Consistência FIFO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-de-entrada" class="md-nav__link">
    Consistência de Entrada
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelos-centrados-nos-clientes" class="md-nav__link">
    Modelos Centrados nos Clientes
  </a>
  
    <nav class="md-nav" aria-label="Modelos Centrados nos Clientes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelo-de-sistema" class="md-nav__link">
    Modelo de Sistema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leituras-monotonicas" class="md-nav__link">
    Leituras Monotônicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escritas-monotonicas" class="md-nav__link">
    Escritas Monotônicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leia-suas-escritas" class="md-nav__link">
    Leia suas Escritas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escritas-seguem-leituras" class="md-nav__link">
    Escritas seguem Leituras
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gerenciamento-de-replicas" class="md-nav__link">
    Gerenciamento de Réplicas
  </a>
  
    <nav class="md-nav" aria-label="Gerenciamento de Réplicas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#posicionamento" class="md-nav__link">
    Posicionamento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagacao-de-atualizacoes" class="md-nav__link">
    Propagação de Atualizações
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recuperacao-checkpoint" class="md-nav__link">
    Recuperação &amp; Checkpoint
  </a>
  
    <nav class="md-nav" aria-label="Recuperação &amp; Checkpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-recuperavel" class="md-nav__link">
    Log Recuperável
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estado-global-consistente" class="md-nav__link">
    Estado global consistente
  </a>
  
    <nav class="md-nav" aria-label="Estado global consistente">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checkpointing-independente" class="md-nav__link">
    Checkpointing independente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpointing-coordenado" class="md-nav__link">
    Checkpointing coordenado
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disdb/" class="md-nav__link">
        Bancos de Dados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disfs/" class="md-nav__link">
        Sistemas de Arquivos
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Estudos de Caso
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Estudos de Caso" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Estudos de Caso
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/cassandra/" class="md-nav__link">
        Cassandra
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/chord/" class="md-nav__link">
        Chord
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/dynamo/" class="md-nav__link">
        Dynamo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/grpc/" class="md-nav__link">
        gRPC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/mosquito/" class="md-nav__link">
        Mosquito
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/rmi/" class="md-nav__link">
        RMI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/thrift/" class="md-nav__link">
        Thrift
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/kafka/" class="md-nav__link">
        Kafka
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/refs/" class="md-nav__link">
        Referências
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cases/swim/" class="md-nav__link">
        Swim
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tech/" class="md-nav__link">
        Tecnologias
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../projeto/" class="md-nav__link">
        Projeto
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelos-de-consistencia" class="md-nav__link">
    Modelos de Consistência
  </a>
  
    <nav class="md-nav" aria-label="Modelos de Consistência">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelos-centrados-nos-dados" class="md-nav__link">
    Modelos Centrados nos Dados
  </a>
  
    <nav class="md-nav" aria-label="Modelos Centrados nos Dados">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linearabilidade" class="md-nav__link">
    Linearabilidade
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-sequencial" class="md-nav__link">
    Consistência Sequencial
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-causal" class="md-nav__link">
    Consistência Causal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-fifo" class="md-nav__link">
    Consistência FIFO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consistencia-de-entrada" class="md-nav__link">
    Consistência de Entrada
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modelos-centrados-nos-clientes" class="md-nav__link">
    Modelos Centrados nos Clientes
  </a>
  
    <nav class="md-nav" aria-label="Modelos Centrados nos Clientes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modelo-de-sistema" class="md-nav__link">
    Modelo de Sistema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leituras-monotonicas" class="md-nav__link">
    Leituras Monotônicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escritas-monotonicas" class="md-nav__link">
    Escritas Monotônicas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leia-suas-escritas" class="md-nav__link">
    Leia suas Escritas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escritas-seguem-leituras" class="md-nav__link">
    Escritas seguem Leituras
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gerenciamento-de-replicas" class="md-nav__link">
    Gerenciamento de Réplicas
  </a>
  
    <nav class="md-nav" aria-label="Gerenciamento de Réplicas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#posicionamento" class="md-nav__link">
    Posicionamento
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#propagacao-de-atualizacoes" class="md-nav__link">
    Propagação de Atualizações
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recuperacao-checkpoint" class="md-nav__link">
    Recuperação &amp; Checkpoint
  </a>
  
    <nav class="md-nav" aria-label="Recuperação &amp; Checkpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#log-recuperavel" class="md-nav__link">
    Log Recuperável
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estado-global-consistente" class="md-nav__link">
    Estado global consistente
  </a>
  
    <nav class="md-nav" aria-label="Estado global consistente">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#checkpointing-independente" class="md-nav__link">
    Checkpointing independente
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkpointing-coordenado" class="md-nav__link">
    Checkpointing coordenado
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

<!-- Edit button -->


  <!--
       Hack: check whether the content contains a h1 headline. If it
       doesn't, the page title (or respectively site name) is used
       as the main headline.
    -->

  <h1>Consistência</h1>


  <!-- Content -->
  <p>Considere por um momento, uma <strong><em>Content Delivery Network</em></strong> (CDN).</p>
<details class="sideslide"><summary>CDN</summary><ul>
<li>Conteúdo é colocado próximo aos clientes. </li>
<li>Conteúdo estático ou majoritariamente determinístico. </li>
<li>Um pequeno atraso na replicação é tolerado.</li>
<li>Atualização acontece infrequentemente.</li>
</ul>
</details>
<p>As <em>Content Delivery Networks</em> são sistemas que replicam os dados do contratante para, dinamicamente, colocar o conteúdo próximo ao usuário.</p>
<p><img alt="https://www.creative-artworks.eu/why-use-a-content-delivery-network-cdn/" src="../images/cdn.jpeg" /></p>
<p>Se o conteúdo é majoritariamente estático, entregar esta funcionalidade é "simples", implicando apenas em um pequeno atraso entre a publicação de novo conteúdo e sua disponibilização para os usuários.
Neste caso, um protocolo de difusão totalmente ordenada, como o RAFT, pode ser usado na replicação, isto é, para garantir que todos os servidores vejam as mesmas mudanças, na mesma ordem, e que alcancem o mesmo estado final em algum momento.
Contudo, os protocolos de difusão totalmente ordenada tem um alto custo para atualizar as réplicas e este custo pode ser demais para a aplicação.
Neste caso, podemos tentar relaxar os requisitos da aplicação, por exemplo permitindo que atualizações sejam vistas em ordens diferentes por diferentes "réplicas", agora com aspas.
Por exemplo, se em vez de difusão atômica usássemos IP-Multicast, teríamos uma atualização mais barata dos dados, mas alguns valores escritos poderiam nunca ser vistos.</p>
<p>O que quero mostrar aqui é <strong>há custos inerentes</strong> na coordenação das partes do sistema distribuído, mas que é possível pensar em níveis diferentes de coordenação, com diferentes custos e é aí que entram os diversos modelos ou níveis de consistência.</p>
<h2 id="modelos-de-consistencia">Modelos de Consistência</h2>
<p>Embora não seja necessário, para falarmos sobre modelos de consistência, falaremos sobre bancos de dados pois é algo próximo da realidade da maioria dos estudantes e torna mais fácil o entendimento do tópico.
Um banco de dados pode ser pensado, em sua forma mais simplista, como um conjunto de variáveis nas quais valores são armazenados.
Assim, clientes do banco de dados essencialmente executam comandos como <strong><span class="arithmatex">\(X\)</span> recebe 'João'</strong> e <strong><span class="arithmatex">\(Y\)</span> recebe 'joao arroba hmail.com'</strong>.
Obviamente que <span class="arithmatex">\(X\)</span> e <span class="arithmatex">\(Y\)</span> não precisam ser declarados antes da primeira escrita, assim como chaves primárias não são declaradas até que sejam usadas, e que o valor associado a uma variável pode ter várias partes, como <strong>"{'Endereço':'Av 1, número 2', 'Profissão':'Computeiro'}</strong> e cada parte um tipo. Veja bem, eu disse uma simplificação, mas não quer dizer que nao seja uma simplificação poderosa.</p>
<p><img alt="Single DB" src="../drawings/disdb.drawio-0.svg" /></p>
<p>Quando um processo se comunica com um banco de dados, ele o faz com certas expectativas quanto ao funcionamento deste banco.
Por exemplo, ao escrever um dados no banco, independentemente de como o banco é implementado, o cliente geralmente espera que as escritas aconteçam na ordem em que as disparou e que, ao ler uma variável, lhe seja retornado o "último" valor escrito na mesma.</p>
<p><img alt="Single DB" src="../drawings/disdb.drawio-2.svg" /></p>
<p>Esta expectativa é independente do banco de dados ser implementado de forma distribuída ou não. Isto é, mesmo que os dados armazenados no banco sejam particionados ou replicados entre vários nós, o cliente espera que o banco tenha comportamento consistente com o de um banco não distribuído e retorne ou aquilo que escreveu ou algo mas recente.</p>
<p><img alt="Single DB" src="../drawings/disdb.drawio-1.svg" /></p>
<details class="sidesline"><summary>Níveis de Consistência</summary><ul>
<li>Consistência forte: leituras sempre retornam a versão mais recente do dado sendo lido.<ul>
<li>Propagação instantânea ou <em>locks</em> dos dados sendo manipulados enquanto a propagação acontece.</li>
</ul>
</li>
<li>Consistência fraca: leituras retornam algum dado escrito anteriormente.<ul>
<li>Qualquer coisa vale</li>
</ul>
</li>
<li>Consistência eventual: se não houver novas escritas, a partir de algum momento as leituras retornam a versão mais recente do dado sendo lido.<ul>
<li>Propagação acontece no segundo plano</li>
</ul>
</li>
</ul>
</details>
<p>A expectativa, ou melhor, a forma como o banco de dados age dada uma interação com o cliente, ou clientes, é o que denominamos um <strong>modelo de consistência</strong>.
Em particular, a expectativa descrita acima é denominada <strong>linearabilidade</strong>, também conhecida como <strong>consistência forte</strong>.
Com o advento do NOSQL, mais e mais desenvolvedores buscam modelos alternativos, por exemplo, consistência <strong><em>eventual</em></strong>, em que há a garantia de que atualizações estarão disponíveis a partir de algum momento para a leitura, mas não há uma definição clara de quando isso ocorrerá.<sup id="fnref:eventual"><a class="footnote-ref" href="#fn:eventual">1</a></sup></p>
<p><img alt="eventual meme" src="../images/eventual-meme0.png" /></p>
<p>Enquanto consistência eventual traz melhoras de desempenho, trabalhar com este modelo implica em muito mais complexidade no desenvolvimento dos sistemas que usam o banco.</p>
<p><img alt="eventual meme" src="../images/eventual-meme.png" /></p>
<p>Um terceiro modelo geral de consistência seria a consistência <strong>fraca</strong>, em que a única garantia é de que o valor retornado nas leituras foi escrito em algum momento.
Na verdade, podemos pensar nos modelos de consistência como um espectro com <strong>forte</strong> e <strong>fraca</strong> nos extremos e diversos modelos, incluindo <strong><em>eventual</em></strong>, no meio.
Diferentes bancos de dados oferecem diferentes modelos, com nomes parecidos ou até iguais e é preciso conhecer o que cada sistema está entregando para poder utilizá-lo da forma correta.</p>
<p><a href="https://arxiv.org/abs/1512.00168"><img alt="" src="../images/consistency-models.png" /></a></p>
<p>Além disso, os modelos podem ser divididos em <strong>Centrados nos Dados</strong>  e <strong>Centrados nos Clientes</strong>, sendo que no primeiro o modelo é definido em termos das garantias de consistência dos dados e, no segundo, em termos das garantias sobre o que os clientes vêem.<sup id="fnref:util"><a class="footnote-ref" href="#fn:util">2</a></sup></p>
<h3 id="modelos-centrados-nos-dados">Modelos Centrados nos Dados</h3>
<details class="sideslide"><summary>Modelos de consistência</summary><ul>
<li>Propagação por ordenação de operações<ul>
<li>Linearabilidade: ordenação total que segue a linha do tempo.</li>
<li>Sequencial: ordenação total</li>
<li>Causal: ordenação causal</li>
<li>FIFO: ordenação FIFO</li>
</ul>
</li>
<li>Propagação quando necessário<ul>
<li>Consistência fraca geral</li>
<li>Consistência de entrada</li>
</ul>
</li>
</ul>
</details>
<h6>Notação</h6>
<p><img alt="" src="../images/07-04.png" /></p>
<ul>
<li>A leitura de x em (a) retorna a</li>
<li>A primeira leitura de x em (b) retorna Nil</li>
<li>A segunda  leitura de x em (b) retorna a</li>
</ul>
<h4 id="linearabilidade">Linearabilidade</h4>
<p>Qualquer leitura de um objeto <span class="arithmatex">\(X\)</span> retorna o valor gravado em <span class="arithmatex">\(X\)</span> pela operação de escrita mais recente em <span class="arithmatex">\(X\)</span>.</p>
<ul>
<li>O que quer dizer "mais recente" em um sistema distribuído assíncrono?</li>
<li>Todas as operações de escrita são instantaneamente visíveis a todos os processos  <em>tempo global</em> é respeitado.</li>
<li>Comportamento observado em um sistema sem conflitos ou centralizado</li>
</ul>
<p>Em qual(is) cenário(s) temos consistência estrita?
<img alt="" src="../images/07-04.png" /></p>
<h4 id="consistencia-sequencial">Consistência Sequencial</h4>
<p>O resultado de qualquer execução é equivalente a alguma execução sequencial das operações dos processos e as operações da cada processo aparecem nesta execução sequencial na ordem especificada por seu programa.</p>
<p><img alt="" src="../images/07-05a.png" /></p>
<p>P2, P3, P4, P1, P4, P3</p>
<p><img alt="" src="../images/07-05b.png" /></p>
<p>P1 ou P2, qual veio primeiro?</p>
<h4 id="consistencia-causal">Consistência Causal</h4>
<p>Escritas com potencial relação causal são vistas por todos os processos na mesma ordem. Escritas concorrentes (não causalmente relacionadas) podem se vistas em ordens diferentes por processos diferentes.</p>
<p><img alt="" src="../images/07-08.png" /></p>
<p>W(x)b depende de R(x)a que depende de W(x)a<br/>
 W(x)c e W(x)b são concorrentes.</p>
<p><img alt="" src="../images/07-09a.png" /></p>
<p>W(x)b depende de R(x)a que depende de W(x)a. W(x)a deve ser ordenado com W(x)b. P3 não pode ter lido b e depois a.</p>
<p><img alt="" src="../images/07-09b.png" /></p>
<h4 id="consistencia-fifo">Consistência FIFO</h4>
<p>Escritas de um processo são vistas por todos os outros processos na ordem em que foram feitas. Escritas de diferentes processos podem ser vistas em ordens diferentes.</p>
<p><img alt="" src="../images/07-08b.png" /></p>
<h4 id="consistencia-de-entrada">Consistência de Entrada</h4>
<h6>Grupos de Operações</h6>
<ul>
<li>Efeitos de operações individuais em um grupo não são visíveis.</li>
<li>Variáveis de sincronização<ul>
<li>Acesso às variáveis de sincronização da datastore é sequencialmente consistente.</li>
<li>Acesso à variável de sincronização não é permitido até que todas as escritas das anteriores tenham sido executadas em todos os lugares.</li>
<li>Acesso aos dados não é permitido até que todas as variáveis de sincronização tenham sido liberadas.</li>
<li>Transações tornam o trancamento/destrancamento de variáveis transparente.</li>
</ul>
</li>
</ul>
<h6>Variáveis de sincronização</h6>
<p><img alt="" src="../images/weaka.png" /></p>
<p><img alt="" src="../images/weakb.png" /></p>
<h6>Locks</h6>
<p>Materializando variáveis de sincronização na forma de <em>locks</em></p>
<ul>
<li>Lock de leitura só retorna quando todas as mudanças guardadas por aquele lock tiverem sido executadas no processo.</li>
<li>Lock de escrita só retorna quando nenhum outro processo tiver um lock, de leitura ou escrita.</li>
<li>Para ler uma variável, processo deve primeiro contactar o dono atual do lock cercando a variável, para pegar as mais recentes atualizações.</li>
</ul>
<p><img alt="" src="../images/07-10.png" /></p>
<h3 id="modelos-centrados-nos-clientes">Modelos Centrados nos Clientes</h3>
<p><strong>Ideia básica</strong></p>
<p>Evitar sincronização global focando-se no que os clientes vêem do sistema. Se para os clientes parecer consistente, tudo bem.</p>
<ul>
<li>
<p>Consistência Eventual</p>
<ul>
<li>Se nenhuma escrita ocorrer em período considerável de tempo, os clientes gradualmente se sincronizarão e ficarão consistentes.</li>
<li>Se clientes sempre acessarem as mesmas réplicas, terão impressão de consistência.</li>
</ul>
</li>
<li>
<p>Garantias são do ponto de vista de <em>um</em> cliente.</p>
<ul>
<li>Leituras monotônicas</li>
<li>Escrita monotônicas</li>
<li>Leia suas escritas</li>
<li>Escritas seguem leituras.</li>
</ul>
</li>
</ul>
<h5 id="modelo-de-sistema">Modelo de Sistema</h5>
<p><img alt="" src="../images/07-11.png" /></p>
<p>Cliente pode se mover antes de sua última operação ter replicado do servidor onde estava para o novo servidor.</p>
<h5 id="leituras-monotonicas">Leituras Monotônicas</h5>
<p><strong>Garantia</strong></p>
<p>Se um processo lê o valor de um item <span class="arithmatex">\(x\)</span>, qualquer leitura sucessiva de <span class="arithmatex">\(x\)</span> retornará o mesmo valor ou um mais recente.</p>
<ul>
<li>Toda vez que se conecta a um servidor de email, seu cliente lê novas mensagens, caso haja.</li>
<li>O cliente nunca esquece uma mensagem, mesmo que ainda não esteja no servidor conectado por último.</li>
<li>WS(<span class="arithmatex">\(x_i\)</span>) -- operações de escrita (<em>write set</em>) que levaram a variável <span class="arithmatex">\(x\)</span> a ter o valor <span class="arithmatex">\(x_i\)</span>.</li>
<li>WS(<span class="arithmatex">\(x_i;x_j\)</span>) -- operações de escrita relativas a <span class="arithmatex">\(x_j\)</span> incluem operações de escrita relativas a <span class="arithmatex">\(x_i\)</span></li>
</ul>
<p><img alt="" src="../images/07-12.png" /></p>
<h5 id="escritas-monotonicas">Escritas Monotônicas</h5>
<p><strong>Garantia:</strong></p>
<p>Se um processo escreve em item <span class="arithmatex">\(x\)</span>, então esta operação deve terminar antes que qualquer escrita sucessiva em <span class="arithmatex">\(x\)</span> possa ser executada pelo mesmo processo.</p>
<ul>
<li>Em um sistema de arquivos na rede, a escrita do conteúdo de um arquivo, em certa posição, só pode ser feita se escritas anteriores já estão registradas no arquivo, independentemente de o cliente contactar novo servidor de arquivos.</li>
</ul>
<p><img alt="" src="../images/07-13.png" /></p>
<h5 id="leia-suas-escritas">Leia suas Escritas</h5>
<p><strong>Garantia:</strong></p>
<p>Se um processo escreve em item <span class="arithmatex">\(x\)</span>, então leituras sucessivas no mesmo item pelo mesmo processo devem refletir tal escrita.</p>
<ul>
<li>Atualizar código fonte de uma página e exigir que o navegador carrega a nova versão.</li>
</ul>
<p><img alt="" src="../images/07-14.png" /></p>
<h5 id="escritas-seguem-leituras">Escritas seguem Leituras</h5>
<p><strong>Garantia:</strong></p>
<p>Se um processo lê um item <span class="arithmatex">\(x\)</span>, então escritas sucessivas no mesmo item só podem ser completadas se o mesmo reflete o valor lido anteriormente.</p>
<ul>
<li>Só é permitido enviar uma resposta a uma mensagem se a mensagem em si é vista, independentemente do cliente ter se movimentado.</li>
</ul>
<p><img alt="" src="../images/07-15.png" /></p>
<h2 id="gerenciamento-de-replicas">Gerenciamento de Réplicas</h2>
<h3 id="posicionamento">Posicionamento</h3>
<p>Onde colocar réplicas para conseguir melhor escalabilidade do sistema? Menor custo de comunicação?</p>
<ul>
<li>Objetos (código/dados)</li>
<li>Permanente</li>
<li>Sob demanda do servidor -- por exemplo em uma CDN</li>
<li>Sob demanda do cliente -- por exemplo um cache.</li>
</ul>
<p><img alt="" src="../images/07-17.png" /></p>
<h6>Sob demanda do Servidor</h6>
<ul>
<li><span class="arithmatex">\(Q\)</span> conta acessos ao arquivo <span class="arithmatex">\(F\)</span></li>
<li>Agrega acessos por possível réplica mais próxima (<span class="arithmatex">\(P\)</span>)</li>
<li>Número de acessos acima de limiar <span class="arithmatex">\(R\)</span>, replica para <span class="arithmatex">\(P\)</span></li>
<li>Número de acessos abaixo de <span class="arithmatex">\(D\)</span>, apaga de <span class="arithmatex">\(P\)</span></li>
<li><span class="arithmatex">\(D &lt; R\)</span></li>
<li>Se não é alto o suficiente para replicar nem baixo o suficiente para ignorar (entre <span class="arithmatex">\(D\)</span> e <span class="arithmatex">\(R\)</span>), considera migrar.</li>
</ul>
<p><img alt="" src="../images/07-18.png" /></p>
<h3 id="propagacao-de-atualizacoes">Propagação de Atualizações</h3>
<p>Réplicas precisam ser atualizadas.</p>
<ul>
<li>Propagar dados -- não reexecuta operações.</li>
<li>Propagar operações -- não copia todos os dados modificados.</li>
<li>Propagar notificações -- réplica precisa solicitar atualização.<br/> Usado em caches.</li>
</ul>
<p>Melhor opção depende do custo das operações, dados manipulados, e taxa de leitura/escrita dos dados.</p>
<ul>
<li>Propagar dados<ul>
<li>razão leitura/escrita é grande</li>
<li>operações são caras</li>
</ul>
</li>
<li>Propagar operações<ul>
<li>razão leitura/escrita é grande</li>
<li>operações são baratas</li>
</ul>
</li>
<li>Propagar notificações<ul>
<li>razão leitura/escrita é pequena</li>
<li>pouco uso da rede</li>
</ul>
</li>
</ul>
<h6>Proativo/Push ou Reativo/Pull</h6>
<ul>
<li>
<p>Proativo</p>
<ul>
<li>Mantém réplicas consistentes</li>
<li>Desnecessário se leitura <span class="arithmatex">\(&lt;&lt;\)</span> escrita.</li>
</ul>
</li>
<li>
<p>Reativo</p>
<ul>
<li>Réplicas só se tornam consistentes quando necessário.</li>
<li>Lento se leitura <span class="arithmatex">\(&gt;&gt;\)</span> escrita</li>
</ul>
</li>
</ul>
<p><em>Qual é melhor?</em></p>
<h6>Híbrido: Lease</h6>
<ul>
<li>Réplica se registra para receber atualizações/notificações por um período.</li>
<li>Estado sobre réplicas é mantido enquanto possível, pelo período contratado.</li>
<li>Em caso de sobrecarga, deixa de mandar atualizações/notificações.</li>
<li>Em caso de lease antigo não renovado, deixa de mandar atualizações/notificações.</li>
<li>Em caso de renovações frequentes, aumenta o período do lease.</li>
</ul>
<h2 id="recuperacao-checkpoint">Recuperação &amp; Checkpoint</h2>
<p>Assumindo que o modelo de consistência implementado é satisfatório, temos que garantir que este modelo não será quebrado na presença de falhas.
Isto é, suponha que uma série de erros aconteceram no sistema, e que não é possível continuar o processamento em algum ou todos os módulos do sistema.
Neste cenário, o sistema precisa agir para ou avançar para um novo estado, livre de erros, ou retroceder a um estado anterior, correto.</p>
<p>Voltar a um estado correto parece ser a solução mais fácil, mas pare isto é preciso garantir a informação sobre estados anteriores seja recuperável. </p>
<h3 id="log-recuperavel">Log Recuperável</h3>
<h6>Replicação</h6>
<p>Como garantir que o log poderá ser lido para recuperar o processo?</p>
<p><img alt="" src="../images/08-23.png" /></p>
<ul>
<li>Dois discos iguais?</li>
<li>Dados diferentes, mas ambos bons?</li>
<li>Um bom outro estragado?</li>
<li>Ambos estragados?</li>
</ul>
<h6>Blocos de paridade</h6>
<h6>Erasure Coding</h6>
<p>Blocos de paridade</p>
<p><img alt="https://support.huawei.com/enterprise/br/doc/EDOC1100067966/c131d3be/erasure-code-nm-protection" src="../images/erasure-coding-diagram0.png" /></p>
<p>Cálculo da paridade</p>
<p><img alt="https://community.mellanox.com/s/article/understanding-erasure-coding-offload" src="../images/erasure-coding-diagram1.png" /></p>
<p>Recuperação de blocos perdidos</p>
<p><img alt="https://www.rubrik.com/en/blog/architecture/17/2/erasure-coding-rubrik-doubled-capacity-cluster" src="../images/erasure-coding-diagram.jpeg" /></p>
<p><a href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction">Reed Solomon</a></p>
<h3 id="estado-global-consistente">Estado global consistente</h3>
<p>Um estado global, o conjunto com um estado local de cada processo no sistema e também são conhecidos como ou <strong><em>snapshots</em></strong>.</p>
<p><img alt="" src="../images/08-24.png" /></p>
<p>Para serem úteis, <em>snapshots</em> precisam formar <strong>Estado Globais Consistentes</strong>, que são estados globais tal que toda mensagem recebida no estado local de um processo também precisa fazer parte do estado local do processo remetente.</p>
<p><img alt="" src="../images/08-24.png" /></p>
<p>O mais recente estado global consistente forma uma <strong>linha de recuperação</strong>.</p>
<p><img alt="" src="../images/08-24.png" /></p>
<p><strong>Linhas de Recuperação</strong> podem ser usados para, não surpreendentemente, recuperação do sistema, mas também para <strong>coleta de lixo</strong> (remover objetos não referenciados em nenhum outro processo), <strong>detecção de deadlocks</strong> e <strong>depuração</strong> (pausar o sistema).</p>
<p>Se o sistema provê comunicação confiável, então toda mensagem enviada no estado local de um processo também precisa fazer parte do estado local do destinatário, ou o estado global precisa capturar o estado dos canais de comunicação.</p>
<h4 id="checkpointing-independente">Checkpointing independente</h4>
<p>Cada processo faz o checkpoint local independentemente, incorrendo no risco de um <em>rollback</em> em cascata.</p>
<ul>
<li>Seja <span class="arithmatex">\(C_i^m\)</span> o <span class="arithmatex">\(m\)</span>-ésimo checkpoint do processo <span class="arithmatex">\(p_i\)</span>.</li>
<li>Seja <span class="arithmatex">\(I_i^m\)</span> o intervalo entre <span class="arithmatex">\(C_i^{m-1}\)</span> e <span class="arithmatex">\(C_i^m\)</span>.</li>
<li>Quando o processo <span class="arithmatex">\(p_i\)</span> envia a mensagem no intervalo <span class="arithmatex">\(I_i^m\)</span>, envia <span class="arithmatex">\((i,m)\)</span> em piggyback</li>
<li>Quando o processo <span class="arithmatex">\(p_j\)</span> recebe a mensagem no intervalo <span class="arithmatex">\(I_j^n\)</span>, grava a dependência <span class="arithmatex">\(I_i^m \rightarrow I_j^n\)</span></li>
<li>
<p>A dependência <span class="arithmatex">\(I_i^m \rightarrow I_j^n\)</span> é salva junto com o checkpoint <span class="arithmatex">\(C_j^n\)</span></p>
</li>
<li>
<p>Se o processo <span class="arithmatex">\(p_j\)</span> é revertido para o estado <span class="arithmatex">\(C_j^n\)</span>, então o <span class="arithmatex">\(p_i\)</span> não pode reverter para nenhum estado anterior a <span class="arithmatex">\(C_i^m\)</span>, ou não teria enviado as mensagens recebidas por <span class="arithmatex">\(p_j\)</span> 4 inclusas em <span class="arithmatex">\(C_j^n\)</span>.</p>
</li>
</ul>
<p>ou</p>
<ul>
<li>Se o processo <span class="arithmatex">\(p_i\)</span> é revertido para o estado <span class="arithmatex">\(C_i^{m-1}\)</span>, então o <span class="arithmatex">\(p_j\)</span> tem que ser revertido pelo menos até <span class="arithmatex">\(C_j^{n-1}\)</span>, ou incluiria mensagens ainda não enviadas por <span class="arithmatex">\(p_i\)</span>.</li>
</ul>
<p>Como implementar a recuperação?</p>
<h6># Caso patológico</h6>
<ul>
<li><span class="arithmatex">\(p_i\)</span> e <span class="arithmatex">\(p_j\)</span> no estado inicial (<span class="arithmatex">\(C_i^0, C_j^0\)</span>)</li>
<li><span class="arithmatex">\(p_i\)</span> manda mensagens para <span class="arithmatex">\(p_j\)</span> (<span class="arithmatex">\(C_i^1 \rightarrow C_j^1\)</span>)</li>
<li><span class="arithmatex">\(C_j^1\)</span></li>
<li><span class="arithmatex">\(p_j\)</span> manda mensagens para <span class="arithmatex">\(p_i\)</span> <span class="arithmatex">\(C_j^2 \rightarrow C_i^1\)</span></li>
<li><span class="arithmatex">\(C_i^1\)</span></li>
<li><span class="arithmatex">\(p_i\)</span> manda mensagens para <span class="arithmatex">\(p_j\)</span> <span class="arithmatex">\(C_i^2 \rightarrow C_j^2\)</span></li>
<li><span class="arithmatex">\(C_j^2\)</span></li>
<li><span class="arithmatex">\(p_j\)</span> manda mensagens para <span class="arithmatex">\(p_i\)</span> <span class="arithmatex">\(C_j^3 \rightarrow C_i^2\)</span></li>
<li><span class="arithmatex">\(C_i^2\)</span></li>
<li>...</li>
</ul>
<p>Se estados locais são capturados na "hora errada", a linha de recuperação pode ser o estado inicial, fazendo um <strong>rollback em cascata*</strong></p>
<p><img alt="" src="../images/08-25.png" /></p>
<h4 id="checkpointing-coordenado">Checkpointing coordenado</h4>
<p>Processos se coordenam por troca de mensagem para executar checkpointing "simultaneamente".</p>
<h6>Bloqueio em duas fases</h6>
<ul>
<li>Um coordenador faz multicast da mensagem "checkpoint-request"</li>
<li>Quando um participante recebe "checkpoint-request"<ul>
<li>faz um checkpoint local</li>
<li>para de mandar mensagens da aplicação</li>
<li>responde com "checkpoint-taken"</li>
</ul>
</li>
<li>Quando "checkpoint-taken" recebido de todos os participantes, multicast "checkpoint-done"</li>
<li>Quando receber "checkpoint-done", retoma computação normal</li>
<li>Por quê funciona?  Impede formação de dependências circulares.</li>
<li>Todos os processos precisam participar?  Somente os que dependem da recuperação do coordenador.</li>
</ul>
<p>Pontos negativos? </p>
<ul>
<li>Se o coordenador falha, outros processos ficam bloqueados?  <ul>
<li>Timeout!</li>
</ul>
</li>
<li>Como eleger outro coordenador? <ul>
<li>E se dois aparecerem juntos? </li>
<li>Pode ser resolvido com um protocolo de eleição como o do RAFT. </li>
<li>Não é garantido, mas aumenta as chances de sucesso.</li>
</ul>
</li>
</ul>
<h6>Chandy-Lamport</h6>
<ul>
<li>Não interfere na aplicação</li>
<li>
<p>Cada processo grava snapshot independentemente</p>
</li>
<li>
<p>Observador (iniciador do snapshot)</p>
<ul>
<li>Salva o próprio estado</li>
<li>Envia uma mensagem "snapshot" aos outros processos em cada canal de saída</li>
<li>Grava as mensagens chegando em cada canal até que receba uma mensagem "snapshot" naquele canal.</li>
</ul>
</li>
<li>
<p>Um processo <span class="arithmatex">\(p\)</span> que receba "snapshot" de um processo <span class="arithmatex">\(q\)</span></p>
<ul>
<li>grava estado local <span class="arithmatex">\(S_p\)</span></li>
<li>grava estado do canal <span class="arithmatex">\(C_{q,p} =\emptyset\)</span></li>
<li>Envia uma mensagem "snapshot" aos outros processos em cada canal de saída</li>
<li>Grava as mensagens chegando em cada canal até que receba uma mensagem "snapshot" naquele canal (excluindo <span class="arithmatex">\(C_{q,p}\)</span>)</li>
</ul>
</li>
<li>
<p>Protocolo termina para o processo <span class="arithmatex">\(p\)</span> quando tiver recebido marcador "snapshot" em cada um de seus canais.</p>
</li>
<li>O estado global consiste dos snapshots + estado em cada um dos canais.</li>
<li>Exige canais FIFO</li>
</ul>
<h6>Message Logging</h6>
<p>Em vez de checkpoints frequentes, crie um log da comunicação e o re-execute a partir do último checkpoint.</p>
<p><strong>Ideia básica:</strong>   </p>
<p>A computação é determinada pela troca de mensagens (eventos não determinísticos). 
Ao se enviar a mesma mensagem a partir de um certo estado, a computação desencadeada é sempre a mesma.</p>
<p>Realista este modelo? Há outros eventos não determinísticos no sistema?</p>
<p><img alt="" src="../images/08-26.png" /></p>
<ul>
<li>
<p><span class="arithmatex">\(Hdr(m)\)</span></p>
<ul>
<li>Cabeçalho da mensagem <span class="arithmatex">\(m\)</span> contendo fonte, destino, número de sequência e número de entrega.</li>
<li>O cabeçalho contém a informação necessária para reenviar e re-receber a mensagem na ordem certa (dados devem ser reproduzidos para aplicação).</li>
<li>A mensagem <span class="arithmatex">\(m\)</span> é estável se <span class="arithmatex">\(Hdr(m)\)</span> estiver em memória estável.</li>
</ul>
</li>
<li>
<p><span class="arithmatex">\(Dep(m)\)</span>: o conjunto de processos a quem <span class="arithmatex">\(m\)</span> ou mensagens que dependem de <span class="arithmatex">\(m\)</span> foram entregues.</p>
</li>
<li><span class="arithmatex">\(Copy(m)\)</span>: o conjunto de processos que tem uma cópia de <span class="arithmatex">\(Hdr(m)\)</span> em memória volátil.</li>
</ul>
<p>Se <span class="arithmatex">\(C\)</span> é um conjunto de processos falhos, então <span class="arithmatex">\(Q\not\in C\)</span> é um órfão se existe uma mensagem <span class="arithmatex">\(m\)</span> tal que <span class="arithmatex">\(Q \in Dep(m)\)</span> e <span class="arithmatex">\(Copy(m)\subseteq C\)</span>    </p>
<p>Se os processos em <span class="arithmatex">\(C\)</span> forem reiniciados, então a computação seguirá um caminho possivelmente distinto do que levou <span class="arithmatex">\(Q\)</span> a receber <span class="arithmatex">\(m\)</span> ou um mensagem causalmente dependente de <span class="arithmatex">\(m\)</span>.</p>
<p>Para cada mensagem <span class="arithmatex">\(m\)</span> não estável, há no máximo um processo dependente em <span class="arithmatex">\(m\)</span> (<span class="arithmatex">\(Dep(m) \leq 1\)</span>)</p>
<p>Uma mensagem não estável, no protocolo pessimista, deve ser estabilizada antes do envio da próxima mensagem.</p>
<p>Toda mensagem é precedida por uma escrita em disco.</p>
<p>Para cada mensagem <span class="arithmatex">\(m\)</span> não estável, então devemos garantir que se <span class="arithmatex">\(Copy(m) \subseteq C\)</span>, então <em>eventually</em> <span class="arithmatex">\(Dep(m) \subseteq C\)</span>, onde <span class="arithmatex">\(C\)</span> é o conjunto de processos que falharam.</p>
<p>Para garantir que <span class="arithmatex">\(Dep(m) \subseteq C\)</span>, fazemos um rollback de cada órfão <span class="arithmatex">\(Q\)</span> até que <span class="arithmatex">\(Q \not\in Dep(m)\)</span></p>
<p>Isto é, forçamos <span class="arithmatex">\(Q\)</span> a ser recuperado mesmo que não tenha falhado.</p>
<h2 id="referencias">Referências</h2>
<ul>
<li><a href="https://blog.yugabyte.com/a-primer-on-acid-transactions/">https://blog.yugabyte.com/a-primer-on-acid-transactions/</a></li>
<li><a href="https://jepsen.io/consistency">https://jepsen.io/consistency</a></li>
<li><a href="https://fauna.com/blog/demystifying-database-systems-part-4-isolation-levels-vs-consistency-levels">https://fauna.com/blog/demystifying-database-systems-part-4-isolation-levels-vs-consistency-levels</a></li>
<li><a href="https://aphyr.com/posts/313-strong-consistency-models">https://aphyr.com/posts/313-strong-consistency-models</a></li>
<li>refs/encyclopedia18.pdf</li>
<li><a href="http://composition.al/blog/2019/04/26/an-example-run-of-the-chandy-lamport-snapshot-algorithm/">Chandy e Lamport</a></li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:eventual">
<p>Enquanto no Português <em>Eventual</em> quer dizer <strong>possivelmente</strong>, no inglês quer dizer <strong>em algum momento</strong> não determinado, mas vindouro.&#160;<a class="footnote-backref" href="#fnref:eventual" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:util">
<p>Caso esteja se perguntando se este modelo e estudo tem alguma serventia para você, afinal nos bancos de dados com que trabalhou ou trabalha as operações são agrupadas em <strong>transações</strong> e não executadas individualmente e as transações garantem ACID, lhe asseguro que sim e que falaremos em transações mais adiante.&#160;<a class="footnote-backref" href="#fnref:util" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <!-- Last update of source file -->


              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Rodapé">
      
        
        <a href="../fault/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Tolerância a Falhas" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Tolerância a Falhas
            </div>
          </div>
        </a>
      
      
        
        <a href="../disdb/" class="md-footer__link md-footer__link--next" aria-label="Próximo: Bancos de Dados" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Próximo
              </span>
              Bancos de Dados
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "Mais 1 nesta p\u00e1gina", "search.result.more.other": "Mais # nesta p\u00e1gina", "search.result.term.missing": "Ausente", "select.version.title": "Selecione a vers\u00e3o"}, "search": "../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.56a63758.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/mathjaxhelper.js"></script>
      
    
  </body>
</html>