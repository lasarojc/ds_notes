
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.5">
    
    
      
        <title>Tempo Físico - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.be71726b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    
      
  



  
  



  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-PJX835H7DP"),document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof location$&&location$.subscribe(function(t){gtag("config","G-PJX835H7DP",{page_path:t.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PJX835H7DP"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tempo-fisico" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabeçalho">
    <a href="../.." title="Notas em Sistemas Distribuídos" class="md-header__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tempo Físico
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Pesquisar">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando a pesquisa
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegação" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../preface/" class="md-nav__link">
        Prefácio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../intro/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Comunicação
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Comunicação" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Comunicação
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/redes/" class="md-nav__link">
        Redes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/internet/" class="md-nav__link">
        Internet
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/sockets/" class="md-nav__link">
        Sockets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/datarep/" class="md-nav__link">
        Representação
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/middleware/" class="md-nav__link">
        Middlewares
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/rpc/" class="md-nav__link">
        RPC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/mom/" class="md-nav__link">
        MOM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/epidemics/" class="md-nav__link">
        Epidêmicos
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../comm/refs/" class="md-nav__link">
        Referências
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Arquiteturas
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Arquiteturas" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Arquiteturas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../arch/arch/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../arch/p2p/" class="md-nav__link">
        P2P
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../arch/microservices/" class="md-nav__link">
        Microsserviços
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        Modelos
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Coordenação
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Coordenação" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Coordenação
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../coord/concurrency/" class="md-nav__link">
        Concorrência
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../coord/coord/" class="md-nav__link">
        Coordenação
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      <label class="md-nav__link" for="__nav_7">
        Tempo
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tempo" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Tempo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tempo Físico
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tempo Físico
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relogios-de-quartzo-e-atomicos" class="md-nav__link">
    Relógios de Quartzo e Atômicos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tempo-universal-coordenado" class="md-nav__link">
    Tempo Universal Coordenado
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sincronizacao-de-relogios" class="md-nav__link">
    Sincronização de Relógios
  </a>
  
    <nav class="md-nav" aria-label="Sincronização de Relógios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-positioning-system" class="md-nav__link">
    Global Positioning System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-cristian" class="md-nav__link">
    Algoritmo de Cristian
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-berkeley" class="md-nav__link">
    Algoritmo de Berkeley
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-time-protocol" class="md-nav__link">
    Network Time Protocol.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ptp-precision-time-protocol" class="md-nav__link">
    PTP - Precision Time Protocol
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nunca-volte-no-tempo" class="md-nav__link">
    Nunca volte no tempo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usos-de-relogios-sincronizados" class="md-nav__link">
    Usos de relógios sincronizados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../logical/" class="md-nav__link">
        Tempo Lógico
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../fault/" class="md-nav__link">
        Tolerância a Falhas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../consistency/" class="md-nav__link">
        Consistência
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../disdb/" class="md-nav__link">
        Bancos de Dados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../disfs/" class="md-nav__link">
        Sistemas de Arquivos
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Estudos de Caso
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Estudos de Caso" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Estudos de Caso
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/cassandra/" class="md-nav__link">
        Cassandra
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/chord/" class="md-nav__link">
        Chord
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/dynamo/" class="md-nav__link">
        Dynamo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/grpc/" class="md-nav__link">
        gRPC
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/mosquito/" class="md-nav__link">
        Mosquito
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/rmi/" class="md-nav__link">
        RMI
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/thrift/" class="md-nav__link">
        Thrift
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/kafka/" class="md-nav__link">
        Kafka
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/refs/" class="md-nav__link">
        Referências
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../cases/swim/" class="md-nav__link">
        Swim
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../tech/" class="md-nav__link">
        Tecnologias
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../projeto/" class="md-nav__link">
        Projeto
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#relogios-de-quartzo-e-atomicos" class="md-nav__link">
    Relógios de Quartzo e Atômicos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tempo-universal-coordenado" class="md-nav__link">
    Tempo Universal Coordenado
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sincronizacao-de-relogios" class="md-nav__link">
    Sincronização de Relógios
  </a>
  
    <nav class="md-nav" aria-label="Sincronização de Relógios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-positioning-system" class="md-nav__link">
    Global Positioning System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-cristian" class="md-nav__link">
    Algoritmo de Cristian
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-berkeley" class="md-nav__link">
    Algoritmo de Berkeley
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-time-protocol" class="md-nav__link">
    Network Time Protocol.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ptp-precision-time-protocol" class="md-nav__link">
    PTP - Precision Time Protocol
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nunca-volte-no-tempo" class="md-nav__link">
    Nunca volte no tempo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usos-de-relogios-sincronizados" class="md-nav__link">
    Usos de relógios sincronizados
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referências
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

<!-- Edit button -->


  <!--
       Hack: check whether the content contains a h1 headline. If it
       doesn't, the page title (or respectively site name) is used
       as the main headline.
    -->


  <!-- Content -->
  <h1 id="tempo-fisico">Tempo Físico</h1>
<p>Para falarmos sobre sincronização de relógios em um cenário distribuído, primeiro devemos entender como funcionam os relógios em nível de uma única máquina, isto é, seus relógios físicos e como são usados pelo sistema operacional.</p>
<h3 id="relogios-de-quartzo-e-atomicos">Relógios de Quartzo e Atômicos</h3>
<p>Quando falamos em relógios, provavelmente falamos sobre relógios a base de quartzo.
Para uma introdução rápida, assista ao seguinte vídeo.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3jfgQF3jX7A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="admonition info inline end">
<p class="admonition-title">Quartzo</p>
<ul>
<li>Efeito piezoelétrico</li>
<li>32768Hz</li>
<li>Erro de 0,5s por dia</li>
</ul>
</div>
<p>Em suma, um relógio de quartzo consiste em um <strong>diapazão de quartzo</strong> cortado a laser que, devido ao <strong>efeito Piezoelétrico</strong><sup id="fnref:piezo"><a class="footnote-ref" href="#fn:piezo">2</a></sup> e sua forma particular, vibra a <span class="arithmatex">\(32768 = 2^{15}\)</span>Hz<sup id="fnref:freq"><a class="footnote-ref" href="#fn:freq">3</a></sup>, e em um contador que conta cada vibração, medindo a passagem do tempo.
Estes relógios erram na medição do tempo em no máximo <strong>&frac12;s por dia</strong>, desde que operem dentro da faixa de 5 a 35C, mas isso também muda com a idade do cristal, a corrente elétrica passando por ele e também devido a imperfeições no cristal<sup id="fnref:quartz"><a class="footnote-ref" href="#fn:quartz">1</a></sup>.</p>
<p>Computadores em geral usam relógios de quartzo, por serem baratos, como base de um relógio mantido em software.
Isto é, do ponto de vista de um computador comum, o tempo é medido com base em um relógio quartzo, cujos incrementos são capturados em um contador;
o contador gera <strong>interrupções em intervalos programados</strong> (e.g., Linux &gt;2.6 usa 250Hz por padrão; máximo 1000Hz) e as interrupções causam ajustes em um <strong>relógio em software</strong>, um contador indireto <span class="arithmatex">\(C\)</span>.</p>
<div class="admonition info inline end">
<p class="admonition-title">Precisão</p>
<p>Dado a frequência padrão de 250Hz, medições de tempo menores que 4ms são altamente imprecisas.
 Como medir o tempo gasto em uma função do seu código?</p>
</div>
<p>Este relógio em software, <span class="arithmatex">\(C\)</span>, que usa um relógio de quartzo, impreciso, pode marcar a passagem do tempo com erro para mais ou para menos. Embora o erro exato do relógio seja desconhecido, o mesmo é limitado probabilisticamente. 
A taxa de erro é denominada <em>drift</em>, é representada por <span class="arithmatex">\(\rho\)</span>.</p>
<p>Assumindo um relógio perfeito, <span class="arithmatex">\(t\)</span>, temos que <span class="arithmatex">\(1 - \rho \leq \frac{dC}{dt} \leq 1 + \rho\)</span>.
Assim, um <span class="arithmatex">\(\rho\)</span> de 0.1 implica em um erro de mais ou menos 10%; a figura a seguir mostra a faixa em que <span class="arithmatex">\(C\)</span> pode operar e que o erro em relação a <span class="arithmatex">\(t\)</span> vai aumentando com a passagem do tempo.</p>
<p><img alt="Clock drift" src="../../drawings/clock_skew.drawio-0.svg" /></p>
<p>Embora adequado para humanos, o erro dos relógios de quartzo é inaceitável em algumas operações computacionais. 
Felizmente, os erros do destes relógios podem ser minimizados ao ponto de termos um erros menores que 1s em milhões de anos, nos dispositivos conhecidos como <strong>relógios atômicos</strong>.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p2BxAu6WZI8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>Embora muito bons, os relógios atômicos também não são perfeitos e, devido a várias razões, podem levar também a erros.
Mas o quê mais se pode fazer no sentido de <strong>melhorar a precisão dos relógios</strong>? A resposta está no UTC.</p>
<h3 id="tempo-universal-coordenado">Tempo Universal Coordenado</h3>
<p>O UTC, de uma mistura dos nomes em Inglês e Francês do <strong>Tempo Universal Coordenado</strong>, um padrão global para coordenação da medição da passagem do tempo.
Segundo o UTC, o sol está a pino às 12:00 na latitude 0, ou a no máximo 1s deste instante; ao redor da latitude 0 grau estabelece-se uma faixa em que todos os pontos tem o mesmo horário, e outras 23 faixas como esta com deslocamentos consecutivos de +-1 hora.
Estas faixas, conhecidas coloquialmente como fusos, sofrem ajustes por fatores políticos; a China, por exemplo, apesar de seu tamanho, está toda dentro de um mesmo horário, "correto" para Beijing.</p>
<p><img alt="Fuso-horários" src="../../images/TimeZones.png" /></p>
<p>O UTC é definido com base no TAI, Tempo Atômico Internacional, calculado como a média dos valores de relógios atômicos espalhados pelo globo. 
O TAI mede "perfeitamente" a passagem do tempo, mas como a rotação da terra é irregular, medir perfeitamente não é o adequado. 
Assim, o UTC leva em consideração o fato do dia não ter exatamente 24 horas e, de fato, não ter duração constante. 
Por exemplo, após um grande terremoto o centro de massa da terra pode ser alterado e a rotação ter sua velocidade aumentada ou diminuída.</p>
<div class="admonition quote">
<p class="admonition-title">UTC</p>
<p>Nearly all UTC days contain exactly 86,400 SI seconds with exactly 60 seconds in each minute. However, because the mean solar day is slightly longer than 86,400 SI seconds, occasionally the last minute of a UTC day is adjusted to have 61 seconds. The extra second is called a leap second. It accounts for the grand total of the extra length (about 2 milliseconds each) of all the mean solar days since the previous leap second. The last minute of a UTC day is permitted to contain 59 seconds to cover the remote possibility of the Earth rotating faster, but that has not yet been necessary.</p>
</div>
<p>Uma vez que tenhamos um tempo global, com o qual todos os relógios concordam, resolvemos os problemas apresentados acima, correto?
Não exatamente, pois os relógios precisam ser sincronizados com o UTC e, como vimos, <strong>mesmo que sincronizados inicialmente, relógios podem se distanciar uns dos outros</strong> na marcação do tempo.</p>
<h3 id="sincronizacao-de-relogios">Sincronização de Relógios</h3>
<p>Dado o UTC, temos então uma referência de tempo adequada para uso em sistemas computacionais, colocamos nova pergunta:</p>
<ul>
<li>Se o relógio se distância da medida correta da passagem do tempo, é possível corrigir este distanciamento, sincronizando-o com uma fonte correta, da qual UTC é nossa melhor aproximação, para que todos percebam a mesma passagem do tempo?</li>
</ul>
<p>Embora a resposta seja negativa, no sentido de que não é possível alcançar sincronização perfeita, nada nos impede de fazer um melhor esforço e, neste sentido, também temos que nos perguntar qual a frequência de sincronização?</p>
<div class="admonition question">
<p class="admonition-title">Frequência de Sincronização</p>
<p>Como garantir que um relógio com erro máximo igual a <span class="arithmatex">\(\rho\)</span> não diferirá em mais que <span class="arithmatex">\(\delta\)</span> unidades de tempo do UTC?</p>
</div>
<p>Vejamos um exemplo:</p>
<ul>
<li><span class="arithmatex">\(\rho = 0,1\)</span> (10%)</li>
<li><span class="arithmatex">\(\delta\)</span> = 1s</li>
<li>Após 10s, um nó com estas características se dessincronizaria em, no máximo, 1s em relação ao UTC. </li>
<li>Logo, a sincronização deve ser feita a cada 10s, i.e, <span class="arithmatex">\(\frac{\delta}{\rho} = \frac{1s}{0,1} = \frac{1s}{\frac{1}{10}} = 10s\)</span></li>
</ul>
<p>Mas, e se quisermos sincronizar dois relógios com UTC, um com erro <span class="arithmatex">\(\rho\)</span>, de forma que estes dois relógios não se distanciem mais que <span class="arithmatex">\(\delta\)</span> unidades, o problema é mais difícil?</p>
<p>Se todos se sincronizarem com a mesma fonte, a cada <span class="arithmatex">\(\frac{\delta}{\rho}\)</span> segundos, como ambos tem um erro máximo de <span class="arithmatex">\(\delta\)</span> em relação à fonte, o erro máximo entre os dois nós é <span class="arithmatex">\(2\delta\)</span>. Como este erro é o dobro do desejado, basta dobrar a frequência de sincronização para cortar o erro pela metade. Vejamos novamente o exemplo</p>
<ul>
<li><span class="arithmatex">\(\rho = 0,1\)</span></li>
<li><span class="arithmatex">\(\delta\)</span> = 1s</li>
<li>Após 10s, um nó com estas características se dessincronizaria em, no máximo, 1s em relação ao UTC. </li>
<li>Como cada nó poderia estar errando em "direções"  diferentes, após 5s, um nó poderia se adiantar em 0,5s enquanto o outro poderia se atrasar pela mesma quantidade de tempo, somando 1s de diferença. Logo, eles tem que se sincronizar a cada 5s, i.e, <span class="arithmatex">\(\frac{\delta}{2\rho} = \frac{1s}{2 \times 0,1} = \frac{1s}{0,2} = 5s\)</span></li>
</ul>
<p>Finalmente, se considerarmos relógios com erros distintos, <span class="arithmatex">\(\rho, \rho'\)</span>, a sincronização deve ser feita pela média dos erros, isto é, <span class="arithmatex">\(\frac{\delta}{2\frac{\rho + \rho'}{2}} = \frac{\delta}{\rho + \rho'}\)</span>.</p>
<p>Agora que você já tem uma fonte confiável de tempo, o UTC, e sabe com que frequência sincronizar os relógios, só nos falta fazer a sincronização. 
Contudo, falta ainda definir o protocolo pelo qual a sincronização é feita e exatamente com quem, uma vez que simplesmente UTC é muito genérico. 
Comecemos com vetor "próximo" do UTC, os relógios atômicos em satélites GPS.</p>
<h4 id="global-positioning-system">Global Positioning System</h4>
<p>Receptores GPS, com seus relógios sincronizados com os dos satélites, que difundem regularmente sua posição e o instante em que a difusão é feita, determinam sua posição relativa aos satélites, em uma técnica conhecida como trilateração, que consiste em determinar a distância do receptor em termos dos eixos <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span> e <span class="arithmatex">\(z\)</span> em relação a cada um dos satélites. </p>
<p>Em outras palavras, baseado na informação de um satélite, o receptor determina sua distância ao mesmo e, portanto, determina que está em uma esfera no entorno do satélite.
Combinando a informação de 2 satélites, a posição do receptor é limitada a uma circunferência, isto é, a interseção de duas esferas. 
Com um terceiro satélite, a posição é reduzida a dois pontos, a interseção de uma esfera e uma circunferência, sendo um no espaço e que pode ser facilmente descartado. </p>
<p><img alt="Funcionamento de GPS" src="https://gisgeography.com/wp-content/uploads/2016/11/GPS-Trilateration-Feature-678x322.png" /></p>
<p>Contudo, para que funcione, relógios dos satélites e receptores precisam estar sincronizados para que o cálculo da distância possa ser feito, mas sincronizar os relógios é exatamente o problema que estamos tentando resolver. Para contornar esta restrição, usa-se um quarto satélite, para determinar a distância na <strong>dimensão do tempo</strong>.</p>
<p>Assim, temos uma receita simples para sincronização de relógios com UTC:</p>
<ul>
<li>Coloque um receptor GPS em cada nó do seu sistema</li>
<li>Tenha erro de 0,1ns a 1ms do UTC</li>
</ul>
<p>Apesar da queda dos preços dos receptores, colocar um GPS em cada dispositivo pode ser custoso demais. 
Em vez disso, podemos usar um recurso amplamente disponível, redes de computadores, e sincronizar com outra máquina, que fez o investimento necessário para manter o erro baixo.
Para estes computadores "de segundo escalão", a receita então é:</p>
<ul>
<li>Pergunte que horas são.</li>
<li>Use a resposta para ajustar o relógio local.</li>
<li>Considere o erro introduzido pela latência variável da rede.</li>
</ul>
<p>Sendo mais específico, nomeemos os processos como cliente, quem pergunta, e servidor, quem responde, e os instantes em que os eventos acontecem:</p>
<ul>
<li>Cliente pergunta "que horas são?" - <span class="arithmatex">\(t_0\)</span></li>
<li>Servidor recebe pergunta - <span class="arithmatex">\(t_1\)</span></li>
<li>Servidor anota o valor do relógio - <span class="arithmatex">\(t_s\)</span></li>
<li>Servidor envia resposta - <span class="arithmatex">\(t_2\)</span></li>
<li>Cliente recebe resposta - <span class="arithmatex">\(t_3\)</span></li>
</ul>
<p><img alt="Algoritmo genérico de sincronização" src="../../drawings/algo_cristian.drawio-0.svg" /></p>
<p>Esta receita básica pode ser ajustada de diversas formas, sendo a primeira dada pelo algoritmo de Cristian.</p>
<h4 id="algoritmo-de-cristian">Algoritmo de Cristian</h4>
<p>No algoritmo de Cristian, assumimos que o relógio do Cliente é bom o suficiente para medir a passagem de tempo em períodos curtos, mesmo que tenha uma <em>drift</em> rate considerável em períodos mais longos. Assim, podemos executar o algoritmo genérico, adicionando o seguinte:</p>
<ul>
<li>Assuma <span class="arithmatex">\(t_1 = t_s = t_2\)</span></li>
<li>Assuma <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span> como o tempo de transmissão da resposta (média da ida e da volta)</li>
<li>Cliente ajusta relógio para <span class="arithmatex">\(C = t_s + \frac{t_3-t_0}{2}\)</span></li>
</ul>
<p><img alt="Algoritmo genérico de sincronização" src="../../drawings/algo_cristian.drawio-1.svg" /></p>
<p>Mas e a aproximação <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span>, é boa? É uma aproximação tão boa quanto possível, pois medir a latência em uma única direção demandaria relógios sincronizados, exatamente o que estamos tentando resolver com este algoritmo. Quero dizer, temos uma dependência circular aqui, como o vídeo a seguir mostra.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/pTn6Ewhb27k" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>Bom, na verdade no nosso caso é um pouco mais fácil de dizer que as duas direções tem latências diferentes, pois sabemos que, em uma rede de larga escala, é possível e comum que pacotes tomem caminhos diferentes na ida e na volta.
Neste caso, podemos estimar o erro que a aproximação introduz na sincronização, desde que tenhamos estimativas de tempo mínimo para a transmissão em cada sentido, <span class="arithmatex">\(T_{min}\)</span>. A figura a seguir demonstra o erro desta técnica<sup id="fnref:erro"><a class="footnote-ref" href="#fn:erro">4</a></sup>, onde </p>
<ul>
<li><span class="arithmatex">\(t_3 - t_0\)</span> corresponde ao tempo medido entre o envio da requisição e recepção da resposta</li>
<li>as setas vermelhas indicam o caso em que a requisição foi muito mais rápida que resposta (<span class="arithmatex">\(T_{min}\)</span>)</li>
<li>as setas verdes indicam o caso em que a resposta foi muito mais rápida que requisição (<span class="arithmatex">\(T_{min}\)</span>)</li>
</ul>
<p><img alt="Erro do algoritmo de Christian" src="../../drawings/algo_cristian.drawio-2.svg" /></p>
<p>No caso vermelho, a aproximação <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span> é muito menor que o tempo de propagação da resposta, <span class="arithmatex">\(t3 - t1\)</span>, e no caso verde a aproximação é maior que o tempo <span class="arithmatex">\(t_3 - t_2\)</span>.
Em ambos os casos, o erro é está limitado a <span class="arithmatex">\(\frac{t_2 - t1}{2}\)</span>, ou seja, <span class="arithmatex">\(+- \frac{t_3 - t_0}{2} - T_{min}\)</span>.</p>
<!--Observe que há dois casos extremos de erro na estimativa.
No primeiro caso, dado um tempo de ida + volta igual a $T_1 - T_0$, na figura, a mensagem de ida trafega no tempo mínimo e a volta lentamente. Neste caso, a estimativa $\frac{t_3-t_0}{2}$ é menor que o tempo de volta real.
No segundo caso, a mensagem de ida trafega lentamente e a de volta no tempo mínimo, levando $\frac{t_3-t_0}{2}$ a ser maior que tempo de transmissão real da mensagem.
O erro, contudo, está limitado à faixa amarela no desenho, que tem duração $T_1 - T_0 - 2T_{min}$. 
O erro então varia de mais ou menos metade deste valor. -->

<h4 id="algoritmo-de-berkeley">Algoritmo de Berkeley</h4>
<p>Enquanto o algoritmo de Cristian permite sincronizar um nó com uma fonte, outro algoritmo, de Berkeley, permite sincronizar múltiplos nós uns com os outros. Este algoritmo assume o que não há uma "fonte da verdade" do tempo, mas sim a necessidade de que todos os processos convirjam para um mesmo valor do relógio. É como nos filmes de espião em que os relógios são sincronizados; pouco importa se a bomba explodirá 10:57 ou 10:59, desde que todos concordem quando isso vai acontecer. Isso é o que chamamos de <strong>sincronização interna</strong> em vez de externa, como provido pelo algoritmo de Cristian.</p>
<p>O algoritmo de Berkeley requer que todo nó execute um processo de sincronização, um "daemon", e separa seus papéis em dois tipos, <strong>primário</strong> e <strong>secundário</strong>.
O papel do primário pode ser rotacionado entre os vários processos, sem perdas para sua execução. O algoritmo então é executa como se segue:</p>
<ul>
<li>Primário pergunta "que horas são" para cada secundário (mensages 1,2,3 e 4)</li>
<li>Secundário responde com valor atual do relógio (mensagens 5,6,7 e 8)</li>
<li>Primário ajusta as respostas de acordo com o algoritmo de Cristian, para minimizar erros.</li>
<li>Primário computa média dos valores recebidos, ignorando <em>outliers</em> (como o da mensagem 8).</li>
<li>Primário envia <strong>ajustes</strong> para secundários (mensagens 8,9,10 e 11)</li>
<li>Secundário executa ajuste sugerido pelo primário.</li>
</ul>
<div class="mermaid">
sequenceDiagram
    autonumber
    note over Primário: 10:00
    note over Secundário1: 10:06
    note over Secundário2: 10:15
    note over Secundário3: 23:18
    par Pergunta
      Primário-&gt;&gt;Primário: Que horas são?
    and
      Primário-&gt;&gt;Secundário1: Que horas são?
    and
      Primário-&gt;&gt;Secundário2: Que horas são?
    and
      Primário-&gt;&gt;Secundário3: Que horas são?
    end

    par Resposta
      Primário-&gt;&gt;Primário: 10:00
    and
      Secundário1-&gt;&gt;Primário: 10:06
    and
      Secundário2-&gt;&gt;Primário: 10:15
    and
      rect rgb(255, 0, 0)
         Secundário3-&gt;&gt;Primário: 23:18
      end
    end

    par Ajuste
      Primário-&gt;&gt;Primário: 10:07
    and
      Primário-&gt;&gt;Secundário1: 10:07
    and
      Primário-&gt;&gt;Secundário2: 10:07
    and
      Primário-&gt;&gt;Secundário3: 10:07
    end
</div>
<p>Embora interessantes, estes algoritmos não são normalmente usados, pelo menos não em sua forma "pura", em sistemas computacionais. Em vez deles, usamos o Network Time Protocol (NTP).</p>
<h4 id="network-time-protocol">Network Time Protocol.</h4>
<p>O NTP foi especificado originalmente na RFC 1305<sup id="fnref:rfc1305"><a class="footnote-ref" href="#fn:rfc1305">6</a></sup> e estendido pelas RFC 5905-5908<sup id="fnref:rfc5905-5908"><a class="footnote-ref" href="#fn:rfc5905-5908">7</a></sup> essencialmente para suportar IPv6 e reduzir o erro de sincronização para até 10<span class="arithmatex">\(\mu\)</span>s.</p>
<p>Os diversos componentes do NTP são organizados em camadas, ou <em>estrata</em>, de forma que a informação do tempo flui da camada 0 (<em>stratum 0</em>) até a camada 15 (<em>stratum</em> 15).
Os componentes não estão presos a camadas, que podem ser alteradas a medida que falhas acontecem e são dedicadas, e novos caminhos são encontrados usando-se o algoritmo de árvore geradora mínima Bellman-Ford, além de caminhos redundantes que conferem propriedades de <strong>tolerância a falhas</strong> à topologia.</p>
<p><img alt="Network Time Protocol" src="../../images/ntp.png" /><sup id="fnref:ntpfigure"><a class="footnote-ref" href="#fn:ntpfigure">5</a></sup></p>
<p>Esta <strong>organização hierárquica</strong> leva a cada camada garantir um nível de sincronização diferente e permite <strong>escalar o uso do protocolo para níveis globais</strong>, usando a <strong>Internet como meio</strong>.</p>
<ul>
<li>Stratum 0: relógios atômicos/receptores GPS</li>
<li>Stratum 1: ms to stratum 0</li>
<li>Stratum 2: contata múltiplos stratum 1 e pares</li>
<li>Strata 3...15</li>
<li>Stratum 16: dessincronizado</li>
</ul>
<p>Toda a comunicação entre nós pode ser <strong>autenticada</strong>, garantindo que a sincronização não seja facilmente manipulada e erros são minimizados pela coleta e uso de estatísticas de latência de comunicação, para evitar desvios quando fontes se tornam problemáticas.</p>
<p>NTP tem múltiplas formas de execução, adequadas para diferentes ambientes.</p>
<ul>
<li>Modo multicast: propaga tempo em rede local</li>
<li>RPC: algoritmo de Cristian</li>
<li>Simétrico: parecido com Berkeley</li>
</ul>
<p>Na prática, boa parte dos dispositivos usa uma versão simplificada do NTP, o SNTP (<strong><em>Simple Network Time Protocol</em></strong>), adequada aos nós nas <strong>folhas da hierarquia</strong>. 
O SNTP é essencialmente o algoritmo de Cristian:</p>
<ul>
<li><span class="arithmatex">\(\delta = (t_4-t_1)-(t_2-t_3)\)</span></li>
<li><span class="arithmatex">\(t = \frac{(t_2-t_1)+(t3-t_4)}{2}\)</span></li>
<li><span class="arithmatex">\(t_c = t_4+t\)</span></li>
</ul>
<p>Por exemplo,</p>
<ul>
<li><span class="arithmatex">\(t_1 = 1100, t_2 = 800, t_3=850, t_4=1200\)</span></li>
<li><span class="arithmatex">\(t = ((800-1100)+(850-1200))/2 = (-300 -350)/ = -325\)</span></li>
<li><span class="arithmatex">\(t_c = 1200-325 = 875\)</span></li>
</ul>
<p>O Comitê Gestor da Internet, <a href="https://cgi.br/">CGI</a>, mantem uma excelente página sobre o NTP, com mais detalhes do que apresentado aqui, em <a href="https://ntp.br/ntp.php">NTP.br</a>.</p>
<h4 id="ptp-precision-time-protocol">PTP - Precision Time Protocol</h4>
<p>Mesmo com melhoria do protocolo e baratemento de dispositivos GPS, há ainda a necessidade de sincronização sub-microssegundo e barata. O <strong><em>Precision Time Protocol</em></strong>, PTP, especificação IEEE 1588<sup id="fnref:ieee1588"><a class="footnote-ref" href="#fn:ieee1588">8</a></sup> tenta cobrir este nicho.</p>
<p>Se escrutinarmos o PTP, veremos que o protocolo em si não difere muito do NTP. Contudo, o PTP usa interfaces de rede especilizadas para fazer o <em>timestamping</em> dos eventos do protocolo, conseguindo remover a latência nos dispositivos processando as mensagens e reduzindo o erro do protocolo até sub <span class="arithmatex">\(\mu\)</span> (versus ordem de <span class="arithmatex">\(ms\)</span> no NTP).
Mais detalhes sobre o protocolo estão fora do escopo deste documento, mas podem ser facilmente encontrados nos links dados.</p>
<h4 id="nunca-volte-no-tempo">Nunca volte no tempo</h4>
<p>Qualquer que seja o algoritmo utilizado, é provavelmente uma boa ideia <strong>nunca voltar no tempo</strong>. 
Mesmo que o universo não seja destruído no processo, voltar no tempo poderia levar a situações estranhas como um dado ter data de edição anterior a data de criação. Para evitar estas situações, devem ser feitos de <strong>ajustes graduais</strong> nos relógios, que acelerem ou desacelerem o relógio <span class="arithmatex">\(C\)</span> em relação a <span class="arithmatex">\(t\)</span> (ou sua melhor aproximação, pelo <strong>ajuste frequência de interrupção para atrasar/adiantar relógio</strong> ou <strong>ajustes dos incrementos com cada interrupção</strong>. Isso fará com que as curvas no seguinte gráfico convirjam.
A exceção a esta regra deve ser restrita a correções após longos períodos em que o relógio dorme.</p>
<p><img alt="Clock drift" src="../../drawings/clock_skew.drawio-1.svg" /></p>
<h3 id="usos-de-relogios-sincronizados">Usos de relógios sincronizados</h3>
<p>Assumindo que tenhamos sincronizado os relógios de um sistema computacional, o que podemos fazer agora? Há uma série de problemas interessantes que podem ser resolvidos,
como <strong>autenticação</strong>, <strong>terminação de transações</strong>, <strong>alocação de <em>leases</em></strong> e diversos outros exemplos.<sup id="fnref:liskov"><a class="footnote-ref" href="#fn:liskov">9</a></sup>
Um exemplo interessante é a ordenação de eventos em um banco de dados.
Para entender este problema, considere um cenário com um Sistema Bancário replicado, isto é, com várias cópias.
No exemplo, sem perda de generalidade, nos focamos em duas cópias em lados opostos de uma rede de larga escala.
Clientes disparam operações como saques, depósitos e transferências, por meio de mensagens para as duas cópias. 
Mensagens para a cópia próxima do cliente (em verde) são entregues rapidamente, enquanto mensagens para a cópia distante (em vermelho), demoram mais para ser entregues.</p>
<p><img alt="Sistema Bancário Replicado" src="../../drawings/dist_trans.drawio-0.svg" /></p>
<p>Imagine que o usuário U1 envie o comando C1 <code>atualizar saldo da conta para USD 10</code><sup id="fnref:usd"><a class="footnote-ref" href="#fn:usd">10</a></sup> e que o usuário U2 envie o comando C2 <code>atualizar saldo da conta para USD 20</code>.
Se os comandos chegam primeiro para a réplica mais próxima e são executados na ordem em que chegam, ao final da execução a réplica R1 terá executado C1 seguido de C2, tendo saldo da conta como USD 20, enquanto R2 terá executado C2 seguido de C1 e terá como saldo na conta USD 10.
O problema está na ordem de execução das operações.</p>
<p>Assuma que relógios estão <strong>perfeitamente</strong> sincronizados e que toda mensagem/update carrega consigo o <em>timestamp</em> de quando foi enviada.
E se as réplicas processarem mensagens na ordem que foram enviadas, como identificado pelos seus <em>timestamps</em>?<sup id="fnref:tiebreak"><a class="footnote-ref" href="#fn:tiebreak">11</a></sup>
Assim, se C1 foi enviado antes de C2, C1 tem um <em>timestamp</em> menor que C2 e será executada primeiro em ambas as réplicas, o que resolve nosso problema, correto?
Parcialmente, pois ainda temos o problema de <strong>identificar que nenhuma outra mensagem ainda por ser entregue</strong> foi enviada antes. 
Para isto, precisamos <strong>estender o modelo e assumir que o tempo de propagação máximo de uma mensagem, <span class="arithmatex">\(\tau\)</span>, é finito e conhecido</strong>.
Assim, ao  receber um comando com timestamp <span class="arithmatex">\(t\)</span>, uma réplica espera até <span class="arithmatex">\(t + \tau\)</span> antes de executá-lo, pois qualquer comando com <em>timestamp</em> <span class="arithmatex">\(t' &lt; t\)</span> deve ter sido entregue até <span class="arithmatex">\(t+\tau\)</span>.</p>
<p><img alt="Ordenação" src="../../drawings/tau.drawio-0.svg" /></p>
<p>Implementar este protocolo é muito simples:</p>
<div class="admonition example">
<p class="admonition-title">Ordenação de Mensagens por Timestamp</p>
<ul>
<li>Quando enviar uma mensagem, aumente-a com o valor atual do relógio.</li>
<li>Quando receber uma mensagem, coloque-a em uma fila ordenada por <em>timestamp</em>.</li>
<li>Quando o relógio marcar um tempo maior que <span class="arithmatex">\(t + \tau\)</span>, onde <span class="arithmatex">\(t\)</span> é o timestamp da mensagem na cabeça da fila, retire a mensagem da cabeça da fila e execute o comando correspondente.</li>
</ul>
</div>
<p>Embora correto, este protocolo, ou melhor, o modelo, <strong>não leva em consideração a dessincronização inerente dos relógios</strong> em um sistema distribuído. 
Como fazê-lo, supondo uma divergência máxima de <span class="arithmatex">\(\Delta\)</span> entre quaisquer dois relógios, algo que pode ser arranjado, como visto antes, sincronizando-se os relógios a cada <span class="arithmatex">\(\frac{\Delta}{2\rho}\)</span>.</p>
<p>Se <span class="arithmatex">\(\Delta\)</span> é a diferença máxima entre relógios, então se uma mensagem é enviada no instante <span class="arithmatex">\(t\)</span>, então até <span class="arithmatex">\(\Delta +t\)</span>, outro processo, atrasado em relação ao primeiro, poderá enviar uma mensagem com timestamp <span class="arithmatex">\(t' &lt; t\)</span>. 
Tal mensagem pode demorar até <span class="arithmatex">\(\tau\)</span> para ser entregue à réplica, ou seja, no instante <span class="arithmatex">\(t + \tau + \Delta\)</span>, do ponto de vista do primeiro cliente.</p>
<p>Se a réplica estiver sincronizada com cliente, então se esperar até <span class="arithmatex">\(t + \tau + \Delta\)</span> para executar o comando, o fará de forma segura. 
Se estiver atrasada em relação ao primeiro cliente, então acabará por esperar além do necessário, mas sem violar a corretude do sistema.</p>
<p>Finalmente, se a réplica estiver adiantada em relação ao primeiro cliente, então seu relógio alcançará <span class="arithmatex">\(t + \tau + \Delta\)</span> antes do relógio do primeiro cliente, mas isso não é um problema. Isto porquê, o último instante em que o cliente 2 poderá enviar uma mensagem com timestamp <span class="arithmatex">\(t' &lt; t\)</span> é o instante em que o relógio da réplica marcar <span class="arithmatex">\(t + \Delta\)</span>, e portanto deverá também ser recebido até que o mesmo relógio marque <span class="arithmatex">\(t + \tau + \Delta\)</span>. </p>
<p><img alt="Ordenação" src="../../drawings/tau.drawio-1.svg" /></p>
<p>O mesmo raciocínio pode ser usado para definir um <strong>protocolo de acesso recursos</strong> para os quais <em>leases</em> são distribuídos, onde um <strong><em>lease</em></strong> <strong>é uma permissão de acesso durante uma janela de tempo</strong>, emitida por um coordenador (possivelmente eleito usando os algoritmos vistos anteriormente), e <span class="arithmatex">\(\Delta\)</span> é o máximo de dessincronismo entre os relógios. 
O seguinte protocolo resolve este problema:</p>
<div class="admonition example">
<p class="admonition-title">Alocação de Lease</p>
<p>Ao receber um <em>lease</em> para a janela de tempo <span class="arithmatex">\(t_1\)</span> a <span class="arithmatex">\(t_2\)</span></p>
<ul>
<li>espera até <span class="arithmatex">\(t_1 + \Delta\)</span></li>
<li>usa o recurso até <span class="arithmatex">\(t_2\)</span>.</li>
</ul>
</div>
<p>Se relógio estiver adiantado em relação ao cliente anterior, vai achar que é <span class="arithmatex">\(t_1+\Delta\)</span> enquanto o anterior acha que é <span class="arithmatex">\(t_1\)</span>; exclusão mútua garantida.
Se relógio estiver atrasado em relação ao cliente anterior, vai achar que é <span class="arithmatex">\(t_1 - \Delta\)</span>, e continua esperando, enquanto ele acha que já é <span class="arithmatex">\(t_1\)</span> e para de usar; exclusão mútua garantida.
Recurso fica ocioso por <span class="arithmatex">\(\Delta\)</span>, em média, a cada lease. </p>
<p>Devido ao alto custo de se manter o recurso não utilizado, <span class="arithmatex">\(\Delta\)</span> deve ser feito tão pequeno quanto possível, como feito, por exemplo, o <a href="https://cloud.google.com/spanner/docs/true-time-external-consistency">Google True Time</a> que consegue manter a diferença em sub-milisegundos usando relógios atômicos dentro de seus datacenters e um API para geração de timestamps.</p>
<p>Nas soluções anteriores, <strong>um nó precisa esperar por muito tempo antes de usar um recurso</strong>. 
E se ele aprendesse antes que os outros nós não farão requisições, que não haverão sobreposições de requisições? 
E se houvesse um relógio que avançasse não com o tempo, mas com eventos interessantes do sistema?
Esta é a ideia dos <strong>relógios lógicos</strong>.</p>
<h2 id="referencias">Referências</h2>
<ul>
<li><a href="https://cloud.google.com/spanner/docs/true-time-external-consistency">Google TrueTime</a></li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:quartz">
<p><a href="https://www.explainthatstuff.com/quartzclockwatch.html">Explain that stuff.</a>&#160;<a class="footnote-backref" href="#fnref:quartz" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:piezo">
<p>Distorção mecânica gera corrente elétrica e submissão a uma corrente elétrica gera uma distorção mecânica.&#160;<a class="footnote-backref" href="#fnref:piezo" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:freq">
<p>32768 é a primeira potência de 2 maior que 20000, a maior frequência sonora audível aos seres humanos.&#160;<a class="footnote-backref" href="#fnref:freq" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:erro">
<p>Adaptado das notas de aula disponíveis <a href="https://www.cs.rutgers.edu/~pxk/417/notes/content/05-clock-synchronization-slides.pdf">aqui</a>.&#160;<a class="footnote-backref" href="#fnref:erro" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:ntpfigure">
<p><a href="https://commons.wikimedia.org/w/index.php?curid=2815097">Fonte: Benjamin D. Esham, (bdesham) - Based upon Ntp.png by Kim Meyrick</a>&#160;<a class="footnote-backref" href="#fnref:ntpfigure" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:rfc1305">
<p><a href="https://datatracker.ietf.org/doc/rfc1305/">RFC 1305</a>, 1991/1992&#160;<a class="footnote-backref" href="#fnref:rfc1305" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:rfc5905-5908">
<p>RFC 5905-5908,2010&#160;<a class="footnote-backref" href="#fnref:rfc5905-5908" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:ieee1588">
<p><a href="https://www.nist.gov/el/intelligent-systems-division-73500/ieee-1588">IEEE 1588TM Standard for A Precision Clock Synchronization Protocol for Networked Measurement and Control Systems</a>.&#160;<a class="footnote-backref" href="#fnref:ieee1588" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:liskov">
<p><a href="http://rdcu.be/s4iy">Liskov, B.: Distrib Comput (1993) 6: 211. doi:10.1007/BF02242709</a>&#160;<a class="footnote-backref" href="#fnref:liskov" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:usd">
<p>Unidade Simples de Dinheiros.&#160;<a class="footnote-backref" href="#fnref:usd" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn:tiebreak">
<p>Empates são quebrados pelo identificador do processo, isto é, se duas mensagens são produzidas ao mesmo tempo por U1 e U2, então o a mensagem de U1 tem precedência na execução.&#160;<a class="footnote-backref" href="#fnref:tiebreak" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <!-- Last update of source file -->


              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Rodapé">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Introdução" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Introdução
            </div>
          </div>
        </a>
      
      
        
        <a href="../logical/" class="md-footer__link md-footer__link--next" aria-label="Próximo: Tempo Lógico" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Próximo
              </span>
              Tempo Lógico
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "Mais 1 nesta p\u00e1gina", "search.result.more.other": "Mais # nesta p\u00e1gina", "search.result.term.missing": "Ausente", "select.version.title": "Selecione a vers\u00e3o"}, "search": "../../assets/javascripts/workers/search.409db549.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56a63758.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../javascripts/mathjaxhelper.js"></script>
      
    
  </body>
</html>