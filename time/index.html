
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>Tempo - Notas em Sistemas Distribu√≠dos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tempo" class="md-skip">
          Ir para o conte√∫do
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribu√≠dos" class="md-header__button md-logo" aria-label="Notas em Sistemas Distribu√≠dos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Notas em Sistemas Distribu√≠dos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tempo
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao reposit√≥rio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribu√≠dos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribu√≠dos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notas em Sistemas Distribu√≠dos
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao reposit√≥rio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        Pref√°cio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introdu√ß√£o
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../arch/" class="md-nav__link">
        Arquiteturas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        Modelos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../comm/" class="md-nav__link">
        Comunica√ß√£o
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../p2p/" class="md-nav__link">
        P2P
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../microservices/" class="md-nav__link">
        Microsservi√ßos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../coord/" class="md-nav__link">
        Coordena√ß√£o
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tempo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tempo
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="√çndice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      √çndice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tempo-fisico" class="md-nav__link">
    Tempo F√≠sico
  </a>
  
    <nav class="md-nav" aria-label="Tempo F√≠sico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relogios-de-quartzo-e-atomicos" class="md-nav__link">
    Rel√≥gios de Quartzo e At√¥micos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tempo-universal-coordenado" class="md-nav__link">
    Tempo Universal Coordenado
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sincronizacao-de-relogios" class="md-nav__link">
    Sincroniza√ß√£o de Rel√≥gios
  </a>
  
    <nav class="md-nav" aria-label="Sincroniza√ß√£o de Rel√≥gios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-positioning-system" class="md-nav__link">
    Global Positioning System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-cristian" class="md-nav__link">
    Algoritmo de Cristian
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-berkeley" class="md-nav__link">
    Algoritmo de Berkeley
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-time-protocol" class="md-nav__link">
    Network Time Protocol.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ptp-precision-time-protocol" class="md-nav__link">
    PTP - Precision Time Protocol
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nunca-volte-no-tempo" class="md-nav__link">
    Nunca volte no tempo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usos-de-relogios-sincronizados" class="md-nav__link">
    Usos de rel√≥gios sincronizados
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tempo-logico" class="md-nav__link">
    Tempo L√≥gico
  </a>
  
    <nav class="md-nav" aria-label="Tempo L√≥gico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#happened-before" class="md-nav__link">
    Happened-Before
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogios-logicos" class="md-nav__link">
    Rel√≥gios l√≥gicos
  </a>
  
    <nav class="md-nav" aria-label="Rel√≥gios l√≥gicos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relogio-de-lamport" class="md-nav__link">
    Rel√≥gio de Lamport
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogio-vetorial" class="md-nav__link">
    Rel√≥gio Vetorial
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogios-hibridos" class="md-nav__link">
    Rel√≥gios H√≠bridos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comunicacao-em-grupo" class="md-nav__link">
    Comunica√ß√£o em Grupo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclusao-mutua-revisitada" class="md-nav__link">
    Exclus√£o M√∫tua Revisitada
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Refer√™ncias
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fault/" class="md-nav__link">
        Toler√¢ncia a Falhas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../consistency/" class="md-nav__link">
        Consist√™ncia
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disdb/" class="md-nav__link">
        Bancos de Dados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disfs/" class="md-nav__link">
        Sistemas de Arquivos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cases/" class="md-nav__link">
        Estudos de Caso
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tech/" class="md-nav__link">
        Tecnologias
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="√çndice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      √çndice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tempo-fisico" class="md-nav__link">
    Tempo F√≠sico
  </a>
  
    <nav class="md-nav" aria-label="Tempo F√≠sico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relogios-de-quartzo-e-atomicos" class="md-nav__link">
    Rel√≥gios de Quartzo e At√¥micos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tempo-universal-coordenado" class="md-nav__link">
    Tempo Universal Coordenado
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sincronizacao-de-relogios" class="md-nav__link">
    Sincroniza√ß√£o de Rel√≥gios
  </a>
  
    <nav class="md-nav" aria-label="Sincroniza√ß√£o de Rel√≥gios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-positioning-system" class="md-nav__link">
    Global Positioning System
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-cristian" class="md-nav__link">
    Algoritmo de Cristian
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#algoritmo-de-berkeley" class="md-nav__link">
    Algoritmo de Berkeley
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-time-protocol" class="md-nav__link">
    Network Time Protocol.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ptp-precision-time-protocol" class="md-nav__link">
    PTP - Precision Time Protocol
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nunca-volte-no-tempo" class="md-nav__link">
    Nunca volte no tempo
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usos-de-relogios-sincronizados" class="md-nav__link">
    Usos de rel√≥gios sincronizados
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tempo-logico" class="md-nav__link">
    Tempo L√≥gico
  </a>
  
    <nav class="md-nav" aria-label="Tempo L√≥gico">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#happened-before" class="md-nav__link">
    Happened-Before
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogios-logicos" class="md-nav__link">
    Rel√≥gios l√≥gicos
  </a>
  
    <nav class="md-nav" aria-label="Rel√≥gios l√≥gicos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#relogio-de-lamport" class="md-nav__link">
    Rel√≥gio de Lamport
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogio-vetorial" class="md-nav__link">
    Rel√≥gio Vetorial
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relogios-hibridos" class="md-nav__link">
    Rel√≥gios H√≠bridos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comunicacao-em-grupo" class="md-nav__link">
    Comunica√ß√£o em Grupo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclusao-mutua-revisitada" class="md-nav__link">
    Exclus√£o M√∫tua Revisitada
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Refer√™ncias
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

<!-- Edit button -->


  <!--
       Hack: check whether the content contains a h1 headline. If it
       doesn't, the page title (or respectively site name) is used
       as the main headline.
    -->


  <!-- Content -->
  <h1 id="tempo">Tempo</h1>
<p>Neste cap√≠tulo discutiremos como o <strong>tempo</strong> √© importante no desenvolvimento de sistemas distribu√≠dos.
Comecemos por analisar o funcionamento de uma aplica√ß√£o distribu√≠da muito comum, o <strong>armazenamento de arquivos na nuvem</strong>, sincronizado com o sistema de arquivos local. 
Alguns exemplos do mundo real s√£o Dropbox, Box, Google Drive and OneDrive; chamemos este servi√ßo genericamente de <strong>cloud-drive</strong>.
No exemplo a seguir, um arquivo √© sincronizado com uma nova c√≥pia, Cliente 1, que altera o arquivo e sincroniza de volta com o servidor.
Na sequ√™ncia, um novo cliente se registra, Cliente 2, recebe o arquivo, o altera e sincroniza com o servidor, que propaga a nova vers√£o para Cliente 1.
Ao final da execu√ß√£o, todos os envolvidos tem c√≥pias id√™nticas do arquivo. <img alt="üëç" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/1f44d.svg" title=":thumbsup:" /></p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-0.svg" /></p>
<p>Se um mesmo arquivo no cloud-drive √© modificado em duas m√°quinas diferentes, enquanto as mesmas est√£o desconectadas, o qu√™ acontece quando elas se reconectam √† Internet?
Mais especificamente, quando as duas m√°quinas se conectam e enviam suas vers√µes do arquivo modificado para o servidor, sendo que ambas foram geradas a partir de um ancestral comum, qual vers√£o deve ser armazenada e qual deve ser descartada?</p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-1.svg" /></p>
<p>Voc√™ pode se perguntar se isso realmente poderia acontecer, afinal, voc√™ n√£o estar√° em dois lugares para fazer modifica√ß√µes concorrentes. Ignorando-se o fato de que outra pessoa poderia estar editando em paralelo, uma falha de comunica√ß√£o poderia lhe permitir editar nos dois computadores <strong>concorrentemente</strong>.</p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-2.svg" /></p>
<p>Uma possibilidade simples √© sempre aceitar cada nova vers√£o como uma modifica√ß√£o do arquivo.
Assim, efetivamente, quando a primeira vers√£o for entregue, ser√° aceita e viver√° momentaneamente at√© que a outra vers√£o seja recebida e a sobrescreva.
No exemplo seguinte, o resultado deveria ser A, seguindo esta abordagem.</p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-3.svg" /></p>
<p>Contudo, vemos alguns problemas pois, pelo gr√°fico, vemos que a "Vers√£o B" foi criada <strong>depois</strong> da "Vers√£o A", mas que a vers√£o final vista pelo servidor √© exatamente a "A". 
Al√©m disso, se encolhermos um pouco a desconex√£o do n√≥ na parte de cima, o resultado final se inverte.</p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-4.svg" /></p>
<p>Isso quer dizer que a decis√£o de qual a vers√£o deve ser mantida depende mais da rede que das edi√ß√µes do arquivo em si, ou mesmo do algoritmo <strong><em>last writes wins</em></strong>.
Logo, a ordem de chegada ao servidor n√£o serve como crit√©rio para escolha pois a ordem de chegada dos arquivos ao servidor n√£o reflete necessariamente a ordem em que os arquivos foram modificados.</p>
<p>Assim, podemos pensar em outras alternativas de aproveitamento e descarte de arquivos baseadas no hor√°rio de  <strong>cria√ß√£o</strong> e <strong>modifica√ß√£o</strong> do arquivo. Contudo, o <strong>hor√°rios s√£o relativos</strong> a onde a opera√ß√£o aconteceu e n√£o ao grupo de processos que comp√µe o sistema, o que pode levar uma modifica√ß√£o que tenha acontecido mais tarde, do ponto de vista de um observador externo, a ter um hor√°rio de cria√ß√£o oficial anterior.</p>
<p><img alt="Cloud Drive" src="../drawings/cloud_drive.drawio-5.svg" /></p>
<!--Uma terceira abordagem √© gerar uma terceira vers√£o, com a "soma" das duas conflitantes. Para gerar esta terceira vers√£o, faz mais sentido quebrar os arquivos em *opera√ß√µes de modifica√ß√£o*, e executar as opera√ß√µes de forma a chegar ao resultado final. O problema permanece, pois as opera√ß√µes agora devem ser ordenadas. , a menos que fa√ßamos com que os processo concordem na passagem do tempo.-->

<p>Se for poss√≠vel identificar a causalidade entre as modifica√ß√µes, isto √©, qual vers√£o originou qual outra, ent√£o √© claro que se deve manter vers√µes de acordo com a ordem causal.
Contudo, edi√ß√µes concorrentes, como a cria√ß√£o das vers√µes A e B no exemplo anterior, n√£o tem rela√ß√£o de causalidade entre si.</p>
<p>Assim, <strong>em qualquer destas linhas de atua√ß√£o, voc√™ tem em m√£os um conflito para resolver</strong>, e automatizar a resolu√ß√£o do mesmo √© muito complicado. √â por isso que o Dropbox, por exemplo, deixa os dois arquivos para que o usu√°rio analise e decida o que fazer, que servidores git exigem que o usu√°rio pegue a vers√£o salva mais recentemente e compatibilize suas mudan√ßas com ela antes de submeter novas mudan√ßas, e o Perforce trabalha com <em>locks</em>  de arquivos.</p>
<p>Se pensarmos em termos n√£o de arquivos sendo enviados para um servidor, mas de opera√ß√µes de modifica√ß√µes sendo executadas, ent√£o dada esta problem√°tica, podemos simplificar a quest√£o em nossas m√£os.</p>
<div class="admonition question">
<p class="admonition-title">Como ordenar opera√ß√µes de clientes?</p>
<p>Se duas opera√ß√µes originadas em clientes s√£o enviadas ao servidor, qual deve ser executada primeiro?</p>
</div>
<p>Embora, como j√° vimos, usar a ordem temporal da cria√ß√£o das opera√ß√µes tamb√©m seja problem√°tico, j√° que rel√≥gios s√£o dessincronizados em sistemas distribu√≠dos t√≠picos, alguns sistemas tentam resolver automaticamente os conflitos usando exatamente estes rel√≥gios. 
O CassandraDB, por exemplo, usa <strong><em>last write wins</em></strong> ou <strong><em>latest version wins</em></strong>, onde <strong><em>last</em></strong> √© definido em termos do rel√≥gio do cliente.
Neste cen√°rio, temos novo problema:</p>
<div class="admonition question">
<p class="admonition-title">Pergunta</p>
<p>Como determinar qual foi enviada primeiro, em um sistema ass√≠ncrono?</p>
</div>
<div class="admonition info inline end">
<p class="admonition-title">Como sincronizar?</p>
<p>Como sincronizar rel√≥gios em um sistema distribu√≠do?</p>
</div>
<p>Para usar esta abordagem, precisamos encontrar uma <strong>fonte de tempo confi√°vel e distribu√≠da</strong>, constru√≠da pelo uso de protocolos de <strong>sincroniza√ß√£o de rel√≥gios f√≠sicos</strong></p>
<h2 id="tempo-fisico">Tempo F√≠sico</h2>
<p>Para falarmos sobre sincroniza√ß√£o de rel√≥gios em um cen√°rio distribu√≠do, primeiro devemos entender como funcionam os rel√≥gios em n√≠vel de uma √∫nica m√°quina, isto √©, seus rel√≥gios f√≠sicos e como s√£o usados pelo sistema operacional.</p>
<h3 id="relogios-de-quartzo-e-atomicos">Rel√≥gios de Quartzo e At√¥micos</h3>
<p>Quando falamos em rel√≥gios, provavelmente falamos sobre rel√≥gios a base de quartzo.
Para uma introdu√ß√£o r√°pida, assista ao seguinte v√≠deo.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/3jfgQF3jX7A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<div class="admonition info inline end">
<p class="admonition-title">Quartzo</p>
<ul>
<li>Efeito piezoel√©trico</li>
<li>32768Hz</li>
<li>Erro de 0,5s por dia</li>
</ul>
</div>
<p>Em suma, um rel√≥gio de quartzo consiste em um <strong>diapaz√£o de quartzo</strong> cortado a laser que, devido ao <strong>efeito Piezoel√©trico</strong><sup id="fnref:piezo"><a class="footnote-ref" href="#fn:piezo">2</a></sup> e sua forma particular, vibra a <span class="arithmatex">\(32768 = 2^{15}\)</span>Hz<sup id="fnref:freq"><a class="footnote-ref" href="#fn:freq">3</a></sup>, e em um contador que conta cada vibra√ß√£o, medindo a passagem do tempo.
Estes rel√≥gios erram na medi√ß√£o do tempo em no m√°ximo <strong>&frac12;s por dia</strong>, desde que operem dentro da faixa de 5 a 35C, mas isso tamb√©m muda com a idade do cristal, a corrente el√©trica passando por ele e tamb√©m devido a imperfei√ß√µes no cristal<sup id="fnref:quartz"><a class="footnote-ref" href="#fn:quartz">1</a></sup>.</p>
<p>Computadores em geral usam rel√≥gios de quartzo, por serem baratos, como base de um rel√≥gio mantido em software.
Isto √©, do ponto de vista de um computador comum, o tempo √© medido com base em um rel√≥gio quartzo, cujos incrementos s√£o capturados em um contador;
o contador gera <strong>interrup√ß√µes em intervalos programados</strong> (e.g., Linux &gt;2.6 usa 250Hz por padr√£o; m√°ximo 1000Hz) e as interrup√ß√µes causam ajustes em um <strong>rel√≥gio em software</strong>, um contador indireto <span class="arithmatex">\(C\)</span>.</p>
<div class="admonition info inline end">
<p class="admonition-title">Precis√£o</p>
<p>Dado a frequ√™ncia padr√£o de 250Hz, medi√ß√µes de tempo menores que 4ms s√£o altamente imprecisas.
 Como medir o tempo gasto em uma fun√ß√£o do seu c√≥digo?</p>
</div>
<p>Este rel√≥gio em software, <span class="arithmatex">\(C\)</span>, que usa um rel√≥gio de quartzo, impreciso, pode marcar a passagem do tempo com erro para mais ou para menos. Embora o erro exato do rel√≥gio seja desconhecido, o mesmo √© limitado probabilisticamente. 
A taxa de erro √© denominada <em>drift</em>, √© representada por <span class="arithmatex">\(\rho\)</span>.</p>
<p>Assumindo um rel√≥gio perfeito, <span class="arithmatex">\(t\)</span>, temos que <span class="arithmatex">\(1 - \rho \leq \frac{dC}{dt} \leq 1 + \rho\)</span>.
Assim, um <span class="arithmatex">\(\rho\)</span> de 0.1 implica em um erro de mais ou menos 10%; a figura a seguir mostra a faixa em que <span class="arithmatex">\(C\)</span> pode operar e que o erro em rela√ß√£o a <span class="arithmatex">\(t\)</span> vai aumentando com a passagem do tempo.</p>
<p><img alt="Clock drift" src="../drawings/clock_skew.drawio-0.svg" /></p>
<p>Embora adequado para humanos, o erro dos rel√≥gios de quartzo √© inaceit√°vel em algumas opera√ß√µes computacionais. 
Felizmente, os erros do destes rel√≥gios podem ser minimizados ao ponto de termos um erros menores que 1s em milh√µes de anos, nos dispositivos conhecidos como <strong>rel√≥gios at√¥micos</strong>.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p2BxAu6WZI8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>Embora muito bons, os rel√≥gios at√¥micos tamb√©m n√£o s√£o perfeito e, devido a v√°rias raz√µes, podem levar tamb√©m a erros.
Mas o qu√™ mais se pode fazer no sentido de <strong>melhorar a precis√£o dos rel√≥gios</strong>? A resposta est√° no UTC.</p>
<h3 id="tempo-universal-coordenado">Tempo Universal Coordenado</h3>
<p>O UTC, de uma mistura dos nomes em Ingl√™s e Franc√™s do <strong>Tempo Universal Coordenado</strong>, um padr√£o global para coordena√ß√£o da medi√ß√£o da passagem do tempo.
Segundo o UTC, o sol est√° a pino √†s 12:00 na latitude 0, ou a no m√°ximo 1s deste instante; ao redor da latitude 0 grau estabelece-se uma faixa em que todos os pontos tem o mesmo hor√°rio, e outras 23 faixas como esta com deslocamentos consecutivos de +-1 hora.
Estas faixas, conhecidas coloquialmente como fusos, sofrem ajustes por fatores pol√≠ticos; a China, por exemplo, apesar de seu tamanho, est√° toda dentro de um mesmo hor√°rio, "correto" para Beijing.</p>
<p><img alt="Fuso-hor√°rios" src="../images/TimeZones.png" /></p>
<p>O UTC √© definido com base no TAI, Tempo At√¥mico Internacional, calculado como a m√©dia dos valores de rel√≥gios at√¥micos espalhados pelo globo. O TAI mede perfeitamente a passagem do tempo, mas como a rota√ß√£o da terra √© irregular, medir perfeitamente n√£o √© o adequado. Assim, o UTC leva em considera√ß√£o o fato do dia n√£o ter exatamente 24 horas e, de fato, n√£o ter dura√ß√£o constante. Por exemplo, ap√≥s um grande terremoto o centro de massa da terra pode ser alterado e a rota√ß√£o ter sua velocidade aumentada ou diminu√≠da.</p>
<div class="admonition quote">
<p class="admonition-title">UTC</p>
<p>Nearly all UTC days contain exactly 86,400 SI seconds with exactly 60 seconds in each minute. However, because the mean solar day is slightly longer than 86,400 SI seconds, occasionally the last minute of a UTC day is adjusted to have 61 seconds. The extra second is called a leap second. It accounts for the grand total of the extra length (about 2 milliseconds each) of all the mean solar days since the previous leap second. The last minute of a UTC day is permitted to contain 59 seconds to cover the remote possibility of the Earth rotating faster, but that has not yet been necessary.</p>
</div>
<p>Uma vez que tenhamos um tempo global, com o qual todos os rel√≥gios concordam, resolvemos os problemas apresentados acima, correto?
N√£o exatamente, pois os rel√≥gios precisam ser sincronizados com o UTC e, como vimos, <strong>mesmo que sincronizados inicialmente, rel√≥gios podem se distanciar uns dos outros</strong> na marca√ß√£o do tempo.</p>
<h3 id="sincronizacao-de-relogios">Sincroniza√ß√£o de Rel√≥gios</h3>
<p>Dado o UTC, temos ent√£o uma refer√™ncia de tempo adequada para uso em sistemas computacionais, colocamos nova pergunta:</p>
<ul>
<li>Se o rel√≥gio se dist√¢ncia da medida correta da passagem do tempo, √© poss√≠vel corrigir este distanciamento, sincronizando-o com uma fonte correta, da qual UTC √© nossa melhor aproxima√ß√£o, para que todos percebam a mesma passagem do tempo?</li>
</ul>
<p>Embora a resposta seja negativa, no sentido de que n√£o √© poss√≠vel alcan√ßar sincroniza√ß√£o perfeita, nada nos impede de fazer um melhor esfor√ßo e, neste sentido, tamb√©m temos que nos perguntar qual a frequ√™ncia de sincroniza√ß√£o?</p>
<div class="admonition question">
<p class="admonition-title">Frequ√™ncia de Sincroniza√ß√£o</p>
<p>Como garantir que um rel√≥gio com erro m√°ximo igual a <span class="arithmatex">\(\rho\)</span> n√£o diferir√° em mais que <span class="arithmatex">\(\delta\)</span> unidades de tempo do UTC?</p>
</div>
<p>Vejamos um exemplo:</p>
<ul>
<li><span class="arithmatex">\(\rho = 0,1\)</span> (10%)</li>
<li><span class="arithmatex">\(\delta\)</span> = 1s</li>
<li>Ap√≥s 10s, um n√≥ com estas caracter√≠sticas se dessincronizaria em, no m√°ximo, 1s em rela√ß√£o ao UTC. </li>
<li>Logo, a sincroniza√ß√£o deve ser feita a cada 10s, i.e, <span class="arithmatex">\(\frac{\delta}{\rho} = \frac{1s}{0,1} = \frac{1s}{0,1} = 10s\)</span></li>
</ul>
<p>Mas, e se quisermos sincronizar dois rel√≥gios com UTC, um com erro <span class="arithmatex">\(\rho\)</span>, de forma que estes dois rel√≥gios n√£o se distanciem mais que <span class="arithmatex">\(\delta\)</span> unidades, o problema √© mais dif√≠cil?</p>
<p>Se todos se sincronizarem com a mesma fonte, a cada <span class="arithmatex">\(\frac{\delta}{\rho}\)</span> segundos, como ambos tem um erro m√°ximo de <span class="arithmatex">\(\delta\)</span> em rela√ß√£o √† fonte, o erro m√°ximo entre os dois n√≥s √© <span class="arithmatex">\(2\delta\)</span>. Como este erro √© o dobro do desejado, basta dobrar a frequ√™ncia de sincroniza√ß√£o para cortar o erro pela metade. Vejamos novamente o exemplo</p>
<ul>
<li><span class="arithmatex">\(\rho = 0,1\)</span></li>
<li><span class="arithmatex">\(\delta\)</span> = 1s</li>
<li>Ap√≥s 10s, um n√≥ com estas caracter√≠sticas se dessincronizaria em, no m√°ximo, 1s em rela√ß√£o ao UTC. </li>
<li>Como cada n√≥ poderia estar errando em "dire√ß√µes"  diferentes, ap√≥s 5s, um n√≥ poderia se adiantar em 0,5s enquanto o outro poderia se atrasar pela mesma quantidade de tempo, somando 1s de diferen√ßa. Logo, eles tem que se sincronizar a cada 5s, i.e, <span class="arithmatex">\(\frac{\delta}{2\rho} = \frac{1s}{2 \times 0,1} = \frac{1s}{0,2} = 5s\)</span></li>
</ul>
<p>Finalmente, se considerarmos rel√≥gios com erros distintos, <span class="arithmatex">\(\rho, \rho'\)</span>, a sincroniza√ß√£o deve ser feita pela m√©dia dos erros, isto √©, <span class="arithmatex">\(\frac{\delta}{2\frac{\rho + \rho'}{2}} = \frac{\delta}{\rho + \rho'}\)</span>.</p>
<p>Agora que voc√™ j√° tem uma fonte confi√°vel de tempo, o UTC, e sabe com que frequ√™ncia sincronizar os rel√≥gios, s√≥ nos falta fazer a sincroniza√ß√£o. 
Contudo, falta ainda definir o protocolo pelo qual a sincroniza√ß√£o √© feita e exatamente com quem, uma vez que simplesmente UTC √© muito gen√©rico. 
Comecemos com vetor "pr√≥ximo" do UTC, os rel√≥gios at√¥micos em sat√©lites GPS.</p>
<h4 id="global-positioning-system">Global Positioning System</h4>
<p>Receptores GPS, com seus rel√≥gios sincronizados com os dos sat√©lites, que difundem regularmente sua posi√ß√£o e o instante em que a difus√£o √© feita, determinam sua posi√ß√£o relativa aos sat√©lites, em uma t√©cnica conhecida como trilatera√ß√£o, que consiste em determinar a dist√¢ncia do receptor em termos dos eixos <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span> e <span class="arithmatex">\(z\)</span> em rela√ß√£o a cada um dos sat√©lites. </p>
<p>Em outras palavras, baseado na informa√ß√£o de um sat√©lite, o receptor determina sua dist√¢ncia ao mesmo e, portanto, determina que est√° em uma esfera no entorno do sat√©lite.
Combinando a informa√ß√£o de 2 sat√©lites, a posi√ß√£o do receptor √© limitada a uma circunfer√™ncia, isto √©, a interse√ß√£o de duas esferas. 
Com um terceiro sat√©lite, a posi√ß√£o √© reduzida a dois pontos, a interse√ß√£o de uma esfera e uma circunfer√™ncia, sendo um no espa√ßo e que pode ser facilmente descartado. </p>
<p><img alt="Funcionamento de GPS" src="https://gisgeography.com/wp-content/uploads/2016/11/GPS-Trilateration-Feature-678x322.png" /></p>
<p>Contudo, para que funcione, rel√≥gios dos sat√©lites e receptores precisam estar sincronizados para que o c√°lculo da dist√¢ncia possa ser feito, mas sincronizar os rel√≥gios √© exatamente o problema que estamos tentando resolver. Para contornar esta restri√ß√£o, usa-se um quarto sat√©lite, para determinar a dist√¢ncia no "eixo temporal".</p>
<p>Assim, temos uma receita simples para sincroniza√ß√£o de rel√≥gios com UTC:</p>
<ul>
<li>Coloque um receptor GPS em cada n√≥ do seu sistema</li>
<li>Tenha erro de 0,1ns a 1ms do UTC</li>
</ul>
<p>Apesar da queda dos pre√ßos dos receptores, colocar um GPS em cada dispositivo pode ser custoso demais. 
Em vez disso, podemos usar um recurso amplamente dispon√≠vel, redes de computadores, e sincronizar com outra m√°quina, que fez o investimento necess√°rio para manter o erro baixo.
Para estes computadores "de segundo escal√£o", a receita ent√£o √©:</p>
<ul>
<li>Pergunte que horas s√£o.</li>
<li>Use a resposta para ajustar o rel√≥gio local.</li>
<li>Considere o erro introduzido pela lat√™ncia vari√°vel da rede.</li>
</ul>
<p>Sendo mais espec√≠fico, nomeemos os processos como cliente, quem pergunta, e servidor, quem responde, e os instantes em que os eventos acontecem:</p>
<ul>
<li>Cliente pergunta "que horas s√£o?" - <span class="arithmatex">\(t_0\)</span></li>
<li>Servidor recebe pergunta - <span class="arithmatex">\(t_1\)</span></li>
<li>Servidor anota o valor do rel√≥gio - <span class="arithmatex">\(t_s\)</span></li>
<li>Servidor envia resposta - <span class="arithmatex">\(t_2\)</span></li>
<li>Cliente recebe resposta - <span class="arithmatex">\(t_3\)</span></li>
</ul>
<p><img alt="Algoritmo gen√©rico de sincroniza√ß√£o" src="../drawings/algo_cristian.drawio-0.svg" /></p>
<p>Esta receita b√°sica pode ser ajustada de diversas formas, sendo a primeira dada pelo algoritmo de Cristian.</p>
<h4 id="algoritmo-de-cristian">Algoritmo de Cristian</h4>
<p>No algoritmo de Cristian, assumimos que o rel√≥gio do Cliente √© bom o suficiente para medir a passagem de tempo em per√≠odos curtos, mesmo que tenha uma <em>drift</em> rate consider√°vel em per√≠odos mais longos. Assim, podemos executar o algoritmo gen√©rico, adicionando o seguinte:</p>
<ul>
<li>Assuma <span class="arithmatex">\(t_1 = t_s = t_2\)</span></li>
<li>Assuma <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span> como o tempo de transmiss√£o da resposta (m√©dia da ida e da volta)</li>
<li>Cliente ajusta rel√≥gio para <span class="arithmatex">\(C = t_s + \frac{t_3-t_0}{2}\)</span></li>
</ul>
<p><img alt="Algoritmo gen√©rico de sincroniza√ß√£o" src="../drawings/algo_cristian.drawio-1.svg" /></p>
<p>Mas e a aproxima√ß√£o <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span>, √© boa? √â uma aproxima√ß√£o t√£o boa quanto poss√≠vel, pois medir a lat√™ncia em uma √∫nica dire√ß√£o demandaria rel√≥gios sincronizados, exatamente o que estamos tentando resolver com este algoritmo. Quero dizer, temos uma depend√™ncia circular aqui, como o v√≠deo a seguir mostra.</p>
<iframe width="560" height="315" src="https://www.youtube.com/watch?v=pTn6Ewhb27k&list=TLPQMDcwNDIwMjEDgk_ulUs7Ig&index=2" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>Bom, na verdade no nosso caso √© um pouco mais f√°cil de dizer que as duas dire√ß√µes tem lat√™ncias diferentes, pois sabemos que, em uma rede de larga escala, √© poss√≠vel e comum que pacotes tomem caminhos diferentes na ida e na volta. Neste, podemos estimar o erro que a aproxima√ß√£o introduz na sincroniza√ß√£o, desde que tenhamos estimativas de tempo m√≠nimo para a transmiss√£o em cada sentido, <span class="arithmatex">\(T_{min}\)</span>. A figura a seguir demonstra o erro desta t√©cnica<sup id="fnref:erro"><a class="footnote-ref" href="#fn:erro">4</a></sup>, onde </p>
<ul>
<li><span class="arithmatex">\(t_3 - t_0\)</span> corresponde ao tempo medido entre o envio da requisi√ß√£o e recep√ß√£o da resposta</li>
<li>as setas vermelhas indicam o caso em que a requisi√ß√£o foi muito mais r√°pida que resposta (<span class="arithmatex">\(T_{min}\)</span>)</li>
<li>as setas verdes indicam o caso em que a resposta foi muito mais r√°pida que requisi√ß√£o (<span class="arithmatex">\(T_{min}\)</span>)</li>
</ul>
<p><img alt="Erro do algoritmo de Christian" src="../drawings/algo_cristian.drawio-2.svg" /></p>
<p>No caso vermelho, a aproxima√ß√£o <span class="arithmatex">\(\frac{t_3-t_0}{2}\)</span> √© muito menor que o tempo de propaga√ß√£o da resposta, <span class="arithmatex">\(t3 - t1\)</span>, e no caso verde a aproxima√ß√£o √© maior que o tempo <span class="arithmatex">\(t_3 - t_2\)</span>.
Em ambos os casos, o erro √© est√° limitado a <span class="arithmatex">\(\frac{t_2 - t1}{2}\)</span>, ou seja, <span class="arithmatex">\(+- \frac{t_3 - t_0}{2} - T_{min}\)</span>.</p>
<!--Observe que h√° dois casos extremos de erro na estimativa.
No primeiro caso, dado um tempo de ida + volta igual a $T_1 - T_0$, na figura, a mensagem de ida trafega no tempo m√≠nimo e a volta lentamente. Neste caso, a estimativa $\frac{t_3-t_0}{2}$ √© menor que o tempo de volta real.
No segundo caso, a mensagem de ida trafega lentamente e a de volta no tempo m√≠nimo, levando $\frac{t_3-t_0}{2}$ a ser maior que tempo de transmiss√£o real da mensagem.
O erro, contudo, est√° limitado √† faixa amarela no desenho, que tem dura√ß√£o $T_1 - T_0 - 2T_{min}$. 
O erro ent√£o varia de mais ou menos metade deste valor. -->

<h4 id="algoritmo-de-berkeley">Algoritmo de Berkeley</h4>
<p>Enquanto o algoritmo de Cristian permite sincronizar um n√≥ com uma fonte, outro algoritmo, de Berkeley, permite sincronizar m√∫ltiplos n√≥s uns com os outros. Este algoritmo assume o que n√£o h√° uma "fonte da verdade" do tempo, mas sim a necessidade de que todos os processos convirjam para um mesmo valor do rel√≥gio. √â como nos filmes de espi√£o em que os rel√≥gios s√£o sincronizados; pouco importa se a bomba explodir√° 10:57 ou 10:59, desde que todos concordem quando isso vai acontecer. Isso √© o que chamamos de <strong>sincroniza√ß√£o interna</strong> em vez de externa, como provido pelo algoritmo de Cristian.</p>
<p>O algoritmo de Berkeley requer que todo n√≥ execute um processo de sincroniza√ß√£o, um "daemon", e separa seus pap√©is em dois tipos, <strong>prim√°rio</strong> e <strong>secund√°rio</strong>.
O papel do prim√°rio pode ser rotacionado entre os v√°rios processos, sem perdas para sua execu√ß√£o. O algoritmo ent√£o √© executa como se segue:</p>
<ul>
<li>Prim√°rio pergunta "que horas s√£o" para cada secund√°rio (mensages 1,2,3 e 4)</li>
<li>Secund√°rio responde com valor atual do rel√≥gio (mensagens 5,6,7 e 8)</li>
<li>Prim√°rio ajusta as respostas de acordo com o algoritmo de Cristian, para minimizar erros.</li>
<li>Prim√°rio computa m√©dia dos valores recebidos, ignorando <em>outliers</em> (como o da mensagem 8).</li>
<li>Prim√°rio envia <strong>ajustes</strong> para secund√°rios (mensagens 8,9,10 e 11)</li>
<li>Secund√°rio executa ajuste sugerido pelo prim√°rio.</li>
</ul>
<div class="mermaid">
sequenceDiagram
    autonumber
    note over Prim√°rio: 10:00
    note over Secund√°rio1: 10:06
    note over Secund√°rio2: 10:15
    note over Secund√°rio3: 23:18
    par Pergunta
      Prim√°rio-&gt;&gt;Prim√°rio: Que horas s√£o?
    and
      Prim√°rio-&gt;&gt;Secund√°rio1: Que horas s√£o?
    and
      Prim√°rio-&gt;&gt;Secund√°rio2: Que horas s√£o?
    and
      Prim√°rio-&gt;&gt;Secund√°rio3: Que horas s√£o?
    end

    par Resposta
      Prim√°rio-&gt;&gt;Prim√°rio: 10:00
    and
      Secund√°rio1-&gt;&gt;Prim√°rio: 10:06
    and
      Secund√°rio2-&gt;&gt;Prim√°rio: 10:15
    and
      rect rgb(255, 0, 0)
         Secund√°rio3-&gt;&gt;Prim√°rio: 23:18
      end
    end

    par Ajuste
      Prim√°rio-&gt;&gt;Prim√°rio: 10:07
    and
      Prim√°rio-&gt;&gt;Secund√°rio1: 10:07
    and
      Prim√°rio-&gt;&gt;Secund√°rio2: 10:07
    and
      Prim√°rio-&gt;&gt;Secund√°rio3: 10:07
    end
</div>
<p>Embora interessantes, estes algoritmos n√£o s√£o normalmente usados, pelo menos n√£o em sua forma "pura", em sistemas computacionais. Em vez deles, usamos o Network Time Protocol (NTP).</p>
<h4 id="network-time-protocol">Network Time Protocol.</h4>
<p>O NTP foi especificado originalmente na RFC 1305<sup id="fnref:rfc1305"><a class="footnote-ref" href="#fn:rfc1305">6</a></sup> e estendido pelas RFC 5905-5908<sup id="fnref:rfc5905-5908"><a class="footnote-ref" href="#fn:rfc5905-5908">7</a></sup> essencialmente para suportar IPv6 e reduzir o erro de sincroniza√ß√£o para at√© 10<span class="arithmatex">\(\mu\)</span>s.</p>
<p>Os diversos componentes do NTP s√£o organizados em camadas, ou <em>estrata</em>, de forma que a informa√ß√£o do tempo flui da camada 0 (<em>stratum 0</em>) at√© a camada 15 (<em>stratum</em> 15).
Os componentes n√£o est√£o presos a camadas, que podem ser alteradas a medida que falhas acontecem e s√£o dedicadas, e novos caminhos s√£o encontrados usando-se o algoritmo de √°rvore geradora m√≠nima Bellman-Ford, al√©m de caminhos redundantes que conferem propriedades de <strong>toler√¢ncia a falhas</strong> √† topologia.</p>
<p><img alt="Network Time Protocol" src="../images/ntp.png" /><sup id="fnref:ntpfigure"><a class="footnote-ref" href="#fn:ntpfigure">5</a></sup></p>
<p>Esta <strong>organiza√ß√£o hier√°rquica</strong> leva a cada camada garantir um n√≠vel de sincroniza√ß√£o diferente e permite <strong>escalar o uso do protocolo para n√≠veis globais</strong>, usando a <strong>Internet como meio</strong>.</p>
<ul>
<li>Stratum 0: rel√≥gios at√¥micos/receptores GPS</li>
<li>Stratum 1: ms to stratum 0</li>
<li>Stratum 2: contata m√∫ltiplos stratum 1 e pares</li>
<li>Strata 3...15</li>
<li>Stratum 16: dessincronizado</li>
</ul>
<p>Toda a comunica√ß√£o entre n√≥s pode ser <strong>autenticada</strong>, garantindo que a sincroniza√ß√£o n√£o seja facilmente manipulada e erros s√£o minimizados pela coleta e uso de estat√≠sticas de lat√™ncia de comunica√ß√£o, para evitar desvios quando fontes se tornam problem√°ticas.</p>
<p>NTP tem m√∫ltiplas formas de execu√ß√£o, adequadas para diferentes ambientes.</p>
<ul>
<li>Modo multicast: propaga tempo em rede local</li>
<li>RPC: algoritmo de Cristian</li>
<li>Sim√©trico: parecido com Berkeley</li>
</ul>
<p>Na pr√°tica, boa parte dos dispositivos usa uma vers√£o simplificada do NTP, o SNTP (<strong><em>Simple Network Time Protocol</em></strong>), adequada aos n√≥s nas <strong>folhas da hierarquia</strong>. 
O SNTP √© essencialmente o algoritmo de Cristian:</p>
<ul>
<li><span class="arithmatex">\(\delta = (t_4-t_1)-(t_2-t_3)\)</span></li>
<li><span class="arithmatex">\(t = \frac{(t_2-t_1)+(t3-t_4)}{2}\)</span></li>
<li><span class="arithmatex">\(t_c = t_4+t\)</span></li>
</ul>
<p>Por exemplo,</p>
<ul>
<li><span class="arithmatex">\(t_1 = 1100, t_2 = 800, t_3=850, t_4=1200\)</span></li>
<li><span class="arithmatex">\(t = ((800-1100)+(850-1200))/2 = (-300 -350)/ = -325\)</span></li>
<li><span class="arithmatex">\(t_c = 1200-325 = 875\)</span></li>
</ul>
<p>O Comit√™ Gestor da Internet, <a href="https://cgi.br/">CGI</a>, mantem uma excelente p√°gina sobre o NTP, com mais detalhes do que apresentado aqui, em <a href="https://ntp.br/ntp.php">NTP.br</a>.</p>
<h4 id="ptp-precision-time-protocol">PTP - Precision Time Protocol</h4>
<p>Mesmo com melhoria do protocolo e baratemento de dispositivos GPS, h√° ainda a necessidade de sincroniza√ß√£o sub-microssegundo e barata. O <strong><em>Precision Time Protocol</em></strong>, PTP, especifica√ß√£o IEEE 1588<sup id="fnref:ieee1588"><a class="footnote-ref" href="#fn:ieee1588">8</a></sup> tenta cobrir este nicho.</p>
<p>Se escrutinarmos o PTP, veremos que o protocolo em si n√£o difere muito do NTP. Contudo, o PTP usa interfaces de rede especilizadas para fazer o <em>timestamping</em> dos eventos do protocolo, conseguindo remover a lat√™ncia nos dispositivos processando as mensagens e reduzindo o erro do protocolo at√© sub <span class="arithmatex">\(\mu\)</span> (versus ordem de <span class="arithmatex">\(ms\)</span> no NTP).
Mais detalhes sobre o protocolo est√£o fora do escopo deste documento, mas podem ser facilmente encontrados nos links dados.</p>
<h4 id="nunca-volte-no-tempo">Nunca volte no tempo</h4>
<p>Qualquer que seja o algoritmo utilizado, √© provavelmente uma boa ideia <strong>nunca voltar no tempo</strong>. 
Mesmo que o universo n√£o seja destru√≠do no processo, voltar no tempo poderia levar a situa√ß√µes estranhas como um dado ter data de edi√ß√£o anterior a data de cria√ß√£o. Para evitar estas situa√ß√µes, devem ser feitos de <strong>ajustes graduais</strong> nos rel√≥gios, que acelerem ou desacelerem o rel√≥gio <span class="arithmatex">\(C\)</span> em rela√ß√£o a <span class="arithmatex">\(t\)</span> (ou sua melhor aproxima√ß√£o, pelo <strong>ajuste frequ√™ncia de interrup√ß√£o para atrasar/adiantar rel√≥gio</strong> ou <strong>ajustes dos incrementos com cada interrup√ß√£o</strong>. Isso far√° com que as curvas no seguinte gr√°fico convirjam.
A exce√ß√£o a esta regra deve ser restrita a corre√ß√µes ap√≥s longos per√≠odos em que o rel√≥gio dorme.</p>
<p><img alt="Clock drift" src="../drawings/clock_skew.drawio-1.svg" /></p>
<h3 id="usos-de-relogios-sincronizados">Usos de rel√≥gios sincronizados</h3>
<p>Assumindo que tenhamos sincronizado os rel√≥gios de um sistema computacional, o que podemos fazer agora? H√° uma s√©rie de problemas interessantes que podem ser resolvidos,
como <strong>autentica√ß√£o</strong>, <strong>termina√ß√£o de transa√ß√µes</strong>, <strong>aloca√ß√£o de <em>leases</em></strong> e diversos outros exemplos.<sup id="fnref:liskov"><a class="footnote-ref" href="#fn:liskov">9</a></sup>
Um exemplo interessante √© a ordena√ß√£o de eventos em um banco de dados.
Para entender este problema, considere um cen√°rio com um Sistema Banc√°rio replicado, isto √©, com v√°rias c√≥pias.
No exemplo, sem perda de generalidade, nos focamos em duas c√≥pias em lados opostos de uma rede de larga escala.
Clientes disparam opera√ß√µes como saques, dep√≥sitos e transfer√™ncias, por meio de mensagens para as duas c√≥pias. 
Mensagens para a c√≥pia pr√≥xima do cliente (em verde) s√£o entregues rapidamente, enquanto mensagens para a c√≥pia distante (em vermelho), demoram mais para ser entregues.</p>
<p><img alt="Sistema Banc√°rio Replicado" src="../drawings/dist_trans.drawio-0.svg" /></p>
<p>Imagine que o usu√°rio U1 envie o comando C1 <code>atualizar saldo da conta para USD 10</code><sup id="fnref:usd"><a class="footnote-ref" href="#fn:usd">10</a></sup> e que o usu√°rio U2 envie o comando C2 <code>atualizar saldo da conta para USD 20</code>.
Se os comandos chegam primeiro para a r√©plica mais pr√≥xima e s√£o executados na ordem em que chegam, ao final da execu√ß√£o a r√©plica R1 ter√° executado C1 seguido de C2, tendo saldo da conta como USD 20, enquanto R2 ter√° executado C2 seguido de C1 e ter√° como saldo na conta USD 10.
O problema est√° na ordem de execu√ß√£o das opera√ß√µes.</p>
<p>Assuma que rel√≥gios est√£o <strong>perfeitamente</strong> sincronizados e que toda mensagem/update carrega consigo o <em>timestamp</em> de quando foi enviada.
E se as r√©plicas processarem mensagens na ordem que foram enviadas, como identificado pelos seus <em>timestamps</em>?<sup id="fnref:tiebreak"><a class="footnote-ref" href="#fn:tiebreak">11</a></sup>
Assim, se C1 foi enviado antes de C2, C1 tem um <em>timestamp</em> menor que C2 e ser√° executada primeiro em ambas as r√©plicas, o que resolve nosso problema, correto?
Parcialmente, pois ainda temos o problema de <strong>identificar que nenhuma outra mensagem ainda por ser entregue</strong> foi enviada antes. 
Para isto, precisamos <strong>estender o modelo e assumir que o tempo de propaga√ß√£o m√°ximo de uma mensagem, <span class="arithmatex">\(\tau\)</span>, √© finito e conhecido</strong>.
Assim, ao  receber um comando com timestamp <span class="arithmatex">\(t\)</span>, uma r√©plica espera at√© <span class="arithmatex">\(t + \tau\)</span> antes de execut√°-lo, pois qualquer comando com <em>timestamp</em> <span class="arithmatex">\(t' &lt; t\)</span> deve ter sido entregue at√© <span class="arithmatex">\(t+\tau\)</span>.</p>
<p><img alt="Ordena√ß√£o" src="../drawings/tau.drawio-0.svg" /></p>
<p>Implementar este protocolo √© muito simples:</p>
<div class="admonition example">
<p class="admonition-title">Ordena√ß√£o de Mensagens por Timestamp</p>
<ul>
<li>Quando enviar uma mensagem, aumente-a com o valor atual do rel√≥gio.</li>
<li>Quando receber uma mensagem, coloque-a em uma fila ordenada por <em>timestamp</em>.</li>
<li>Quando o rel√≥gio marcar um tempo maior que <span class="arithmatex">\(t + \tau\)</span>, onde <span class="arithmatex">\(t\)</span> √© o timestamp da mensagem na cabe√ßa da fila, retire a mensagem da cabe√ßa da fila e execute o comando correspondente.</li>
</ul>
</div>
<p>Embora correto, este protocolo, ou melhor, o modelo, <strong>n√£o leva em considera√ß√£o a dessincroniza√ß√£o inerente dos rel√≥gios</strong> em um sistema distribu√≠do. 
Como faz√™-lo, supondo uma diverg√™ncia m√°xima de <span class="arithmatex">\(\Delta\)</span> entre quaisquer dois rel√≥gios, algo que pode ser arranjado, como visto antes, sincronizando-se os rel√≥gios a cada <span class="arithmatex">\(\frac{\Delta}{2\rho}\)</span>.</p>
<p>Se <span class="arithmatex">\(\Delta\)</span> √© a diferen√ßa m√°xima entre rel√≥gios, ent√£o se uma mensagem √© enviada no instante <span class="arithmatex">\(t\)</span>, ent√£o at√© <span class="arithmatex">\(\Delta +t\)</span>, outro processo, atrasado em rela√ß√£o ao primeiro, poder√° enviar uma mensagem com timestamp <span class="arithmatex">\(t' &lt; t\)</span>. 
Tal mensagem pode demorar at√© <span class="arithmatex">\(\tau\)</span> para ser entregue √† r√©plica, ou seja, no instante <span class="arithmatex">\(t + \tau + \Delta\)</span>, do ponto de vista do primeiro cliente.</p>
<p>Se a r√©plica estiver sincronizada com cliente, ent√£o se esperar at√© <span class="arithmatex">\(t + \tau + \Delta\)</span> para executar o comando, o far√° de forma segura. 
Se estiver atrasada em rela√ß√£o ao primeiro cliente, ent√£o acabar√° por esperar al√©m do necess√°rio, mas sem violar a corretude do sistema.</p>
<p>Finalmente, se a r√©plica estiver adiantada em rela√ß√£o ao primeiro cliente, ent√£o seu rel√≥gio alcan√ßar√° <span class="arithmatex">\(t + \tau + \Delta\)</span> antes do rel√≥gio do primeiro cliente, mas isso n√£o √© um problema. Isto porqu√™, o √∫ltimo instante em que o cliente 2 poder√° enviar uma mensagem com timestamp <span class="arithmatex">\(t' &lt; t\)</span> √© o instante em que o rel√≥gio da r√©plica marcar <span class="arithmatex">\(t + \Delta\)</span>, e portanto dever√° tamb√©m ser recebido at√© que o mesmo rel√≥gio marque <span class="arithmatex">\(t + \tau + \Delta\)</span>. </p>
<p><img alt="Ordena√ß√£o" src="../drawings/tau.drawio-1.svg" /></p>
<p>O mesmo racioc√≠nio pode ser usado para definir um <strong>protocolo de acesso recursos</strong> para os quais <em>leases</em> s√£o distribu√≠dos, onde um <strong><em>lease</em></strong> <strong>√© uma permiss√£o de acesso durante uma janela de tempo</strong>, emitida por um coordenador (possivelmente eleito usando os algoritmos vistos anteriormente), e <span class="arithmatex">\(\Delta\)</span> √© o m√°ximo de dessincronismo entre os rel√≥gios. 
O seguinte protocolo resolve este problema:</p>
<div class="admonition example">
<p class="admonition-title">Aloca√ß√£o de Lease</p>
<p>Ao receber um <em>lease</em> para a janela de tempo <span class="arithmatex">\(t_1\)</span> a <span class="arithmatex">\(t_2\)</span></p>
<ul>
<li>espera at√© <span class="arithmatex">\(t_1 + \Delta\)</span></li>
<li>usa o recurso at√© <span class="arithmatex">\(t_2\)</span>.</li>
</ul>
</div>
<p>Se rel√≥gio estiver adiantado em rela√ß√£o ao cliente anterior, vai achar que √© <span class="arithmatex">\(t_1+\Delta\)</span> enquanto o anterior acha que √© <span class="arithmatex">\(t_1\)</span>; exclus√£o m√∫tua garantida.
Se rel√≥gio estiver atrasado em rela√ß√£o ao cliente anterior, vai achar que √© <span class="arithmatex">\(t_1 - \Delta\)</span>, e continua esperando, enquanto ele acha que j√° √© <span class="arithmatex">\(t_1\)</span> e para de usar; exclus√£o m√∫tua garantida.
Recurso fica ocioso por <span class="arithmatex">\(\Delta\)</span>, em m√©dia, a cada lease. </p>
<p>Devido ao alto custo de se manter o recurso n√£o utilizado, <span class="arithmatex">\(\Delta\)</span> deve ser feito t√£o pequeno quanto poss√≠vel, como feito, por exemplo, o <a href="https://cloud.google.com/spanner/docs/true-time-external-consistency">Google True Time</a> que consegue manter a diferen√ßa em sub-milisegundos usando rel√≥gios at√¥micos dentro de seus datacenters e um API para gera√ß√£o de timestamps.</p>
<p>Nas solu√ß√µes anteriores, <strong>um n√≥ precisa esperar por muito tempo antes de usar um recurso</strong>. 
E se ele aprendesse antes que os outros n√≥s n√£o far√£o requisi√ß√µes, que n√£o haver√£o sobreposi√ß√µes de requisi√ß√µes? 
E se houvesse um rel√≥gio que avan√ßasse n√£o com o tempo, mas com eventos interessantes do sistema?
Esta √© a ideia dos <strong>rel√≥gios l√≥gicos</strong>.</p>
<h2 id="tempo-logico">Tempo L√≥gico</h2>
<p>A ideia por tr√°s do "tempo l√≥gico" √© de o que importa s√£o eventos e n√£o a passagem do tempo, uma vez que tempo √© relativo aos processos <sup id="fnref:tempologico"><a class="footnote-ref" href="#fn:tempologico">12</a></sup>.
Assim, surgem os rel√≥gios l√≥gicos, que ``ticam'' quando um evento importante acontece.</p>
<p>Para chegarmos aos rel√≥gios l√≥gicos, precisamos primeiro entender a rela√ß√£o <strong><em>Happened-Before</em></strong>, proposta por Leslie Lamport<sup id="fnref:tcoeds"><a class="footnote-ref" href="#fn:tcoeds">13</a></sup> e que lhe rendeu um <a href="https://amturing.acm.org/">Pr√™mio Turing</a> em <a href="https://www.microsoft.com/en-us/research/blog/leslie-lamport-receives-turing-award/">2014</a>.
Hoje √© comum usar a rela√ß√£o <em>happened-before</em> e o vocabul√°rio associado para falar sobre ordem de eventos em um sistema computacional, em especial um distribu√≠do.</p>
<h3 id="happened-before">Happened-Before</h3>
<p>A rela√ß√£o <em>happened-before</em> captura a <strong>causalidade</strong> entre eventos.
Isto √©, se um evento <span class="arithmatex">\(e\)</span> <strong>aconteceu-antes</strong> de um evento <span class="arithmatex">\(e'\)</span>, ent√£o <span class="arithmatex">\(e\)</span> potencialmente causou <span class="arithmatex">\(e'\)</span>.
Tamb√©m podemos dizer que <span class="arithmatex">\(e\)</span> precede <span class="arithmatex">\(e'\)</span> em uma ordem causal.</p>
<p>O evento <span class="arithmatex">\(a\)</span> aconteceu-antes <span class="arithmatex">\(b\)</span>, notado como <span class="arithmatex">\(a \rightarrow b\)</span>, se uma das tr√™s condi√ß√µes seguintes √© v√°lida:</p>
<div class="admonition note">
<p class="admonition-title">Happened-Before</p>
<ul>
<li>Se <span class="arithmatex">\(e\)</span> e <span class="arithmatex">\(e'\)</span> s√£o eventos em um mesmo processo (ou <em>thread</em>) e <span class="arithmatex">\(e\)</span> foi executado antes de <span class="arithmatex">\(e'\)</span>.</li>
<li>Se <span class="arithmatex">\(e\)</span> e <span class="arithmatex">\(e'\)</span> s√£o eventos de processos distintos e <span class="arithmatex">\(e\)</span> √© o envio de uma mensagem e <span class="arithmatex">\(e'\)</span> a sua recep√ß√£o.</li>
<li>Se h√° transitividade, isto √©, se existe um evento <span class="arithmatex">\(e''\)</span> tal que <span class="arithmatex">\(e \rightarrow e''\)</span> e <span class="arithmatex">\(e'' \rightarrow e'\)</span>.</li>
</ul>
</div>
<p>Na figura abaixo, as tr√™s regras s√£o exemplificadas pelos eventos de cor vermelha, amarela e verde, respectivamente.</p>
<p><img alt="LC - Primeira tentativa" src="../drawings/clock.drawio-1.svg" /></p>
<p>Note que se <span class="arithmatex">\(e \rightarrow e'\)</span> √© falso e <span class="arithmatex">\(e' \rightarrow e\)</span> √© falso, ent√£o <span class="arithmatex">\(e\)</span> e <span class="arithmatex">\(e'\)</span> s√£o <strong>concorrentes</strong>, e que ser concorrente n√£o quer dizer que aconteceram exatamente no mesmo instante, do ponto de vista de um observador externo, como exemplificado na figura anterior pelos eventos de cor roxa.
Ser concorrente quer dizer que um evento <span class="arithmatex">\(e\)</span> n√£o pode ter influenciado o evento <span class="arithmatex">\(e'\)</span>, dado que os efeitos de <span class="arithmatex">\(e\)</span> n√£o poderiam ser conhecidos pelo processo onde <span class="arithmatex">\(e'\)</span> ocorreu, quando <span class="arithmatex">\(e'\)</span> ocorreu.
O cone de luz na figura seguinte mostra esta rela√ß√£o entre eventos. Somente os efeitos dos eventos uma dist√¢ncia no espa√ßo/tempo menor ou igual √†s dos pontos mais distantes ao evento em quest√£o, podem ter influenciado tal evento. No caso dos eventos <span class="arithmatex">\(o\)</span> e <span class="arithmatex">\(v\)</span> na figura, os mesmos n√£o figuram no mesmo cone de luz.</p>
<p><img alt="Light-cone" src="../drawings/clock.drawio-2.svg" /></p>
<p>Mas para que nos serve capturar a causalidade entre os eventos? Bem, se capturarmos a causalidade, podemos usar esta informa√ß√£o para ordenar os seu processamento, de forma a fazer sentido.
Por exemplo, considere um sistema em que o primeiro usu√°rio de um servi√ßo de emails recebe primeiro a resposta da mensagem A, R:A, para somente depois receber A.
Para que a troca de mensagens fa√ßa sentido, o usu√°rio posterga a leitura de R:A at√© depois de ter lido A.</p>
<p><img alt="Invers√£o causal" src="../drawings/group_com.drawio-0.svg" /></p>
<p>Observe que em nenhum momento a informa√ß√£o sobre <strong>quando</strong> as mensagens foram enviadas foi necess√°ria, apenas a <strong>ordem</strong> das mesmas.
Rel√≥gios l√≥gicos permitem que sistemas capturem a rela√ß√£o de causalidade entre eventos e implementem esquemas como o apenas descrito, para coordenar as a√ß√µes dos processos em sistemas distribu√≠dos.</p>
<h3 id="relogios-logicos">Rel√≥gios l√≥gicos</h3>
<p>Para que computadores possam usar a causalidade, precisamos capturar a rela√ß√£o de acontecer antes em um sistema.
Lamport prop√¥s uma tal forma, que denominou <strong>rel√≥gio l√≥gico</strong>, mas que hoje √© conhecido universalmente como <strong>rel√≥gio de Lamport</strong>.
Estes rel√≥gios permitem associar um <em>timestamp</em> a eventos de forma a se garantir a seguinte propriedade:</p>
<ul>
<li>seja <span class="arithmatex">\(e\)</span> um evento</li>
<li>seja <span class="arithmatex">\(C(e)\)</span> o valor do rel√≥gio l√≥gico quando associado a <span class="arithmatex">\(e\)</span></li>
<li>se <span class="arithmatex">\(e \rightarrow e'\)</span> ent√£o <span class="arithmatex">\(C(e) &lt; C(e')\)</span></li>
</ul>
<p>Mas como definir a fun√ß√£o <span class="arithmatex">\(C\)</span>?
Experimentemos a seguinte defini√ß√£o:</p>
<div class="admonition example">
<p class="admonition-title">Quase Rel√≥gio de Lamport</p>
<ul>
<li>Seja <span class="arithmatex">\(c_p\)</span> um contador em <span class="arithmatex">\(p\)</span> com valor inicialmente igual a 0.</li>
<li><span class="arithmatex">\(C(e) = ++c_p\)</span> no momento em que <span class="arithmatex">\(e\)</span> ocorreu.</li>
<li>Usamos como <span class="arithmatex">\(&lt;\)</span> a rela√ß√£o normal de inteiros.</li>
</ul>
</div>
<p>Observe que n√£o h√° <strong>fonte da verdade</strong> em termos de tempo l√≥gico, j√° que <strong>cada processo mant√©m seu pr√≥prio rel√≥gio</strong> que pode ser relacionado com rel√≥gios de outros processos.
Veja um exemplo desta defini√ß√£o em a√ß√£o.</p>
<p><img alt="LC - Primeira tentativa" src="../drawings/clock.drawio-3.svg" /></p>
<p>√â verdade neste cen√°rio que se <span class="arithmatex">\(a \rightarrow b\)</span> ent√£o <span class="arithmatex">\(C(a) &lt; C(b)\)</span>?<br />
Observe com aten√ß√£o os eventos <span class="arithmatex">\(j\)</span> e <span class="arithmatex">\(q\)</span>, pois para estes, a regra n√£o √© respeitada.</p>
<h4 id="relogio-de-lamport">Rel√≥gio de Lamport</h4>
<p>Para que a regra <span class="arithmatex">\(e \rightarrow e'\)</span> ent√£o <span class="arithmatex">\(C(e) &lt; C(e')\)</span> seja v√°lida, precisamos modificar a tentativa anterior para que, na recep√ß√£o de uma mensagem, os contadores sejam atualizados para que sejam maiores tanto que os rel√≥gios dos eventos locais quanto dos eventos que antecederam o envio da mensagem sendo recebida.</p>
<div class="admonition example">
<p class="admonition-title">Rel√≥gio de Lamport</p>
<ul>
<li>Seja <span class="arithmatex">\(c_p\)</span> um contador em <span class="arithmatex">\(p\)</span> com valor inicialmente igual a 0.</li>
<li>Se o evento <span class="arithmatex">\(e\)</span> √© uma opera√ß√£o local<ul>
<li><span class="arithmatex">\(c_p \gets c_p + 1\)</span></li>
<li><span class="arithmatex">\(C(e) \gets c_p\)</span></li>
</ul>
</li>
<li>Se o evento <span class="arithmatex">\(e\)</span> √© o envio de uma mensagem<ul>
<li><span class="arithmatex">\(c_p \gets c_p + 1\)</span></li>
<li><span class="arithmatex">\(C(e) \gets c_p\)</span></li>
<li><span class="arithmatex">\(C(e)\)</span> √© enviado com a mensagem como seu <em>timestamp</em>.</li>
</ul>
</li>
<li>Se o evento <span class="arithmatex">\(e\)</span> √© a recep√ß√£o de uma mensagem com <em>timestamp</em> <span class="arithmatex">\(ts\)</span><ul>
<li><span class="arithmatex">\(c_p \gets max(c_p,ts)+1\)</span>.</li>
<li><span class="arithmatex">\(C(e) \gets c_p\)</span></li>
</ul>
</li>
</ul>
</div>
<p>Com este ajuste, temos os <strong>Rel√≥gios de Lamport</strong>.</p>
<p><img alt="LC - Primeira tentativa" src="../drawings/clock.drawio-4.svg" /></p>
<p>Neste caso, temos que para quaisquer eventos <span class="arithmatex">\(e,e'\)</span>,  se <span class="arithmatex">\(e \rightarrow e'\)</span> ent√£o <span class="arithmatex">\(C(e) &lt; C(e')\)</span>.</p>
<details class="todo"><summary>Todo</summary><p>Exemplo em que n√£o √© bom o suficiente.</p>
</details>
<p>Se <span class="arithmatex">\(e \rightarrow e'\)</span> ent√£o <span class="arithmatex">\(C(e) &lt; C(e')\)</span>. Contudo, a volta n√£o √© verdade, isto √©, se <span class="arithmatex">\(C(e) &lt; C(e')\)</span> ent√£o <span class="arithmatex">\(e \rightarrow e'\)</span>.
Esta propriedade √© interessante na ordena√ß√£o de eventos, pois evita que eventos concorrentes sejam ordenados.
Entram os rel√≥gios vetoriais.</p>
<h4 id="relogio-vetorial">Rel√≥gio Vetorial</h4>
<p><strong>Rel√≥gios vetoriais</strong> s√£o rel√≥gios l√≥gicos em que cada processo mant√©m n√£o apenas um contador dos seus eventos locais, mas tamb√©m sua vis√£o dos contadores dos outros processos.
Estas vis√µes s√£o atualizadas a cada recep√ß√£o de mensagem, de acordo com a seguinte especifica√ß√£o, onde assume-se que <span class="arithmatex">\(n\)</span> processos fazem parte do sistema.</p>
<div class="admonition example">
<p class="admonition-title">Rel√≥gio Vetorial</p>
<p>Considerando o ponto de vista do processo <span class="arithmatex">\(p\)</span></p>
<ul>
<li>Seja <span class="arithmatex">\(c_p[i], 1 \leq i \leq n\)</span> inicialmente igual a 0</li>
<li>Seja um evento <span class="arithmatex">\(e\)</span><ul>
<li>Se <span class="arithmatex">\(e\)</span> √© uma opera√ß√£o local<ul>
<li><span class="arithmatex">\(c_p[p] \gets c_p[p] + 1\)</span></li>
<li><span class="arithmatex">\(V(e) \gets c_p\)</span></li>
</ul>
</li>
<li>Se <span class="arithmatex">\(e\)</span> √© o envio de uma mensagem<ul>
<li><span class="arithmatex">\(c_p[p] \gets c_p[p] + 1\)</span></li>
<li><span class="arithmatex">\(V(e) \gets c_p\)</span></li>
<li><span class="arithmatex">\(V(e)\)</span> √© enviado com a mensagem como seu timestamp.</li>
</ul>
</li>
<li>Se <span class="arithmatex">\(e\)</span> √© a recep√ß√£o de uma mensagem com timestamp <span class="arithmatex">\(ts\)</span> de <span class="arithmatex">\(q\)</span>, ent√£o<ul>
<li><span class="arithmatex">\(c_p[p] \gets c_p[p] + 1\)</span></li>
<li><span class="arithmatex">\(c_p[i] \gets max(c_p[i], ts[i]), \forall i \neq p\)</span></li>
<li><span class="arithmatex">\(V(e) \gets c_p\)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Uma observa√ß√£o interessante a ser feita aqui √© que embora o algoritmo pare√ßa indicar que cada processo precisa saber quantos mais processos existem no sistema, isto n√£o √© verdade, pois pode-se assumir que para todo processo desconhecido <span class="arithmatex">\(q\)</span>, <span class="arithmatex">\(c_p[q] = 0\)</span>.</p>
<p>Como dito, este rel√≥gio l√≥gico tem a propriedade <span class="arithmatex">\(e \rightarrow e' \iff V(e) &lt; V(e')\)</span>, considerando-se a seguinte defini√ß√£o de <span class="arithmatex">\(&lt;\)</span> para vetores:</p>
<div class="admonition note">
<p class="admonition-title">Compara√ß√£o entre vetores</p>
<ul>
<li><span class="arithmatex">\(v = v' \iff v[i] = v'[i], 1 \leq i \leq n\)</span></li>
<li><span class="arithmatex">\(v \leq v' \iff v[i] \leq v'[i], 1 \leq i \leq n\)</span></li>
<li><span class="arithmatex">\(v &lt; v' \iff v \leq v' \land v \neq v'\)</span></li>
</ul>
</div>
<p>Assim, sejam dois eventos <span class="arithmatex">\(e \neq e'\)</span>:</p>
<ul>
<li><span class="arithmatex">\(e \rightarrow e' \iff V(e) &lt; V(e')\)</span></li>
<li>Se <span class="arithmatex">\(V(e) \not &lt; V(e')\)</span> e <span class="arithmatex">\(V(e') \not &lt; V(e)\)</span>, ent√£o <span class="arithmatex">\(e\)</span> e <span class="arithmatex">\(e'\)</span> s√£o concorrentes.</li>
</ul>
<p>Para entender melhor como esta defini√ß√£o funciona, considere a seguinte execu√ß√£o.
O que quer dizer <span class="arithmatex">\(c_p[q] = k\)</span>, ou tomando o evento <span class="arithmatex">\(d\)</span> como exemplo, o que quer dizer <span class="arithmatex">\(V(d) = (4,1,0)\)</span>?</p>
<p><img alt="Rel√≥gio Vetorial" src="../drawings/clock.drawio-5.svg" /></p>
<p>Quer dizer que <span class="arithmatex">\(p1\)</span> est√° ciente de 1 eventos locais a <span class="arithmatex">\(p2\)</span>, assim com est√° ciente de 0 eventos em <span class="arithmatex">\(p3\)</span> e de que <span class="arithmatex">\(d\)</span> √© o quarto evento em <span class="arithmatex">\(p1\)</span>.
Agora compare os eventos <span class="arithmatex">\(o\)</span> e <span class="arithmatex">\(v\)</span>.
<span class="arithmatex">\(o\)</span> e <span class="arithmatex">\(v\)</span> s√£o concorrentes pois embora as posi√ß√µes 1 e 2 de <span class="arithmatex">\(V(o)\)</span> sejam maiores que em <span class="arithmatex">\(V(v)\)</span>, a posi√ß√£o 3 √© menor.
Isso quer dizer que o nem <span class="arithmatex">\(o\)</span> est√° ciente do evento <span class="arithmatex">\(v\)</span> e nem <span class="arithmatex">\(v\)</span> est√° ciente do evento <span class="arithmatex">\(o\)</span>, ou melhor, que um n√£o pode ter causado o outro.</p>
<p>Esta abstra√ß√£o simples j√° √© muito poderosa e, embora possa ser melhorada,<sup id="fnref:matrix_clock"><a class="footnote-ref" href="#fn:matrix_clock">14</a></sup> j√° √© suficiente para se implementar outras abstra√ß√µes interessantes, como ser√° visto adiante.
Antes, √© necess√°rio mencionar mais um tipo de rel√≥gio l√≥gico, os h√≠bridos.</p>
<h4 id="relogios-hibridos">Rel√≥gios H√≠bridos</h4>
<p>A grande vantagem dos rel√≥gios l√≥gicos sobre os f√≠sicos √© de ignorar a passagem do tempo, s√≥ se importanto com a ordem de eventos.
Esta vantagem tamb√©m √© uma desvantagem quando eventos precisam ser associados a eventos externos ao sistema, por exemplo, durante uma sess√£o de depura√ß√£o.
Suponha que ap√≥s uma atualiza√ß√£o de um sistema, voc√™ note um problema nos dados e, em depurando o problema, identifique o evento problem√°tico nos <em>logs</em> do sistema, associado ao seu rel√≥gio l√≥gico.
Como identificar se este evento problem√°tico aconteceu antes ou depois da atualiza√ß√£o?
<a href="http://muratbuffalo.blogspot.com.br/2014/07/hybrid-logical-clocks.html">Rel√≥gios h√≠bridos</a> tentam resolver este problema combinando rel√≥gios f√≠sicos e l√≥gicos em um.</p>
<p>No seguinte algoritmo, cada processo mantem um rel√≥gio f√≠sico e um l√≥gico e sempre que um evento acontece, usa como novo valor do rel√≥gio l√≥gico o m√°ximo entre o valor anterior + 1, o valor do <em>timestamp</em> na mensagem sendo recebida + 1, se for o recebimento de uma mensagem, e o valor do rel√≥gio f√≠sico.
Isto √©, se poucos eventos acontecerem, o valor do rel√≥gio l√≥gico acompanhar√° o valor do f√≠sico.</p>
<div class="admonition example">
<p class="admonition-title">Rel√≥gio H√≠brido Simples</p>
<p>Considerando o ponto de vista do processo <span class="arithmatex">\(p\)</span></p>
<ul>
<li><span class="arithmatex">\(c_p.f\)</span> √© o rel√≥gio f√≠sico de <span class="arithmatex">\(p\)</span>, incrementado automaticamente</li>
<li><span class="arithmatex">\(c_p.l\)</span> √© o rel√≥gio l√≥gico de <span class="arithmatex">\(p\)</span>, inicialmente 0</li>
<li>Seja um evento <span class="arithmatex">\(e\)</span><ul>
<li>Se <span class="arithmatex">\(e\)</span> √© uma opera√ß√£o local<ul>
<li><span class="arithmatex">\(c_p.l \gets max(c_p.l + 1, c_p.f)\)</span></li>
<li><span class="arithmatex">\(H(e) \gets c_p.l\)</span></li>
</ul>
</li>
<li>Se <span class="arithmatex">\(e\)</span> √© o envio de uma mensagem<ul>
<li><span class="arithmatex">\(c_p.l \gets max(c_p.l + 1, c_p.f)\)</span></li>
<li><span class="arithmatex">\(H(e) \gets c_p.l\)</span></li>
<li><span class="arithmatex">\(H(e)\)</span> √© enviado com a mensagem como seu timestamp.</li>
</ul>
</li>
<li>Se <span class="arithmatex">\(e\)</span> √© a recep√ß√£o de uma mensagem com timestamp <span class="arithmatex">\(ts\)</span> de <span class="arithmatex">\(q\)</span>, ent√£o<ul>
<li><span class="arithmatex">\(c_p.l \gets max(c_p.l + 1, ts + 1, c_p.f)\)</span></li>
<li><span class="arithmatex">\(V(e) = c_p.l\)</span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p><img alt="Rel√≥gio H√≠brido Simples" src="../drawings/clock.drawio-0.svg" /></p>
<p>Nesta vers√£o do algoritmo, contudo, se muitos eventos acontecerem, o valor do rel√≥gio l√≥gico pode ser incrementadado muito rapidamente, perdendo a rela√ß√£o com o rel√≥gio f√≠sico.
Em uma vers√£o melhorada do algoritmo,<sup id="fnref:hlc"><a class="footnote-ref" href="#fn:hlc">15</a></sup> a dist√¢ncia entre os dois rel√≥gios √© limitada, mantendo a propriedade que faz o rel√≥gios h√≠bridos interessantes.<sup id="fnref:hlcerror"><a class="footnote-ref" href="#fn:hlcerror">16</a></sup></p>
<!--![Hibrid Logical Clock](images/lc_hybrid.png) - Onde se l√™ 3,13, leia-se 3,10,3.-->

<h3 id="comunicacao-em-grupo">Comunica√ß√£o em Grupo</h3>
<p>Rel√≥gios l√≥gicos podem e s√£o usados diretamente em sistemas, por exemplo, para controlar vers√µes no sistema de identidade da Microsoft, <a href="https://cdn.ttgtmedia.com/searchwin2000/downloads/pdfs/ImplementingtheAD202014.pdf">Active Directory</a>.
Outra forma de uso √© como block de constru√ß√£o de outras abstra√ß√µes, por exemplo, primitivas de comunica√ß√£o em grupo, pelas quais um processo envia mensagens para um conjunto de processos.</p>
<ul>
<li>Difus√£o Totalmente Ordenada (<em>Total Order Multicast</em>):<ul>
<li>Difus√£o: mensagens s√£o enviadas de 1 para n (comunica√ß√£o em grupo)</li>
<li>Totalmente Ordenada: todos os processos entregam as mensagens na mesma ordem</li>
</ul>
</li>
<li>Difus√£o Causalmente Ordenada:<ul>
<li>Causalmente Ordenada: uma mensagem s√≥ √© entregue se todas as que causalmente a precedem j√° foram entregues.</li>
</ul>
</li>
</ul>
<p>Com estas abstra√ß√µes, podemos resolver o problema apresentado no in√≠cio deste cap√≠tulo, relembrando, <em>cloud-drive</em>, da seguinte forma.
Considere um programa qualquer, que se comporte de forma determin√≠stica (isto √©, dada uma mesma entrada, gera sempre uma mesma sa√≠da). 
Como todo programa, este √© uma m√°quina de estados, com a peculiaridade de ser determin√≠stica.
Logo, se tivermos <strong>v√°rias c√≥pias</strong> deste programa, executando em locais distintos, mas garantirmos que cada c√≥pia veja exatamente a <strong>mesma entrada de dados</strong>, ent√£o garantiremos que todas as c√≥pias <strong>transitar√£o pelos mesmos estados</strong> e chegar√£o ao mesmo estado final.
Como difus√£o totalmente ordenada pode ser usado para garantir que todas as c√≥pias receber√£o a mesma entrada, pode ser usado para implementar esta t√©cnica, conhecida como Replica√ß√£o de M√°quinas de Estados (em ingl√™s, <a href="https://en.wikipedia.org/wiki/State_machine_replication"><em>State Machine Replication</em></a>, ou pelo menos o seu princ√≠pio.</p>
<p><img alt="State Machine Replication" src="../drawings/group_com.drawio-1.svg" /></p>
<p>Mas como podemos implementar estas primitivas de difus√£o usando rel√≥gios l√≥gicos? 
Vejamos um algoritmo, onde consideramos que todas as mensagens s√£o enviadas a todos os processos, inclusive o pr√≥prio remetente.</p>
<div class="admonition example">
<p class="admonition-title">Difus√£o Totalmente Ordenado</p>
<ul>
<li>
<p>Considerando o ponto de vista do processo <span class="arithmatex">\(p\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(f_p\)</span> √© uma fila de mensagens ordenadas pelo seus <em>timestamps</em>, mantida em <span class="arithmatex">\(p\)</span></p>
</li>
<li>Para difundir uma mensagem <span class="arithmatex">\(m\)</span><ul>
<li>colocar <span class="arithmatex">\(m\)</span> na fila</li>
<li>enviar <span class="arithmatex">\(m\)</span> para todos os demais processos</li>
</ul>
</li>
<li>Quando uma mensagem <span class="arithmatex">\(m\)</span> √© recebida<ul>
<li>colocar <span class="arithmatex">\(m\)</span> na fila</li>
<li>se <span class="arithmatex">\(m\)</span> n√£o √© um ack<ul>
<li>enviar <span class="arithmatex">\(m ack\)</span> de volta ao remetente de <span class="arithmatex">\(m\)</span> (com <em>timestamp</em> maior que de <span class="arithmatex">\(m\)</span>)</li>
</ul>
</li>
</ul>
</li>
<li>Seja <span class="arithmatex">\(m\)</span> a mensagem com <em>timestamp</em> ts na cabe√ßa da fila<ul>
<li>Se para cada processo <span class="arithmatex">\(q\)</span>, h√° uma mensagem <span class="arithmatex">\(m'\)</span> de <span class="arithmatex">\(q\)</span> com <em>timestamp</em> ts' na fila de <span class="arithmatex">\(p\)</span> tal que <span class="arithmatex">\(ts &lt; ts'\)</span><ul>
<li>entregar <span class="arithmatex">\(m\)</span> para a aplica√ß√£o</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>O objetivo deste algoritmo √© de entregar mensagens na ordem de seus <em>timestamps</em>. Para isso, antes de entregar a mensagem <span class="arithmatex">\(m\)</span> de menor <em>tmestamp</em> ts conhecido atualmente por <span class="arithmatex">\(p\)</span>, <span class="arithmatex">\(p\)</span> espera por mensagens com <span class="arithmatex">\(timestamps\)</span> maiores que ts de todos os processos. Uma vez que isso aconte√ßa, <span class="arithmatex">\(p\)</span> sabe que nenhuma outra mensagem que chegue depois poderia ter <span class="arithmatex">\(timestamp\)</span> menor que ts.
Para que isto funcione, √© necess√°rio que os canais de comunica√ß√£o usados sejam confi√°veis (todas as mensagens enviadas s√£o entregues) e FIFO (a primeira a ser enviada √© primeira a ser recebida).</p>
<div class="admonition exercise">
<p class="admonition-title">Exerc√≠cio - FIFO e Confi√°veis</p>
<p>√â necess√°rio que canais de comunica√ß√£o sejam FIFO e confi√°veis para que mensagens com <em>timestamp</em> maiores n√£o sejam perdidas e para que mensagens com <em>timestamps</em> maiores n√£o sejam reordenadas e entregues primeiro. </p>
<p>Explique porqu√™ isto seria um problema; descreva execu√ß√µes problem√°ticas.</p>
</div>
<p>Vejamos um outro algoritmo, de difus√£o <strong>causalmente</strong> ordenada.</p>
<div class="admonition example">
<p class="admonition-title">Difus√£o Causalmente Ordenada</p>
<ul>
<li>
<p>Considerando o ponto de vista do processo <span class="arithmatex">\(p\)</span></p>
</li>
<li>
<p><span class="arithmatex">\(p\)</span> incrementa <span class="arithmatex">\(c_p[p]\)</span> somente no envio de mensagens.</p>
</li>
<li><span class="arithmatex">\(p\)</span> s√≥ entrega uma mensagem recebida de <span class="arithmatex">\(q\)</span>, com timestamp <span class="arithmatex">\(ts\)</span> quando<ul>
<li><span class="arithmatex">\(ts[q] = c_p[q]+1\)</span></li>
<li><span class="arithmatex">\(ts[k] \leq c_p[k], k \neq q\)</span></li>
</ul>
</li>
</ul>
</div>
<p><img alt="Causal Ordering" src="../drawings/group_com.drawio-2.svg" /></p>
<div class="admonition exercise">
<p class="admonition-title">Difus√£o Causalmente Ordenada</p>
<p>Considere <span class="arithmatex">\(c_{p3}[0,2,2]\)</span> e <span class="arithmatex">\(ts=[1,3,0]\)</span>, de <span class="arithmatex">\(p1\)</span>. O que <span class="arithmatex">\(p3\)</span> est√° esperando? Como age ao receber mensagem com <span class="arithmatex">\(ts\)</span>?</p>
</div>
<p>Um aspecto interessante da implementa√ß√£o de primitivas de comunica√ß√£o em grupo que usa rel√≥gios para ordena√ß√£o de mensagens √© que elas podem ser feitas de forma transparente para a aplica√ß√£o que as usa. 
Isto √©, no exemplo descrito anteriormente em que processos mandam mensagens para r√©plicas usando difus√£o totalmente ordenada, os clientes n√£o precisam estar cientes disto, e podem simplesmente mandar suas requisi√ß√µes como faziam antes do servi√ßo ser replicado. Mas como ent√£o as mensagens tem seus rel√≥gios l√≥gicos atualizados e usados para a gera√ß√£o de <em>timestamps</em>?
Isto pode ser feito por meio de <strong>interceptadores</strong> em uma camada de <strong><em>middleware</em></strong>.</p>
<p><img alt="Interceptadores" src="../images/tanenbaum-06-10.png" /></p>
<p>Quando a aplica√ß√£o envia uma mensagem, o rel√≥gio l√≥gico mantido no <em>middleware</em> √© atualizado e seu valor usado como <em>timestamp</em> em uma vers√£o estendida da mensagem, efetivamente enviada na rede.
Quando a mensagem estendida √© entregue ao destinat√°rio, a mensagem √© passada para o interceptador que extrai o <em>timestamp</em> e atualiza seu rel√≥gio. A mensagem sem o <em>timestamp</em> √© entregue para a aplica√ß√£o quando apropriado, e aplica√ß√£o n√£o percebe a manipula√ß√£o.</p>
<h3 id="exclusao-mutua-revisitada">Exclus√£o M√∫tua Revisitada</h3>
<details class="todo"><summary>Todo</summary><ul>
<li><a href="http://www.cs.cmu.edu/~dga/15-440/F10/lectures/Distributed-Mutual-Exclusion-slides.pdf">Algoritmos de Exclu√£o m√∫tua baeados em LC</a></li>
<li>Algoritmo de Lamport, Ricart e agrawalla</li>
<li><a href="https://www.coursera.org/learn/cloud-computing-2/lecture/GMHYN/2-4-maekawas-algorithm-and-wrap-up">Algoritmo de Maekawa</a></li>
</ul>
</details>
<h2 id="referencias">Refer√™ncias</h2>
<ul>
<li><a href="https://cloud.google.com/spanner/docs/true-time-external-consistency">Google TrueTime</a></li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:quartz">
<p><a href="https://www.explainthatstuff.com/quartzclockwatch.html">Explain that stuff.</a>&#160;<a class="footnote-backref" href="#fnref:quartz" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:piezo">
<p>Distor√ß√£o mec√¢nica gera corrente el√©trica e submiss√£o a uma corrente el√©trica gera uma distor√ß√£o mec√¢nica.&#160;<a class="footnote-backref" href="#fnref:piezo" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:freq">
<p>32768 √© a primeira pot√™ncia de 2 maior que 20000, a maior frequ√™ncia sonora aud√≠vel aos seres humanos.&#160;<a class="footnote-backref" href="#fnref:freq" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:erro">
<p>Adaptado das notas de aula dispon√≠veis <a href="https://www.cs.rutgers.edu/~pxk/417/notes/content/05-clock-synchronization-slides.pdf">aqui</a>.&#160;<a class="footnote-backref" href="#fnref:erro" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:ntpfigure">
<p><a href="https://commons.wikimedia.org/w/index.php?curid=2815097">Fonte: Benjamin D. Esham, (bdesham) - Based upon Ntp.png by Kim Meyrick</a>&#160;<a class="footnote-backref" href="#fnref:ntpfigure" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:rfc1305">
<p><a href="https://datatracker.ietf.org/doc/rfc1305/">RFC 1305</a>, 1991/1992&#160;<a class="footnote-backref" href="#fnref:rfc1305" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:rfc5905-5908">
<p>RFC 5905-5908,2010&#160;<a class="footnote-backref" href="#fnref:rfc5905-5908" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:ieee1588">
<p><a href="https://www.nist.gov/el/intelligent-systems-division-73500/ieee-1588">IEEE 1588TM Standard for A Precision Clock Synchronization Protocol for Networked Measurement and Control Systems</a>.&#160;<a class="footnote-backref" href="#fnref:ieee1588" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:liskov">
<p><a href="http://rdcu.be/s4iy">Liskov, B.: Distrib Comput (1993) 6: 211. doi:10.1007/BF02242709</a>&#160;<a class="footnote-backref" href="#fnref:liskov" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:usd">
<p>Unidade Simples de Dinheiros.&#160;<a class="footnote-backref" href="#fnref:usd" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn:tiebreak">
<p>Empates s√£o quebrados pelo identificador do processo, isto √©, se duas mensagens s√£o produzidas ao mesmo tempo por U1 e U2, ent√£o o a mensagem de U1 tem preced√™ncia na execu√ß√£o.&#160;<a class="footnote-backref" href="#fnref:tiebreak" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
<li id="fn:tempologico">
<p>Reza a lenda que Leslie Lamport desenvolveu o conceito de rel√≥gios l√≥gicos pensando na teoria da relatividade geral.&#160;<a class="footnote-backref" href="#fnref:tempologico" title="Jump back to footnote 12 in the text">&#8617;</a></p>
</li>
<li id="fn:tcoeds">
<p><a href="http://amturing.acm.org/p558-lamport.pdf">Time, Clocks and the Ordering of Events in a Distributed System. July 5, 1978</a>.&#160;<a class="footnote-backref" href="#fnref:tcoeds" title="Jump back to footnote 13 in the text">&#8617;</a></p>
</li>
<li id="fn:matrix_clock">
<p><a href="https://en.wikipedia.org/wiki/Matrix_clock">Matrix Clock</a>&#160;<a class="footnote-backref" href="#fnref:matrix_clock" title="Jump back to footnote 14 in the text">&#8617;</a></p>
</li>
<li id="fn:hlc">
<p>O <a href="http://muratbuffalo.blogspot.com/2014/07/hybrid-logical-clocks.html">blog</a> de um dos autores descreve ambas as vers√µes de forma resumida. Para a vers√£o completa dos algoritmos, consulte o <a href="http://www.cse.buffalo.edu/tech-reports/2014-04.pdf">artigo</a>.&#160;<a class="footnote-backref" href="#fnref:hlc" title="Jump back to footnote 15 in the text">&#8617;</a></p>
</li>
<li id="fn:hlcerror">
<p>Tanto no artigo quanto no blog, a imagem que descreve um exemplo do HLC parece ter um erro e onde se l√™ (3,13) deve-se ler (3,10,3).&#160;<a class="footnote-backref" href="#fnref:hlcerror" title="Jump back to footnote 16 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <!-- Last update of source file -->


              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../coord/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Coordena√ß√£o
            </div>
          </div>
        </a>
      
      
        <a href="../fault/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Pr√≥ximo
              </span>
              Toler√¢ncia a Falhas
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/mathjaxhelper.js"></script>
      
    
  </body>
</html>