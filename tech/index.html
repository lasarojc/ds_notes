
<!doctype html>
<html lang="pt" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Tecnologias - Notas em Sistemas Distribuídos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-PJX835H7DP","lasarojc.github.org/dsnotes"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tecnologias" class="md-skip">
          Ir para o conteúdo
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-header-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Notas em Sistemas Distribuídos
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Tecnologias
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Buscar" placeholder="Buscar" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Notas em Sistemas Distribuídos" class="md-nav__button md-logo" aria-label="Notas em Sistemas Distribuídos">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notas em Sistemas Distribuídos
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lasarojc/ds_notes" title="Ir ao repositório" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../preface/" class="md-nav__link">
        Prefácio
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introdução
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        Fundamentos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../arch/" class="md-nav__link">
        Arquiteturas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../comm/" class="md-nav__link">
        Comunicação
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../coord/" class="md-nav__link">
        Coordenação
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../time/" class="md-nav__link">
        Tempo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../fault/" class="md-nav__link">
        Tolerância a Falhas
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disdb/" class="md-nav__link">
        Bancos de Dados
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../disfs/" class="md-nav__link">
        Sistemas de Arquivos
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.md" class="md-nav__link">
        Tecnologias
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Índice">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Índice
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#como-sincronizar-duas-maquinas" class="md-nav__link">
    Como sincronizar duas máquinas?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rabin-fingerprinting" class="md-nav__link">
    Rabin Fingerprinting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blockchain" class="md-nav__link">
    Blockchain
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-small-piece-of-big-data" class="md-nav__link">
    A Small Piece of Big Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estudo-de-caso-kafka" class="md-nav__link">
    Estudo de caso: Kafka
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              

<!-- Edit button -->


  <!--
       Hack: check whether the content contains a h1 headline. If it
       doesn't, the page title (or respectively site name) is used
       as the main headline.
    -->


  <!-- Content -->
  <h1 id="tecnologias">Tecnologias</h1>
<p>O objetivo deste capítulo é visitar algumas técnicas e tecnologias recentes e interessantes na área de sistemas distribuídos. Não espere então que as várias seções sejam conexas umas com as outras.</p>
<h2 id="como-sincronizar-duas-maquinas">Como sincronizar duas máquinas?</h2>
<ul>
<li>Abordagem 1<ul>
<li>Copie os arquivos da fonte para o destino</li>
</ul>
</li>
<li>Abordagem 2<ul>
<li>Produza um hash do arquivo</li>
<li>Troque o hash com a outra máquina</li>
<li>Se hashes iguais, pronto.</li>
<li>Se hashes diferentes, copie o arquivo para a outra máquina.</li>
</ul>
</li>
<li>Abordagem 3 - Merkle Tree<sup id="fnref:madsmt"><a class="footnote-ref" href="#fn:madsmt">1</a></sup><ul>
<li>Divida o arquivo em blocos de mesmo tamanho</li>
<li>Faça um hash de cada bloco</li>
<li>Se mais de um hash gerado, <ul>
<li>Concatene hashes duas a duas; cada concatenação resulta em um novo bloco.</li>
<li>Repita o processo; os hashes resultantes correspondem a uma árvore<br />
<img alt="Merkle Tree" src="../drawings/merkle.drawio-0.svg" /></li>
</ul>
</li>
<li>Troque hashes da raiz.<ul>
<li>Se hashes iguais, pronto.</li>
<li>Se hashes diferentes troque hashes das raizes das subárvores e execute recursivamente.
<img alt="Merkle Tree" src="../drawings/merkle.drawio-1.svg" /></li>
</ul>
</li>
</ul>
</li>
</ul>
<details class="question"><summary>Se um byte é adicionado no meio do arquivo?</summary><p><img alt="Merkle Tree" src="../drawings/merkle.drawio-2.svg" /></p>
</details>
<p>A conclusão é que blocos com tamanho pré-definido são problemáticos e que precisamos de blocos definidos pelo conteúdo. Por exemplo, em um texto, uma possibilidade é definir um bloco como um período ou um parágrafo; se uma palavra é inserida no texto, , somente o bloco em que foi inserida é modificado e somente o hash do mesmo terá novo valor. Mas esta abordagem não é genérica, pois qual o correspondente em uma imagem ou um áudio ou em um arquivo <code>tgz</code>?</p>
<h2 id="rabin-fingerprinting">Rabin Fingerprinting</h2>
<div class="admonition todo">
<p class="admonition-title">Rabin Fingerprint</p>
<p><a href="https://en.wikipedia.org/wiki/Rolling_hash">Rolling Hash</a></p>
</div>
<h2 id="blockchain">Blockchain</h2>
<p>Uma cadeia de fornecimento (<em>supply chain</em>), temos, em vários níveis, <strong>Clientes</strong>, <strong>Vendedores</strong> e <strong>Fornecedores</strong>, que estabelecem <strong>contratos</strong> de bens e serviços.
A um consumidor seria interessante saber quem produziu o cacho de bananas que está comprando, se a produção é livre de trabalho escravo, se o transporte foi feito dentro de parâmetros corretos de temperatura, se não violou tratados de rotas marítimas para proteger baleias, e assim por diante. Essencialmente, seria interessante rastrear como o bem "bananas" foi transferido de mão em mão até chegar à feira livre. 
Há diversos tipos de <strong>bens</strong>, tangíveis (e.g., <strong>casa</strong>) e intangíveis (e.g., <strong>patente</strong>),  nominais (e.g., <strong>promissória</strong>) e ao portador (e.g., <strong>dinheiro "vivo"</strong>), etc.</p>
<p>As interações multipartido podem ser registradas em <strong>livros razão</strong> mantidos pelos independentemente pelos participantes, registrando cada troca bens envolvendo o participante responsável.
Esta abordagem <strong>dificilmente permitiria aos participantes ou auditores reconstruir todo o trajeto</strong>, que dirá um consumidor na ponta, além ser <strong>suscetível a modificações</strong>, intencionais ou não.</p>
<p><strong><em>Blockchains</em></strong> provêem um "livro razão" <strong>incorruptível</strong>, <strong>decentralizado</strong> e "facilmente" auditável.
Desde que Nakamoto introduziu a primeira <em>blockchain</em><sup id="fnref:nakamoto"><a class="footnote-ref" href="#fn:nakamoto">2</a></sup>, destinada a "rastrear" a troca de uma moeda digital, a <a href="https://bitcoin.org">bitcoin</a>, <a href="https://medium.com/wikidlt/a-complete-list-of-blockchain-platforms-2020-49cf01ee6688">diversas outras <em>blockchains</em></a> foram desenvolvidas, para diferentes usos e com diferentes funcionalidades.</p>
<p>Algumas características comuns, ou pelo menos desejáveis, das <em>blockchains</em> são</p>
<ul>
<li>Decentralizado - Replicado usando P2P e não facilmente subjugável. (Hyperledger, da IBM, não é.)</li>
<li>Consenso - acordo na transação</li>
<li>Proveniência - todo o histórico de um bem é mantido na <em>blockchain</em></li>
<li>Imutabilidade - entradas não podem ser alteradas</li>
<li>Finalidade - entradas não podem ser refutadas</li>
</ul>
<div class="admonition quote">
<p class="admonition-title">Bitcoin</p>
<p>Everything you don't understand about money, combined with everything you don't understand about technology.</p>
<p>Joh Oliver, Last Week Tonight, Março 2018.</p>
</div>
<p>Além disso, no mundo dos negócios, é interessante que possa usar a <strong>blockchain</strong> para diferentes tipos de bens (na <em>bitcoin</em>, só a <em>bitcoin</em>), que as partes sejam <strong>identificáveis</strong> (na <em>bitcoin</em>, os usuários são anônimos), e que não gaste muito energia (<em>bitcoin</em> usa <em>proof-of-work</em>, que gasta muita, muita energia).</p>
<p>Vejamos um <a href="https://andersbrownworth.com/blockchain/">exemplo de como uma blockchain funciona</a>.</p>
<p>Os termos do negócio são mantidos na blockchain: "Se na data X a entidade E não tiver transferido D dinheiros para a entidade F, então transfira o asset A de E para F."</p>
<p>Se quiser saber mais, consulte esta pequena <a href="https://www.paperdigest.org/2020/06/recent-papers-on-blockchain-bitcoin/">lista</a> artigos sobre <em>blockchain</em>.</p>
<p><img alt="" src="../images/bitcoin_jun_2018.png" /></p>
<details class="todo"><summary>Todo</summary><ul>
<li>Smart-contracts</li>
<li>proof-of-stake</li>
<li>grupos pequenos como certificadores.</li>
</ul>
</details>
<hr />
<h2 id="a-small-piece-of-big-data">A Small Piece of Big Data</h2>
<div class="admonition quote">
<p class="admonition-title"><a href="https://en.wikipedia.org/wiki/Big_data">Big-Data</a></p>
<p>Big data is a term for data sets that are so large or complex that traditional data processing application software is inadequate to deal with them.</p>
</div>
<p>Ciclo convencional:</p>
<ul>
<li>Coleta</li>
<li>Armazenamento</li>
<li>Análise</li>
<li>Consulta</li>
<li>Compartilhamento</li>
<li>Visualização</li>
<li>Atualização
...</li>
</ul>
<p>Áreas</p>
<p>Grandes massas de dados:</p>
<ul>
<li>Propaganda</li>
<li>Astronomia</li>
<li>Ciência</li>
<li>e-governos</li>
<li>meteorologia</li>
<li>genomics</li>
</ul>
<p>Dados
Internet das coisas
sensoriamento remoto
suas fotos
logs de software
RFID
redes de sensores
...</p>
<p>Quão grande é ``big'' o suficiente? 
Depende dos dados, ferramentas, e capacidade de manipulá-los. 
Uma vez dado um passo, o alvo passa a ser o próximo passo. 
Isso quer dizer que vai de alguns TB até Petabytes, dependendo do problema.</p>
<div class="admonition quote">
<p class="admonition-title">Gartner, 2012</p>
<p>Big data is high volume, high velocity, and/or high variety information assets that require new forms of processing to enable enhanced decision making, insight discovery and process optimization.</p>
<ul>
<li>Volume: incapacidade de armazenar todos os dados; apenas observe e guarde conclusões</li>
<li>Velocidade: dados passando em ``tempo real''</li>
<li>Variedade: imagens, vídeos, áudio, temperatura,...</li>
<li>Machine learning para automação de extração de informação, por exemplo, detecção de padrões, sem se preocupar com o porquê dos mesmos.</li>
</ul>
</div>
<p>Como lidar?</p>
<ul>
<li>Bancos de dados colunares</li>
<li>Stream DBs</li>
<li>MapReduce</li>
<li>...</li>
</ul>
<p>Google FS</p>
<ul>
<li>Google, 2003</li>
<li>File System</li>
<li>Dados recuperados da Internet usados em consultas</li>
<li>Milhões de arquivos de múltiplos GB</li>
<li>Chunks de 64MB (``blocos do disco'')</li>
<li>Operações comuns são appends ou reads</li>
<li>Servidores/discos/memórias estão sempre falhando</li>
<li>Centenas de clientes concorrentes no mesmo arquivo</li>
</ul>
<p><img alt="" src="../images/gfs3.png" /></p>
<p><img alt="" src="../images/gfs2.png" /></p>
<ul>
<li>Clusters de nós ``comuns''</li>
<li>Master node: metadata</li>
<li>Chunk servers: data</li>
<li>Permite usar um cluster como um único HD elástico na rede.</li>
</ul>
<p><a href="https://www.cs.rutgers.edu/~pxk/417/lectures/l-dfs.html">Fonte</a></p>
<p><img alt="" src="../images/gfs3.png" /></p>
<ul>
<li>Apps recebem \emph{leases} de acesso direto aos dados</li>
<li>Atomic commitment garante consistência entre réplicas</li>
</ul>
<p><a href="http://google-file-system.wikispaces.asu.edu/">Fonte</a></p>
<ul>
<li>
<p>Consistência 
<img alt="" src="../images/gfs6.png" /></p>
</li>
<li>
<p>Application sends the file name and data to the GFS client.</p>
</li>
<li>GFS Client send the file name and chunk index to master</li>
<li>Master sends the identity of the primary and other secondary replicas to the client.</li>
<li>Client caches this information. Client contacts master again only when primary is unreachable or it sends a reply saying it does not holds the lease anymore.</li>
<li>Considering the network topology the client sends the data to all the replicas.This improves performance. GFS separates data flow from the control flow. Replicas store the data in their LRU buffers till it is used.</li>
<li>After all replicas receiving of the data, client sends write request to the primary. Primary decides the mutation order. It applies this order to its local copy.</li>
<li>Primary sends the write request to all the secondary replicas. They perform write according to serial order decided by the primary.</li>
<li>After completing the operation all secondary acknowledge primary.</li>
<li>Primary replies the client about completion of the operation. In case of the errors that is when some of the secondary fail to write client request is supposed to be fail.This leaves modified chunk inconsistent. </li>
<li>Client handles this by retrying the failed mutation. </li>
</ul>
<p><a href="http://google-file-system.wikispaces.asu.edu/">Fonte</a></p>
<p>Map Reduce</p>
<ul>
<li>Google, 2004</li>
<li>Processamento distribuído</li>
<li>Processa arquivos no Google FS</li>
</ul>
<p><img alt="" src="../images/gfs4.png" /></p>
<p>Chubby</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>*  Google, 2006
![](../images/chubby1.png)
</code></pre></div>
</td></tr></table>
<p>Hadoop</p>
<ul>
<li>HDFS: Hadoop Distributed File System</li>
<li>Map Reduce</li>
<li>Yahoo!</li>
<li>Open source em 2011, 1.0.0</li>
<li>2012, 2.0.0,</li>
<li>2017, 3.0.0</li>
<li>nov 2018, 2.9.2</li>
</ul>
<p>Ecosistema</p>
<ul>
<li>Hive: data warehouse</li>
<li>Spark: </li>
<li>Kafka</li>
<li>Yarn</li>
<li>Pig: linguagem para especificação de data flow.</li>
<li>HBase: banco de dados estruturado</li>
<li>Sqoop</li>
<li>Flume</li>
<li>Oozie</li>
<li>Avro: serialização</li>
<li>Mahout: machine learning</li>
</ul>
<p>HDFS</p>
<ul>
<li>Distribuído</li>
<li>Escalável</li>
<li>Cost effective</li>
<li>Tolerante a falhas</li>
<li>Alta vazão</li>
</ul>
<p>Arquitetura</p>
<ul>
<li>Rack e rack failure</li>
<li>Top of rack switch</li>
<li>Core switch</li>
<li>Name Node: nomes das pastas e arquivos</li>
<li>Data Node: conteúdo dos arquivos</li>
<li>Cliente</li>
</ul>
<p>Arquitetura</p>
<ul>
<li>Crie arquivo: cliente -&gt; name node</li>
<li>Escreva um block (e.g., 128MB): cliente</li>
<li>Aloque block: cliente -&gt; name node</li>
<li>Salve os dados: cliente -&gt; data node</li>
<li>Heartbeat block report: data node -&gt; name node</li>
<li>Dados são replicados (RF configurado por arquivo): Data node -&gt; data node</li>
</ul>
<p>Name node</p>
<p>Dados em memory e edit log.</p>
<ul>
<li>Name node é um SPOF? </li>
<li>Quorum Journal Manager replica edit log.</li>
<li>Standby Name Node</li>
<li>Zookeeper usado para decidir quem é o líder</li>
<li>Secondary Name Node replica checkpoint da imagem em memória.</li>
</ul>
<p>MapReduce</p>
<ul>
<li>Programação funcional</li>
<li>Map: (map length (() (a) (a b c)) = (0 1 3))</li>
<li>Fold/Reduce: (reduce + (1 2 3)) = 6</li>
</ul>
<p>MapReduce</p>
<ul>
<li>Não há dependência entre os dados</li>
<li>Dados divididos em \emph{shards}</li>
<li>Execução paralela e distribuída</li>
<li>Trabalhador recebe um shard</li>
<li>Mestre agrega valores</li>
<li>Milhares de processos</li>
<li>Petabytes de dados</li>
</ul>
<p>MapReduce</p>
<ul>
<li>Shards são arquivos do GFS/HDFS/EC2</li>
<li>Função mapeada a cada shard</li>
<li>Resultado é lista de chaves e valores</li>
<li>Agregação acontece por chaves</li>
<li>Resultado são arquivos no GFS/HDFS/EC2</li>
</ul>
<p>MapReduce</p>
<p><img alt="" src="../images/mapreduce1.png" /></p>
<p><img alt="" src="../images/mapreduce2.png" /></p>
<p>Exemplo
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">...</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCount</span> 
<span class="p">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">TokenizerMapper</span> 
 <span class="kd">extends</span> <span class="n">Mapper</span><span class="o">&lt;</span><span class="n">Object</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">IntWritable</span><span class="o">&gt;</span>
 <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">IntWritable</span> <span class="n">one</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">Text</span> <span class="n">word</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Text</span><span class="p">();</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">map</span><span class="p">(</span><span class="n">Object</span> <span class="n">key</span><span class="p">,</span> <span class="n">Text</span> <span class="n">value</span><span class="p">,</span> <span class="n">Context</span> <span class="n">context</span><span class="p">)</span> 
   <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">InterruptedException</span> 
  <span class="p">{</span>
   <span class="n">StringTokenizer</span> <span class="n">itr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="na">hasMoreTokens</span><span class="p">())</span> 
   <span class="p">{</span>
    <span class="n">word</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">itr</span><span class="p">.</span><span class="na">nextToken</span><span class="p">());</span>
    <span class="n">context</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">one</span><span class="p">);</span>
   <span class="p">}</span>
  <span class="p">}</span> 
 <span class="p">}</span>
<span class="p">...</span>
</code></pre></div>
</td></tr></table></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="p">...</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">IntSumReducer</span> 
  <span class="kd">extends</span> <span class="n">Reducer</span><span class="o">&lt;</span><span class="n">Text</span><span class="p">,</span><span class="n">IntWritable</span><span class="p">,</span><span class="n">Text</span><span class="p">,</span><span class="n">IntWritable</span><span class="o">&gt;</span> 
 <span class="p">{</span> 
  <span class="kd">private</span> <span class="n">IntWritable</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IntWritable</span><span class="p">();</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">Text</span> <span class="n">key</span><span class="p">,</span> <span class="n">Iterable</span><span class="o">&lt;</span><span class="n">IntWritable</span><span class="o">&gt;</span> <span class="n">values</span><span class="p">,</span> <span class="n">Context</span> <span class="n">context</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">InterruptedException</span> 
  <span class="p">{</span>
   <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="k">for</span> <span class="p">(</span><span class="n">IntWritable</span> <span class="n">val</span> <span class="p">:</span> <span class="n">values</span><span class="p">)</span> 
    <span class="n">sum</span> <span class="o">+=</span> <span class="n">val</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
   <span class="n">result</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">sum</span><span class="p">);</span>
   <span class="n">context</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
  <span class="p">}</span>
 <span class="p">}</span>

 <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> 
 <span class="p">{</span>
  <span class="p">...</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p><a href="https://hadoop.apache.org/docs/current/hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html#Example:_WordCount_v1.0">Fonte</a></p>
<p><a href="https://youtu.be/DJPwV2ge9m0?list=PLkz1SCf5iB4dw3jbRo0SYCk2urRESUA3v">https://youtu.be/DJPwV2ge9m0?list=PLkz1SCf5iB4dw3jbRo0SYCk2urRESUA3v</a></p>
<h2 id="estudo-de-caso-kafka">Estudo de caso: Kafka</h2>
<p>![](../images/kafka0.png</p>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Kafka is a distributed streaming platform.</p>
</div>
<ul>
<li>LinkedIn</li>
<li>OpenSource em 2011</li>
<li>Projeto Apache em ????</li>
</ul>
<p><img alt="" src="../images/kafka1.png" /></p>
<p><img alt="" src="../images/kafka2.png" /></p>
<p>Producers x Message Broker x Consumers</p>
<p><img alt="" src="../images/kafka3.png" /></p>
<ul>
<li>Produtores: enviam dados/mensagens/records (array de bytes)</li>
<li>Consumidores: recebem dados</li>
<li>Cluster/Broker: distribuído e tolerantes a falhas.</li>
<li>Conectores: integração simplificada com outras aplicações </li>
<li>Stream processors: spark ou outros frameworks; transformam dados</li>
</ul>
<p>Brokers</p>
<ul>
<li>Cluster de brokers</li>
<li>Distribuído</li>
<li>Tolerante a falhas</li>
<li>Desacoplamento espacial</li>
<li>Desacoplamento temporal</li>
<li>Tópicos, não endereços</li>
</ul>
<p>Tópicos</p>
<ul>
<li>Nome de uma stream de dados: ordem de serviço, exame de sangue, MSFT</li>
<li>Quantidade pode ser imensa.</li>
</ul>
<p>Partição</p>
<ul>
<li>Subdivisões de tópicos</li>
<li>Número de partições é definido por usuário</li>
<li>Cada partição está associada a um único servidor</li>
</ul>
<p>Offset</p>
<ul>
<li>Índice de uma mensagem em uma partição</li>
<li>Índices atribuídos na ordem de chegada</li>
<li>Offsets são locais às partições</li>
<li>Mensagens são unicamente identificadas por (tópico, partição, índice)</li>
</ul>
<p><img alt="" src="../images/kafka4.png" /></p>
<p>Consumer group</p>
<ul>
<li>Carga pode ser muito grande para um consumidor</li>
<li>Compartilham o processamento de um tópico</li>
<li>Cada mensagem é processada por um membro do grupo</li>
<li>A mesma mensagem pode ser processada por múltiplos grupos</li>
<li>Número de consumidores <span class="arithmatex">\(\leq\)</span> partições no tópico</li>
<li>Máximo de dois consumidores por partição (mantem pos. de cada um)</li>
</ul>
<p><img alt="" src="../images/kafka5.png" /></p>
<p>Siga o <a href="http://kafka.apache.org/quickstart">tutorial</a>, até o passo 5.</p>
<ul>
<li>Baixe e descompacte</li>
<li>Rode o zookeeper (Terminal 1)</li>
<li>Rode o Kafka (Terminal 2)</li>
<li>Crie um tópico (Terminal 3) - 
        Mais de uma partição em um servidor</li>
<li>Conecte-se ao Zookeeper e dê uma olhada. O que está vendo?</li>
<li>Liste os tópicos criados</li>
<li>Envie algumas mensagens</li>
<li>Inicie um consumidor (Terminal 4)</li>
</ul>
<div class="footnote">
<hr />
<ol>
<li id="fn:madsmt">
<p><a href="http://www.slideshare.net/quipo/modern-algorithms-and-data-structures-1-bloom-filters-merkle-trees">Modern Algorithms and Data Structures: Merkle Trees</a>&#160;<a class="footnote-backref" href="#fnref:madsmt" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:nakamoto">
<p><a href="https://bitcoin.org/bitcoin.pdf">Bitcoin: A Peer-to-Peer Electronic Cash System</a>&#160;<a class="footnote-backref" href="#fnref:nakamoto" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>

  <!-- Last update of source file -->


              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copiar para \u00e1rea de transfer\u00eancia", "clipboard.copied": "Copiado para \u00e1rea de transfer\u00eancia", "search.config.lang": "pt", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Buscar", "search.result.placeholder": "Digite para iniciar a busca", "search.result.none": "Nenhum resultado encontrado", "search.result.one": "1 resultado encontrado", "search.result.other": "# resultados encontrados", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://unpkg.com/mermaid@8.5.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../javascripts/mathjaxhelper.js"></script>
      
    
  </body>
</html>